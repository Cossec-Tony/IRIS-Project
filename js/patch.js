(()=>{var fe={};(()=>{fe.d=(e,t)=>{for(var i in t){if(fe.o(t,i)&&!fe.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{fe.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{fe.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var ge={};(()=>{"use strict";fe.r(ge);fe.d(ge,{Anim:()=>h,AnimKey:()=>l,CONSTANTS:()=>u,EMBED:()=>F,Link:()=>I,LoadingStatus:()=>S,Op:()=>w,Patch:()=>y,PatchVariable:()=>ne,Port:()=>O,Profiler:()=>N,RenderLoop:()=>he,Timer:()=>R,default:()=>ce,now:()=>C,utils:()=>e});var e={};fe.r(e);fe.d(e,{ajax:()=>T,basename:()=>W,cacheBust:()=>E,clamp:()=>_,cleanJson:()=>c,copyArray:()=>A,escapeHTML:()=>re,filename:()=>K,float32Concat:()=>q,generateUUID:()=>o,getShortOpName:()=>i,isNumeric:()=>x,logErrorConsole:()=>J,logStack:()=>Z,map:()=>v,prefixedHash:()=>p,request:()=>Q,shortId:()=>b,shuffleArray:()=>r,simpleId:()=>g,smoothStep:()=>d,smootherStep:()=>m,uniqueArray:()=>$,uuid:()=>a});class k{constructor(e,t,i,r){this.targetObj=e;this.id=t;this.eventName=i;this.cb=r}remove(){this.targetObj.off(this.id)}}class D{constructor(){this._simpleIdCounter=0}uuid(){let i=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=(i+Math.random()*16)%16|0;i=Math.floor(i/16);return(e==="x"?t:t&3|8).toString(16)})}isNumeric(e){const t=parseFloat(e);return!isNaN(t)&&isFinite(t)}simpleId(){this._simpleIdCounter++;return this._simpleIdCounter}pathLookup(e,t){const i=t.split(".");if(i.length==1){return e[i[0]]}return this.pathLookup(e[i[0]],i.slice(1).join("."))}}const U=new D;class n{constructor(e,t){this.initiator=e;this._options=t;if(!this.initiator){console.error("no log initator given");CABLES.logStack()}}stack(e){console.info("["+this.initiator+"] ",e);console.log((new Error).stack)}groupCollapsed(e){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.log("["+this.initiator+"]",...arguments);console.groupCollapsed("["+this.initiator+"] "+e)}table(e){console.table(e)}groupEnd(){console.groupEnd()}error(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:2},...arguments)||!CABLES.UI){console.error("["+this.initiator+"]",...arguments)}if(this._options&&this._options.onError){this._options.onError(this.initiator,...arguments)}}errorGui(){if(CABLES.UI)CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:2},...arguments)}warn(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:1},...arguments)||!CABLES.logSilent)console.warn("["+this.initiator+"]",...arguments)}verbose(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.log("["+this.initiator+"]",...arguments)}info(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.info("["+this.initiator+"]",...arguments)}log(){if(CABLES.UI&&CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)||!CABLES.logSilent)console.log("["+this.initiator+"]",...arguments)}logGui(){if(CABLES.UI)CABLES.UI.logFilter.filterLog({initiator:this.initiator,level:0},...arguments)}userInteraction(e){}}class t{#eventLog=new n("eventtarget");#listeners={};#logEvents=false;#logName="";#eventCallbacks={};#countErrorUnknowns=0;eventsPaused=false;constructor(){}on(e,t,i=""){const r=(i||"")+U.simpleId();const n=new k(this,r,e,t);if(!this.#eventCallbacks[e])this.#eventCallbacks[e]=[n];else this.#eventCallbacks[e].push(n);this.#listeners[n.id]=n;return n}removeAllEventListeners(){for(const e in this.#listeners){this.off(this.#listeners[e])}}addEventListener(e,t,i=""){return this.on(e,t,i)}hasEventListener(e,t=null){if(e&&!t){if(typeof e=="string")return!!this.#listeners[e];else return!!this.#listeners[e.id]}else{this.#eventLog.warn("old eventtarget function haseventlistener!");if(e&&t){if(this.#eventCallbacks[e]){const i=this.#eventCallbacks[e].indexOf(t);return i!==-1}}}}hasListenerForEventName(e){return this.#eventCallbacks[e]&&this.#eventCallbacks[e].length>0}removeEventListener(e){return this.off(e)}off(e){if(e===null||e===undefined){this.#eventLog.warn("removeEventListener id null",e);return}let i=e;if(e.eventName)i=e.id;if(typeof i!="string"){console.log("old function signature: removeEventListener! use listener id");return}const r=this.#listeners[i];if(!r){if(this.#countErrorUnknowns==20)this.#eventLog.warn("stopped reporting unknown events");if(this.#countErrorUnknowns<20)this.#eventLog.warn("could not find event...",i,r);this.#countErrorUnknowns++;return}let n=0;let s=true;while(s){s=false;let t=-1;for(let e=0;e<this.#eventCallbacks[r.eventName].length;e++){if(this.#eventCallbacks[r.eventName][e].id.indexOf(i)===0){s=true;t=e}}if(t!==-1){this.#eventCallbacks[r.eventName].splice(t,1);delete this.#listeners[i];n++}}if(n==0)console.log("no events removed",r.eventName,i);return}logEvents(e,t){this.#logEvents=e;this.#logName=t}emitEvent(t,i=null,r=null,n=null,s=null,a=null,o=null,l=null,u=null){if(this.eventsPaused)return;if(this.#logEvents)this.#eventLog.log("[event] ",this.#logName,t,this.#eventCallbacks);if(this.#eventCallbacks[t]){for(let e=0;e<this.#eventCallbacks[t].length;e++){if(this.#eventCallbacks[t][e]){this.#eventCallbacks[t][e].cb(i,r,n,s,a,o,l,u)}}}else{if(this.#logEvents)this.#eventLog.log("[event] has no event callback",t,this.#eventCallbacks)}}}class l{anim=null;id=CABLES.simpleId();time=0;value=0;onChange=null;_easing=0;bezCp1=null;bezCp2=null;bezAn=null;cb=null;cbTriggered=false;temp={};uiAttribs={};clip=null;clipId=null;constructor(e,t){this.anim=e.anim||t||null;this.setEasing(h.EASING_LINEAR);this.set(e)}setClip(e,t){this.clipId=e;this.clip=t;if(this.anim)this.anim.emitEvent(h.EVENT_CHANGE)}emitChange(){if(this.anim.batchMode)return;if(!this.anim)return;this.bezAn=null;if(this.onChange!==null)this.onChange();this.anim.forceChangeCallbackSoon();for(let e=0;e<this.anim.keys.length;e++)this.anim.keys[e].bezAn=null}delete(){if(this.anim)this.anim.remove(this);else console.log("animkey without anim...")}setUiAttribs(t){for(const e in t){this.uiAttribs[e]=t[e];if(t[e]===null)delete this.uiAttribs[e]}if(this.anim)this.anim.emitEvent(h.EVENT_CHANGE)}setEasing(e){if(this.anim.uiAttribs.readOnly)return;if(this.anim.uiAttribs.muted)return;let t=false;if(this._easing!=e)t=true;this._easing=e;if(this._easing!=h.EASING_CLIP){this.clipId="";this.clip=null}if(this._easing==h.EASING_LINEAR)this.ease=this.easeLinear;else if(this._easing==h.EASING_ABSOLUTE)this.ease=this.easeAbsolute;else if(this._easing==h.EASING_SMOOTHSTEP)this.ease=l.easeSmoothStep;else if(this._easing==h.EASING_SMOOTHERSTEP)this.ease=l.easeSmootherStep;else if(this._easing==h.EASING_CUBIC_IN)this.ease=l.easeCubicIn;else if(this._easing==h.EASING_CUBIC_OUT)this.ease=l.easeCubicOut;else if(this._easing==h.EASING_CUBIC_INOUT)this.ease=l.easeCubicInOut;else if(this._easing==h.EASING_EXPO_IN)this.ease=l.easeExpoIn;else if(this._easing==h.EASING_EXPO_OUT)this.ease=l.easeExpoOut;else if(this._easing==h.EASING_EXPO_INOUT)this.ease=l.easeExpoInOut;else if(this._easing==h.EASING_SIN_IN)this.ease=l.easeSinIn;else if(this._easing==h.EASING_SIN_OUT)this.ease=l.easeSinOut;else if(this._easing==h.EASING_SIN_INOUT)this.ease=l.easeSinInOut;else if(this._easing==h.EASING_BACK_OUT)this.ease=l.easeOutBack;else if(this._easing==h.EASING_BACK_IN)this.ease=l.easeInBack;else if(this._easing==h.EASING_BACK_INOUT)this.ease=l.easeInOutBack;else if(this._easing==h.EASING_ELASTIC_IN)this.ease=l.easeInElastic;else if(this._easing==h.EASING_ELASTIC_OUT)this.ease=l.easeOutElastic;else if(this._easing==h.EASING_BOUNCE_IN)this.ease=l.easeInBounce;else if(this._easing==h.EASING_BOUNCE_OUT)this.ease=l.easeOutBounce;else if(this._easing==h.EASING_QUART_OUT)this.ease=l.easeOutQuart;else if(this._easing==h.EASING_QUART_IN)this.ease=l.easeInQuart;else if(this._easing==h.EASING_QUART_INOUT)this.ease=l.easeInOutQuart;else if(this._easing==h.EASING_QUINT_OUT)this.ease=l.easeOutQuint;else if(this._easing==h.EASING_QUINT_IN)this.ease=l.easeInQuint;else if(this._easing==h.EASING_QUINT_INOUT)this.ease=l.easeInOutQuint;else if(this._easing==h.EASING_CLIP)this.ease=this.easeAbsolute;else if(this._easing==h.EASING_CUBICSPLINE){if(this.ease!=this.easeCubicSpline){this.ease=this.easeCubicSpline;this.bezReset()}this.bezAn=null}else{this._easing=h.EASING_LINEAR;this.ease=this.easeLinear}if(t)this.emitChange()}bezReset(){let e=.5;const t=this.anim.getPrevKey(this.time);if(t)e=(this.time-t.time)/2;let i=.5;const r=this.anim.getNextKey(this.time);if(r)i=(r.time-this.time)/2;this.bezCp1=[-Math.min(e,i),0];this.bezCp2=[Math.min(e,i),0];this.emitChange()}trigger(){this.cb();this.cbTriggered=true}setValue(e){this.value=e;this.emitChange()}setBezCp1(e,t){this.bezCp1=[e,t];this.emitChange()}setBezCp2(e,t){this.bezCp2=[e,t];this.emitChange()}set(e){if(e){if(e.hasOwnProperty("e"))this.setEasing(e.e);if(e.cb){this.cb=e.cb;this.cbTriggered=false}if(e.hasOwnProperty("cp1")){this.bezCp1=e.cp1;this.bezCp2=e.cp2}if(e.hasOwnProperty("t"))this.time=e.t;if(e.hasOwnProperty("time"))this.time=e.time;if(e.hasOwnProperty("v"))this.value=e.v;else if(e.hasOwnProperty("value"))this.value=e.value;if(e.hasOwnProperty("uiAttribs"))this.setUiAttribs(e.uiAttribs);if(e.clipId)this.clipId=e.clipId}this.emitChange()}getSerialized(){const e={};e.t=this.time;e.v=this.value;e.e=this._easing;e.uiAttribs=this.uiAttribs;if(this.clipId)e.clipId=this.clipId;if(this._easing===h.EASING_CUBICSPLINE){e.cp1=this.bezCp1;e.cp2=this.bezCp2}return e}getEasing(){return this._easing}easeCubicSpline(e,t){if(!this.bezAn){const i=30;this.bezAn=new h;for(let e=0;e<=i+1;e++){const r=l.cubicSpline(e/i,this,t);this.bezAn.setValue(r[0],r[1])}}return this.bezAn.getValue(this.time+e*(t.time-this.time))}easeLinear(e,t){return l.linear(e,this,t)}easeAbsolute(){return this.value}}l.cubicSpline=function(e,t,i){const r=1-e;const n=r*r;const s=e*e;const a=n*r;const o=3*n*e;const l=3*r*s;const u=s*e;t.bezCp1=t.bezCp1||[-.5,0];t.bezCp2=t.bezCp2||[.5,0];i.bezCp1=i.bezCp1||[-.5,0];i.bezCp2=i.bezCp2||[.5,0];const h=Math.min(i.time,t.bezCp2[0]+t.time);const c=Math.max(t.time,i.bezCp1[0]+i.time);const f=a*t.time+o*h+l*c+u*i.time;const g=a*t.value+o*(t.bezCp2[1]+t.value)+l*(i.bezCp1[1]+i.value)+u*i.value;return[f,g]};l.linear=function(e,t,i){return t.value+(i.value-t.value)*e};const B=function(e){return e=2**(10*(e-1))};l.easeExpoIn=function(e,t){e=B(e);return l.linear(e,this,t)};const V=function(e){e=-(2**(-10*e))+1;return e};l.easeExpoOut=function(e,t){e=V(e);return l.linear(e,this,t)};const j=function(e){e*=2;if(e<1){e=.5*2**(10*(e-1))}else{e--;e=.5*(-(2**(-10*e))+2)}return e};l.easeExpoInOut=function(e,t){e=j(e);return l.linear(e,this,t)};l.easeSinIn=function(e,t){e=-1*Math.cos(e*Math.PI/2)+1;return l.linear(e,this,t)};l.easeSinOut=function(e,t){e=Math.sin(e*Math.PI/2);return l.linear(e,this,t)};l.easeSinInOut=function(e,t){e=-.5*(Math.cos(Math.PI*e)-1);return l.linear(e,this,t)};const G=function(e){e=e*e*e;return e};l.easeCubicIn=function(e,t){e=G(e);return l.linear(e,this,t)};l.easeInQuint=function(e,t){e=e*e*e*e*e;return l.linear(e,this,t)};l.easeOutQuint=function(e,t){e=(e-=1)*e*e*e*e+1;return l.linear(e,this,t)};l.easeInOutQuint=function(e,t){if((e/=.5)<1)e=.5*e*e*e*e*e;else e=.5*((e-=2)*e*e*e*e+2);return l.linear(e,this,t)};l.easeInQuart=function(e,t){e=e*e*e*e;return l.linear(e,this,t)};l.easeOutQuart=function(e,t){e=-1*((e-=1)*e*e*e-1);return l.linear(e,this,t)};l.easeInOutQuart=function(e,t){if((e/=.5)<1)e=.5*e*e*e*e;else e=-.5*((e-=2)*e*e*e-2);return l.linear(e,this,t)};l.bounce=function(e){if((e/=1)<1/2.75)e=7.5625*e*e;else if(e<2/2.75)e=7.5625*(e-=1.5/2.75)*e+.75;else if(e<2.5/2.75)e=7.5625*(e-=2.25/2.75)*e+.9375;else e=7.5625*(e-=2.625/2.75)*e+.984375;return e};l.easeInBounce=function(e,t){return l.linear(l.bounce(e),this,t)};l.easeOutBounce=function(e,t){return l.linear(l.bounce(e),this,t)};l.easeInElastic=function(e,t){let i=1.70158;let r=0;let n=1;const s=0;const a=1;const o=1;if(e===0)e=s;else if((e/=a)==1)e=s+o;else{if(!r)r=a*.3;if(n<Math.abs(o)){n=o;i=r/4}else i=r/(2*Math.PI)*Math.asin(o/n);e=-(n*2**(10*(e-=1))*Math.sin((e*a-i)*(2*Math.PI)/r))+s}return l.linear(e,this,t)};l.easeOutElastic=function(e,t){let i=1.70158;let r=0;let n=1;const s=0;const a=1;const o=1;if(e===0)e=s;else if((e/=a)==1)e=s+o;else{if(!r)r=a*.3;if(n<Math.abs(o)){n=o;i=r/4}else i=r/(2*Math.PI)*Math.asin(o/n);e=n*2**(-10*e)*Math.sin((e*a-i)*(2*Math.PI)/r)+o+s}return l.linear(e,this,t)};l.easeInBack=function(e,t){const i=1.70158;e=e*e*((i+1)*e-i);return l.linear(e,this,t)};l.easeOutBack=function(e,t){const i=1.70158;e=(e=e/1-1)*e*((i+1)*e+i)+1;return l.linear(e,this,t)};l.easeInOutBack=function(e,t){let i=1.70158;const r=1/2;if((e/=1/2)<1)e=r*(e*e*(((i*=1.525)+1)*e-i));else e=r*((e-=2)*e*(((i*=1.525)+1)*e+i)+2);return l.linear(e,this,t)};const z=function(e){e--;e=e*e*e+1;return e};l.easeCubicOut=function(e,t){e=z(e);return l.linear(e,this,t)};const H=function(e){e*=2;if(e<1)e=.5*e*e*e;else{e-=2;e=.5*(e*e*e+2)}return e};l.easeCubicInOut=function(e,t){e=H(e);return l.linear(e,this,t)};l.easeSmoothStep=function(e,t){const i=Math.max(0,Math.min(1,e));e=i*i*(3-2*i);return l.linear(e,this,t)};l.easeSmootherStep=function(e,t){const i=Math.max(0,Math.min(1,(e-0)/(1-0)));e=i*i*i*(i*(i*6-15)+10);return l.linear(e,this,t)};let X={};class h extends t{static EVENT_KEY_DELETE="keyDelete";static EVENT_CHANGE="onChange";static EVENT_UIATTRIB_CHANGE="uiattrchange";static LOOP_OFF=0;static LOOP_REPEAT=1;static LOOP_MIRROR=2;static LOOP_OFFSET=3;static EASING_LINEAR=0;static EASING_ABSOLUTE=1;static EASING_SMOOTHSTEP=2;static EASING_SMOOTHERSTEP=3;static EASING_CUBICSPLINE=4;static EASING_CUBIC_IN=5;static EASING_CUBIC_OUT=6;static EASING_CUBIC_INOUT=7;static EASING_EXPO_IN=8;static EASING_EXPO_OUT=9;static EASING_EXPO_INOUT=10;static EASING_SIN_IN=11;static EASING_SIN_OUT=12;static EASING_SIN_INOUT=13;static EASING_BACK_IN=14;static EASING_BACK_OUT=15;static EASING_BACK_INOUT=16;static EASING_ELASTIC_IN=17;static EASING_ELASTIC_OUT=18;static EASING_BOUNCE_IN=19;static EASING_BOUNCE_OUT=21;static EASING_QUART_IN=22;static EASING_QUART_OUT=23;static EASING_QUART_INOUT=24;static EASING_QUINT_IN=25;static EASING_QUINT_OUT=26;static EASING_QUINT_INOUT=27;static EASING_CLIP=28;static EASINGNAMES=["linear","absolute","smoothstep","smootherstep","Cubic In","Cubic Out","Cubic In Out","Expo In","Expo Out","Expo In Out","Sin In","Sin Out","Sin In Out","Quart In","Quart Out","Quart In Out","Quint In","Quint Out","Quint In Out","Back In","Back Out","Back In Out","Elastic In","Elastic Out","Bounce In","Bounce Out","Clip"];#tlActive=true;uiAttribs={};loop=0;onLooped=null;_timesLooped=0;#needsSort=false;_cachedIndex=0;port=null;keys=[];onChange=null;stayInTimeline=false;batchMode=false;constructor(e={}){super();e=e||{};this.id=a();this._log=new n("Anim");this.name=e.name||null;this.defaultEasing=e.defaultEasing||h.EASING_LINEAR}forceChangeCallback(){if(this.onChange!==null)this.onChange();this.emitEvent(h.EVENT_CHANGE,this)}forceChangeCallbackSoon(){if(this.batchMode)return;if(!this.forcecbto)this.forcecbto=setTimeout(()=>{this.forceChangeCallback();this.forcecbto=null},50)}getLoop(){return this.loop}setLoop(e){if(e===false)e=0;if(e===true)e=1;this.loop=e;this.emitEvent(h.EVENT_CHANGE,this)}hasEnded(e){if(this.#needsSort)this.sortKeys();if(this.keys.length===0)return true;if(this.keys[this.keys.length-1].time<=e)return true;return false}hasStarted(e){if(this.#needsSort)this.sortKeys();if(this.keys.length===0)return false;if(e>=this.keys[0].time)return true;return false}isRising(e){if(this.#needsSort)this.sortKeys();if(this.hasEnded(e))return false;const t=this.getKeyIndex(e);if(this.keys[t].value<this.keys[t+1].value)return true;return false}clearBefore(e){if(this.#needsSort)this.sortKeys();const t=this.getValue(e);const i=this.getKeyIndex(e);this.setValue(e,t);if(i>1){this.keys.splice(0,i);this.#needsSort=true}}clear(e){if(this.#needsSort)this.sortKeys();let t=0;if(e)t=this.getValue(e);for(let e=0;e<this.keys.length;e++)this.emitEvent(h.EVENT_KEY_DELETE,this.keys[e]);this.keys.length=0;if(e)this.setValue(e,t);this.#needsSort=true;if(this.onChange!==null)this.onChange();this.emitEvent(h.EVENT_CHANGE,this)}checkIsSorted(){let t=true;for(let e=0;e<this.keys.length-1;e++)if(this.keys[e].time>this.keys[e+1].time){t=false;break}return t}sortKeys(){if(this.batchMode)return;if(!this.checkIsSorted()){this.keys.sort((e,t)=>{return e.time-t.time});this.#needsSort=false;if(this.keys.length>999&&this.keys.length%1e3==0)console.log(this.name,this.keys.length);this.emitEvent(h.EVENT_CHANGE)}}hasDuplicates(){const t={};let i=0;for(let e=0;e<this.keys.length;e++){t[this.keys[e].time]=1;i++}const e=Object.keys(t);if(e.length!=i){return true}return false}removeDuplicates(){if(this.hasDuplicates()){if(this.#needsSort)this.sortKeys();let t=0;while(this.hasDuplicates()){for(let e=0;e<this.keys.length-1;e++){if(this.keys[e].time==this.keys[e+1].time){const i=this.keys[e];this.keys.splice(e,1);this.emitEvent(h.EVENT_KEY_DELETE,i)}t++}}this.#needsSort=true}}getLengthLoop(){if(this.#needsSort)this.sortKeys();if(this.keys.length<2)return 0;return this.lastKey.time-this.firstKey.time}getLength(){if(this.#needsSort)this.sortKeys();if(this.keys.length===0)return 0;return this.lastKey.time}getKeyIndex(t){if(this.#needsSort)this.sortKeys();let i=0;let r=0;if(this._cachedIndex&&this.keys.length>this._cachedIndex&&t>=this.keys[this._cachedIndex].time)r=this._cachedIndex;for(let e=r;e<this.keys.length;e++){if(t>=this.keys[e].time)i=e;if(this.keys[e].time>t){if(t!=0)this._cachedIndex=i;return i}}return i}setValue(t,i,r=null){if(isNaN(i))CABLES.logStack();if(this.#needsSort)this.sortKeys();let n=null;if(!this.batchMode)if(this.keys.length==0||t<=this.lastKey.time)for(let e=0;e<this.keys.length;e++)if(this.keys[e].time==t){n=this.keys[e];this.keys[e].setValue(i);this.keys[e].cb=r;break}if(!n){n=new l({time:t,value:i,e:this.defaultEasing,cb:r,anim:this});this.keys.push(n)}if(!this.batchMode){if(this.onChange)this.onChange();this.emitEvent(h.EVENT_CHANGE,this);this.#needsSort=true}return n}setKeyEasing(e,t){if(this.keys[e]){this.keys[e].setEasing(t);this.emitEvent(h.EVENT_CHANGE,this)}}deserialize(t,e,i){if(t.loop)this.loop=t.loop;if(t.tlActive)this.#tlActive=t.tlActive;if(t.height)this.uiAttribs.height=t.height;if(e){while(this.keys.length)this.keys[0].delete();this.keys.length=0}for(const r in t.keys){let e=new l(t.keys[r],this);this.keys.push(e);if(i)if(t.keys[r].clipId){i[t.keys[r].clipId]=i[t.keys[r].clipId]||[];if(i)i[t.keys[r].clipId].push(e)}}this.sortKeys()}getSerialized(){const t={};t.keys=[];t.loop=this.loop;if(this.#tlActive)t.tlActive=this.tlActive;if(this.uiAttribs.height)t.height=this.uiAttribs.height;for(let e=0;e<this.keys.length;e++)t.keys.push(this.keys[e].getSerialized());return t}getKey(e){if(this.#needsSort)this.sortKeys();const t=this.getKeyIndex(e);return this.keys[t]}getNextKey(e){if(this.#needsSort)this.sortKeys();let t=this.getKeyIndex(e)+1;if(t>=this.keys.length)return null;return this.keys[t]}getPrevKey(e){if(this.#needsSort)this.sortKeys();let t=this.getKeyIndex(e)-1;if(t<0)return null;return this.keys[t]}isFinished(e){if(this.#needsSort)this.sortKeys();if(this.keys.length<=0)return true;return e>this.lastKey.time}isStarted(e){if(this.#needsSort)this.sortKeys();if(this.keys.length<=0)return false;return e>=this.firstKey.time}remove(t,i){for(let e=0;e<this.keys.length;e++){if(this.keys[e]==t){this.emitEvent(h.EVENT_KEY_DELETE,this.keys[e]);this.keys.splice(e,1);this.#needsSort=true;if(i===undefined){this.emitEvent(h.EVENT_CHANGE,this)}return}}}get lastKey(){if(this.#needsSort)this.sortKeys();return this.keys[this.keys.length-1]}get firstKey(){if(this.#needsSort)this.sortKeys();return this.keys[0]}getLoopIndex(e){if(this.#needsSort)this.sortKeys();if(this.keys.length<2)return 0;return(e-this.firstKey.time)/this.getLengthLoop()}getValue(e=0){let t=0;if(this.keys.length===0)return 0;if(this.#needsSort)this.sortKeys();if(!this.loop&&e>this.lastKey.time){if(this.lastKey.cb&&!this.lastKey.cbTriggered)this.lastKey.trigger();return this.lastKey.value}if(e<this.firstKey.time)return this.keys[0].value;if(this.loop&&this.keys.length>1&&e>this.lastKey.time){const o=this.getLoopIndex(e);if(o>this._timesLooped){this._timesLooped++;if(this.onLooped)this.onLooped()}e=(e-this.firstKey.time)%this.getLengthLoop();if(this.loop==h.LOOP_REPEAT){}else if(this.loop==h.LOOP_MIRROR){if(Math.floor(o)%2==1)e=this.getLengthLoop()-e}else if(this.loop==h.LOOP_OFFSET){t=(this.lastKey.value-this.keys[0].value)*Math.floor(o)}e+=this.firstKey.time}const i=this.getKeyIndex(e);if(i>=this.keys.length-1){if(this.lastKey.cb&&!this.lastKey.cbTriggered)this.lastKey.trigger();return this.lastKey.value}const r=i+1;const n=this.keys[i];const s=this.keys[r];if(n.cb&&!n.cbTriggered)n.trigger();if(!s)return-1;const a=(e-n.time)/(s.time-n.time);if(n.getEasing()==h.EASING_CLIP){if(!n.clip&&this.port){const l=this.port.op.patch;const u=l.getVar(n.clipId)?.getValue();if(u)n.clip=u}if(n.clip&&n.clip.getValue){return n.clip.getValue(a*n.clip.getLength())}else{console.log("no clip found")}}return n.ease(a,s)+t}addKey(e){if(e.time===undefined){this._log.warn("key time undefined, ignoring!")}else{this.keys.push(e);if(this.onChange!==null)this.onChange();this.emitEvent(h.EVENT_CHANGE,this);this.#needsSort=true}}sortSoon(){this.#needsSort=true}easingFromString(e){if(e=="linear")return h.EASING_LINEAR;if(e=="absolute")return h.EASING_ABSOLUTE;if(e=="smoothstep")return h.EASING_SMOOTHSTEP;if(e=="smootherstep")return h.EASING_SMOOTHERSTEP;if(e=="Cubic In")return h.EASING_CUBIC_IN;if(e=="Cubic Out")return h.EASING_CUBIC_OUT;if(e=="Cubic In Out")return h.EASING_CUBIC_INOUT;if(e=="Expo In")return h.EASING_EXPO_IN;if(e=="Expo Out")return h.EASING_EXPO_OUT;if(e=="Expo In Out")return h.EASING_EXPO_INOUT;if(e=="Sin In")return h.EASING_SIN_IN;if(e=="Sin Out")return h.EASING_SIN_OUT;if(e=="Sin In Out")return h.EASING_SIN_INOUT;if(e=="Back In")return h.EASING_BACK_IN;if(e=="Back Out")return h.EASING_BACK_OUT;if(e=="Back In Out")return h.EASING_BACK_INOUT;if(e=="Elastic In")return h.EASING_ELASTIC_IN;if(e=="Elastic Out")return h.EASING_ELASTIC_OUT;if(e=="Bounce In")return h.EASING_BOUNCE_IN;if(e=="Bounce Out")return h.EASING_BOUNCE_OUT;if(e=="Quart Out")return h.EASING_QUART_OUT;if(e=="Quart In")return h.EASING_QUART_IN;if(e=="Quart In Out")return h.EASING_QUART_INOUT;if(e=="Quint Out")return h.EASING_QUINT_OUT;if(e=="Quint In")return h.EASING_QUINT_IN;if(e=="Quint In Out")return h.EASING_QUINT_INOUT;console.log("unknown anim easing?",e)}createPort(e,t,i){const r=e.inDropDown(t,h.EASINGNAMES,"linear");r.set("linear");r.defaultValue=0;r.onChange=()=>{this.defaultEasing=this.easingFromString(r.get());this.emitEvent("onChangeDefaultEasing",this);if(i)i()};return r}get tlActive(){return this.#tlActive}set tlActive(e){if(CABLES.UI){this.#tlActive=e;window.gui.emitEvent("tlActiveChanged",this);this.forceChangeCallbackSoon()}}setUiAttribs(t){for(const e in t){this.uiAttribs[e]=t[e];if(t[e]===null)delete this.uiAttribs[e]}this.emitEvent(h.EVENT_UIATTRIB_CHANGE)}hasKeyframesBetween(t,i){for(let e=0;e<this.keys.length;e++)if(this.keys[e].time>=t&&this.keys[e].time<=i)return true;return false}static initClipsFromVars(i){for(const t in i.missingClipAnims){const r=i.getVar(t);for(let e=0;e<i.missingClipAnims[t].length;e++){i.missingClipAnims[t].clip=r.getValue();delete i.missingClipAnims[t]}}}}const u={ANIM:{EASINGS:h.EASINGNAMES,EASING_LINEAR:0,EASING_ABSOLUTE:1,EASING_SMOOTHSTEP:2,EASING_SMOOTHERSTEP:3,EASING_CUBICSPLINE:4,EASING_CUBIC_IN:5,EASING_CUBIC_OUT:6,EASING_CUBIC_INOUT:7,EASING_EXPO_IN:8,EASING_EXPO_OUT:9,EASING_EXPO_INOUT:10,EASING_SIN_IN:11,EASING_SIN_OUT:12,EASING_SIN_INOUT:13,EASING_BACK_IN:14,EASING_BACK_OUT:15,EASING_BACK_INOUT:16,EASING_ELASTIC_IN:17,EASING_ELASTIC_OUT:18,EASING_BOUNCE_IN:19,EASING_BOUNCE_OUT:21,EASING_QUART_IN:22,EASING_QUART_OUT:23,EASING_QUART_INOUT:24,EASING_QUINT_IN:25,EASING_QUINT_OUT:26,EASING_QUINT_INOUT:27,EASING_CLIP:28},OP:{OP_PORT_TYPE_VALUE:0,OP_PORT_TYPE_NUMBER:0,OP_PORT_TYPE_FUNCTION:1,OP_PORT_TYPE_TRIGGER:1,OP_PORT_TYPE_OBJECT:2,OP_PORT_TYPE_TEXTURE:2,OP_PORT_TYPE_ARRAY:3,OP_PORT_TYPE_DYNAMIC:4,OP_PORT_TYPE_STRING:5,OP_VERSION_PREFIX:"_v"},PORT:{PORT_DIR_IN:0,PORT_DIR_OUT:1},PACO:{PACO_CLEAR:0,PACO_VALUECHANGE:1,PACO_OP_DELETE:2,PACO_UNLINK:3,PACO_LINK:4,PACO_LOAD:5,PACO_OP_CREATE:6,PACO_OP_ENABLE:7,PACO_OP_DISABLE:8,PACO_UIATTRIBS:9,PACO_VARIABLES:10,PACO_TRIGGERS:11,PACO_PORT_SETVARIABLE:12,PACO_PORT_SETANIMATED:13,PACO_PORT_ANIM_UPDATED:14,PACO_DESERIALIZE:15,PACO_OP_RELOAD:16}};Math.randomSeed=1;Math.setRandomSeed=function(e){Math.randomSeed=e*50728129;if(e!=0){Math.randomSeed=Math.seededRandom()*17624813;Math.randomSeed=Math.seededRandom()*9737333}};Math.seededRandom=function(e,t){if(Math.randomSeed===0)Math.randomSeed=Math.random()*999;e=e||1;t=t||0;Math.randomSeed=(Math.randomSeed*9301+49297)%233280;const i=Math.randomSeed/233280;return t+i*(e-t)};String.prototype.endl=function(){return this+"\n"};String.prototype.contains=function(e){console.warn("string.contains deprecated, use string.includes");console.log((new Error).stack);return this.includes(e)};function Y(){}Y();function q(e,t){if(!(e instanceof Float32Array))e=new Float32Array(e);if(!(t instanceof Float32Array))t=new Float32Array(t);const i=new Float32Array(e.length+t.length);i.set(e);i.set(t,e.length);return i}const i=function(e){let t=e.split(".")[e.split(".").length-1];if(t.includes(u.OP.OP_VERSION_PREFIX)){const i=t.split(u.OP.OP_VERSION_PREFIX)[1];t=t.substring(0,t.length-(u.OP.OP_VERSION_PREFIX+i).length)}return t};const r=function(t){for(let e=t.length-1;e>0;e--){const i=Math.floor(Math.seededRandom()*(e+1));const r=t[e];t[e]=t[i];t[i]=r}return t};const s={};const b=function(){let e=Math.random().toString(36).substr(2,9);if(s.hasOwnProperty(e))e=b();s[e]=true;return e};const a=function(){let i=(new Date).getTime();const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=(i+Math.random()*16)%16|0;i=Math.floor(i/16);return(e=="x"?t:t&3|8).toString(16)});return e};const o=a;function c(t){for(const e in t){if(t[e]&&typeof objValue==="object"&&t[e].constructor===Object)t[e]=c(t[e]);if(t[e]===null||t[e]===undefined)delete t[e];else if(Array.isArray(t[e])&&t[e].length==0)delete t[e]}return t}const p=function(i,e="id"){let r=0;if(i.length>0){for(let t=0;t<i.length;t++){let e=i.charCodeAt(t);r=(r<<5)-r+e;r&=r}}return e+""+r};let f=0;const g=function(){f++;return f};const d=function(e){const t=Math.max(0,Math.min(1,(e-0)/(1-0)));e=t*t*(3-2*t);return e};const m=function(e){const t=Math.max(0,Math.min(1,(e-0)/(1-0)));e=t*t*t*(t*(t*6-15)+10);return e};const _=function(e,t,i){return Math.min(Math.max(e,t),i)};const v=function(e,t,i,r,n,s=0,a=true){if(a){if(e>=i)return n;if(e<=t)return r}let o=false;const l=Math.min(t,i);const u=Math.max(t,i);if(l!=t)o=true;let h=false;const c=Math.min(r,n);const f=Math.max(r,n);if(c!=r)h=true;let g=0;let d=0;if(o)g=(u-e)*(f-c)/(u-l);else g=(e-l)*(f-c)/(u-l);if(h)d=f-g;else d=g+c;if(!s)return d;if(s==1){e=Math.max(0,Math.min(1,(d-r)/(n-r)));return r+e*e*(3-2*e)*(n-r)}if(s==2){e=Math.max(0,Math.min(1,(d-r)/(n-r)));return r+e*e*e*(e*(e*6-15)+10)*(n-r)}return d};function x(e){return!isNaN(parseFloat(e))&&isFinite(e)}const E=function(e=""){if(!e)return"";if(e.startsWith("data:"))return;if(e.includes("?"))e+="&";else e+="?";return e+"cache="+CABLES.uuid()};const A=function(t,i){if(!t)return null;i=i||[];i.length=t.length;for(let e=0;e<t.length;e++)i[e]=t[e];return i};const W=function(e){let t=CABLES.filename(e);const i=t.split(".");t=i[0];return t};const Z=function(){console.log("logstack",(new Error).stack)};const K=function(e){let t="";if(!e)return"";if(e.startsWith("data:")&&e.includes(":")){const i=e.split(",");return i[0]}let i=(e+"").split("/");if(i.length>0){const r=i[i.length-1];let e=r.split("?");t=e[0]}return t||""};function T(e,t,i,r,n,s,a={},o={}){const l={url:e,cb:t,method:i,data:r,contenttype:n,sync:false,jsonP:s,headers:a};if(o&&o.credentials)l.credentials=o.credentials;Q(l)}function Q(t){if(!t.hasOwnProperty("asynch"))t.asynch=true;let i;try{i=new XMLHttpRequest}catch(e){}i.onreadystatechange=function(){if(i.readyState!=4)return;if(t.cb){if(i.status==200||i.status==0)t.cb(false,i.responseText,i);else t.cb(true,i.responseText,i)}};try{i.open(t.method?t.method.toUpperCase():"GET",t.url,!t.sync)}catch(e){if(t.cb&&e)t.cb(true,e.msg,i)}if(typeof t.headers==="object"){if(t.headers){const r=Object.keys(t.headers);for(let e=0;e<r.length;e++){const n=r[e];const s=t.headers[n];i.setRequestHeader(n,s)}}}if(t.credentials&&t.credentials!=="omit"){i.withCredentials=true}try{if(!t.post&&!t.data){i.send()}else{i.setRequestHeader("Content-type",t.contenttype?t.contenttype:"application/x-www-form-urlencoded");i.send(t.data||t.post)}}catch(e){if(t.cb)t.cb(true,e.msg,i)}}const J=function(e){CABLES.errorConsole=CABLES.errorConsole||{log:[]};CABLES.errorConsole.log.push({initiator:e,arguments:arguments});if(!CABLES.errorConsole.ele){const t=document.createElement("div");t.id="cablesErrorConsole";t.style.width="90%";t.style.height="300px";t.style.zIndex="9999999";t.style.display="inline-block";t.style.position="absolute";t.style.padding="10px";t.style.fontFamily="monospace";t.style.color="red";t.style.backgroundColor="#200";CABLES.errorConsole.ele=t;document.body.appendChild(t)}let r="ERROR<br/>for more info, open your browsers dev tools console (Ctrl+Shift+I or Command+Alt+I)<br/>";for(let i=0;i<CABLES.errorConsole.log.length;i++){r+=CABLES.errorConsole.log[i].initiator+" ";for(let e=1;e<CABLES.errorConsole.log[i].arguments.length;e++){if(e>2)r+=", ";let t=CABLES.errorConsole.log[i].arguments[e];if(t.constructor.name.indexOf("Error")>-1||t.constructor.name.indexOf("error")>-1){let e="Uncaught ErrorEvent ";if(t.message)e+=" message: "+t.message;r+=e}else if(typeof t=="string")r+=t;else if(typeof t=="number")r+=String(t)+" "}r+="<br/>"}CABLES.errorConsole.ele.innerHTML=r};function $(i){const r={},n=[];for(let e=0,t=i.length;e<t;++e){if(!r.hasOwnProperty(i[e])){n.push(i[e]);r[i[e]]=1}}return n}const ee={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};const te=/[&<>"']/g;const ie=RegExp(te.source);const re=function(e){return e&&ie.test(e)?e.replace(te,function(e){return ee[e]}):e||""};class O extends t{static DIR_IN=0;static DIR_OUT=1;static TYPE_VALUE=0;static TYPE_NUMBER=0;static TYPE_FUNCTION=1;static TYPE_TRIGGER=1;static TYPE_OBJECT=2;static TYPE_TEXTURE=2;static TYPE_ARRAY=3;static TYPE_DYNAMIC=4;static TYPE_STRING=5;static EVENT_UIATTRCHANGE="onUiAttrChange";static EVENT_VALUE_CHANGE="change";static EVENT_LINK_CHANGED="onLinkChanged";static EVENT_LINK_REMOVED="onLinkRemoved";#oldAnimVal=-5711;animMuted=false;lastAnimTime=0;#uiActiveState=true;#valueBeforeLink=null;#animated=false;#useVariableName=null;#op=null;constructor(e,t,i,r={}){super();this.data={};this._log=new n("core_port");this.direction=O.DIR_IN;this.id=String(CABLES.simpleId());this.#op=e;this.links=[];this.value=0;this.name=t;this.type=i||O.TYPE_VALUE;this.uiAttribs=r||{};this.anim=null;this.defaultValue=null;this.ignoreValueSerialize=false;this.onLinkChanged=null;this.crashed=false;this.onValueChanged=null;this.onTriggered=null;this.changeAlways=false;this.forceRefChange=false;this.activityCounter=0;this.apf=0;this.activityCounterStartFrame=0;this.canLink=null;this.preserveLinks=null;this.indexPort=null}get parent(){this._log.stack("use port.op, not .parent");return this.op}get title(){return this.uiAttribs.title||this.name}get op(){return this.#op}get val(){return this.get()}set val(e){this.setValue(e)}copyLinkedUiAttrib(e,t){if(!CABLES.UI)return;if(!this.isLinked())return;const i={};i[e]=this.links[0].getOtherPort(this).getUiAttrib(e);t.setUiAttribs(i)}getValueForDisplay(){let e=this.value;if(typeof this.value==="string"||this.value instanceof String){if(e.length>1e3){e=e.substring(0,999);e+="..."}if(this.uiAttribs&&this.uiAttribs.display=="boolnum"){e+=" - ";if(!this.value)e+="false";else e+="true"}e=e.replace(/[\u00A0-\u9999<>\&]/g,function(e){return"&#"+e.charCodeAt(0)+";"});if(e.length>100)e=e.substring(0,100)}else{e=String(this.value)}return e}onAnimToggle(){}_onAnimToggle(){this.onAnimToggle()}remove(){this.removeLinks();this.#op.removePort(this)}setUiAttribs(e){let t=false;if(!this.uiAttribs)this.uiAttribs={};for(const i in e){if(e[i]===undefined){delete this.uiAttribs[i];continue}if(this.uiAttribs[i]!=e[i])t=true;this.uiAttribs[i]=e[i];if(i=="group"&&this.indexPort)this.indexPort.setUiAttribs({group:e[i]})}if(e.hasOwnProperty("expose"))this.#op.patch.emitEvent("subpatchExpose",this.#op.uiAttribs.subPatch);if(t)this.emitEvent(O.EVENT_UIATTRCHANGE,e,this)}getUiAttribs(){return this.uiAttribs}getUiAttrib(e){if(!this.uiAttribs||!this.uiAttribs.hasOwnProperty(e))return null;return this.uiAttribs[e]}get(){if(CABLES.UI&&this.#animated&&this.lastAnimTime==this.#op.patch.timer.getTime()&&!CABLES.UI.keyframeAutoCreate){return this.value}if(!this.animMuted&&this.#animated&&this.lastAnimFrame!=this.#op.patch.getFrameNum()){this.lastAnimTime=this.#op.patch.timer.getTime();this.lastAnimFrame=this.#op.patch.getFrameNum();let e=this.anim.getValue(this.#op.patch.timer.getTime());if(this.value!=e){this.value=e;this.#oldAnimVal=this.value;this.forceChange()}}return this.value}setRef(e){this.forceRefChange=true;this.set(e)}set(e){this.setValue(e)}setValue(t){if(t===undefined)t=null;if(CABLES.UI&&CABLES.UI.showDevInfos)if(this.direction==u.PORT.PORT_DIR_OUT&&this.type==O.TYPE_OBJECT&&t&&!this.forceRefChange)this._log.warn("object port ["+this.name+"] uses .set ["+this.op.objName+"]");if(this.#op.enabled&&!this.crashed){if(t!==this.value||this.changeAlways||this.type==O.TYPE_TEXTURE||this.type==O.TYPE_ARRAY){if(CABLES.UI&&this.#animated){CABLES.UI.PREVISKEYVAL=null;if(!CABLES.UI.keyframeAutoCreate)CABLES.UI.PREVISKEYVAL=t}if(CABLES.UI&&this.#animated&&CABLES.UI.keyframeAutoCreate){let e=this.#op.patch.timer.getTime();if(CABLES.UI&&CABLES.Patch.getGui().glTimeline)CABLES.Patch.getGui().glTimeline.createKey(this.anim,e,t);else this.anim.setValue(e,t)}else{try{this.value=t;this.forceChange()}catch(e){this.crashed=true;this.setValue=function(e){};this.onTriggered=function(){};this._log.error("exception in ",this.#op);this._log.error(e);this.#op.patch.emitEvent("exception",e,this.#op)}if(this.#op&&this.#op.patch&&this.#op.patch.isEditorMode()&&this.type==O.TYPE_TEXTURE)CABLES.Patch.getGui().texturePreview().updateTexturePort(this)}if(this.direction==u.PORT.PORT_DIR_OUT)for(let e=0;e<this.links.length;++e)this.links[e].setValue()}}}updateAnim(){if(!this.#animated||this.animMuted)return;this.value=this.get();if(this.#oldAnimVal!=this.value||this.changeAlways){this.#oldAnimVal=this.value;this.forceChange()}this.#oldAnimVal=this.value}forceChange(){if(this.onValueChanged||this.onChange){}this._activity();this.emitEvent(O.EVENT_VALUE_CHANGE,this.value,this);if(this.onChange)this.onChange(this,this.value);else if(this.onValueChanged)this.onValueChanged(this,this.value)}static getTypeString(e){if(e==O.TYPE_VALUE)return"Number";if(e==O.TYPE_FUNCTION)return"Trigger";if(e==O.TYPE_OBJECT)return"Object";if(e==O.TYPE_DYNAMIC)return"Dynamic";if(e==O.TYPE_ARRAY)return"Array";if(e==O.TYPE_STRING)return"String";return"Unknown"}getTypeString(){return O.getTypeString(this.type)}deSerializeSettings(e){if(!e)return;if(e.animated)this.setAnimated(e.animated);if(e.useVariable)this.setVariableName(e.useVariable);if(e.title)this.setUiAttribs({title:e.title});if(e.expose)this.setUiAttribs({expose:true});if(e.order)this.setUiAttribs({order:e.order});if(e.multiPortManual)this.setUiAttribs({multiPortManual:e.multiPortManual});if(e.multiPortNum)this.setUiAttribs({multiPortNum:e.multiPortNum});if(e.anim){if(!this.anim)this.anim=new h({name:"port "+this.name});this.#op.hasAnimPort=true;this.anim.port=this;this.anim.deserialize(e.anim,true,this.op.patch.clipAnims);this.#op.patch.emitEvent("portAnimUpdated",this.#op,this,this.anim);this.bindAnimListeners();this.anim.sortKeys()}}setInitialValue(e){if(this.op.preservedPortLinks[this.name]){for(let e=0;e<this.op.preservedPortLinks[this.name].length;e++){const t=this.op.preservedPortLinks[this.name][e];this.op.patch._addLink(t.objIn,t.objOut,t.portIn,t.portOut)}}if(this.op.preservedPortValues&&this.op.preservedPortValues.hasOwnProperty(this.name)&&this.op.preservedPortValues[this.name]!==undefined){this.set(this.op.preservedPortValues[this.name])}else if(e!==undefined)this.set(e);if(e!==undefined)this.defaultValue=e}getSerialized(){let t={name:this.getName()};if(!this.ignoreValueSerialize&&this.links.length===0){if(this.type==O.TYPE_OBJECT&&this.value&&this.value.tex){}else t.value=this.value}if(this.#useVariableName)t.useVariable=this.#useVariableName;if(this.#animated)t.animated=true;if(this.anim)t.anim=this.anim.getSerialized();if(this.uiAttribs.multiPortNum)t.multiPortNum=this.uiAttribs.multiPortNum;if(this.uiAttribs.multiPortManual)t.multiPortManual=this.uiAttribs.multiPortManual;if(this.uiAttribs.display=="file")t.display=this.uiAttribs.display;if(this.uiAttribs.expose){t.expose=true;if(this.uiAttribs.hasOwnProperty("order"))t.order=this.uiAttribs.order}if(this.uiAttribs.title)t.title=this.uiAttribs.title;if((this.preserveLinks||this.direction==u.PORT.PORT_DIR_OUT)&&this.links.length>0){t.links=[];for(const e in this.links){if(!this.links[e].ignoreInSerialize&&(this.links[e].portIn&&this.links[e].portOut))t.links.push(this.links[e].getSerialized())}}if(this.direction==O.DIR_IN&&this.links.length>0){for(const e in this.links){if(!this.links[e].portIn||!this.links[e].portOut)continue;const i=this.links[e].getOtherPort(this);if(i.op.isInBlueprint2&&this.op.isInBlueprint2){if(i.op.isInBlueprint2()&&!this.op.isInBlueprint2()){t.links=t.links||[];t.links.push(this.links[e].getSerialized())}}}}if(t.links&&t.links.length==0)delete t.links;if(this.type===O.TYPE_FUNCTION)delete t.value;if(this.type===O.TYPE_FUNCTION&&this.links.length==0)t=null;if(t&&Object.keys(t).length==1&&t.name)t=null;c(t);return t}shouldLink(e,t){return!!(e&&t)}removeLinks(){let e=0;while(this.links.length>0){e++;if(e>5e3){this._log.warn("could not delete links... / infinite loop");this.links.length=0;break}this.links[0].remove()}}removeLink(t){for(let e=0;e<this.links.length;e++)if(this.links[e]==t)this.links.splice(e,1);if(this.direction==O.DIR_IN){if(this.type==O.TYPE_VALUE)this.setValue(this.#valueBeforeLink||0);else this.setValue(this.#valueBeforeLink||null)}if(CABLES.UI&&this.#op.checkLinkTimeWarnings)this.#op.checkLinkTimeWarnings();try{if(this.onLinkChanged)this.onLinkChanged();this.emitEvent(O.EVENT_LINK_CHANGED);this.emitEvent(O.EVENT_LINK_REMOVED);this.#op.emitEvent(O.EVENT_LINK_CHANGED)}catch(e){this._log.error(e)}}getName(){return this.name}getTitle(){if(this.uiAttribs.title)return this.uiAttribs.title;return this.name}addLink(e){this.#valueBeforeLink=this.value;this.links.push(e);if(CABLES.UI&&this.#op.checkLinkTimeWarnings)this.#op.checkLinkTimeWarnings();try{if(this.onLinkChanged)this.onLinkChanged();this.emitEvent(O.EVENT_LINK_CHANGED);this.#op.emitEvent(O.EVENT_LINK_CHANGED)}catch(e){this._log.error(e)}}getLinkTo(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return this.links[e]}removeLinkTo(t){for(const e in this.links){if(this.links[e].portIn==t||this.links[e].portOut==t){this.links[e].remove();if(CABLES.UI&&this.#op.checkLinkTimeWarnings)this.#op.checkLinkTimeWarnings();if(this.onLinkChanged)this.onLinkChanged();this.emitEvent(O.EVENT_LINK_CHANGED);this.emitEvent(O.EVENT_LINK_REMOVED);return}}}isLinkedTo(t){for(const e in this.links)if(this.links[e].portIn==t||this.links[e].portOut==t)return true;return false}_activity(){this.activityCounter++}trigger(){const t=this.links.length;this._activity();if(t===0)return;if(!this.#op.enabled)return;let i=null;try{for(let e=0;e<t;++e){if(this.links[e].portIn){i=this.links[e].portIn;i.op.patch.pushTriggerStack(i);if(!i._onTriggered){console.log(i,i._onTriggered)}i._onTriggered();i.op.patch.popTriggerStack()}if(this.links[e])this.links[e].activity()}}catch(e){if(!i)return console.error("unknown port error");i.op.enabled=false;i.op.setUiError("crash","op crashed, port exception "+i.name,3);if(this.#op.patch.isEditorMode()){if(i.op.onError)i.op.onError(e)}this._log.error("exception in port: ",i.name,i.op.name,i.op.id);this._log.error(e)}}call(){this._log.warn("call deprecated - use trigger() ");this.trigger()}execute(){}setVariableName(e){this.#useVariableName=e;this.#op.patch.on("variableRename",(e,t)=>{if(e!=this.#useVariableName)return;this.#useVariableName=t})}getVariableName(){return this.#useVariableName}setVariable(e){this.setAnimated(false);const t={useVariable:false};if(this._variableIn&&this._varChangeListenerId){this._variableIn.off(this._varChangeListenerId);this._variableIn=null}if(e){this._variableIn=this.#op.patch.getVar(e);if(!this._variableIn){}else{if(this.type==O.TYPE_OBJECT){this._varChangeListenerId=this._variableIn.on("change",()=>{this.set(null);this.set(this._variableIn.getValue())})}else{this._varChangeListenerId=this._variableIn.on("change",this.set.bind(this))}this.set(this._variableIn.getValue())}this.#useVariableName=e;t.useVariable=true;t.variableName=this.#useVariableName}else{t.variableName=this.#useVariableName=null;t.useVariable=false}this.setUiAttribs(t);this.#op.patch.emitEvent("portSetVariable",this.#op,this,e)}_handleNoTriggerOpAnimUpdates(e){let t=false;if(!t){if(e)this._notriggerAnimUpdate=this.#op.patch.on("onRenderFrame",()=>{this.updateAnim()});else if(this._notriggerAnimUpdate)this._notriggerAnimUpdate=this.#op.patch.off(this._notriggerAnimUpdate)}}bindAnimListeners(){this.anim.on(h.EVENT_CHANGE,()=>{this.#op.patch.emitEvent("portAnimUpdated",this.#op,this,this.anim);this.#op.patch.updateAnimMaxTimeSoon()});this.anim.on(h.EVENT_KEY_DELETE,()=>{this.#op.patch.updateAnimMaxTimeSoon()})}setAnimated(e){let t=false;if(this.#animated!=e){this.#animated=e;this.#op.hasAnimPort=true;t=true}if(this.#animated&&!this.anim){this.anim=new h({name:"port "+this.name});this.bindAnimListeners()}if(this.#animated){let e=0;if(this.#op.patch.gui&&this.#op.patch.gui.glTimeline)e=this.#op.patch.timer.getTime();if(this.anim.keys.length==0)this.anim.setValue(e,this.value)}else{this.anim=null}this._handleNoTriggerOpAnimUpdates(e);this.#op.patch.emitEvent("portAnimToggle",this.#op,this,this.anim);this.setUiAttribs({isAnimated:this.#animated});if(t)this._onAnimToggle()}toggleAnim(){this.setAnimated(!this.#animated);this.setUiAttribs({isAnimated:this.#animated});this.#op.patch.emitEvent("portAnimUpdated",this.#op,this,this.anim);this.#op.patch.emitEvent("portAnimToggle",this.#op,this,this.anim)}getType(){return this.type}isLinked(){return this.links.length>0||this.#animated||this.#useVariableName!=null}isBoundToVar(){const e=this.#useVariableName!=null;this.uiAttribs.boundToVar=e;return e}isAnimated(){return this.#animated}isHidden(){return this.uiAttribs.hidePort}_onTriggered(e){this._activity();this.#op.updateAnims();if(this.#op.enabled&&this.onTriggered)this.onTriggered();if(this.#op.enabled)this.emitEvent("trigger",e)}_onSetProfiling(e){if(this.op.patch.debuggerEnabled){const t=e;this.op.patch.emitEvent("debuggerstep",{opname:this.op.name,opid:this.op.id,portname:this.name,log:this.op.name+" - port "+this.name+": set value to "+e,exec:()=>{this.setValue(t)}});return}this.#op.patch.profiler.add("port",this);this.setValue(e);this.#op.patch.profiler.add("port",null)}_onTriggeredProfiling(){if(this.#op.enabled&&this.onTriggered){if(this.op.patch.debuggerEnabled){console.log();this.op.patch.emitEvent("debuggerstep",{opname:this.op.name,opid:this.op.id,portname:this.name,log:this.op.name+" - triggered "+this.name,exec:()=>{this.onTriggered()}});return}this.#op.patch.profiler.add("port",this);this.onTriggered();this.#op.patch.profiler.add("port",null)}}onValueChange(e){this.onChange=e}hidePort(){}static portTypeNumberToString(e){if(e==O.TYPE_VALUE)return"value";if(e==O.TYPE_FUNCTION)return"function";if(e==O.TYPE_OBJECT)return"object";if(e==O.TYPE_ARRAY)return"array";if(e==O.TYPE_STRING)return"string";if(e==O.TYPE_DYNAMIC)return"dynamic";return"unknown"}}class I extends t{constructor(e){super();this.id=CABLES.simpleId();this.portIn=null;this.portOut=null;this._patch=e;this.activityCounter=0;this.ignoreInSerialize=false}setValue(e){if(e===undefined)this._setValue();else this.portIn.set(e)}activity(){this.activityCounter++}_setValue(){if(!this.portOut){this.remove();return}const e=this.portOut.get();if(e==e){if(this.portIn.type!=O.TYPE_FUNCTION)this.activity();if(this.portIn.get()!==e){this.portIn.set(e)}else{if(this.portIn.changeAlways)this.portIn.set(e);if(this.portOut.forceRefChange)this.portIn.forceChange()}}}getOtherPort(e){if(e==this.portIn)return this.portOut;return this.portIn}remove(){if(this.portIn)this.portIn.removeLink(this);if(this.portOut)this.portOut.removeLink(this);if(this._patch){this._patch.emitEvent("onUnLink",this.portIn,this.portOut,this)}if(this.portIn&&(this.portIn.type==O.TYPE_OBJECT||this.portIn.type==O.TYPE_ARRAY)){this.portIn.set(null);if(this.portIn.links.length>0)this.portIn.set(this.portIn.links[0].getOtherPort(this.portIn).get())}if(this.portIn)this.portIn.op._checkLinksNeededToWork();if(this.portOut)this.portOut.op._checkLinksNeededToWork();this.portIn=null;this.portOut=null;this._patch=null}link(e,t){if(!I.canLink(e,t)){console.warn("[core_link] cannot link ports!",e,t);return false}if(e.direction==O.DIR_IN){this.portIn=e;this.portOut=t}else{this.portIn=t;this.portOut=e}e.addLink(this);t.addLink(this);this.setValue();e.op._checkLinksNeededToWork();t.op._checkLinksNeededToWork()}getSerialized(){const e={};e.portIn=this.portIn.getName();e.portOut=this.portOut.getName();e.objIn=this.portIn.op.id;e.objOut=this.portOut.op.id;return e}static canLinkText(e,t){if(e.direction==t.direction){let e="(out)";if(t.direction==O.DIR_IN)e="(in)";return"can not link: same direction "+e}if(e.op==t.op)return"can not link: same op";if(e.type!=O.TYPE_DYNAMIC&&t.type!=O.TYPE_DYNAMIC){if(e.type!=t.type)return"can not link: different type"}if(CABLES.UI&&e.type==O.TYPE_OBJECT&&t.type==O.TYPE_OBJECT){if(e.uiAttribs.objType&&t.uiAttribs.objType)if(e.uiAttribs.objType!=t.uiAttribs.objType)return"incompatible objects"}if(!e)return"can not link: port 1 invalid";if(!t)return"can not link: port 2 invalid";if(e.direction==O.DIR_IN&&e.isAnimated())return"can not link: is animated";if(t.direction==O.DIR_IN&&t.isAnimated())return"can not link: is animated";if(e.isLinkedTo(t))return"ports already linked";if(e.canLink&&!e.canLink(t)||t.canLink&&!t.canLink(e))return"Incompatible";return"can link"}static canLink(e,t){if(!e)return false;if(!t)return false;if(e.direction==O.DIR_IN&&e.isAnimated())return false;if(t.direction==O.DIR_IN&&t.isAnimated())return false;if(e.isHidden()||t.isHidden())return false;if(e.isLinkedTo(t))return false;if(e.direction==t.direction)return false;if(CABLES.UI&&e.type==O.TYPE_OBJECT&&t.type==O.TYPE_OBJECT){if(e.uiAttribs.objType&&t.uiAttribs.objType){if(e.uiAttribs.objType.indexOf("sg_")==0&&t.uiAttribs.objType.indexOf("sg_")==0)return true;if(e.uiAttribs.objType!=t.uiAttribs.objType)return false}}if(e.type!=t.type&&(e.type!=O.TYPE_DYNAMIC&&t.type!=O.TYPE_DYNAMIC))return false;if(e.type==O.TYPE_DYNAMIC||t.type==O.TYPE_DYNAMIC)return true;if(e.op==t.op)return false;if(e.canLink&&!e.canLink(t))return false;if(t.canLink&&!t.canLink(e))return false;return true}}class S extends t{constructor(e){super();this._log=new n("LoadingStatus");this._loadingAssets={};this._cbFinished=[];this._assetTasks=[];this._percent=0;this._count=0;this._countFinished=0;this._order=0;this._startTime=0;this._patch=e;this._wasFinishedPrinted=false;this._loadingAssetTaskCb=false}setOnFinishedLoading(e){this._cbFinished.push(e)}getNumAssets(){return this._countFinished}getProgress(){return this._percent}checkStatus(){this._countFinished=0;this._count=0;for(const e in this._loadingAssets){this._count++;if(!this._loadingAssets[e].finished){this._countFinished++}}this._percent=(this._count-this._countFinished)/this._count;if(this._countFinished===0){for(let e=0;e<this._cbFinished.length;e++){if(this._cbFinished[e]){const t=this._cbFinished[e];setTimeout(()=>{t(this._patch);this.emitEvent("finishedAll")},100)}}if(!this._wasFinishedPrinted){this._wasFinishedPrinted=true;this.print()}this.emitEvent("finishedAll")}}getList(){let t=[];for(const e in this._loadingAssets){t.push(this._loadingAssets[e])}return t}getListJobs(){let t=[];for(const e in this._loadingAssets){if(!this._loadingAssets[e].finished)t.push(this._loadingAssets[e].name)}return t}print(){if(this._patch.config.silent)return;const t=[];for(const e in this._loadingAssets){t.push([this._loadingAssets[e].order,this._loadingAssets[e].type,this._loadingAssets[e].name,(this._loadingAssets[e].timeEnd-this._loadingAssets[e].timeStart)/1e3+"s"])}this._log.groupCollapsed("finished loading "+this._order+" assets in "+(Date.now()-this._startTime)/1e3+"s");this._log.table(t);this._log.groupEnd()}finished(e){const t=this._loadingAssets[e];if(t){if(t.finished)this._log.warn("loading job was already finished",t);if(t.op)t.op.setUiAttribs({loading:false});t.finished=true;t.timeEnd=Date.now()}this.checkStatus();this.emitEvent("finishedTask");return null}_startAssetTasks(){for(let e=0;e<this._assetTasks.length;e++)this._assetTasks[e]();this._assetTasks.length=0}addAssetLoadingTask(e){if(this._patch.isEditorMode()&&!CABLES.UI.loaded){this._assetTasks.push(e);if(!this._loadingAssetTaskCb)window.gui.addEventListener("uiloaded",this._startAssetTasks.bind(this));this._loadingAssetTaskCb=true}else{e()}this.emitEvent("addAssetTask")}existByName(t){for(let e in this._loadingAssets){if(this._loadingAssets[e].name==t&&!this._loadingAssets[e].finished)return true}}start(e,t,i){if(this._startTime==0)this._startTime=Date.now();const r=o();t=t||"unknown";if(t.length>100)t=t.substring(0,100);if(i)i.setUiAttrib({loading:true});this._loadingAssets[r]={id:r,op:i,type:e,name:t,finished:false,timeStart:Date.now(),order:this._order};this._order++;this.emitEvent("startTask");return r}}const M=function(){return window.performance.now()};const C=function(){return M()};class R extends t{static EVENT_PLAY_PAUSE="playPause";static EVENT_TIME_CHANGED="timeChanged";#lastTime=0;#timeOffset=0;#currentTime=0;#paused=true;#delay=0;#timeStart=0;#ts;constructor(){super();this.#timeStart=0;this.overwriteTime=-1}#internalNow(){if(this.#ts)return this.#ts;return M()}#getTime(){this.#lastTime=(this.#internalNow()-this.#timeStart)/1e3;return this.#lastTime+this.#timeOffset}setDelay(e){this.#delay=e;this.emitEvent(R.EVENT_TIME_CHANGED)}isPlaying(){return!this.#paused}update(e){if(e)this.#ts=e;if(this.#paused)return;this.#currentTime=this.#getTime();return this.#currentTime}getMillis(){return this.get()*1e3}get(){return this.getTime()}getTime(){if(this.overwriteTime>=0)return this.overwriteTime-this.#delay;return this.#currentTime-this.#delay}togglePlay(){if(this.#paused)this.play();else this.pause()}setTime(e){if(isNaN(e)||e<0)e=0;this.#timeStart=this.#internalNow();this.#timeOffset=e;this.#currentTime=e;this.emitEvent(R.EVENT_TIME_CHANGED)}setOffset(e){if(this.#currentTime+e<0){this.#timeStart=this.#internalNow();this.#timeOffset=0;this.#currentTime=0}else{this.#timeOffset+=e;this.#currentTime=this.#lastTime+this.#timeOffset}this.emitEvent(R.EVENT_TIME_CHANGED)}play(){this.#timeStart=this.#internalNow();this.#paused=false;this.emitEvent(R.EVENT_PLAY_PAUSE)}pause(){this.#timeOffset=this.#currentTime;this.#paused=true;this.emitEvent(R.EVENT_PLAY_PAUSE)}static now(){return window.performance.now()}}class N{constructor(e){this.startFrame=e.getFrameNum();this.items={};this.currentId=null;this.currentStart=0;this._patch=e}getItems(){return this.items}clear(){this.currentStart=performance.now();if(this.paused)return;this.items={}}togglePause(){this.paused=!this.paused;if(!this.paused){this.items={};this.currentStart=performance.now()}}add(e,t){if(this.paused)return;if(this.currentId!==null){if(!t||t.id!=this.currentId){const i=this.items[this.currentId];if(i){i.timeUsed+=performance.now()-this.currentStart;i._timePsCount++;i._timePsMs+=performance.now()-this.currentStart;if(i._timePsStart==0||performance.now()>i._timePsStart+1e3){i.timePsMs=i._timePsMs;i.timePsMsAvg=i._timePsMs/i._timePsCount;i.timePsCount=i._timePsCount;i._timePsCount=0;i._timePsMs=0;i._timePsStart=performance.now()}if(!i.peakTime||C()-i.peakTime>5e3){i.peak=0;i.peakTime=C()}i.peak=Math.max(i.peak,performance.now()-this.currentStart)}}}if(t!==null){if(!this.items[t.id]){this.items[t.id]={numTriggers:0,timeUsed:0,timeUsedFrame:0,timePsMsAvg:0,timePsMs:0,_timePsCount:0,_timePsMs:0,_timePsStart:performance.now()}}if(this.items[t.id].lastFrame!=this._patch.getFrameNum())this.items[t.id].numTriggers=0;this.items[t.id].lastFrame=this._patch.getFrameNum();this.items[t.id].numTriggers++;this.items[t.id].opid=t.op.id;this.items[t.id].title=t.op.name+"."+t.name;this.items[t.id].subPatch=t.op.uiAttribs.subPatch;this.currentId=t.id;this.currentStart=performance.now()}else{this.currentId=null}}print(){console.log("--------");for(const e in this.items){console.log(this.items[e].title+": "+this.items[e].numTriggers+" / "+this.items[e].timeUsed)}}}class ne extends t{#name;constructor(e,t,i){super();this.#name=e;this.type=i;this.setValue(t)}addListener(e){this.on("change",e,"var")}getValue(){return this._v}get name(){return this.#name}getName(){return this.#name}setValue(e){this._v=e;this.emitEvent("change",e,this)}}class y extends t{static EVENT_OP_DELETED="onOpDelete";static EVENT_OP_ADDED="onOpAdd";static EVENT_PAUSE="pause";static EVENT_RESUME="resume";static EVENT_PATCHLOADEND="patchLoadEnd";static EVENT_VARIABLES_CHANGED="variablesChanged";static EVENT_RENDER_FRAME="onRenderFrame";static EVENT_RENDERED_ONE_FRAME="renderedOneFrame";static EVENT_LINK="onLink";static EVENT_VALUESSET="loadedValueSet";static EVENT_DISPOSE="dispose";static EVENT_ANIM_MAXTIME_CHANGE="animmaxtimechange";#renderOneFrame=false;#initialDeserialize=true;ops=[];settings={};animMaxTime=0;missingClipAnims={};constructor(e){super();this._log=new n("core_patch",{onError:e.onError});this.renderloop=null;this.config=e||{glCanvasResizeToWindow:false,prefixAssetPath:"",prefixJsPath:"",silent:true,onError:null,onFinishedLoading:null,onFirstFrameRendered:null,onPatchLoaded:null,fpsLimit:0};this.timer=new R;this.freeTimer=new R;this.animFrameOps=[];this.gui=false;CABLES.logSilent=this.silent=true;this.profiler=null;this.aborted=false;this._crashedOps=[];this._animReq=null;this._opIdCache={};this._triggerStack=[];this.storeObjNames=false;this.loading=new S(this);this._volumeListeners=[];this.namedTriggers={};this._origData=null;this.tempData=this.frameStore={};if(!function(){return!this}())console.log("not in strict mode: core patch");if(this.config.hasOwnProperty("silent"))this.silent=CABLES.logSilent=this.config.silent;if(!this.config.hasOwnProperty("doRequestAnimation"))this.config.doRequestAnimation=true;if(!this.config.prefixAssetPath)this.config.prefixAssetPath="";if(!this.config.prefixJsPath)this.config.prefixJsPath="";if(!this.config.masterVolume)this.config.masterVolume=1;this._variables={};this.vars={};if(e&&e.vars)this.vars=e.vars;this.cgl=null;this.cgp=null;this._subpatchOpCache={};window.dispatchEvent(new CustomEvent("INIT_CG",{detail:this}));this.loading.setOnFinishedLoading(this.config.onFinishedLoading);if(!CABLES.OPS){this.aborted=true;throw new Error("no CABLES.OPS found")}this.freeTimer.play();if(this.config.patch){this.deSerialize(this.config.patch)}else if(this.config.patchFile){T(this.config.patchFile,(e,t)=>{try{const i=JSON.parse(t);if(e){const r="";this._log.error("err",e);this._log.error("data",i);this._log.error("data",i.msg);return}this.deSerialize(i)}catch(e){this._log.error("could not load/parse patch ",e)}})}this.timer.play();console.log("made with https://cables.gl");this.cg=undefined}static getGui(){return window.gui}isPlaying(){if(this.renderloop)return!this.renderloop.paused;return false}renderOneFrame(){}isEditorMode(){return this.config.editorMode===true}pause(){this.emitEvent(y.EVENT_PAUSE);if(this.renderloop)this.renderloop.pause();this.freeTimer.pause()}resume(){this.freeTimer.play();this.emitEvent(y.EVENT_RESUME);if(this.renderloop)this.renderloop.resume()}setVolume(t){this.config.masterVolume=t;for(let e=0;e<this._volumeListeners.length;e++)this._volumeListeners[e].onMasterVolumeChanged(t)}getAssetPath(t=null){if(this.config.hasOwnProperty("assetPath")){return this.config.assetPath}else if(this.isEditorMode()){let e=t||y.getGui().project()._id;return"/assets/"+e+"/"}else if(document.location.href.indexOf("cables.gl")>0||document.location.href.indexOf("cables.local")>0){const i=document.location.pathname.split("/");let e=t||i[i.length-1];return"/assets/"+e+"/"}else{return"assets/"}}getJsPath(){if(this.config.hasOwnProperty("jsPath")){return this.config.jsPath}else{return"js/"}}getFilePath(e){if(!e)return e;e=String(e);if(e.indexOf("https:")===0||e.indexOf("http:")===0)return e;if(e.indexOf("data:")===0)return e;if(e.indexOf("file:")===0)return e;e=e.replace("//","/");if(e.startsWith(this.config.prefixAssetPath))e=e.replace(this.config.prefixAssetPath,"");return this.config.prefixAssetPath+e+(this.config.suffixAssetPath||"")}clear(){this.emitEvent("patchClearStart");this.animFrameOps.length=0;this.timer=new R;while(this.ops.length>0)this.deleteOp(this.ops[0].id);this._opIdCache={};this.emitEvent("patchClearEnd")}createOp(e,t,i=null){let r=null;let n="";try{if(!e){console.error("createop identifier false",e);console.log((new Error).stack);return}if(e.indexOf("Ops.")===-1){const s=e;if(CABLES.OPS[s]){n=CABLES.OPS[s].objName;try{r=new CABLES.OPS[s].f(this,n,t,s)}catch(e){this._crashedOps.push(n);this._log.error("[instancing error] constructor: "+n,e);if(!this.isEditorMode()){this._log.error("INSTANCE_ERR","Instancing Error: "+n,e)}else{r=new CABLES.Op(this,n,t);r.setUiError("instancingError","Failed to instanciate op",3);r.setEnabled(false);if(this.#initialDeserialize)y.getGui().patchView.store.opCrashed=true}}r.opId=s}else{if(i){e=i;this._log.warn("could not find op by id: "+s)}else{throw new Error("could not find op by id: "+s,{cause:"opId:"+s})}}}if(!r){n=e;const a=e.split(".");const o=y.getOpClass(n);if(!o){this.emitEvent("criticalError",{title:"Unknown op: "+n,text:"Unknown op: "+n});this._log.error("unknown op: "+n);throw new Error("unknown op: "+n)}else{if(a.length==2)r=new window[a[0]][a[1]](this,n,t);else if(a.length==3)r=new window[a[0]][a[1]][a[2]](this,n,t);else if(a.length==4)r=new window[a[0]][a[1]][a[2]][a[3]](this,n,t);else if(a.length==5)r=new window[a[0]][a[1]][a[2]][a[3]][a[4]](this,n,t);else if(a.length==6)r=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]](this,n,t);else if(a.length==7)r=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]][a[6]](this,n,t);else if(a.length==8)r=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]][a[6]][a[7]](this,n,t);else if(a.length==9)r=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]][a[6]][a[7]][a[8]](this,n,t);else if(a.length==10)r=new window[a[0]][a[1]][a[2]][a[3]][a[4]][a[5]][a[6]][a[7]][a[8]][a[9]](this,n,t);else console.log("parts.length",a.length)}if(r){r.opId=null;for(const e in CABLES.OPS){if(CABLES.OPS[e].objName==n)r.opId=e}}}}catch(e){this._crashedOps.push(n);this._log.error("[instancing error] "+n,e);if(!this.isEditorMode()){this._log.error("INSTANCE_ERR","Instancing Error: "+n,e)}else{if(this.#initialDeserialize)y.getGui().patchView.store.opCrashed=true}}if(r){r._objName=n;r.patch=this}else{this._log.log("no op was created!?",e,t)}return r}addOp(e,t,i,r=false,n=null){const s=this.createOp(e,i,n);if(s){t=t||{};if(t.hasOwnProperty("errors"))delete t.errors;if(t.hasOwnProperty("error"))delete t.error;t.subPatch=t.subPatch||0;s.setUiAttribs(t);if(s.onCreate)s.onCreate();if(s.hasOwnProperty("onAnimFrame")&&s.onAnimFrame)this.addOnAnimFrame(s);if(s.hasOwnProperty("onMasterVolumeChanged"))this._volumeListeners.push(s);if(this._opIdCache[s.id]){this._log.warn("opid with id "+s.id+" already exists in patch!");this.deleteOp(s.id)}this.ops.push(s);this._opIdCache[s.id]=s;if(this._subPatchCacheAdd)this._subPatchCacheAdd(t.subPatch,s);this.emitEvent(y.EVENT_OP_ADDED,s,r);if(s.init)s.init();s.emitEvent(w.EVENT_INIT,r)}else{this._log.error("addop: op could not be created: ",e)}return s}addOnAnimFrame(t){for(let e=0;e<this.animFrameOps.length;e++)if(this.animFrameOps[e]==t){return}this.animFrameOps.push(t)}removeOnAnimFrame(t){for(let e=0;e<this.animFrameOps.length;e++){if(this.animFrameOps[e]==t){this.animFrameOps.splice(e,1);return}}}addOnAnimFrameCallback(e){this.animFrameCallbacks.push(e)}removeOnAnimCallback(t){for(let e=0;e<this.animFrameCallbacks.length;e++){if(this.animFrameCallbacks[e]==t){this.animFrameCallbacks.splice(e,1);return}}}updateAnimMaxTimeSoon(){if(this.toAnimMaxTime)clearTimeout(this.toAnimMaxTime);this.toAnimMaxTime=setTimeout(()=>{this.updateAnimMaxTime()},50)}updateAnimMaxTime(){let i=0;for(let t=0;t<this.ops.length;t++){if(this.ops[t].hasAnimPort){for(let e=0;e<this.ops[t].portsIn.length;e++){if(this.ops[t].portsIn[e].anim){if(this.ops[t].portsIn[e].anim.lastKey&&this.ops[t].portsIn[e].anim.lastKey.time>i){i=this.ops[t].portsIn[e].anim.lastKey.time}}}}}if(i!=this.animMaxTime){this.animMaxTime=i;this.emitEvent(y.EVENT_ANIM_MAXTIME_CHANGE)}}deleteOp(r,n,s){let a=false;for(let i=0;i<this.ops.length;i++){if(this.ops[i].id==r){const o=this.ops[i];let e=null;let t=null;if(o){a=true;if(n){if(o.portsIn.length>0&&o.portsIn[0].isLinked()&&(o.portsOut.length>0&&o.portsOut[0].isLinked())){if(o.portsIn[0].getType()==o.portsOut[0].getType()&&o.portsIn[0].links[0]){e=o.portsIn[0].links[0].getOtherPort(o.portsIn[0]);t=o.portsOut[0].links[0].getOtherPort(o.portsOut[0])}}}const l=this.ops[i];l.removeLinks();this.ops.splice(i,1);l.emitEvent("delete",l);this.emitEvent(y.EVENT_OP_DELETED,l,s);if(this.clearSubPatchCache)this.clearSubPatchCache(l.uiAttribs.subPatch);if(l.onDelete)l.onDelete(s);l.cleanUp();if(e!==null&&t!==null){this.link(e.op,e.getName(),t.op,t.getName())}delete this._opIdCache[r];break}}}if(!a)this._log.warn("core patch deleteop: not found...",r)}getFrameNum(){if(this.renderloop)return this.renderloop.frameNum}updateAnims(t,i,e){if(!this.renderloop)return;this.timer.update(e);this.freeTimer.update(e);t=t||this.timer.getTime();for(let e=0;e<this.animFrameOps.length;++e)if(this.animFrameOps[e].onAnimFrame)this.animFrameOps[e].onAnimFrame(t,this.renderloop.frameNum,i)}link(e,t,i,r,n=false,s=false){if(!e)return this._log.warn("link: op1 is null ");if(!i)return this._log.warn("link: op2 is null");const a=e.getPort(t,n);const o=i.getPort(r,n);if(!a)return this._log.warn("port1 not found! "+t+" ("+e.objName+")");if(!o)return this._log.warn("port2 not found! "+r+" of "+i.name+"("+i.objName+")",i);if(!a.shouldLink(a,o)||!o.shouldLink(a,o))return false;if(I.canLink(a,o)){const l=new I(this);l.link(a,o);this.emitEvent(y.EVENT_LINK,a,o,l,s);return l}}serialize(e){const t={};e=e||{};t.ops=[];t.settings=this.settings;for(let e=0;e<this.ops.length;e++){const i=this.ops[e];if(i&&i.getSerialized)t.ops.push(i.getSerialized())}c(t);if(e.asObject)return t;return JSON.stringify(t)}getOpsByRefId(t){const e=y.getGui().uiProfiler.start("[corepatchetend] getOpsByRefId");const i=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].storage&&this.ops[e].storage.ref==t)i.push(this.ops[e]);e.finish();return i}getOpById(e){return this._opIdCache[e]}getOpsByObjName(t){const i=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].objName==t)i.push(this.ops[e]);return i}getOpsByOpId(t){const i=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].opId==t)i.push(this.ops[e]);return i}getSubPatchOpsByName(t,i){const r=[];for(let e=0;e<this.ops.length;e++)if(this.ops[e].uiAttribs&&this.ops[e].uiAttribs.subPatch==t&&this.ops[e].objName==i)r.push(this.ops[e]);return r}getSubPatchOp(e,t){return this.getFirstSubPatchOpByName(e,t)}getFirstSubPatchOpByName(t,i){for(let e=0;e<this.ops.length;e++)if(this.ops[e].uiAttribs&&this.ops[e].uiAttribs.subPatch==t&&this.ops[e].objName==i)return this.ops[e];return null}_addLink(e,t,i,r){return this.link(this.getOpById(e),i,this.getOpById(t),r,false,true)}logStartup(e){if(window.logStartup)window.logStartup(e)}deSerialize(a,e={genIds:false,createRef:false}){if(this.aborted)return;const r=[];const t=this.loading.start("core","deserialize");if(typeof a==="string")a=JSON.parse(a);if(this.#initialDeserialize){this.namespace=a.namespace||"";this.name=a.name||"";this.settings=a.settings}this.emitEvent("patchLoadStart");a.ops=a.ops||[];this.logStartup("add "+a.ops.length+" ops... ");const n=[];for(let i=0;i<a.ops.length;i++){const s=CABLES.now();const o=a.ops[i];let t=null;try{if(o.opId)t=this.addOp(o.opId,o.uiAttribs,o.id,true,o.objName);else t=this.addOp(o.objName,o.uiAttribs,o.id,true)}catch(e){this._log.error("[instancing error] op data:",o,e)}if(t){n.push(t);if(e.genIds)t.id=b();t.portsInData=o.portsIn;t._origData=JSON.parse(JSON.stringify(o));t.storage=o.storage;if(o.portsIn)for(let e=0;e<o.portsIn.length;e++){const u=o.portsIn[e];if(u&&u.hasOwnProperty("name")){const h=t.getPort(u.name);if(h&&(h.uiAttribs.display=="bool"||h.uiAttribs.type=="bool")&&!isNaN(u.value))u.value=u.value==true?1:0;if(h&&u.value!==undefined&&h.type!=O.TYPE_TEXTURE)h.set(u.value);if(h){h.deSerializeSettings(u)}else{t.preservedPortValues=t.preservedPortValues||{};t.preservedPortValues[u.name]=u.value}}}if(o.portsOut)for(let e=0;e<o.portsOut.length;e++){const u=o.portsOut[e];if(u&&u.hasOwnProperty("name")){const c=t.getPort(u.name);if(c){c.deSerializeSettings(u);if(c.uiAttribs.hasOwnProperty("title")){t.preservedPortTitles=t.preservedPortTitles||{};t.preservedPortTitles[c.name]=c.uiAttribs.title}if(c.type!=O.TYPE_TEXTURE&&u.hasOwnProperty("value"))c.set(a.ops[i].portsOut[e].value);if(u.expose)c.setUiAttribs({expose:true})}}}r.push(t)}const l=Math.round(100*(CABLES.now()-s))/100;if(!this.silent&&l>5)console.log("long op init ",a.ops[i].objName,l)}this.logStartup("add ops done");for(let e=0;e<this.ops.length;e++){if(this.ops[e].onLoadedValueSet){this.ops[e].onLoadedValueSet(this.ops[e]._origData);this.ops[e].onLoadedValueSet=null;this.ops[e]._origData=null}this.ops[e].emitEvent(y.EVENT_VALUESSET)}this.logStartup("creating links");if(e.opsCreated)e.opsCreated(n);if(a.ops){for(let s=0;s<a.ops.length;s++){if(a.ops[s].portsIn){for(let t=0;t<a.ops[s].portsIn.length;t++){if(a.ops[s].portsIn[t]&&a.ops[s].portsIn[t].links){for(let e=0;e<a.ops[s].portsIn[t].links.length;e++){this._addLink(a.ops[s].portsIn[t].links[e].objIn,a.ops[s].portsIn[t].links[e].objOut,a.ops[s].portsIn[t].links[e].portIn,a.ops[s].portsIn[t].links[e].portOut)}}}}if(a.ops[s].portsOut)for(let n=0;n<a.ops[s].portsOut.length;n++)if(a.ops[s].portsOut[n]&&a.ops[s].portsOut[n].links){for(let r=0;r<a.ops[s].portsOut[n].links.length;r++){if(a.ops[s].portsOut[n].links[r]){if(a.ops[s].portsOut[n].links[r].subOpRef){const f=this.getOpById(a.ops[s].portsOut[n].links[r].objOut);let t=null;let i=0;for(let e=0;e<this.ops.length;e++){if(this.ops[e].storage&&this.ops[e].storage.ref==a.ops[s].portsOut[n].links[r].subOpRef&&f.uiAttribs.subPatch==this.ops[e].uiAttribs.subPatch){i=this.ops[e].patchId.get();break}}for(let e=0;e<this.ops.length;e++){if(this.ops[e].storage&&this.ops[e].storage.ref==a.ops[s].portsOut[n].links[r].refOp&&this.ops[e].uiAttribs.subPatch==i){t=this.ops[e];break}}if(!t)this._log.warn("could not find op for lost link");else{this._addLink(t.id,a.ops[s].portsOut[n].links[r].objOut,a.ops[s].portsOut[n].links[r].portIn,a.ops[s].portsOut[n].links[r].portOut)}}else{const i=this._addLink(a.ops[s].portsOut[n].links[r].objIn,a.ops[s].portsOut[n].links[r].objOut,a.ops[s].portsOut[n].links[r].portIn,a.ops[s].portsOut[n].links[r].portOut);if(!i){const g=this.getOpById(a.ops[s].portsOut[n].links[r].objIn);const d=this.getOpById(a.ops[s].portsOut[n].links[r].objOut);if(!g)console.log("could not find link op1");if(!d)console.log("could not find link op2");const m=a.ops[s].portsOut[n].links[r].portIn;if(g&&!g.getPort(m)){g.preservedPortLinks[m]=g.preservedPortLinks[m]||[];g.preservedPortLinks[m].push(a.ops[s].portsOut[n].links[r])}const p=a.ops[s].portsOut[n].links[r].portOut;if(d&&!d.getPort(p)){d.preservedPortLinks[m]=d.preservedPortLinks[m]||[];d.preservedPortLinks[m].push(a.ops[s].portsOut[n].links[r])}}}}}}}}this.logStartup("calling ops onloaded");for(let e=0;e<this.ops.length;e++){if(this.ops[e].onLoaded){this.ops[e].onLoaded();this.ops[e].onLoaded=null}}this.logStartup("initializing ops...");for(let e=0;e<this.ops.length;e++){if(this.ops[e].init){try{this.ops[e].init();this.ops[e].init=null}catch(e){console.error("op.init crash",e)}}}this.logStartup("initializing vars...");if(this.config.variables)for(const _ in this.config.variables)this.setVarValue(_,this.config.variables[_]);this.logStartup("initializing var ports");for(let e=0;e<this.ops.length;e++){this.ops[e].initVarPorts();delete this.ops[e].uiAttribs.pasted}setTimeout(()=>{this.loading.finished(t)},100);this.updateAnimMaxTime();if(this.config.onPatchLoaded)this.config.onPatchLoaded(this);this.emitEvent(y.EVENT_PATCHLOADEND,r,a,e.genIds);this.#initialDeserialize=false}profile(e){this.profiler=new N(this);for(let e=0;e<this.ops.length;e++)this.ops[e].profile()}setVariable(e,t){if(this._variables[e]!==undefined){this._variables[e].setValue(t)}else{this._log.warn("variable "+e+" not found!")}}_sortVars(){if(!this.isEditorMode())return;const t={};Object.keys(this._variables).sort((e,t)=>{return e.localeCompare(t,"en",{sensitivity:"base"})}).forEach(e=>{t[e]=this._variables[e]});this._variables=t}hasVar(e){return this._variables[e]!==undefined}setVarValue(e,t,i){if(this.hasVar(e)){this._variables[e].setValue(t)}else{this._variables[e]=new ne(e,t,i);this._sortVars();this.emitEvent(y.EVENT_VARIABLES_CHANGED)}return this._variables[e]}getVarValue(e,t){if(this._variables.hasOwnProperty(e))return this._variables[e].getValue()}getVar(e){if(this._variables.hasOwnProperty(e))return this._variables[e]}deleteVar(i){for(let t=0;t<this.ops.length;t++)for(let e=0;e<this.ops[t].portsIn.length;e++)if(this.ops[t].portsIn[e].getVariableName()==i)this.ops[t].portsIn[e].setVariable(null);delete this._variables[i];this.emitEvent("variableDeleted",i);this.emitEvent("variablesChanged")}getVars(t){if(t===undefined)return this._variables;if(t===1)return{};const e=y.getGui().uiProfiler.start("[corepatchetend] getVars");const i=[];let r="";if(t==O.TYPE_STRING)r="string";else if(t==O.TYPE_VALUE)r="number";else if(t==O.TYPE_ARRAY)r="array";else if(t==O.TYPE_OBJECT)r="object";else if(t==O.TYPE_DYNAMIC)r="dynamic";else{console.log("unknown port type",t);console.log((new Error).stack)}for(const e in this._variables){if(!this._variables[e].type||this._variables[e].type==r||this._variables[e].type==t)i.push(this._variables[e])}e.finish();return i}preRenderOps(){this._log.log("prerendering...");for(let e=0;e<this.ops.length;e++){if(this.ops[e].preRender){this.ops[e].preRender();this._log.log("prerender "+this.ops[e].objName)}}}dispose(){this.pause();this.clear();this.emitEvent(y.EVENT_DISPOSE)}pushTriggerStack(e){this._triggerStack.push(e)}popTriggerStack(){this._triggerStack.pop()}printTriggerStack(){if(this._triggerStack.length==0){return}console.groupCollapsed("trigger port stack "+this._triggerStack[this._triggerStack.length-1].op.objName+"."+this._triggerStack[this._triggerStack.length-1].name);const t=[];for(let e=0;e<this._triggerStack.length;e++){t.push(e+". "+this._triggerStack[e].op.objName+" "+this._triggerStack[e].name)}console.table(t);console.groupEnd()}get containerElement(){if(this.config.containerElement)return this.config.containerElement;if(this.cg&&this.cg.canvas.parentElement)return this.cg.canvas.parentElement;if(this.cgl&&this.cgl.canvas.parentElement)return this.cgl.canvas.parentElement;return document.body}getDocument(){return this.containerElement.ownerDocument}static getOpClass(e){const t=e.split(".");let i=null;try{if(t.length==2)i=window[t[0]][t[1]];else if(t.length==3)i=window[t[0]][t[1]][t[2]];else if(t.length==4)i=window[t[0]][t[1]][t[2]][t[3]];else if(t.length==5)i=window[t[0]][t[1]][t[2]][t[3]][t[4]];else if(t.length==6)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]];else if(t.length==7)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]];else if(t.length==8)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]][t[7]];else if(t.length==9)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]][t[7]][t[8]];else if(t.length==10)i=window[t[0]][t[1]][t[2]][t[3]][t[4]][t[5]][t[6]][t[7]][t[8]][t[9]];return i}catch(e){return null}}static replaceOpIds(r,n){const t={};for(const e in r.ops){t[r.ops[e].id]=r.ops[e]}for(const i in r.ops){for(const o in r.ops[i].portsOut){const l=r.ops[i].portsOut[o].links;if(l){let e=l.length;while(e--){if(l[e]&&(!t[l[e].objIn]||!t[l[e].objOut])){if(!n.doNotUnlinkLostLinks){l.splice(e,1)}else{if(n.fixLostLinks){const u=y.getGui().corePatch().getOpById(l[e].objIn);if(!u)console.log("op not found!");else{const h=y.getGui().patchView.getSubPatchOuterOp(u.uiAttribs.subPatch);if(h){u.storage=u.storage||{};u.storage.ref=u.storage.ref||b();l[e].refOp=u.storage.ref;l[e].subOpRef=h.storage.ref}}}}}}}}}for(const t in r.ops){const u=r.ops[t];const c=u.id;let e=b();if(n.prefixHash)e=p(n.prefixHash+c);else if(n.prefixId)e=n.prefixId+c;else if(n.refAsId){if(u.storage&&u.storage.ref){e=u.storage.ref;delete u.storage.ref}else{u.storage=u.storage||{};u.storage.ref=e=b()}}const f=u.id=e;if(n.oldIdAsRef){u.storage=u.storage||{};u.storage.ref=c}for(const i in r.ops){if(r.ops[i].portsIn)for(const o in r.ops[i].portsIn){if(r.ops[i].portsIn[o].links){let e=r.ops[i].portsIn[o].links.length;while(e--)if(r.ops[i].portsIn[o].links[e]===null)r.ops[i].portsIn[o].links.splice(e,1);for(e in r.ops[i].portsIn[o].links){if(r.ops[i].portsIn[o].links[e].objIn===c)r.ops[i].portsIn[o].links[e].objIn=f;if(r.ops[i].portsIn[o].links[e].objOut===c)r.ops[i].portsIn[o].links[e].objOut=f}}}if(r.ops[i].portsOut)for(const o in r.ops[i].portsOut){if(r.ops[i].portsOut[o].links){let e=r.ops[i].portsOut[o].links.length;while(e--)if(r.ops[i].portsOut[o].links[e]===null)r.ops[i].portsOut[o].links.splice(e,1);for(e in r.ops[i].portsOut[o].links){if(r.ops[i].portsOut[o].links[e].objIn===c)r.ops[i].portsOut[o].links[e].objIn=f;if(r.ops[i].portsOut[o].links[e].objOut===c)r.ops[i].portsOut[o].links[e].objOut=f}}}}}const s=[];const a=[];for(let i=0;i<r.ops.length;i++){if(r.ops[i].storage&&r.ops[i].storage.subPatchVer){for(let t=0;t<r.ops[i].portsIn.length;t++){if(r.ops[i].portsIn[t].name==="patchId"){let e=b();if(n.prefixHash)e=p(n.prefixHash+r.ops[i].portsIn[t].value);const g=r.ops[i].portsIn[t].value;const d=r.ops[i].portsIn[t].value=e;s.push(d);for(let e=0;e<r.ops.length;e++){if(r.ops[e].uiAttribs){if(r.ops[e].uiAttribs.subPatch===g){r.ops[e].uiAttribs.subPatch=d;a.push(r.ops[e].id)}}}}}}}for(const m in r.ops){let t=false;for(let e=0;e<a.length;e++){if(r.ops[m].id===a[e]){t=true;break}}if(!t&&r.ops[m].uiAttribs&&n.parentSubPatchId!=null)r.ops[m].uiAttribs.subPatch=n.parentSubPatchId}return r}}class se extends O{constructor(e,t,i,r,n){super(e,t,i,r);this.get=()=>{let e=super.get();if(CABLES.UI){if(e===""||e===null||e===undefined||r.values&&r.values.indexOf(String(e))===-1){this.op.setUiError("invalidswitch","Invalid Value ["+this.name+']: "'+e+'"',1)}else this.op.setUiError("invalidswitch",null)}if(e===null||e===undefined)e="";return e};this.indexPort=n;this.indexPort.set=e=>{const t=r.values;if(!t){return}let i=Math.floor(e);i=Math.min(i,t.length-1);i=Math.max(i,0);this.indexPort.setValue(i);this.set(t[i]);if(this.op.patch.isEditorMode()&&performance.now()-(this.lastTime||0)>100&&y.getGui()&&y.getGui().patchView.isCurrentOp(this.op)){y.getGui().opParams.show(this.op);this.lastTime=performance.now()}}}setUiAttribs(e){const t=e.hidePort;e.hidePort=true;super.setUiAttribs(e);if(typeof t!=="undefined")this.indexPort.setUiAttribs({hidePort:t})}}class ae extends se{setUiAttribs(e){if(this.indexPort.isLinked()){for(const t in e){if(t=="greyout"&&!e[t])e[t]="true"}}super.setUiAttribs(e)}}const P=2;class oe extends O{constructor(e,i,r,n,t,s){super(e,i,O.TYPE_ARRAY,t);this.setUiAttribs({multiPort:true,group:this.name,order:-1});this.ports=[];this.direction=n;this._uiAttribsPorts=s;const a=()=>{const t=[];let i=1;if(this.uiAttribs.multiPortManual)i=0;for(let e=0;e<this.ports.length-i;e++)t[e]=this.ports[e];this.setRef(t)};const o=()=>{let s=!this.uiAttribs.multiPortManual||false;if(this.direction==u.PORT.PORT_DIR_OUT)s=false;for(let n=0;n<this.ports.length;n++){let e;let t=false;let i;let r={};if(this.op.preservedPortTitles&&this.op.preservedPortTitles[this.ports[n].name])i=this.op.preservedPortTitles[this.ports[n].name];if(n==0)e=this.ports.length;if(!this.uiAttribs.multiPortManual)if(n==this.ports.length-1){i="add port";t=true;s=true}for(const a in this._uiAttribsPorts){r[a]=this._uiAttribsPorts[a]}r.addPort=t;r.longPort=e;r.title=i;r.greyout=s;r.group=this.name;this.ports[n].setUiAttribs(r)}};this.removeInvalidPorts=()=>{for(let e=0;e<this.ports.length;e++){if(!this.ports[e])this.ports.splice(e,1)}if(!this.uiAttribs.multiPortManual){if(this.ports.length>P)for(let e=this.ports.length-1;e>1;e--){if(!this.ports[e].isLinked())this.uiAttribs.multiPortNum=e;else break}}a()};this.countPorts=()=>{const e=y.getGui();if(CABLES.UI&&!e.isRemoteClient&&e.patchView&&e.patchView.patchRenderer&&e.patchView.patchRenderer.isDraggingPort()){clearTimeout(this.retryTo);this.retryTo=setTimeout(this.countPorts.bind(this));return}this.retryTo=null;let i=false;this.removeListeners();this.removeInvalidPorts();for(let e=0;e<this.ports.length;e++){if(this.ports[e]&&this.ports[e].links.length>1){const r=this.ports[e+1];const n=this.ports[e].links[0].getOtherPort(this.ports[e]);if(!r||!n){this._log.warn("no port found?")}else{this.ports[e].links[0].remove();this.op.patch.link(this.op,r.name,n.op,n.name);i=true}break}}if(!this.uiAttribs.multiPortManual){let t=true;while(t){t=false;for(let e=this.ports.length-1;e>1;e--){if(this.ports[e]&&this.ports[e].links.length>0&&this.ports[e-1].links.length==0){const n=this.ports[e].links[0].getOtherPort(this.ports[e]);this.ports[e].links[0].remove();const r=this.ports[e-1];if(r&&this.ports[e]){this.op.patch.link(this.op,r.name,n.op,n.name);t=true;i=true;break}}}}}if(!this.uiAttribs.multiPortManual){while(this.ports.length>P&&!this.ports[this.ports.length-1].isLinked()&&!this.ports[this.ports.length-2].isLinked()){let e=this.ports.length-1;if(!this.ports[e].isLinked()&&this.ports[e-1]&&!this.ports[e-1].isLinked()){this.ports[e].setUiAttribs({removed:true});this.ports[e].remove();this.ports.splice(e,1)}}}this.removeInvalidPorts();if(!this.uiAttribs.multiPortManual&&this.ports.length>0&&this.ports[this.ports.length-1].isLinked())this.newPort();a();o();if(i)this.countPorts();else this.addListeners()};this.removeListeners=()=>{for(let e=0;e<this.ports.length;e++){const t=this.ports[e];if(t.multiPortChangeListener)t.multiPortChangeListener=t.off(t.multiPortChangeListener);if(t.multiLinkChangeListener)t.multiLinkChangeListener=t.off(t.multiLinkChangeListener)}};this.addListeners=()=>{for(let e=0;e<this.ports.length;e++){const t=this.ports[e];const i=e;if(t.multiPortChangeListener)t.multiPortChangeListener=t.off(t.multiPortChangeListener);t.multiPortChangeListener=t.on("change",a.bind(this));if(t.multiPortTriggerListener)t.multiPortTriggerListener=t.off(t.multiPortTriggerListener);t.multiPortTriggerListener=t.on("trigger",()=>{this._onTriggered()});if(t.multiLinkChangeListener)t.multiLinkChangeListener=t.off(t.multiLinkChangeListener);t.multiLinkChangeListener=t.on("onLinkChanged",()=>{this.countPorts();this.emitEvent("onLinkChanged")});if(t.multiLinkRemoveListener)t.multiLinkRemoveListener=t.off(t.multiLinkRemoveListener);t.multiLinkRemoveListener=t.on("onLinkRemoved",()=>{o();this.emitEvent("onLinkChanged")})}};this.newPort=()=>{const e={};e.type=r;const t=new O(this.op,i+"_"+this.ports.length,r,e);t.direction=n;if(this.direction==u.PORT.PORT_DIR_OUT)this.op.addOutPort(t);else this.op.addInPort(t,this.ports[this.ports.length-1]);this.ports.push(t);if(r==O.TYPE_NUMBER)t.setInitialValue(0);else if(r==O.TYPE_STRING)t.setInitialValue("");this.addListeners();o();a();this.emitEvent("onLinkChanged");if(this.op.preservedPortTitles&&this.op.preservedPortTitles[t.name])t.setUiAttribs({title:this.op.preservedPortTitles[t.name]});return t};this.initPorts=()=>{for(let e=0;e<P;e++)this.newPort();a();o()};this.checkNum=()=>{this.uiAttribs.multiPortNum=Math.max(P,this.uiAttribs.multiPortNum);while(this.ports.length<this.uiAttribs.multiPortNum)this.newPort();while(this.ports.length>this.uiAttribs.multiPortNum)if(this.ports[this.ports.length-1])this.ports.pop().remove();this.removeInvalidPorts()};this.incDec=e=>{this.uiAttribs.multiPortNum=this.uiAttribs.multiPortNum||P;this.setUiAttribs({multiPortNum:this.uiAttribs.multiPortNum+e});this.checkNum();o()};this.toggleManual=()=>{this.setUiAttribs({multiPortManual:!this.uiAttribs.multiPortManual});this.op.refreshParams()};this.on("onUiAttrChange",e=>{if(e.hasOwnProperty("multiPortManual")){o();this.removeInvalidPorts();this.checkNum();this.countPorts();o()}});this.on("onUiAttrChange",this.checkNum.bind(this));this.checkNum();this.countPorts();this.removeInvalidPorts();o()}}const L=2;class le extends O{constructor(e,i,r,n,t,s){super(e,i,O.TYPE_ARRAY,t);this.setUiAttribs({multiPort2:true,multiPort:true,group:this.name,order:-1,multiPortManual:true});this.ports=[];this.direction=n;this._uiAttribsPorts=s;const a=()=>{const t=[];let i=1;for(let e=0;e<this.ports.length-i;e++)t[e]=this.ports[e];this.setRef(t)};const o=()=>{let s=!this.uiAttribs.multiPortManual;if(this.direction==u.PORT.PORT_DIR_OUT)s=false;for(let n=0;n<this.ports.length;n++){let e;let t=false;let i;let r={};if(this.op.preservedPortTitles&&this.op.preservedPortTitles[this.ports[n].name])i=this.op.preservedPortTitles[this.ports[n].name];if(n==0)e=this.ports.length;if(n==this.ports.length-1){i="add port";t=true;s=true}for(const a in this._uiAttribsPorts)r[a]=this._uiAttribsPorts[a];r.addPort=t;r.longPort=e;r.title=i;r.greyout=s;r.group=this.name;this.ports[n].setUiAttribs(r)}};this.removeInvalidPorts=()=>{for(let e=0;e<this.ports.length;e++)if(!this.ports[e])this.ports.splice(e,1);a()};this.countPorts=()=>{const e=y.getGui();if(CABLES.UI&&!e.isRemoteClient&&e.patchView&&e.patchView.patchRenderer&&e.patchView.patchRenderer.isDraggingPort()){clearTimeout(this.retryTo);this.retryTo=setTimeout(this.countPorts.bind(this));return}this.retryTo=null;let t=false;this.removeListeners();this.removeInvalidPorts();for(let e=0;e<this.ports.length;e++){if(this.ports[e]&&this.ports[e].links.length>1){const i=this.ports[e+1];const r=this.ports[e].links[0].getOtherPort(this.ports[e]);if(!i||!r){this._log.warn("no port found?")}else{this.ports[e].links[0].remove();this.op.patch.link(this.op,i.name,r.op,r.name);t=true}break}}if(this.ports.length>1&&this.ports[this.ports.length-1].uiAttribs.addPort&&this.ports[this.ports.length-1].isLinked()){this.ports[this.ports.length-1].uiAttribs.addPort=false;this.setUiAttribs({multiPortNum:this.uiAttribs.multiPortNum+1})}this.removeInvalidPorts();if(!this.uiAttribs.multiPortManual&&this.ports.length>0&&this.ports[this.ports.length-1].isLinked())this.newPort();a();o();if(t)this.countPorts();else this.addListeners()};this.removeListeners=()=>{for(let e=0;e<this.ports.length;e++){const t=this.ports[e];if(t.multiPortChangeListener)t.multiPortChangeListener=t.off(t.multiPortChangeListener);if(t.multiLinkChangeListener)t.multiLinkChangeListener=t.off(t.multiLinkChangeListener)}};this.addListeners=()=>{for(let e=0;e<this.ports.length;e++){const t=this.ports[e];const i=e;if(t.multiPortChangeListener)t.multiPortChangeListener=t.off(t.multiPortChangeListener);t.multiPortChangeListener=t.on("change",a.bind(this));if(t.multiPortTriggerListener)t.multiPortTriggerListener=t.off(t.multiPortTriggerListener);t.multiPortTriggerListener=t.on("trigger",()=>{this._onTriggered(i)});if(t.multiLinkChangeListener)t.multiLinkChangeListener=t.off(t.multiLinkChangeListener);t.multiLinkChangeListener=t.on("onLinkChanged",()=>{this.countPorts();this.emitEvent("onLinkChanged")});if(t.multiLinkRemoveListener)t.multiLinkRemoveListener=t.off(t.multiLinkRemoveListener);t.multiLinkRemoveListener=t.on("onLinkRemoved",()=>{o();this.emitEvent("onLinkChanged")})}};this.newPort=()=>{const e={};e.type=r;const t=new O(this.op,i+"_"+this.ports.length,r,e);t.direction=n;if(this.direction==u.PORT.PORT_DIR_OUT)this.op.addOutPort(t);else this.op.addInPort(t,this.ports[this.ports.length-1]);this.ports.push(t);if(r==O.TYPE_NUMBER)t.setInitialValue(0);else if(r==O.TYPE_STRING)t.setInitialValue("");this.addListeners();o();a();this.emitEvent("onLinkChanged");if(this.op.preservedPortTitles&&this.op.preservedPortTitles[t.name])t.setUiAttribs({title:this.op.preservedPortTitles[t.name]});return t};this.initPorts=()=>{for(let e=0;e<L;e++)this.newPort();a();o()};this.checkNum=()=>{this.uiAttribs.multiPortNum=Math.max(L,this.uiAttribs.multiPortNum);while(this.ports.length<this.uiAttribs.multiPortNum)this.newPort();while(this.ports.length>this.uiAttribs.multiPortNum)if(this.ports[this.ports.length-1])this.ports.pop().remove();this.removeInvalidPorts();if(this.ports.length>1&&this.ports[this.ports.length-1].uiAttribs.addPort&&this.ports[this.ports.length-1].isLinked()){this.ports[this.ports.length-1].removeLinks();console.log("found invalid")}};this.incDec=e=>{this.uiAttribs.multiPortNum=this.uiAttribs.multiPortNum||L;this.setUiAttribs({multiPortNum:this.uiAttribs.multiPortNum+e});this.checkNum();o()};this.on("onUiAttrChange",this.checkNum.bind(this));this.checkNum();this.countPorts();this.removeInvalidPorts();o()}}class w extends t{static OP_VERSION_PREFIX="_v";static EVENT_INIT="init";static EVENT_UIATTR_CHANGE="onUiAttribsChange";static UI_ERRORLEVEL_HINT=0;static UI_ERRORLEVEL_WARNING=1;static UI_ERRORLEVEL_ERROR=2;static UI_ERRORLEVEL_NOTWORKING=3;#objName="";_log=new n("core_op");#shortOpName="";opId="";portsOut=[];patch=null;data={};storage={};portsIn=[];portsInData=[];uiAttribs={};enabled=true;onAnimFrame=null;preservedPortTitles={};preservedPortValues={};preservedPortLinks={};linkTimeRules={needsLinkedToWork:[],needsStringToWork:[],needsParentOp:null};shouldWork={};hasUiErrors=0;uiErrors={};hasAnimPort=false;patchId=null;constructor(e,t,i=null){super();this.opId=i;this.#objName=t;this.patch=e;this.#shortOpName=CABLES.getShortOpName(t);this.getTitle();this.id=i||b();this.onAddPort=null;this.onCreate=null;this.onResize=null;this.onLoaded=null;this.onDelete=null;this.onError=null;this._instances=null;this.preRender=null;this.init=null}isInBlueprint2(){return false}getSubPatch(){return 0}get name(){return this.getTitle()}set name(e){this.setTitle(e)}set _objName(e){this.#objName=e;this._log=new n("op "+e)}get objName(){return this.#objName}get shortName(){return this.#shortOpName}require(e){if(CABLES.platform&&CABLES.StandaloneElectron&&!CABLES.platform.frontendOptions.isElectron)this.setUiError("notstandalone","This op will only work in cables standalone version",3);return null}checkMainloopExists(){if(!CABLES.UI)return;if(!this.patch.tempData.mainloopOp)this.setUiError("nomainloop","patch should have a mainloop to use this op");else this.setUiError("nomainloop",null)}getTitle(){if(!this.uiAttribs)return"nouiattribs"+this.shortName;return this.uiAttribs.title||this.#shortOpName}setTitle(e){if(e!=this.getTitle())this._setUiAttrib({title:e})}setStorage(e){if(!e)return;this.storage=this.storage||{};let t=false;for(const i in e){if(this.storage[i]!=e[i])t=true;this.storage[i]=e[i]}if(t)this.emitEvent("onStorageChange",e)}isSubPatchOp(){if(this.patchId&&this.storage)return this.storage.subPatchVer||this.storage.blueprintVer||0;return false}setUiAttrib(e){this._setUiAttrib(e)}setUiAttribs(e){this._setUiAttrib(e)}uiAttr(e){this._setUiAttrib(e)}_setUiAttrib(e){if(!e)return;if(typeof e!="object")this._log.error("op.uiAttrib attribs are not of type object");if(!this.uiAttribs)this.uiAttribs={};let t=false;let i=false;if(CABLES.UI&&e.hasOwnProperty("translate")&&(!this.uiAttribs.translate||this.uiAttribs.translate.x!=e.translate.x||this.uiAttribs.translate.y!=e.translate.y))i=true;if(e.hasOwnProperty("title")&&e.title!=this.uiAttribs.title){this.uiAttribs.title=e.title;t=true}if(e.hasOwnProperty("disabled")){t=true;this.setEnabled(!e.disabled)}for(const r in e){if(this.uiAttribs[r]!=e[r])t=true;this.uiAttribs[r]=e[r]}if(this.uiAttribs.hasOwnProperty("highlighted")&&this.uiAttribs.highlighted==false)delete this.uiAttribs.highlighted;if(this.uiAttribs.hasOwnProperty("highlightedMore")&&this.uiAttribs.highlightedMore==false)delete this.uiAttribs.highlightedMore;if(this.uiAttribs.hasOwnProperty("selected")&&this.uiAttribs.selected==false)delete this.uiAttribs.selected;if(this.uiAttribs.hasOwnProperty("selected"))t=true;if(t){this.emitEvent(w.EVENT_UIATTR_CHANGE,e);this.patch.emitEvent("onUiAttribsChange",this,e)}if(i)this.emitEvent("move")}getName(){return this.#shortOpName}addOutPort(e){e.direction=u.PORT.PORT_DIR_OUT;if(e.op!=this)console.error("port op is not this...");this.portsOut.push(e);this.emitEvent("onPortAdd",e);return e}hasDynamicPort(){let e=0;for(e=0;e<this.portsIn.length;e++){if(this.portsIn[e].type==O.TYPE_DYNAMIC)return true;if(this.portsIn[e].getName()=="dyn")return true}for(e=0;e<this.portsOut.length;e++){if(this.portsOut[e].type==O.TYPE_DYNAMIC)return true;if(this.portsOut[e].getName()=="dyn")return true}return false}addInPort(e,t){e.direction=O.DIR_IN;e._op=this;if(!t){this.portsIn.push(e)}else{const i=this.portsIn.indexOf(t);this.portsIn.splice(i+1,0,e)}this.emitEvent("onPortAdd",e);return e}inFunction(e,t){return this.inTrigger(e,t)}inTrigger(e,t){const i=this.addInPort(new O(this,e,O.TYPE_FUNCTION));if(t!==undefined)i.set(t);return i}inTriggerButton(e,t){const i=this.addInPort(new O(this,e,O.TYPE_FUNCTION,{display:"button"}));if(t!==undefined)i.set(t);return i}inUiTriggerButtons(e,t){const i=this.addInPort(new O(this,e,O.TYPE_FUNCTION,{display:"buttons"}));if(t!==undefined)i.set(t);return i}inValueFloat(e,t){return this.inFloat(e,t)}inValue(e,t){return this.inFloat(e,t)}inFloat(e,t){const i=this.addInPort(new O(this,e,O.TYPE_VALUE));i.setInitialValue(t);return i}inValueBool(e,t){return this.inBool(e,t)}inBool(e,t){const i=this.addInPort(new O(this,e,O.TYPE_NUMBER,{display:"bool"}));if(t===true)t=1;if(t===false)t=0;i.setInitialValue(t);return i}inMultiPort(e,t,i){const r={addPort:true,hidePort:true};const n=new oe(this,e,t,O.DIR_IN,r,i);n.ignoreValueSerialize=true;this.addInPort(n);n.initPorts();return n}inMultiPort2(e,t,i){const r={addPort:true,hidePort:true};const n=new le(this,e,t,O.DIR_IN,r,i);n.ignoreValueSerialize=true;this.addInPort(n);n.initPorts();return n}outMultiPort(e,t,i={}){const r=new oe(this,e,t,u.PORT.PORT_DIR_OUT,{display:"multiport",hidePort:true},i);r.ignoreValueSerialize=true;this.addOutPort(r);r.initPorts();return r}outMultiPort2(e,t,i={}){const r=new le(this,e,t,u.PORT.PORT_DIR_OUT,{display:"multiport",hidePort:true},i);r.ignoreValueSerialize=true;this.addOutPort(r);r.initPorts();return r}inValueString(e,t){const i=this.addInPort(new O(this,e,O.TYPE_VALUE,{type:"string"}));i.value="";i.setInitialValue(t);return i}inString(e,t){const i=this.addInPort(new O(this,e,O.TYPE_STRING,{type:"string"}));t=t||"";i.setInitialValue(t);return i}inTextarea(e,t){const i=this.addInPort(new O(this,e,O.TYPE_STRING,{type:"string",display:"text"}));i.value="";if(t!==undefined){i.set(t);i.defaultValue=t}return i}inStringEditor(e,t,i,r=true){const n=this.addInPort(new O(this,e,O.TYPE_STRING,{type:"string",display:"editor",editShortcut:true,editorSyntax:i,hideFormatButton:r}));n.value="";if(t!==undefined){n.set(t);n.defaultValue=t}return n}inValueEditor(e,t,i,r=true){const n=this.addInPort(new O(this,e,O.TYPE_NUMBER,{type:"string",display:"editor",editorSyntax:i,hideFormatButton:r}));n.value="";if(t!==undefined){n.set(t);n.defaultValue=t}return n}inValueSelect(e,t,i,r){return this.inDropDown(e,t,i,r)}inDropDown(e,t,i,r){let n=null;if(!r){const s=new O(this,e+" index",O.TYPE_NUMBER,{increment:"integer",hideParam:true});const a=this.addInPort(s);if(t)for(let e=0;e<t.length;e++)t[e]=String(t[e]);const o=new ae(this,e,O.TYPE_NUMBER,{display:"dropdown",hidePort:true,type:"string",values:t},a);o.indexPort=s;o.on("change",(e,t)=>{if(!t.indexPort.isLinked()&&t.uiAttribs.values){const i=t.uiAttribs.values.indexOf(e);if(i>-1)t.indexPort.set(i)}});s.onLinkChanged=()=>{o.setUiAttribs({greyout:s.isLinked()})};n=this.addInPort(o);if(i!==undefined){n.set(i);const l=t.findIndex(e=>{return e==i});a.setValue(l);n.defaultValue=i;a.defaultValue=l}}else{const o=new O(this,e,O.TYPE_VALUE,{display:"dropdown",hidePort:true,type:"string",values:t});n=this.addInPort(o)}return n}inSwitch(e,t,i,r){let n=null;if(!r){if(!i)i=t[0];const s=new O(this,e+" index",O.TYPE_VALUE,{increment:"integer",values:t,hideParam:true});const a=this.addInPort(s);if(t)for(let e=0;e<t.length;e++)t[e]=String(t[e]);const o=new se(this,e,O.TYPE_STRING,{display:"switch",hidePort:true,type:"string",values:t},a);o.indexPort=s;o.on("change",(e,t)=>{if(!t.indexPort.isLinked()&&t.uiAttribs.values){const i=t.uiAttribs.values.indexOf(e);if(i>-1)t.indexPort.set(i)}});s.onLinkChanged=function(){o.setUiAttribs({greyout:s.isLinked()})};n=this.addInPort(o);if(i!==undefined){n.set(i);const l=t.findIndex(e=>{return e==i});a.setValue(l);n.defaultValue=i;a.defaultValue=l}}else{const o=new O(this,e,O.TYPE_STRING,{display:"switch",hidePort:true,type:"string",values:t});n=this.addInPort(o)}return n}inValueInt(e,t){return this.inInt(e,t)}inInt(e,t){const i=this.addInPort(new O(this,e,O.TYPE_VALUE,{increment:"integer"}));if(t!==undefined){i.set(t);i.defaultValue=t}return i}inFile(e,t,i){const r=this.addInPort(new O(this,e,O.TYPE_VALUE,{display:"file",type:"string",filter:t}));if(i!==undefined){r.set(i);r.defaultValue=i}return r}inUrl(e,t,i){const r=this.addInPort(new O(this,e,O.TYPE_STRING,{display:"file",type:"string",filter:t}));if(i!==undefined){r.set(i);r.defaultValue=i}return r}inTexture(e,t){const i=this.addInPort(new O(this,e,O.TYPE_OBJECT,{display:"texture",objType:"texture",preview:true}));i.ignoreValueSerialize=true;if(t!==undefined)i.set(t);return i}inObject(e,t,i){const r=this.addInPort(new O(this,e,O.TYPE_OBJECT,{objType:i}));r.ignoreValueSerialize=true;if(t!==undefined)r.set(t);return r}inGradient(e,t){const i=this.addInPort(new O(this,e,O.TYPE_VALUE,{display:"gradient"}));if(t!==undefined)i.set(t);return i}getPortVisibleIndex(t){let i=this.portsIn;if(t.direction==u.PORT_DIR_OUT)i=this.portsOut;let r=0;for(let e=0;e<i.length;e++){if(i[e].uiAttribs.hidePort)continue;r++;if(i[e]==t)return r}}inArray(e,t=undefined,i=undefined){let r=i;if(!i&&CABLES.isNumeric(t))r=t;const n=this.addInPort(new O(this,e,O.TYPE_ARRAY,{stride:r}));if(t!==undefined&&(Array.isArray(t)||t==null))n.set(t);return n}inValueSlider(e,t,i,r){return this.inFloatSlider(e,t,i,r)}inFloatSlider(e,t,i,r){const n={display:"range"};if(i!=undefined&&r!=undefined){n.min=i;n.max=r}const s=this.addInPort(new O(this,e,O.TYPE_VALUE,n));if(t!==undefined){s.set(t);s.defaultValue=t}return s}outFunction(e,t){return this.outTrigger(e,t)}outTrigger(e,t){const i=this.addOutPort(new O(this,e,O.TYPE_FUNCTION));if(t!==undefined)i.set(t);return i}outValue(e,t){return this.outNumber(e,t)}outNumber(e,t){const i=this.addOutPort(new O(this,e,O.TYPE_VALUE));if(t!==undefined)i.set(t);return i}outValueBool(e,t){return this.outBool(e,t)}outBool(e,t){const i=this.addOutPort(new O(this,e,O.TYPE_VALUE,{display:"bool"}));if(t!==undefined)i.set(t);else i.set(0);return i}outBoolNum(e,t){const i=this.addOutPort(new O(this,e,O.TYPE_VALUE,{display:"boolnum"}));i.set=function(e){this.setValue(e?1:0)}.bind(i);if(t!==undefined)i.set(t);else i.set(0);return i}outValueString(e,t){const i=this.addOutPort(new O(this,e,O.TYPE_VALUE,{type:"string"}));if(t!==undefined)i.set(t);return i}outString(e,t){const i=this.addOutPort(new O(this,e,O.TYPE_STRING,{type:"string"}));if(t!==undefined)i.set(t);else i.set("");return i}outObject(e,t,i){const r=this.addOutPort(new O(this,e,O.TYPE_OBJECT,{objType:i||null}));r.set(t||null);r.ignoreValueSerialize=true;return r}outArray(e,t,i){if(!i&&CABLES.isNumeric(t))i=t;const r=this.addOutPort(new O(this,e,O.TYPE_ARRAY,{stride:i}));if(t!==undefined&&(Array.isArray(t)||t==null))r.set(t);r.ignoreValueSerialize=true;return r}outTexture(e,t){console.log("outtexture not overwritte.,..");return null}inDynamic(e,t,i,r){const n=new O(this,e,O.TYPE_DYNAMIC,i);n.shouldLink=()=>{if(t&&Array.isArray(t))return false;return true};this.addInPort(n);if(r!==undefined){n.set(r);n.defaultValue=r}return n}removeLinks(){for(let e=0;e<this.portsIn.length;e++)this.portsIn[e].removeLinks();for(let e=0;e<this.portsOut.length;e++)this.portsOut[e].removeLinks()}getSerialized(){const t={};if(this.opId)t.opId=this.opId;if(this.patch.storeObjNames)t.objName=this.objName;t.id=this.id;t.uiAttribs=JSON.parse(JSON.stringify(this.uiAttribs))||{};if(this.storage&&Object.keys(this.storage).length>0)t.storage=JSON.parse(JSON.stringify(this.storage));if(this.uiAttribs.hasOwnProperty("working")&&this.uiAttribs.working==true)delete this.uiAttribs.working;if(t.uiAttribs.hasOwnProperty("uierrors"))delete t.uiAttribs.uierrors;if(t.uiAttribs.hasOwnProperty("highlighted"))delete t.uiAttribs.highlighted;if(t.uiAttribs.hasOwnProperty("highlightedMore"))delete t.uiAttribs.highlightedMore;if(t.uiAttribs.hasOwnProperty("heatmapIntensity"))delete t.uiAttribs.heatmapIntensity;if(t.uiAttribs.title==="")delete t.uiAttribs.title;if(t.uiAttribs.color===null)delete t.uiAttribs.color;if(t.uiAttribs.comment===null)delete t.uiAttribs.comment;if(t.uiAttribs.title==this.#shortOpName||(this.uiAttribs.title||"").toLowerCase()==this.#shortOpName.toLowerCase())delete t.uiAttribs.title;t.portsIn=[];t.portsOut=[];for(let e=0;e<this.portsIn.length;e++){const i=this.portsIn[e].getSerialized();if(i)t.portsIn.push(i)}for(let e=0;e<this.portsOut.length;e++){const i=this.portsOut[e].getSerialized();if(i)t.portsOut.push(i)}if(t.portsIn.length==0)delete t.portsIn;if(t.portsOut.length==0)delete t.portsOut;c(t);return t}getFirstOutPortByType(t){for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].type==t)return this.portsOut[e]}getFirstInPortByType(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].type==t)return this.portsIn[e]}getPort(e,t=false){return this.getPortByName(e,t)}getPortByName(t,e=false){if(e){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getName().toLowerCase()==t||this.portsIn[e].id.toLowerCase()==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].getName().toLowerCase()==t||this.portsOut[e].id.toLowerCase()==t)return this.portsOut[e]}else{for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getName()==t||this.portsIn[e].id==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].getName()==t||this.portsOut[e].id==t)return this.portsOut[e]}}getPortById(t){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].id==t)return this.portsIn[e];for(let e=0;e<this.portsOut.length;e++)if(this.portsOut[e].id==t)return this.portsOut[e]}updateAnims(){if(this.hasAnimPort)for(let e=0;e<this.portsIn.length;e++)this.portsIn[e].updateAnim()}log(){this._log.log(...arguments)}error(){this._log.error(...arguments)}logError(){this._log.error(...arguments)}warn(){this._log.warn(...arguments)}logWarn(){this._log.warn(...arguments)}verbose(){this._log.verbose(...arguments)}logVerbose(){this._log.verbose(...arguments)}profile(){for(let e=0;e<this.portsIn.length;e++){this.portsIn[e]._onTriggered=this.portsIn[e]._onTriggeredProfiling;this.portsIn[e].set=this.portsIn[e]._onSetProfiling}}cleanUp(){if(this._instances){for(let e=0;e<this._instances.length;e++)if(this._instances[e].onDelete)this._instances[e].onDelete();this._instances.length=0}for(let e=0;e<this.portsIn.length;e++)this.portsIn[e].setAnimated(false);if(this.onAnimFrame)this.patch.removeOnAnimFrame(this)}instanced(e){return false}initInstancable(){}hasUiError(e){return this.uiErrors.hasOwnProperty(e)&&this.uiErrors[e]}setUiError(e,t,i=2,r={}){}setEnabled(e){this.enabled=e;this.emitEvent("onEnabledChange",e)}setPortGroup(t,i){for(let e=0;e<i.length;e++){if(i[e])if(i[e].setUiAttribs)i[e].setUiAttribs({group:t});else this._log.error("setPortGroup: invalid port!")}}setUiAxisPorts(e,t,i){if(e)e.setUiAttribs({axis:"X"});if(t)t.setUiAttribs({axis:"Y"});if(i)i.setUiAttribs({axis:"Z"})}removePort(t){for(let e=0;e<this.portsIn.length;e++){if(this.portsIn[e]==t){this.portsIn.splice(e,1);this.emitEvent(w.EVENT_UIATTR_CHANGE,{});this.emitEvent("onPortRemoved",{});return}}for(let e=0;e<this.portsOut.length;e++){if(this.portsOut[e]==t){this.portsOut.splice(e,1);this.emitEvent(w.EVENT_UIATTR_CHANGE,{});this.emitEvent("onPortRemoved",{});return}}}toWorkNeedsParent(e){this.linkTimeRules.needsParentOp=e}toWorkShouldNotBeChild(e,t){if(!this.patch.isEditorMode())return;this.linkTimeRules.forbiddenParent=e;if(t!=undefined)this.linkTimeRules.forbiddenParentType=t}toWorkPortsNeedsString(){if(!this.patch.isEditorMode())return;for(let e=0;e<arguments.length;e++)if(this.linkTimeRules.needsStringToWork.indexOf(arguments[e])==-1)this.linkTimeRules.needsStringToWork.push(arguments[e])}toWorkPortsNeedToBeLinked(){if(!this.patch.isEditorMode())return;for(let e=0;e<arguments.length;e++)if(this.linkTimeRules.needsLinkedToWork.indexOf(arguments[e])==-1)this.linkTimeRules.needsLinkedToWork.push(arguments[e])}toWorkPortsNeedToBeLinkedReset(){if(!this.patch.isEditorMode())return;this.linkTimeRules.needsLinkedToWork.length=0;if(this.checkLinkTimeWarnings)this.checkLinkTimeWarnings()}initVarPorts(){for(let e=0;e<this.portsIn.length;e++)if(this.portsIn[e].getVariableName())this.portsIn[e].setVariable(this.portsIn[e].getVariableName())}checkLinkTimeWarnings(){}_checkLinksNeededToWork(){}refreshParams(){if(this.patch&&this.patch.isEditorMode()&&this.isCurrentUiOp())y.getGui().opParams.show(this)}isCurrentUiOp(){if(this.patch.isEditorMode())return y.getGui().patchView.isCurrentOp(this)}checkGraphicsApi(e=1){if(this.patch.isEditorMode())if(this.patch.cg&&this.patch.cg.gApi!=e)this.setUiError("wronggapi","Wrong graphics API",2)}}const F={};F.addPatch=function(e,t){let i=e;let r=o();if(typeof e=="string"){r=e;i=document.getElementById(r);if(!i){console.error(r+" Polyshape Container Element not found!");return}}const n=document.createElement("canvas");n.id="glcanvas_"+r;n.width=i.clientWidth;n.height=i.clientHeight;window.addEventListener("resize",function(){this.setAttribute("width",i.clientWidth);this.height=i.clientHeight}.bind(n));i.appendChild(n);t=t||{};t.glCanvasId=n.id;if(!t.onError){t.onError=function(e){console.error(e)}}CABLES.patch=new y(t);return n};const ue=function(){let t=null;const i=[];this.onChanged=function(e){i.push(e)};this.getValue=function(){return t};this.setValue=function(e){t=e;this.emitChanged()};this.emitChanged=function(){for(let e=0;e<i.length;e++){i[e]()}}};class he extends t{paused=false;frameNum=0;frameStartTime=0;exec(e){}pause(){}resume(){}}CABLES=CABLES||{};CABLES={...CABLES,...u.PORT,...u.PACO,...u.ANIM,...u.OP};CABLES.EMBED=F;CABLES.Link=I;CABLES.Port=O;CABLES.Op=w;CABLES.Profiler=N;CABLES.Patch=y;CABLES.Timer=R;CABLES.Variable=ue;CABLES.LoadingStatus=S;CABLES.now=C;CABLES.internalNow=M;CABLES.Anim=h;CABLES.AnimKey=l;CABLES.RenderLoop=he;CABLES.shortId=b;CABLES.uuid=a;CABLES.getShortOpName=i;CABLES.simpleId=g;CABLES.clamp=_;CABLES.map=v;CABLES.shuffleArray=r;CABLES.generateUUID=o;CABLES.prefixedHash=p;CABLES.smoothStep=d;CABLES.smootherStep=m;CABLES.cacheBust=E;CABLES.copyArray=A;CABLES.basename=W;CABLES.logStack=Z;CABLES.filename=K;CABLES.ajax=T;CABLES.logErrorConsole=J;CABLES.isNumeric=x;CABLES.uniqueArray=$;CABLES.OPS=[];CABLES.utils=e;CABLES.CONSTANTS=u;CABLES.SHARED={};CABLES.SHARED.Events=t;CABLES.SHARED.Logger=n;const ce=CABLES;if(!function(){return!this}())console.warn("not in strict mode: index core")})();var e=CABLES=typeof CABLES==="undefined"?{}:CABLES;for(var t in ge)e[t]=ge[t];if(ge.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();var CABLES=CABLES||{};CABLES.build={timestamp:1765905240353,created:"2025-12-16T17:14:00.353Z",git:{branch:"master",commit:"9fcc94f55ff19aae41cda73b4d136cebd8cd57f4",date:"1765801614",message:"gradients"}};if(!CABLES.exportedPatches)CABLES.exportedPatches={};CABLES.exportedPatches["g9QGb8"]={_id:"6966417b95b4e8ede5ef3516",ops:[{id:"yk180n3ld",uiAttribs:{},portsIn:[{name:"value",value:50}],portsOut:[{name:"result",links:[{portIn:"Inc factor",portOut:"result",objIn:"xtshifs23",objOut:"yk180n3ld"},{portIn:"Inc factor",portOut:"result",objIn:"w19qah5hl",objOut:"yk180n3ld"}]}],objName:"Ops.Number.Number"},{id:"ouoktj48w",uiAttribs:{},portsIn:[{name:"Max Pixel Density (DPR)",value:2},{name:"FPS Limit",value:60},{name:"Reduce FPS unfocussed",value:0},{name:"Transparent",value:0},{name:"Active",value:1},{name:"Focus canvas",value:1}],portsOut:[{name:"trigger",links:[{portIn:"Exec",portOut:"trigger",objIn:"wgibs13n7",objOut:"ouoktj48w"},{portIn:"Trigger",portOut:"trigger",objIn:"3aaryjlcn",objOut:"ouoktj48w"},{portIn:"exe",portOut:"trigger",objIn:"1etvfk86a",objOut:"ouoktj48w"},{portIn:"render",portOut:"trigger",objIn:"4g0dcy2sk",objOut:"ouoktj48w"}]},{name:"width",value:982},{name:"height",value:692},{name:"Pixel Density",value:2}],objName:"Ops.Gl.MainLoop_v2"},{id:"c9vb3vnrs",uiAttribs:{},portsIn:[{name:"Input Type index",value:1},{name:"Input Type",value:"-1 to 1"}],portsOut:[{name:"Trigger out",links:[{portIn:"Update",portOut:"Trigger out",objIn:"xtshifs23",objOut:"c9vb3vnrs"},{portIn:"Update",portOut:"Trigger out",objIn:"w19qah5hl",objOut:"c9vb3vnrs"}]},{name:"Result X",links:[{portIn:"Numbers_1",portOut:"Result X",objIn:"of3t5oma2",objOut:"c9vb3vnrs"}]},{name:"Result Y",links:[{portIn:"Numbers_1",portOut:"Result Y",objIn:"dz681xu7j",objOut:"c9vb3vnrs"}]}],objName:"Ops.Gl.Matrix.ScreenPosTo3d_v3"},{id:"k2yt9homf",uiAttribs:{},portsIn:[{name:"Coordinates index",value:0},{name:"Coordinates",value:"-1 to 1"},{name:"Area index",value:0},{name:"Area",value:"Canvas"},{name:"flip y",value:1},{name:"right click prevent default",value:1},{name:"Touch support",value:1},{name:"Passive Events",value:0},{name:"Active",value:1}],portsOut:[{name:"x",links:[{portIn:"X",portOut:"x",objIn:"c9vb3vnrs",objOut:"k2yt9homf"}]},{name:"y",links:[{portIn:"Y",portOut:"y",objIn:"c9vb3vnrs",objOut:"k2yt9homf"}]},{name:"Button is down",value:0},{name:"Mouse is hovering",value:0},{name:"Movement X",value:-2.5},{name:"Movement Y",value:7}],objName:"Ops.Devices.Mouse.Mouse_v3"},{id:"xtshifs23",uiAttribs:{},portsIn:[{name:"Separate inc/dec",value:0},{name:"Inc factor",title:"Inc/Dec factor"},{name:"Dec factor",value:4}],portsOut:[{name:"Result",links:[{portIn:"A",portOut:"Result",objIn:"y4chzaekg",objOut:"xtshifs23"},{portIn:"X",portOut:"Result",objIn:"pfh95li8v",objOut:"xtshifs23"}]}],objName:"Ops.Anim.Smooth"},{id:"w19qah5hl",uiAttribs:{},portsIn:[{name:"Separate inc/dec",value:0},{name:"Inc factor",title:"Inc/Dec factor"},{name:"Dec factor",value:4}],portsOut:[{name:"Next",links:[{portIn:"exec",portOut:"Next",objIn:"ugif28ji1",objOut:"w19qah5hl"}]},{name:"Result",links:[{portIn:"B",portOut:"Result",objIn:"y4chzaekg",objOut:"w19qah5hl"},{portIn:"Y",portOut:"Result",objIn:"pfh95li8v",objOut:"w19qah5hl"}]}],objName:"Ops.Anim.Smooth"},{id:"9jgmb6kyy",uiAttribs:{},portsIn:[{name:"Active",value:1},{name:"Clear",value:1}],portsOut:[{name:"Next",links:[{portIn:"exe",portOut:"Next",objIn:"k9ytz5oyo",objOut:"9jgmb6kyy"},{portIn:"Update",portOut:"Next",objIn:"pfh95li8v",objOut:"9jgmb6kyy"}]},{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"glo6jyroc",objOut:"9jgmb6kyy"},{portIn:"array",portOut:"Result",objIn:"k9ytz5oyo",objOut:"9jgmb6kyy"}]}],objName:"Ops.Data.Compose.Array.CompArray"},{id:"1etvfk86a",uiAttribs:{},portsOut:[{name:"trigger 0",links:[{portIn:"Update",portOut:"trigger 0",objIn:"9jgmb6kyy",objOut:"1etvfk86a"},{portIn:"Update",portOut:"trigger 0",objIn:"bcnb9y71f",objOut:"1etvfk86a"},{portIn:"render",portOut:"trigger 0",objIn:"dk4dvdvgd",objOut:"1etvfk86a"},{portIn:"Exec",portOut:"trigger 0",objIn:"c9vb3vnrs",objOut:"1etvfk86a"},{portIn:"Update",portOut:"trigger 0",objIn:"k5e49zfnk",objOut:"1etvfk86a"},{portIn:"exe",portOut:"trigger 0",objIn:"x4r8z0p52",objOut:"1etvfk86a"}]},{name:"trigger 14",links:[{portIn:"Trigger",portOut:"trigger 14",objIn:"8wztcb5w7",objOut:"1etvfk86a"}]},{name:"trigger 15",links:[{portIn:"Trigger",portOut:"trigger 15",objIn:"x7l01kgni",objOut:"1etvfk86a"}]}],objName:"Ops.Trigger.Sequence"},{id:"wbabcd23z",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"gdt60rfld",objOut:"wbabcd23z"}]},{name:"Result",links:[{portIn:"Array",portOut:"Result",objIn:"shfo7ukvx",objOut:"wbabcd23z"}]}],objName:"Ops.Data.Compose.Array.CompArraySnapshot"},{id:"lvm4rpnkd",uiAttribs:{},portsIn:[{name:"number2",value:3}],portsOut:[{name:"result",links:[{portIn:"Max Length",portOut:"result",objIn:"fjc1x68ig",objOut:"lvm4rpnkd"}]}],objName:"Ops.Math.Multiply"},{id:"y4sfv82ny",uiAttribs:{},portsIn:[{name:"Direction index",value:0},{name:"Direction",value:"Forward"}],portsOut:[{name:"Next",links:[{portIn:"Update",portOut:"Next",objIn:"wbabcd23z",objOut:"y4sfv82ny"}]},{name:"index",links:[{portIn:"number1",portOut:"index",objIn:"r4goile0j",objOut:"y4sfv82ny"},{portIn:"Index",portOut:"index",objIn:"shfo7ukvx",objOut:"y4sfv82ny"},{portIn:"Index",portOut:"index",objIn:"herrf7p45",objOut:"y4sfv82ny"}]}],objName:"Ops.Trigger.Repeat_v2"},{id:"pfh95li8v",uiAttribs:{},portsIn:[{name:"Z",value:0},{name:"W",value:1},{name:"Num index",value:2},{name:"Num",value:"3"}],portsOut:[{name:"Next",links:[{portIn:"Execute",portOut:"Next",objIn:"y4sfv82ny",objOut:"pfh95li8v"}]}],objName:"Ops.Data.Compose.Array.CompArrayPushNumbers"},{id:"shfo7ukvx",uiAttribs:{},portsOut:[{name:"X",links:[{portIn:"x1",portOut:"X",objIn:"dvw4c0bbb",objOut:"shfo7ukvx"},{portIn:"A",portOut:"X",objIn:"3cy5oytq4",objOut:"shfo7ukvx"}]},{name:"Y",links:[{portIn:"y1",portOut:"Y",objIn:"dvw4c0bbb",objOut:"shfo7ukvx"},{portIn:"A",portOut:"Y",objIn:"8so3wqo9w",objOut:"shfo7ukvx"}]},{name:"Z",value:0}],objName:"Ops.Array.Array3GetNumbers"},{id:"zhzpku5s8",uiAttribs:{},portsOut:[{name:"X",links:[{portIn:"x2",portOut:"X",objIn:"dvw4c0bbb",objOut:"zhzpku5s8"},{portIn:"B",portOut:"X",objIn:"3cy5oytq4",objOut:"zhzpku5s8"}]},{name:"Y",links:[{portIn:"y2",portOut:"Y",objIn:"dvw4c0bbb",objOut:"zhzpku5s8"},{portIn:"B",portOut:"Y",objIn:"8so3wqo9w",objOut:"zhzpku5s8"}]},{name:"Z",value:0}],objName:"Ops.Array.Array3GetNumbers"},{id:"r4goile0j",uiAttribs:{},portsIn:[{name:"number2",value:1}],portsOut:[{name:"result",links:[{portIn:"Index",portOut:"result",objIn:"zhzpku5s8",objOut:"r4goile0j"},{portIn:"Index",portOut:"result",objIn:"ow1kispgw",objOut:"r4goile0j"}]}],objName:"Ops.Math.Sum"},{id:"almgiva7q",uiAttribs:{},portsIn:[{name:"number2",value:1}],portsOut:[{name:"result",links:[{portIn:"Repeats",portOut:"result",objIn:"5t0yiak1c",objOut:"almgiva7q"}]}],objName:"Ops.Math.Subtract"},{id:"1n5mdbzxt",uiAttribs:{},portsIn:[{name:"title",value:"Mouse"},{name:"text",value:""}],objName:"Ops.Ui.Comment_v2"},{id:"dvw4c0bbb",uiAttribs:{},portsOut:[{name:"distance",links:[{portIn:"C",portOut:"distance",objIn:"3cy5oytq4",objOut:"dvw4c0bbb"},{portIn:"C",portOut:"distance",objIn:"8so3wqo9w",objOut:"dvw4c0bbb"}]}],objName:"Ops.Math.Distance2d"},{id:"3cy5oytq4",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"posX",portOut:"Result",objIn:"gdt60rfld",objOut:"3cy5oytq4"},{portIn:"Value 2",portOut:"Result",objIn:"pelz0rmqz",objOut:"3cy5oytq4"}]},{name:"Expression Valid",value:true}],objName:"Ops.Math.MathExpression"},{id:"7n20wr9uu",uiAttribs:{},portsIn:[{name:"value",value:"a+d*((b-a)/abs(c))"}],portsOut:[{name:"String",links:[{portIn:"Expression",portOut:"String",objIn:"3cy5oytq4",objOut:"7n20wr9uu"},{portIn:"Expression",portOut:"String",objIn:"8so3wqo9w",objOut:"7n20wr9uu"}]}],objName:"Ops.String.String_v2"},{id:"8so3wqo9w",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"posY",portOut:"Result",objIn:"gdt60rfld",objOut:"8so3wqo9w"},{portIn:"Value 2",portOut:"Result",objIn:"2akdt4s8n",objOut:"8so3wqo9w"}]},{name:"Expression Valid",value:true}],objName:"Ops.Math.MathExpression"},{id:"7zyv63jlz",uiAttribs:{},portsIn:[{name:"title",value:"Segment Coordinates"},{name:"text",value:""}],objName:"Ops.Ui.Comment_v2"},{id:"1iz4ki3t5",uiAttribs:{},portsIn:[{name:"Slider",value:0},{name:"Index 0",value:2.6},{name:"Index 1",value:3},{name:"Index 2",value:3.2},{name:"Index 3",value:3},{name:"Index 4",value:2.8},{name:"Index 5",value:2.4},{name:"Index 6",value:2},{name:"Index 7",value:1.5},{name:"Index 8",value:1.2},{name:"Index 9",value:.9},{name:"Index 10",value:.65},{name:"Index 11",value:.2},{name:"Index 12",value:0},{name:"Index 13",value:0},{name:"Index 14",value:0},{name:"Index 15",value:0},{name:"Index 16",value:0},{name:"Index 17",value:0},{name:"Index 18",value:0},{name:"Index 19",value:0},{name:"Index 20",value:0},{name:"Index 21",value:0},{name:"Index 22",value:0},{name:"Index 23",value:0},{name:"Index 24",value:0},{name:"Index 25",value:0},{name:"Index 26",value:0},{name:"Index 27",value:0},{name:"Index 28",value:0},{name:"Index 29",value:0}],portsOut:[{name:"Array",links:[{portIn:"array",portOut:"Array",objIn:"j8ktfq34x",objOut:"1iz4ki3t5"},{portIn:"array",portOut:"Array",objIn:"zxqzn4ga3",objOut:"1iz4ki3t5"}]}],objName:"Ops.Array.ArrayFromNumbers"},{id:"wsqxpct0i",uiAttribs:{},portsIn:[{name:"Position",value:.75}],portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"5c6sgz7pm",objOut:"wsqxpct0i"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"5c6sgz7pm",objOut:"wsqxpct0i"}]}],objName:"Ops.Math.CircleCoordinates"},{id:"i95inmkiv",uiAttribs:{},portsIn:[{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"5c6sgz7pm",objOut:"i95inmkiv"},{portIn:"render",portOut:"trigger",objIn:"uon5w3xsa",objOut:"i95inmkiv"}]}],objName:"Ops.Graphics.Transform"},{id:"3zq1z542c",uiAttribs:{},portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"i95inmkiv",objOut:"3zq1z542c"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"i95inmkiv",objOut:"3zq1z542c"}]},{name:"Z",value:0}],objName:"Ops.Array.Array3GetNumbers"},{id:"5c6sgz7pm",uiAttribs:{},portsIn:[{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"803warcvk",objOut:"5c6sgz7pm"}]}],objName:"Ops.Graphics.Transform"},{id:"sx1px46dd",uiAttribs:{},portsIn:[{name:"Direction index",value:0},{name:"Direction",value:"Forward"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"i95inmkiv",objOut:"sx1px46dd"}]},{name:"index",links:[{portIn:"Index",portOut:"index",objIn:"3zq1z542c",objOut:"sx1px46dd"},{portIn:"index",portOut:"index",objIn:"j8ktfq34x",objOut:"sx1px46dd"},{portIn:"Index",portOut:"index",objIn:"pk53b1xnq",objOut:"sx1px46dd"}]}],objName:"Ops.Trigger.Repeat_v2"},{id:"j8ktfq34x",uiAttribs:{},portsIn:[{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"number1",portOut:"value",objIn:"ze5hew3yv",objOut:"j8ktfq34x"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"ze5hew3yv",uiAttribs:{},portsIn:[{name:"number2",value:32.25}],portsOut:[{name:"result",links:[{portIn:"Radius",portOut:"result",objIn:"wsqxpct0i",objOut:"ze5hew3yv"},{portIn:"Radius",portOut:"result",objIn:"5awepmxir",objOut:"ze5hew3yv"}]}],objName:"Ops.Math.Divide"},{id:"5awepmxir",uiAttribs:{},portsIn:[{name:"Position",value:.25}],portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"uon5w3xsa",objOut:"5awepmxir"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"uon5w3xsa",objOut:"5awepmxir"}]}],objName:"Ops.Math.CircleCoordinates"},{id:"uon5w3xsa",uiAttribs:{},portsIn:[{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:39.8}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"fykwzr18f",objOut:"uon5w3xsa"}]}],objName:"Ops.Graphics.Transform"},{id:"fykwzr18f",uiAttribs:{},portsOut:[{name:"trigger",links:[{portIn:"Update",portOut:"trigger",objIn:"a3u57j3km",objOut:"fykwzr18f"}]},{name:"X",links:[{portIn:"Number",portOut:"X",objIn:"a3u57j3km",objOut:"fykwzr18f"}]},{name:"Y",links:[{portIn:"Number",portOut:"Y",objIn:"wvhcul9za",objOut:"fykwzr18f"}]},{name:"Z",value:0}],objName:"Ops.Gl.Matrix.Coordinates"},{id:"y4chzaekg",uiAttribs:{},portsIn:[{name:"Expression",value:"atan2(d-b,c-a)*(180/PI)+90"}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"ugif28ji1",objOut:"y4chzaekg"}]},{name:"Expression Valid",value:true}],objName:"Ops.Math.MathExpression"},{id:"2al7mz89s",uiAttribs:{},portsIn:[{name:"Expression",value:"atan2(d-b,c-a)*(180/PI)+90"}],portsOut:[{name:"Result",links:[{portIn:"Number",portOut:"Result",objIn:"3iy8xrexs",objOut:"2al7mz89s"}]},{name:"Expression Valid",value:true}],objName:"Ops.Math.MathExpression"},{id:"bcnb9y71f",uiAttribs:{},portsIn:[{name:"Active",value:1},{name:"Clear",value:1}],portsOut:[{name:"Next",links:[{portIn:"Update",portOut:"Next",objIn:"rv4ekjrhe",objOut:"bcnb9y71f"}]},{name:"Result",links:[{portIn:"Array1x",portOut:"Result",objIn:"13mu3ddj9",objOut:"bcnb9y71f"}]}],objName:"Ops.Data.Compose.Array.CompArray"},{id:"i4s3fj6wl",uiAttribs:{},portsOut:[{name:"X",links:[{portIn:"C",portOut:"X",objIn:"2al7mz89s",objOut:"i4s3fj6wl"}]},{name:"Y",links:[{portIn:"D",portOut:"Y",objIn:"2al7mz89s",objOut:"i4s3fj6wl"}]},{name:"Z",value:0}],objName:"Ops.Array.Array3GetNumbers"},{id:"0ur6q19e4",uiAttribs:{},portsOut:[{name:"X",links:[{portIn:"A",portOut:"X",objIn:"2al7mz89s",objOut:"0ur6q19e4"}]},{name:"Y",links:[{portIn:"B",portOut:"Y",objIn:"2al7mz89s",objOut:"0ur6q19e4"}]},{name:"Z",value:0}],objName:"Ops.Array.Array3GetNumbers"},{id:"t83fj92u0",uiAttribs:{},portsIn:[{name:"Active",value:1},{name:"Clear",value:1}],portsOut:[{name:"Next",links:[{portIn:"Execute",portOut:"Next",objIn:"sdu68zwgv",objOut:"t83fj92u0"}]},{name:"Result",links:[{portIn:"array",portOut:"Result",objIn:"k9ytz5oyo",objOut:"t83fj92u0"}]}],objName:"Ops.Data.Compose.Array.CompArray"},{id:"sdu68zwgv",uiAttribs:{},portsIn:[{name:"Direction index",value:0},{name:"Direction",value:"Forward"}],portsOut:[{name:"Next",links:[{portIn:"Update",portOut:"Next",objIn:"70xaig35o",objOut:"sdu68zwgv"}]},{name:"index",links:[{portIn:"number1",portOut:"index",objIn:"ztaa6guww",objOut:"sdu68zwgv"}]}],objName:"Ops.Trigger.Repeat_v2"},{id:"ztaa6guww",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"X",portOut:"result",objIn:"70xaig35o",objOut:"ztaa6guww"}]}],objName:"Ops.Math.Multiply"},{id:"70xaig35o",uiAttribs:{},portsIn:[{name:"Y",value:0},{name:"Z",value:0},{name:"W",value:1},{name:"Num index",value:2},{name:"Num",value:"3"}],objName:"Ops.Data.Compose.Array.CompArrayPushNumbers"},{id:"fjc1x68ig",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"Array",portOut:"Result",objIn:"zhzpku5s8",objOut:"fjc1x68ig"}]},{name:"Array length",value:36}],objName:"Ops.Array.ArrayBuffer"},{id:"k9ytz5oyo",uiAttribs:{},portsOut:[{name:"trigger",links:[{portIn:"exec",portOut:"trigger",objIn:"fjc1x68ig",objOut:"k9ytz5oyo"}]},{name:"index",value:35},{name:"value",links:[{portIn:"Value",portOut:"value",objIn:"fjc1x68ig",objOut:"k9ytz5oyo"}]}],objName:"Ops.Array.ArrayIteratorNumbers"},{id:"5t0yiak1c",uiAttribs:{},portsIn:[{name:"Direction index",value:0},{name:"Direction",value:"Forward"}],portsOut:[{name:"Next",links:[{portIn:"Update",portOut:"Next",objIn:"3iy8xrexs",objOut:"5t0yiak1c"}]},{name:"index",links:[{portIn:"number1",portOut:"index",objIn:"2guwf2qfr",objOut:"5t0yiak1c"},{portIn:"Index",portOut:"index",objIn:"i4s3fj6wl",objOut:"5t0yiak1c"}]}],objName:"Ops.Trigger.Repeat_v2"},{id:"2guwf2qfr",uiAttribs:{},portsIn:[{name:"number2",value:1}],portsOut:[{name:"result",links:[{portIn:"Index",portOut:"result",objIn:"0ur6q19e4",objOut:"2guwf2qfr"}]}],objName:"Ops.Math.Sum"},{id:"pk53b1xnq",uiAttribs:{},portsOut:[{name:"X",value:0},{name:"Y",value:0},{name:"Z",links:[{portIn:"rotZ",portOut:"Z",objIn:"i95inmkiv",objOut:"pk53b1xnq"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"a3u57j3km",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Update",portOut:"Next",objIn:"vcko8y3mn",objOut:"a3u57j3km"}]}],objName:"Ops.Data.Compose.Array.CompArrayPushNumber"},{id:"onhd4puuc",uiAttribs:{},portsIn:[{name:"Active",value:1},{name:"Clear",value:1}],portsOut:[{name:"Next",links:[{portIn:"Execute",portOut:"Next",objIn:"sx1px46dd",objOut:"onhd4puuc"}]},{name:"Result",links:[{portIn:"Array in xyz",portOut:"Result",objIn:"l0z2aihiq",objOut:"onhd4puuc"}]}],objName:"Ops.Data.Compose.Array.CompArray"},{id:"803warcvk",uiAttribs:{},portsOut:[{name:"X",links:[{portIn:"Number",portOut:"X",objIn:"vcko8y3mn",objOut:"803warcvk"}]},{name:"Y",links:[{portIn:"Number",portOut:"Y",objIn:"eeov8y736",objOut:"803warcvk"}]},{name:"Z",value:0}],objName:"Ops.Gl.Matrix.Coordinates"},{id:"l0z2aihiq",uiAttribs:{},portsOut:[{name:"Array 1 out",links:[{portIn:"Array2x",portOut:"Array 1 out",objIn:"ov0mx7daq",objOut:"l0z2aihiq"}]},{name:"Array 2 out",links:[{portIn:"Array2x",portOut:"Array 2 out",objIn:"mqbjnlrnv",objOut:"l0z2aihiq"}]},{name:"Array lengths",value:24}],objName:"Ops.Array.ArrayUnpack2"},{id:"ol4273veh",uiAttribs:{},portsIn:[{name:"Array 3",value:0},{name:"Array 4",value:0},{name:"Array 5",value:0},{name:"Array 6",value:0},{name:"Array 7",value:0}],portsOut:[{name:"Result",links:[{portIn:"Points",portOut:"Result",objIn:"e8rbu88u4",objOut:"ol4273veh"}]},{name:"Array length",value:84}],objName:"Ops.Array.ArrayMerge_v3"},{id:"vcko8y3mn",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Update",portOut:"Next",objIn:"wvhcul9za",objOut:"vcko8y3mn"}]}],objName:"Ops.Data.Compose.Array.CompArrayPushNumber"},{id:"wvhcul9za",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Update",portOut:"Next",objIn:"eeov8y736",objOut:"wvhcul9za"}]}],objName:"Ops.Data.Compose.Array.CompArrayPushNumber"},{id:"eeov8y736",uiAttribs:{},objName:"Ops.Data.Compose.Array.CompArrayPushNumber"},{id:"ov0mx7daq",uiAttribs:{},portsOut:[{name:"Array3x",links:[{portIn:"Array 1",portOut:"Array3x",objIn:"ol4273veh",objOut:"ov0mx7daq"}]},{name:"Total points",value:12},{name:"Array length",value:36}],objName:"Ops.Array.Array2To3"},{id:"mqbjnlrnv",uiAttribs:{},portsOut:[{name:"Array3x",links:[{portIn:"Array",portOut:"Array3x",objIn:"e6c3nxiuv",objOut:"mqbjnlrnv"}]},{name:"Total points",value:12},{name:"Array length",value:36}],objName:"Ops.Array.Array2To3"},{id:"e6c3nxiuv",uiAttribs:{},portsOut:[{name:"Reversed Array",links:[{portIn:"Array 2",portOut:"Reversed Array",objIn:"ol4273veh",objOut:"e6c3nxiuv"}]}],objName:"Ops.Array.ReverseArray3"},{id:"e8rbu88u4",uiAttribs:{},portsIn:[{name:"Num Subdivs",value:5},{name:"Smooth",value:1},{name:"Loop",value:1},{name:"Bezier Start/End Points",value:0}],portsOut:[{name:"Result",links:[{portIn:"Array3x",portOut:"Result",objIn:"h2h0opzuf",objOut:"e8rbu88u4"},{portIn:"Points",portOut:"Result",objIn:"7j6ooknik",objOut:"e8rbu88u4"}]}],objName:"Ops.Array.PointArray.SubdivideArray3_v2"},{id:"h2h0opzuf",uiAttribs:{},portsOut:[{name:"Array2x",links:[{portIn:"2d Point Path",portOut:"Array2x",objIn:"v6zpsggiu",objOut:"h2h0opzuf"}]}],objName:"Ops.Array.Array3To2"},{id:"lwrzm0vd2",uiAttribs:{},portsIn:[{name:"Position",value:.3}],portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"nldyb15yw",objOut:"lwrzm0vd2"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"nldyb15yw",objOut:"lwrzm0vd2"}]}],objName:"Ops.Math.CircleCoordinates"},{id:"l19ime88e",uiAttribs:{},portsIn:[{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"nldyb15yw",objOut:"l19ime88e"},{portIn:"render",portOut:"trigger",objIn:"88w8d4ilj",objOut:"l19ime88e"}]}],objName:"Ops.Graphics.Transform"},{id:"nldyb15yw",uiAttribs:{},portsIn:[{name:"posZ",value:.01},{name:"scale",value:.8},{name:"rotX",value:35},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"bkh8vstdr",objOut:"nldyb15yw"},{portIn:"render",portOut:"trigger",objIn:"gfvt7j3qi",objOut:"nldyb15yw"}]}],objName:"Ops.Graphics.Transform"},{id:"fuk39444t",uiAttribs:{},portsIn:[{name:"radius",value:.03},{name:"innerRadius",value:0},{name:"segments",value:16},{name:"percent",value:1},{name:"steps",value:0},{name:"invertSteps",value:0},{name:"mapping index",value:0},{name:"mapping",value:"flat"},{name:"Spline",value:0},{name:"Draw",value:1,title:"Render mesh"}],objName:"Ops.Graphics.Meshes.Circle_v3"},{id:"bkh8vstdr",uiAttribs:{},portsIn:[{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"g67jva2xl",objOut:"bkh8vstdr"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"ig96oqctp",uiAttribs:{},portsIn:[{name:"Position",value:.7}],portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"88w8d4ilj",objOut:"ig96oqctp"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"88w8d4ilj",objOut:"ig96oqctp"}]}],objName:"Ops.Math.CircleCoordinates"},{id:"88w8d4ilj",uiAttribs:{},portsIn:[{name:"posZ",value:.01},{name:"scale",value:.8},{name:"rotX",value:35},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"bkh8vstdr",objOut:"88w8d4ilj"},{portIn:"render",portOut:"trigger",objIn:"gfvt7j3qi",objOut:"88w8d4ilj"}]}],objName:"Ops.Graphics.Transform"},{id:"dk4dvdvgd",uiAttribs:{},portsIn:[{name:"r",value:.26926944732666014},{name:"g",value:.29700414717197415},{name:"b",value:.38760416666666664},{name:"a",value:1}],objName:"Ops.Gl.ClearColor"},{id:"gfvt7j3qi",uiAttribs:{},portsIn:[{name:"r",value:0},{name:"g",value:0},{name:"b",value:0},{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"usg5eu3gu",objOut:"gfvt7j3qi"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"usg5eu3gu",uiAttribs:{},portsIn:[{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:.005},{name:"scale",value:.5},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"g67jva2xl",objOut:"usg5eu3gu"}]}],objName:"Ops.Graphics.Transform"},{id:"idj47oum8",uiAttribs:{},portsIn:[{name:"value",value:60}],portsOut:[{name:"result",links:[{portIn:"rotY",portOut:"result",objIn:"nldyb15yw",objOut:"idj47oum8"},{portIn:"number1",portOut:"result",objIn:"e7bvvgdgl",objOut:"idj47oum8"}]}],objName:"Ops.Number.Number"},{id:"e7bvvgdgl",uiAttribs:{},portsIn:[{name:"number2",value:-1}],portsOut:[{name:"result",links:[{portIn:"rotY",portOut:"result",objIn:"88w8d4ilj",objOut:"e7bvvgdgl"}]}],objName:"Ops.Math.Multiply"},{id:"fyuk5254b",uiAttribs:{},portsIn:[{name:"r",value:.23529411764705882},{name:"g",value:.5372549019607843},{name:"b",value:.6431372549019608},{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"mw4kr0ypj",objOut:"fyuk5254b"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"mw4kr0ypj",uiAttribs:{},portsIn:[{name:"radius",value:.1},{name:"innerRadius",value:0},{name:"segments",value:32},{name:"percent",value:1},{name:"steps",value:0},{name:"invertSteps",value:0},{name:"mapping index",value:0},{name:"mapping",value:"flat"},{name:"Spline",value:0},{name:"Draw",value:1,title:"Render mesh"}],objName:"Ops.Graphics.Meshes.Circle_v3"},{id:"4q1vh9lcv",uiAttribs:{},portsIn:[{name:"title",value:"Body points"},{name:"text",value:""}],objName:"Ops.Ui.Comment_v2"},{id:"vamkvu9gx",uiAttribs:{},portsIn:[{name:"Variable",value:"Segment number"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"h06md5vgs",uiAttribs:{},portsIn:[{name:"value",value:12}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"vamkvu9gx",objOut:"h06md5vgs"}]}],objName:"Ops.Number.Number"},{id:"acjyk6vq2",uiAttribs:{},portsIn:[{name:"Variable",value:"Segment number"}],portsOut:[{name:"Value",links:[{portIn:"number1",portOut:"Value",objIn:"almgiva7q",objOut:"acjyk6vq2"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"dbzmp9mlu",uiAttribs:{},portsIn:[{name:"Variable",value:"Segment number"}],portsOut:[{name:"Value",links:[{portIn:"Repeats",portOut:"Value",objIn:"sx1px46dd",objOut:"dbzmp9mlu"},{portIn:"Limit",portOut:"Value",objIn:"1iz4ki3t5",objOut:"dbzmp9mlu"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"wgibs13n7",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Trigger",portOut:"Next",objIn:"jkwj9sce1",objOut:"wgibs13n7"}]},{name:"Was Triggered",value:1}],objName:"Ops.Trigger.TriggerOnce"},{id:"jkwj9sce1",uiAttribs:{},portsIn:[{name:"Named Trigger",value:"once"}],objName:"Ops.Trigger.TriggerSend"},{id:"8o47oy8e8",uiAttribs:{},portsIn:[{name:"Named Trigger",value:"once"}],portsOut:[{name:"Triggered",links:[{portIn:"Update",portOut:"Triggered",objIn:"t83fj92u0",objOut:"8o47oy8e8"}]}],objName:"Ops.Trigger.TriggerReceive"},{id:"6c3k51mqu",uiAttribs:{},portsIn:[{name:"Named Trigger",value:"once"}],portsOut:[{name:"Triggered",links:[{portIn:"Update",portOut:"Triggered",objIn:"1iz4ki3t5",objOut:"6c3k51mqu"}]}],objName:"Ops.Trigger.TriggerReceive"},{id:"x7l01kgni",uiAttribs:{},portsIn:[{name:"Named Trigger",value:"last"}],objName:"Ops.Trigger.TriggerSend"},{id:"8wztcb5w7",uiAttribs:{},portsIn:[{name:"Named Trigger",value:"other"}],objName:"Ops.Trigger.TriggerSend"},{id:"27u02eul4",uiAttribs:{},portsOut:[{name:"trigger 0",links:[{portIn:"Execute",portOut:"trigger 0",objIn:"a2fyx3dts",objOut:"27u02eul4"}]},{name:"trigger 6",links:[{portIn:"render",portOut:"trigger 6",objIn:"gelk9ow4u",objOut:"27u02eul4"}]},{name:"trigger 11",links:[{portIn:"render",portOut:"trigger 11",objIn:"rhktvauan",objOut:"27u02eul4"},{portIn:"Render",portOut:"trigger 11",objIn:"mczzw2ceh",objOut:"27u02eul4"},{portIn:"Execute",portOut:"trigger 11",objIn:"5d02320if",objOut:"27u02eul4"}]},{name:"trigger 14",links:[{portIn:"render",portOut:"trigger 14",objIn:"l19ime88e",objOut:"27u02eul4"}]}],objName:"Ops.Gl.LayerSequence"},{id:"tlm4eze8o",uiAttribs:{},portsIn:[{name:"value",value:.075}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"3q8xe13ym",objOut:"tlm4eze8o"}]}],objName:"Ops.Number.Number"},{id:"3q8xe13ym",uiAttribs:{},portsIn:[{name:"Variable",value:"Segment distance"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"vi15og086",uiAttribs:{},portsIn:[{name:"Variable",value:"Segment distance"}],portsOut:[{name:"Value",links:[{portIn:"number2",portOut:"Value",objIn:"ztaa6guww",objOut:"vi15og086"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"ppahdtne0",uiAttribs:{},portsIn:[{name:"Variable",value:"Segment distance"}],portsOut:[{name:"Value",links:[{portIn:"D",portOut:"Value",objIn:"3cy5oytq4",objOut:"ppahdtne0"},{portIn:"D",portOut:"Value",objIn:"8so3wqo9w",objOut:"ppahdtne0"},{portIn:"Radius",portOut:"Value",objIn:"54ff56aqm",objOut:"ppahdtne0"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"tnt9r7q1i",uiAttribs:{},portsIn:[{name:"Named Trigger",value:"other"}],portsOut:[{name:"Triggered",links:[{portIn:"Update",portOut:"Triggered",objIn:"onhd4puuc",objOut:"tnt9r7q1i"}]}],objName:"Ops.Trigger.TriggerReceive"},{id:"shdmymgn1",uiAttribs:{},portsIn:[{name:"Named Trigger",value:"other"}],portsOut:[{name:"Triggered",links:[{portIn:"exe",portOut:"Triggered",objIn:"27u02eul4",objOut:"shdmymgn1"}]}],objName:"Ops.Trigger.TriggerReceive"},{id:"iq3sojv3r",uiAttribs:{},portsIn:[{name:"Variable",value:"rotation"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"7axrfvbnm",uiAttribs:{},portsIn:[{name:"Variable",value:"coordinates"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"3zq1z542c",objOut:"7axrfvbnm"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"uadei5u51",uiAttribs:{},portsIn:[{name:"Variable",value:"rotation"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"pk53b1xnq",objOut:"uadei5u51"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"jak1n3at6",uiAttribs:{},portsIn:[{name:"Variable",value:"Segment number"}],portsOut:[{name:"Value",links:[{portIn:"Repeats",portOut:"Value",objIn:"sdu68zwgv",objOut:"jak1n3at6"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"vzykes0xv",uiAttribs:{},portsIn:[{name:"number2",value:1}],portsOut:[{name:"result",links:[{portIn:"Repeats",portOut:"result",objIn:"y4sfv82ny",objOut:"vzykes0xv"}]}],objName:"Ops.Math.Subtract"},{id:"oyiecmp21",uiAttribs:{},portsIn:[{name:"Variable",value:"Segment number"}],portsOut:[{name:"Value",links:[{portIn:"number1",portOut:"Value",objIn:"vzykes0xv",objOut:"oyiecmp21"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"e40f7ueso",uiAttribs:{},portsIn:[{name:"Variable",value:"Segment number"}],portsOut:[{name:"Value",links:[{portIn:"number1",portOut:"Value",objIn:"lvm4rpnkd",objOut:"e40f7ueso"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"l4r7vdcp1",uiAttribs:{},portsIn:[{name:"title",value:"Segment Rotation"},{name:"text",value:""}],objName:"Ops.Ui.Comment_v2"},{id:"2wku1njxz",uiAttribs:{},portsIn:[{name:"title",value:"Segment Initialisation"},{name:"text",value:""}],objName:"Ops.Ui.Comment_v2"},{id:"9h1w9zxcf",uiAttribs:{},portsIn:[{name:"title",value:"Var"},{name:"text",value:""}],objName:"Ops.Ui.Comment_v2"},{id:"7rf4w6v2p",uiAttribs:{},portsIn:[{name:"title",value:"Eyes"},{name:"text",value:""}],objName:"Ops.Ui.Comment_v2"},{id:"najunq9tk",uiAttribs:{},portsIn:[{name:"Variable",value:"coordinates"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"0ur6q19e4",objOut:"najunq9tk"},{portIn:"Array",portOut:"Value",objIn:"i4s3fj6wl",objOut:"najunq9tk"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"13mu3ddj9",uiAttribs:{},portsIn:[{name:"Format index",value:1},{name:"Format",value:"ABC"},{name:"A index",value:4},{name:"A",value:"0"},{name:"B index",value:4},{name:"B",value:"0"},{name:"C index",value:0},{name:"C",value:"Input"},{name:"D index",value:4},{name:"D",value:"0"}],portsOut:[{name:"Array3x",links:[{portIn:"Value",portOut:"Array3x",objIn:"iq3sojv3r",objOut:"13mu3ddj9"}]},{name:"Total points",value:12},{name:"Array length",value:36}],objName:"Ops.Array.Array1toX"},{id:"rv4ekjrhe",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Execute",portOut:"Next",objIn:"5t0yiak1c",objOut:"rv4ekjrhe"}]}],objName:"Ops.Data.Compose.Array.CompArrayPushNumber"},{id:"3iy8xrexs",uiAttribs:{},objName:"Ops.Data.Compose.Array.CompArrayPushNumber"},{id:"1rl13w99c",uiAttribs:{},portsOut:[{name:"X",links:[{portIn:"Numbers_0",portOut:"X",objIn:"of3t5oma2",objOut:"1rl13w99c"}]},{name:"Y",links:[{portIn:"Numbers_0",portOut:"Y",objIn:"dz681xu7j",objOut:"1rl13w99c"}]},{name:"Z",value:0}],objName:"Ops.Gl.Matrix.Coordinates"},{id:"of3t5oma2",uiAttribs:{},portsIn:[{name:"Numbers",multiPortNum:2},{name:"Numbers_2",value:0,title:"add port"}],portsOut:[{name:"Number",links:[{portIn:"C",portOut:"Number",objIn:"y4chzaekg",objOut:"of3t5oma2"},{portIn:"Value",portOut:"Number",objIn:"xtshifs23",objOut:"of3t5oma2"}]},{name:"Num Values",value:2}],objName:"Ops.Number.SwitchNumberMultiPort"},{id:"dz681xu7j",uiAttribs:{},portsIn:[{name:"Numbers",multiPortNum:2},{name:"Numbers_2",value:0,title:"add port"}],portsOut:[{name:"Number",links:[{portIn:"D",portOut:"Number",objIn:"y4chzaekg",objOut:"dz681xu7j"},{portIn:"Value",portOut:"Number",objIn:"w19qah5hl",objOut:"dz681xu7j"}]},{name:"Num Values",value:2}],objName:"Ops.Number.SwitchNumberMultiPort"},{id:"v5u4u3qbo",uiAttribs:{},portsIn:[{name:"Text",value:"Follow mouse"},{name:"Input",value:1},{name:"Default",value:1},{name:"Grey Out",value:0},{name:"Visible",value:1}],portsOut:[{name:"Value",links:[{portIn:"Index",portOut:"Value",objIn:"of3t5oma2",objOut:"v5u4u3qbo"},{portIn:"Index",portOut:"Value",objIn:"dz681xu7j",objOut:"v5u4u3qbo"},{portIn:"Value",portOut:"Value",objIn:"wtohf7hvl",objOut:"v5u4u3qbo"}]}],objName:"Ops.Sidebar.Toggle_v4"},{id:"onnhiqlvx",uiAttribs:{},portsIn:[{name:"Visible",value:1},{name:"Opacity",value:1},{name:"Default Minimized",value:0},{name:"Minimized Opacity",value:.5},{name:"Show undo button",value:0},{name:"Show Minimize",value:0},{name:"Title",value:"Sidebar"},{name:"Side",value:0},{name:"Default CSS",value:1}],portsOut:[{name:"childs",title:"Children",links:[{portIn:"link",portOut:"childs",objIn:"v5u4u3qbo",objOut:"onnhiqlvx"},{portIn:"link",portOut:"childs",objIn:"1vdh1scvz",objOut:"onnhiqlvx"},{portIn:"link",portOut:"childs",objIn:"rufejzorz",objOut:"onnhiqlvx"},{portIn:"link",portOut:"childs",objIn:"bbc3gg391",objOut:"onnhiqlvx"}]},{name:"Opfened",value:true,title:"Opened"}],objName:"Ops.Sidebar.Sidebar"},{id:"glo6jyroc",uiAttribs:{},portsIn:[{name:"Variable",value:"coordinates"}],objName:"Ops.Vars.VarSetArray_v2"},{id:"m8nur3u2j",uiAttribs:{},portsIn:[{name:"Z",value:0},{name:"W",value:1},{name:"Num index",value:2},{name:"Num",value:"3"}],objName:"Ops.Data.Compose.Array.CompArrayPushNumbers"},{id:"54ff56aqm",uiAttribs:{},portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"ak35tzgh6",objOut:"54ff56aqm"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"ak35tzgh6",objOut:"54ff56aqm"}]}],objName:"Ops.Math.CircleCoordinates"},{id:"abxkgcpsk",uiAttribs:{},portsIn:[{name:"C",value:2},{name:"D",value:3},{name:"Expression",value:"(abs(a-90)-abs(b-90))/-360"}],portsOut:[{name:"Result",links:[{portIn:"number1",portOut:"Result",objIn:"te09kque1",objOut:"abxkgcpsk"}]},{name:"Expression Valid",value:true}],objName:"Ops.Math.MathExpression"},{id:"jpwggj4hs",uiAttribs:{},portsIn:[{name:"Variable",value:"rotation"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"6e506k3l0",objOut:"jpwggj4hs"},{portIn:"Array",portOut:"Value",objIn:"herrf7p45",objOut:"jpwggj4hs"},{portIn:"Array",portOut:"Value",objIn:"ow1kispgw",objOut:"jpwggj4hs"},{portIn:"Array",portOut:"Value",objIn:"jm1fhl55z",objOut:"jpwggj4hs"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"6e506k3l0",uiAttribs:{},portsIn:[{name:"Index",value:1}],portsOut:[{name:"X",value:0},{name:"Y",value:0},{name:"Z",links:[{portIn:"rotZ",portOut:"Z",objIn:"gdt60rfld",objOut:"6e506k3l0"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"cv2d9se08",uiAttribs:{},portsOut:[{name:"trigger",links:[{portIn:"Update",portOut:"trigger",objIn:"m8nur3u2j",objOut:"cv2d9se08"}]},{name:"X",links:[{portIn:"Value 1",portOut:"X",objIn:"pelz0rmqz",objOut:"cv2d9se08"}]},{name:"Y",links:[{portIn:"Value 1",portOut:"Y",objIn:"2akdt4s8n",objOut:"cv2d9se08"}]},{name:"Z",value:0}],objName:"Ops.Gl.Matrix.Coordinates"},{id:"ak35tzgh6",uiAttribs:{},portsIn:[{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"cv2d9se08",objOut:"ak35tzgh6"}]}],objName:"Ops.Graphics.Transform"},{id:"gdt60rfld",uiAttribs:{},portsIn:[{name:"posZ",value:0},{name:"scale",value:.31},{name:"rotX",value:0},{name:"rotY",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"ak35tzgh6",objOut:"gdt60rfld"}]}],objName:"Ops.Graphics.Transform"},{id:"herrf7p45",uiAttribs:{},portsOut:[{name:"X",value:0},{name:"Y",value:0},{name:"Z",links:[{portIn:"A",portOut:"Z",objIn:"abxkgcpsk",objOut:"herrf7p45"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"ow1kispgw",uiAttribs:{},portsOut:[{name:"X",value:0},{name:"Y",value:0},{name:"Z",links:[{portIn:"B",portOut:"Z",objIn:"abxkgcpsk",objOut:"ow1kispgw"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"jm1fhl55z",uiAttribs:{},portsIn:[{name:"Index",value:0}],portsOut:[{name:"X",value:0},{name:"Y",value:0},{name:"Z",links:[{portIn:"number1",portOut:"Z",objIn:"0q1ubu0gk",objOut:"jm1fhl55z"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"0q1ubu0gk",uiAttribs:{},portsIn:[{name:"number2",value:90}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"8nj0id2ja",objOut:"0q1ubu0gk"}]}],objName:"Ops.Math.Subtract"},{id:"8nj0id2ja",uiAttribs:{},portsIn:[{name:"Remove zero",value:0}],portsOut:[{name:"Result",links:[{portIn:"number2",portOut:"Result",objIn:"te09kque1",objOut:"8nj0id2ja"}]}],objName:"Ops.Math.Sign"},{id:"pelz0rmqz",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"X",portOut:"Result",objIn:"m8nur3u2j",objOut:"pelz0rmqz"}]}],objName:"Ops.Math.Interpolate"},{id:"2akdt4s8n",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"Y",portOut:"Result",objIn:"m8nur3u2j",objOut:"2akdt4s8n"}]}],objName:"Ops.Math.Interpolate"},{id:"v2bhkm1bk",uiAttribs:{},portsIn:[{name:"value",value:.75}],portsOut:[{name:"result",links:[{portIn:"Percentage",portOut:"result",objIn:"2akdt4s8n",objOut:"v2bhkm1bk"},{portIn:"Percentage",portOut:"result",objIn:"pelz0rmqz",objOut:"v2bhkm1bk"},{portIn:"Number",portOut:"result",objIn:"9njs4nhvz",objOut:"v2bhkm1bk"}]}],objName:"Ops.Number.Number"},{id:"9njs4nhvz",uiAttribs:{},portsOut:[{name:"Result",value:.75}],objName:"Ops.Ui.VizNumber"},{id:"te09kque1",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"Position",portOut:"result",objIn:"54ff56aqm",objOut:"te09kque1"}]}],objName:"Ops.Math.Multiply"},{id:"ugif28ji1",uiAttribs:{},portsIn:[{name:"Max Length",value:6}],portsOut:[{name:"Result",links:[{portIn:"array",portOut:"Result",objIn:"1mrrplclo",objOut:"ugif28ji1"}]},{name:"Array length",value:6}],objName:"Ops.Array.ArrayBuffer"},{id:"1mrrplclo",uiAttribs:{},portsIn:[{name:"index",value:0},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"Number",portOut:"value",objIn:"rv4ekjrhe",objOut:"1mrrplclo"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"c3wegz0zc",uiAttribs:{},portsIn:[{name:"value",value:.095}],portsOut:[{name:"result",links:[{portIn:"Radius",portOut:"result",objIn:"ig96oqctp",objOut:"c3wegz0zc"},{portIn:"Radius",portOut:"result",objIn:"lwrzm0vd2",objOut:"c3wegz0zc"}]}],objName:"Ops.Number.Number"},{id:"g67jva2xl",uiAttribs:{},portsIn:[{name:"Discard index",value:0},{name:"Discard",value:"Back Sides"},{name:"Active",value:1}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"fuk39444t",objOut:"g67jva2xl"}]}],objName:"Ops.Gl.FaceCulling_v2"},{id:"3aaryjlcn",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Exec",portOut:"Next",objIn:"8rgslr8js",objOut:"3aaryjlcn"},{portIn:"Update",portOut:"Next",objIn:"a7mxhhjvc",objOut:"3aaryjlcn"},{portIn:"Trigger",portOut:"Next",objIn:"i02nhhulh",objOut:"3aaryjlcn"}]}],objName:"Ops.Ui.Routing.RouteTrigger"},{id:"p0fqi73fu",uiAttribs:{},portsIn:[{name:"title",value:"Fin rendering"},{name:"text",value:""}],objName:"Ops.Ui.Comment_v2"},{id:"rya5pml1q",uiAttribs:{},portsIn:[{name:"Value In",value:0},{name:"When False index",value:1},{name:"When False",value:"custom"},{name:"Custom Value",value:0}],portsOut:[{name:"Value Out",links:[{portIn:"Pass Through",portOut:"Value Out",objIn:"jtyii9je8",objOut:"rya5pml1q"}]}],objName:"Ops.Number.GateNumber"},{id:"wtohf7hvl",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"Pass Through",portOut:"Result",objIn:"rya5pml1q",objOut:"wtohf7hvl"}]}],objName:"Ops.Boolean.IsZero"},{id:"qxa44zq5j",uiAttribs:{},portsIn:[{name:"r",value:.2},{name:"g",value:.4470588235294118},{name:"b",value:.5333333333333333},{name:"a",value:1}],portsOut:[{name:"outr",links:[{portIn:"r",portOut:"outr",objIn:"rhktvauan",objOut:"qxa44zq5j"}]},{name:"outg",links:[{portIn:"g",portOut:"outg",objIn:"rhktvauan",objOut:"qxa44zq5j"}]},{name:"outb",links:[{portIn:"b",portOut:"outb",objIn:"rhktvauan",objOut:"qxa44zq5j"}]},{name:"outa",value:1},{name:"Hex",value:"337288"}],objName:"Ops.Color.ColorValue"},{id:"my20gle8r",uiAttribs:{},portsIn:[{name:"title",value:"Body rendering"},{name:"text",value:""}],objName:"Ops.Ui.Comment_v2"},{id:"rhktvauan",uiAttribs:{},portsIn:[{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Update",portOut:"trigger",objIn:"v6zpsggiu",objOut:"rhktvauan"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"mczzw2ceh",uiAttribs:{},portsIn:[{name:"Width",value:-.03},{name:"Width Perspective",value:1},{name:"Mapping index",value:0},{name:"Mapping",value:"Full"},{name:"Colorize Texture",value:0},{name:"Offset",value:0},{name:"r",value:.23529411764705882},{name:"g",value:.5372549019607843},{name:"b",value:.6431372549019608},{name:"a",value:1}],portsOut:[{name:"Trigger",links:[{portIn:"Render",portOut:"Trigger",objIn:"7j6ooknik",objOut:"mczzw2ceh"}]}],objName:"Ops.Gl.Meshes.SplineMeshMaterial_v2"},{id:"7j6ooknik",uiAttribs:{},portsIn:[{name:"Tesselate Edges",value:0},{name:"Render Mesh",value:1}],objName:"Ops.Gl.Meshes.SplineMesh_v2"},{id:"k8n5phf7i",uiAttribs:{},portsIn:[{name:"Render Mesh",value:1},{name:"Add Vertex Numbers",value:0}],objName:"Ops.Gl.RenderGeometry_v2"},{id:"v6zpsggiu",uiAttribs:{},portsIn:[{name:"Combine index",value:0},{name:"Combine",value:"Positive"},{name:"Path 2",value:0},{name:"Path 3",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"k8n5phf7i",objOut:"v6zpsggiu"}]},{name:"Geometry",links:[{portIn:"Geometry",portOut:"Geometry",objIn:"k8n5phf7i",objOut:"v6zpsggiu"}]}],objName:"Ops.Graphics.Geometry.Triangulate2dPath"},{id:"i92gwj0r3",uiAttribs:{},portsIn:[{name:"title",value:"Face points"},{name:"text",value:""}],objName:"Ops.Ui.Comment_v2"},{id:"zxqzn4ga3",uiAttribs:{},portsIn:[{name:"index",value:0},{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"number1",portOut:"value",objIn:"ngr13wb63",objOut:"zxqzn4ga3"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"mxcu1x7gb",uiAttribs:{},portsIn:[{name:"Variable",value:"rotation"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"748e087fa",objOut:"mxcu1x7gb"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"uqrpwueul",uiAttribs:{},portsIn:[{name:"Variable",value:"coordinates"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"3sxyza3kz",objOut:"uqrpwueul"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"izs45co9d",uiAttribs:{},portsIn:[{name:"B",value:1},{name:"C",value:2},{name:"D",value:3},{name:"Expression",value:"0.5/(a+1)"}],portsOut:[{name:"Result",links:[{portIn:"B",portOut:"Result",objIn:"7nlyu2335",objOut:"izs45co9d"}]},{name:"Expression Valid",value:true}],objName:"Ops.Math.MathExpression"},{id:"7nlyu2335",uiAttribs:{},portsIn:[{name:"C",value:2},{name:"D",value:3},{name:"Expression",value:"(a+1)*b+.25"}],portsOut:[{name:"Result",links:[{portIn:"Position",portOut:"Result",objIn:"9duof6cuw",objOut:"7nlyu2335"}]},{name:"Expression Valid",value:true}],objName:"Ops.Math.MathExpression"},{id:"jii9m6nkb",uiAttribs:{},portsIn:[{name:"Z",value:0},{name:"W",value:1},{name:"Num index",value:2},{name:"Num",value:"3"}],objName:"Ops.Data.Compose.Array.CompArrayPushNumbers"},{id:"exfl0cfmx",uiAttribs:{},portsOut:[{name:"trigger",links:[{portIn:"Update",portOut:"trigger",objIn:"jii9m6nkb",objOut:"exfl0cfmx"}]},{name:"X",links:[{portIn:"X",portOut:"X",objIn:"jii9m6nkb",objOut:"exfl0cfmx"}]},{name:"Y",links:[{portIn:"Y",portOut:"Y",objIn:"jii9m6nkb",objOut:"exfl0cfmx"}]},{name:"Z",value:0}],objName:"Ops.Gl.Matrix.Coordinates"},{id:"buv6ddqpv",uiAttribs:{},portsIn:[{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:39.8}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"exfl0cfmx",objOut:"buv6ddqpv"}]}],objName:"Ops.Graphics.Transform"},{id:"3rgm9m7il",uiAttribs:{},portsIn:[{name:"value",value:4}],portsOut:[{name:"result",links:[{portIn:"A",portOut:"result",objIn:"izs45co9d",objOut:"3rgm9m7il"},{portIn:"Repeats",portOut:"result",objIn:"wqq29s1gk",objOut:"3rgm9m7il"}]}],objName:"Ops.Number.Number"},{id:"9duof6cuw",uiAttribs:{},portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"buv6ddqpv",objOut:"9duof6cuw"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"buv6ddqpv",objOut:"9duof6cuw"}]}],objName:"Ops.Math.CircleCoordinates"},{id:"2syh9hve7",uiAttribs:{},portsIn:[{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"buv6ddqpv",objOut:"2syh9hve7"}]}],objName:"Ops.Graphics.Transform"},{id:"k5e49zfnk",uiAttribs:{},portsIn:[{name:"Active",value:1},{name:"Clear",value:1}],portsOut:[{name:"Next",links:[{portIn:"Execute",portOut:"Next",objIn:"wqq29s1gk",objOut:"k5e49zfnk"}]},{name:"Result",links:[{portIn:"Array 0",portOut:"Result",objIn:"ol4273veh",objOut:"k5e49zfnk"}]}],objName:"Ops.Data.Compose.Array.CompArray"},{id:"wqq29s1gk",uiAttribs:{},portsIn:[{name:"Direction index",value:1},{name:"Direction",value:"Backward"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"2syh9hve7",objOut:"wqq29s1gk"}]},{name:"index",links:[{portIn:"A",portOut:"index",objIn:"7nlyu2335",objOut:"wqq29s1gk"}]}],objName:"Ops.Trigger.Repeat_v2"},{id:"ngr13wb63",uiAttribs:{},portsIn:[{name:"number2",value:24}],portsOut:[{name:"result",links:[{portIn:"Radius",portOut:"result",objIn:"9duof6cuw",objOut:"ngr13wb63"}]}],objName:"Ops.Math.Divide"},{id:"748e087fa",uiAttribs:{},portsIn:[{name:"Index",value:0}],portsOut:[{name:"X",value:0},{name:"Y",value:0},{name:"Z",links:[{portIn:"rotZ",portOut:"Z",objIn:"l19ime88e",objOut:"748e087fa"},{portIn:"rotZ",portOut:"Z",objIn:"2syh9hve7",objOut:"748e087fa"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"3sxyza3kz",uiAttribs:{},portsIn:[{name:"Index",value:0}],portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"l19ime88e",objOut:"3sxyza3kz"},{portIn:"posX",portOut:"X",objIn:"2syh9hve7",objOut:"3sxyza3kz"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"l19ime88e",objOut:"3sxyza3kz"},{portIn:"posY",portOut:"Y",objIn:"2syh9hve7",objOut:"3sxyza3kz"}]},{name:"Z",value:0}],objName:"Ops.Array.Array3GetNumbers"},{id:"09p6m8j5l",uiAttribs:{},portsIn:[{name:"number2",value:3}],portsOut:[{name:"result",links:[{portIn:"Limit",portOut:"result",objIn:"d11wrnt7b",objOut:"09p6m8j5l"}]}],objName:"Ops.Math.Multiply"},{id:"0mh7zvuf2",uiAttribs:{},portsIn:[{name:"title",value:"Side fins"},{name:"text",value:""}],objName:"Ops.Ui.Comment_v2"},{id:"fyu3b3tbr",uiAttribs:{},portsIn:[{name:"Variable",value:"rotation"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"otvuk5qvm",objOut:"fyu3b3tbr"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"7xoyct7i7",uiAttribs:{},portsIn:[{name:"Variable",value:"coordinates"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"nbz48si8g",objOut:"7xoyct7i7"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"p9v13jliu",uiAttribs:{},portsIn:[{name:"Named Trigger",value:"once"}],portsOut:[{name:"Triggered",links:[{portIn:"Update",portOut:"Triggered",objIn:"d11wrnt7b",objOut:"p9v13jliu"}]}],objName:"Ops.Trigger.TriggerReceive"},{id:"kfs5z7li9",uiAttribs:{},portsOut:[{name:"X",links:[{portIn:"Index",portOut:"X",objIn:"otvuk5qvm",objOut:"kfs5z7li9"},{portIn:"Index",portOut:"X",objIn:"nbz48si8g",objOut:"kfs5z7li9"}]},{name:"Y",links:[{portIn:"scale",portOut:"Y",objIn:"bjz3ebkwp",objOut:"kfs5z7li9"}]},{name:"Z",links:[{portIn:"Radius",portOut:"Z",objIn:"4m2c9nfux",objOut:"kfs5z7li9"},{portIn:"Radius",portOut:"Z",objIn:"hrmfigy0c",objOut:"kfs5z7li9"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"mhqh0timr",uiAttribs:{},portsIn:[{name:"value",value:2}],portsOut:[{name:"result",links:[{portIn:"number1",portOut:"result",objIn:"09p6m8j5l",objOut:"mhqh0timr"},{portIn:"Repeats",portOut:"result",objIn:"a2fyx3dts",objOut:"mhqh0timr"}]}],objName:"Ops.Number.Number"},{id:"d11wrnt7b",uiAttribs:{},portsIn:[{name:"Slider",value:0},{name:"Index 0",value:1},{name:"Index 1",value:.9},{name:"Index 2",value:.14},{name:"Index 3",value:7},{name:"Index 4",value:.2},{name:"Index 5",value:.04},{name:"Index 6",value:0},{name:"Index 7",value:0},{name:"Index 8",value:0},{name:"Index 9",value:0},{name:"Index 10",value:0},{name:"Index 11",value:0},{name:"Index 12",value:0},{name:"Index 13",value:0},{name:"Index 14",value:0},{name:"Index 15",value:0},{name:"Index 16",value:0},{name:"Index 17",value:0},{name:"Index 18",value:0},{name:"Index 19",value:0},{name:"Index 20",value:0},{name:"Index 21",value:0},{name:"Index 22",value:0},{name:"Index 23",value:0},{name:"Index 24",value:0},{name:"Index 25",value:0},{name:"Index 26",value:0},{name:"Index 27",value:0},{name:"Index 28",value:0},{name:"Index 29",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array",portOut:"Array",objIn:"kfs5z7li9",objOut:"d11wrnt7b"}]}],objName:"Ops.Array.ArrayFromNumbers"},{id:"t4f5usnx0",uiAttribs:{},portsIn:[{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:-10},{name:"rotZ",value:-40}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"bjz3ebkwp",objOut:"t4f5usnx0"}]}],objName:"Ops.Graphics.Transform"},{id:"4m2c9nfux",uiAttribs:{},portsIn:[{name:"Position",value:.85}],portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"t4f5usnx0",objOut:"4m2c9nfux"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"t4f5usnx0",objOut:"4m2c9nfux"}]}],objName:"Ops.Math.CircleCoordinates"},{id:"bjz3ebkwp",uiAttribs:{},portsIn:[{name:"x",value:.59},{name:"y",value:.16},{name:"z",value:1}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"fyuk5254b",objOut:"bjz3ebkwp"}]}],objName:"Ops.Gl.Matrix.Scale"},{id:"7x4sn0sm9",uiAttribs:{},portsIn:[{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:10},{name:"rotZ",value:40}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"bjz3ebkwp",objOut:"7x4sn0sm9"}]}],objName:"Ops.Graphics.Transform"},{id:"hrmfigy0c",uiAttribs:{},portsIn:[{name:"Position",value:.15}],portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"7x4sn0sm9",objOut:"hrmfigy0c"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"7x4sn0sm9",objOut:"hrmfigy0c"}]}],objName:"Ops.Math.CircleCoordinates"},{id:"0o4jh9q6n",uiAttribs:{},portsIn:[{name:"posZ",value:-.05},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"t4f5usnx0",objOut:"0o4jh9q6n"},{portIn:"render",portOut:"trigger",objIn:"7x4sn0sm9",objOut:"0o4jh9q6n"}]}],objName:"Ops.Graphics.Transform"},{id:"otvuk5qvm",uiAttribs:{},portsOut:[{name:"X",value:0},{name:"Y",value:0},{name:"Z",links:[{portIn:"rotZ",portOut:"Z",objIn:"0o4jh9q6n",objOut:"otvuk5qvm"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"nbz48si8g",uiAttribs:{},portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"0o4jh9q6n",objOut:"nbz48si8g"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"0o4jh9q6n",objOut:"nbz48si8g"}]},{name:"Z",value:0}],objName:"Ops.Array.Array3GetNumbers"},{id:"a2fyx3dts",uiAttribs:{},portsIn:[{name:"Direction index",value:0},{name:"Direction",value:"Forward"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"0o4jh9q6n",objOut:"a2fyx3dts"}]},{name:"index",links:[{portIn:"Index",portOut:"index",objIn:"kfs5z7li9",objOut:"a2fyx3dts"}]}],objName:"Ops.Trigger.Repeat_v2"},{id:"ewihcwal0",uiAttribs:{},portsIn:[{name:"Variable",value:"rotation"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"7dkk9drls",objOut:"ewihcwal0"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"bt4xon2ys",uiAttribs:{},portsIn:[{name:"Variable",value:"coordinates"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"y9wvudwz6",objOut:"bt4xon2ys"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"hvcsdxf0w",uiAttribs:{},portsIn:[{name:"Named Trigger",value:"once"}],portsOut:[{name:"Triggered",links:[{portIn:"Update",portOut:"Triggered",objIn:"zlhlixqeq",objOut:"hvcsdxf0w"}]}],objName:"Ops.Trigger.TriggerReceive"},{id:"7asr6xhdj",uiAttribs:{},portsIn:[{name:"title",value:"Back fins"},{name:"text",value:""}],objName:"Ops.Ui.Comment_v2"},{id:"bd6wgv6rz",uiAttribs:{},portsIn:[{name:"Value Invalid Index",value:0}],portsOut:[{name:"value",links:[{portIn:"scale",portOut:"value",objIn:"b7ptyyj94",objOut:"bd6wgv6rz"}]},{name:"Valid Index",value:1}],objName:"Ops.Array.ArrayGetNumber"},{id:"zlhlixqeq",uiAttribs:{},portsIn:[{name:"Slider",value:0},{name:"Index 0",value:.3},{name:"Index 1",value:.5},{name:"Index 2",value:.4},{name:"Index 3",value:.35},{name:"Index 4",value:.2},{name:"Index 5",value:0},{name:"Index 6",value:0},{name:"Index 7",value:0},{name:"Index 8",value:0},{name:"Index 9",value:0},{name:"Index 10",value:0},{name:"Index 11",value:0},{name:"Index 12",value:0},{name:"Index 13",value:0},{name:"Index 14",value:0},{name:"Index 15",value:0},{name:"Index 16",value:0},{name:"Index 17",value:0},{name:"Index 18",value:0},{name:"Index 19",value:0},{name:"Index 20",value:0},{name:"Index 21",value:0},{name:"Index 22",value:0},{name:"Index 23",value:0},{name:"Index 24",value:0},{name:"Index 25",value:0},{name:"Index 26",value:0},{name:"Index 27",value:0},{name:"Index 28",value:0},{name:"Index 29",value:0}],portsOut:[{name:"Array",links:[{portIn:"array",portOut:"Array",objIn:"bd6wgv6rz",objOut:"zlhlixqeq"}]}],objName:"Ops.Array.ArrayFromNumbers"},{id:"3j6k73kfp",uiAttribs:{},portsIn:[{name:"value",value:2}],portsOut:[{name:"result",links:[{portIn:"Limit",portOut:"result",objIn:"zlhlixqeq",objOut:"3j6k73kfp"},{portIn:"Repeats",portOut:"result",objIn:"5d02320if",objOut:"3j6k73kfp"}]}],objName:"Ops.Number.Number"},{id:"anzb8x47g",uiAttribs:{},portsIn:[{name:"number2",value:1}],portsOut:[{name:"result",links:[{portIn:"Index",portOut:"result",objIn:"7dkk9drls",objOut:"anzb8x47g"},{portIn:"Index",portOut:"result",objIn:"y9wvudwz6",objOut:"anzb8x47g"}]}],objName:"Ops.Math.Sum"},{id:"5d02320if",uiAttribs:{},portsIn:[{name:"Direction index",value:0},{name:"Direction",value:"Forward"}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"0htcleese",objOut:"5d02320if"}]},{name:"index",links:[{portIn:"index",portOut:"index",objIn:"bd6wgv6rz",objOut:"5d02320if"},{portIn:"number1",portOut:"index",objIn:"anzb8x47g",objOut:"5d02320if"}]}],objName:"Ops.Trigger.Repeat_v2"},{id:"p0kabs5mj",uiAttribs:{},portsIn:[{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:-.01},{name:"scale",value:1},{name:"rotX",value:90},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"fyuk5254b",objOut:"p0kabs5mj"}]}],objName:"Ops.Graphics.Transform"},{id:"b7ptyyj94",uiAttribs:{},portsIn:[{name:"x",value:1.5},{name:"y",value:1},{name:"z",value:.7}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"p0kabs5mj",objOut:"b7ptyyj94"}]}],objName:"Ops.Gl.Matrix.Scale"},{id:"9g3itmr63",uiAttribs:{},portsIn:[{name:"posZ",value:.005},{name:"scale",value:1},{name:"rotX",value:35},{name:"rotY",value:0},{name:"rotZ",value:90}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"b7ptyyj94",objOut:"9g3itmr63"}]}],objName:"Ops.Graphics.Transform"},{id:"7pu0pv729",uiAttribs:{},portsIn:[{name:"Position",value:0},{name:"Radius",value:.1}],portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"9g3itmr63",objOut:"7pu0pv729"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"9g3itmr63",objOut:"7pu0pv729"}]}],objName:"Ops.Math.CircleCoordinates"},{id:"0htcleese",uiAttribs:{},portsIn:[{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"9g3itmr63",objOut:"0htcleese"}]}],objName:"Ops.Graphics.Transform"},{id:"7dkk9drls",uiAttribs:{},portsOut:[{name:"X",value:0},{name:"Y",value:0},{name:"Z",links:[{portIn:"rotZ",portOut:"Z",objIn:"0htcleese",objOut:"7dkk9drls"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"y9wvudwz6",uiAttribs:{},portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"0htcleese",objOut:"y9wvudwz6"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"0htcleese",objOut:"y9wvudwz6"}]},{name:"Z",value:0}],objName:"Ops.Array.Array3GetNumbers"},{id:"wnufjvudk",uiAttribs:{},portsIn:[{name:"title",value:"Tail"},{name:"text",value:""}],objName:"Ops.Ui.Comment_v2"},{id:"1psd5jfxr",uiAttribs:{},portsIn:[{name:"Variable",value:"rotation"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"wn77lxq0u",objOut:"1psd5jfxr"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"ycxdv4zaf",uiAttribs:{},portsIn:[{name:"Variable",value:"coordinates"}],portsOut:[{name:"Value",links:[{portIn:"Array",portOut:"Value",objIn:"9akxxy894",objOut:"ycxdv4zaf"}]}],objName:"Ops.Vars.VarGetArray_v2"},{id:"31xqat5gr",uiAttribs:{},portsIn:[{name:"Variable",value:"Segment number"}],portsOut:[{name:"Value",links:[{portIn:"Index",portOut:"Value",objIn:"wn77lxq0u",objOut:"31xqat5gr"},{portIn:"Index",portOut:"Value",objIn:"9akxxy894",objOut:"31xqat5gr"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"8r4qkbyoa",uiAttribs:{},portsIn:[{name:"posX",value:0},{name:"posY",value:0},{name:"posZ",value:-.01},{name:"scale",value:1},{name:"rotX",value:90},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"mlicop1nb",objOut:"8r4qkbyoa"}]}],objName:"Ops.Graphics.Transform"},{id:"ohgasi2m4",uiAttribs:{},portsIn:[{name:"value",value:.08}],portsOut:[{name:"result",links:[{portIn:"posY",portOut:"result",objIn:"ms7nr7iqa",objOut:"ohgasi2m4"},{portIn:"posY",portOut:"result",objIn:"brif0qvoa",objOut:"ohgasi2m4"}]}],objName:"Ops.Number.Number"},{id:"ms7nr7iqa",uiAttribs:{},portsIn:[{name:"posX",value:0},{name:"posZ",value:-.05},{name:"scale",value:1},{name:"rotX",value:-35},{name:"rotY",value:0},{name:"rotZ",value:90}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"526wwirte",objOut:"ms7nr7iqa"}]}],objName:"Ops.Graphics.Transform"},{id:"526wwirte",uiAttribs:{},portsIn:[{name:"scale",value:.9},{name:"x",value:1.5},{name:"y",value:1},{name:"z",value:.75}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"8r4qkbyoa",objOut:"526wwirte"}]}],objName:"Ops.Gl.Matrix.Scale"},{id:"brif0qvoa",uiAttribs:{},portsIn:[{name:"posX",value:0},{name:"posZ",value:.05},{name:"scale",value:1},{name:"rotX",value:35},{name:"rotY",value:0},{name:"rotZ",value:90}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"526wwirte",objOut:"brif0qvoa"}]}],objName:"Ops.Graphics.Transform"},{id:"gelk9ow4u",uiAttribs:{},portsIn:[{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"ms7nr7iqa",objOut:"gelk9ow4u"},{portIn:"render",portOut:"trigger",objIn:"brif0qvoa",objOut:"gelk9ow4u"}]}],objName:"Ops.Graphics.Transform"},{id:"wn77lxq0u",uiAttribs:{},portsOut:[{name:"X",value:0},{name:"Y",value:0},{name:"Z",links:[{portIn:"rotZ",portOut:"Z",objIn:"gelk9ow4u",objOut:"wn77lxq0u"}]}],objName:"Ops.Array.Array3GetNumbers"},{id:"9akxxy894",uiAttribs:{},portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"gelk9ow4u",objOut:"9akxxy894"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"gelk9ow4u",objOut:"9akxxy894"}]},{name:"Z",value:0}],objName:"Ops.Array.Array3GetNumbers"},{id:"mlicop1nb",uiAttribs:{},portsIn:[{name:"r",value:.23675404866536456},{name:"g",value:.5376227193196615},{name:"b",value:.6433333333333333},{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"Vertex Colors",value:0},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"Luminance"},{name:"Opacity TexCoords Transform",value:0},{name:"Discard Transparent Pixels",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0},{name:"Crop TexCoords",value:0},{name:"billboard",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"0e7ylt539",objOut:"mlicop1nb"}]}],objName:"Ops.Gl.Shader.BasicMaterial_v3"},{id:"0e7ylt539",uiAttribs:{},portsIn:[{name:"radius",value:.1},{name:"innerRadius",value:0},{name:"segments",value:32},{name:"percent",value:1},{name:"steps",value:0},{name:"invertSteps",value:0},{name:"mapping index",value:0},{name:"mapping",value:"flat"},{name:"Spline",value:0},{name:"Draw",value:1,title:"Render mesh"}],objName:"Ops.Graphics.Meshes.Circle_v3"},{id:"x4r8z0p52",uiAttribs:{},portsOut:[{name:"trigger 3",links:[{portIn:"Render",portOut:"trigger 3",objIn:"vdtcnhgk9",objOut:"x4r8z0p52"}]},{name:"trigger 4",links:[{portIn:"render",portOut:"trigger 4",objIn:"x7l4aw0b2",objOut:"x4r8z0p52"}]},{name:"trigger 6",links:[{portIn:"Render",portOut:"trigger 6",objIn:"wztscwpps",objOut:"x4r8z0p52"}]},{name:"trigger 8",links:[{portIn:"Render",portOut:"trigger 8",objIn:"wkit9x93u",objOut:"x4r8z0p52"}]},{name:"trigger 11",links:[{portIn:"Render",portOut:"trigger 11",objIn:"qlm1ca93a",objOut:"x4r8z0p52"}]},{name:"trigger 13",links:[{portIn:"Render",portOut:"trigger 13",objIn:"pgtfukn9r",objOut:"x4r8z0p52"}]},{name:"trigger 14",links:[{portIn:"render",portOut:"trigger 14",objIn:"tfeenp5p0",objOut:"x4r8z0p52"}]}],objName:"Ops.Trigger.Sequence"},{id:"x7l4aw0b2",uiAttribs:{},portsIn:[{name:"use original size",value:1},{name:"width",value:982},{name:"height",value:692},{name:"filter index",value:1},{name:"filter",value:"linear"},{name:"Pixel Format index",value:11},{name:"Pixel Format",value:"RGBA 32bit float"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"wrap index",value:0},{name:"wrap",value:"clamp to edge"},{name:"Alpha Mask Source index",value:0},{name:"Alpha Mask Source",value:"A"},{name:"Convert Greyscale index",value:0},{name:"Convert Greyscale",value:"Off"},{name:"Invert R",value:0},{name:"Invert G",value:0},{name:"Invert B",value:0},{name:"Invert A",value:0},{name:"Flip X",value:0},{name:"Flip Y",value:0}],portsOut:[{name:"texture_out",links:[{portIn:"Image",portOut:"texture_out",objIn:"t9kmmuq9t",objOut:"x7l4aw0b2"}]},{name:"Aspect Ratio",value:1.4190751445086704}],objName:"Ops.Gl.Textures.CopyTexture_v3"},{id:"vdtcnhgk9",uiAttribs:{},portsIn:[{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:0},{name:"Wrap",value:"clamp to edge"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"Pixel Format index",value:11},{name:"Pixel Format",value:"RGBA 32bit float"},{name:"Clear",value:1},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"w3ipiovh5",objOut:"vdtcnhgk9"}]},{name:"texture_out",links:[{portIn:"Texture",portOut:"texture_out",objIn:"x7l4aw0b2",objOut:"vdtcnhgk9"},{portIn:"Image",portOut:"texture_out",objIn:"e5liaoq4k",objOut:"vdtcnhgk9"},{portIn:"Image",portOut:"texture_out",objIn:"5q4fi5ete",objOut:"vdtcnhgk9"}]},{name:"Aspect Ratio",value:1.4190751445086704},{name:"Texture Width",value:982},{name:"Texture Height",value:692}],objName:"Ops.Gl.ImageCompose.ImageCompose_v4"},{id:"pgtfukn9r",uiAttribs:{},portsIn:[{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:0},{name:"Wrap",value:"clamp to edge"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Clear",value:1},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"akn4w8vu7",objOut:"pgtfukn9r"}]},{name:"texture_out",links:[{portIn:"Texture",portOut:"texture_out",objIn:"tfeenp5p0",objOut:"pgtfukn9r"}]},{name:"Aspect Ratio",value:1.4190751445086704},{name:"Texture Width",value:982},{name:"Texture Height",value:692}],objName:"Ops.Gl.ImageCompose.ImageCompose_v4"},{id:"tfeenp5p0",uiAttribs:{},portsIn:[{name:"Scale index",value:0},{name:"Scale",value:"Stretch"},{name:"Flip Y",value:0},{name:"Flip X",value:0}],objName:"Ops.Gl.Meshes.FullscreenRectangle_v2"},{id:"cs1c3j7h0",uiAttribs:{},portsIn:[{name:"Amount",value:1},{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Alpha Mask index",value:0},{name:"Alpha Mask",value:"Off"},{name:"Size",value:.167},{name:"Inner",value:0},{name:"Stretch X",value:0},{name:"Stretch Y",value:0},{name:"fallOff index",value:0},{name:"fallOff",value:"Linear"},{name:"fade Out",value:.043},{name:"warn overflow",value:0},{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1}],objName:"Ops.Gl.ImageCompose.CircleTexture_v4"},{id:"0tt6337ws",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Strength",value:22.45},{name:"Width",value:.309},{name:"Mul Color",value:0}],portsOut:[{name:"Trigger",links:[{portIn:"Render",portOut:"Trigger",objIn:"10da134ke",objOut:"0tt6337ws"}]}],objName:"Ops.Gl.ImageCompose.EdgeDetection_v4"},{id:"10da134ke",uiAttribs:{},portsIn:[{name:"In Min",value:0},{name:"Midpoint",value:.24},{name:"In Max",value:1},{name:"Out Min",value:0},{name:"Out Max",value:1}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"fhs8jtq6y",objOut:"10da134ke"}]}],objName:"Ops.Gl.ImageCompose.Levels_v2"},{id:"ftki1mjwy",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"Pixel",value:9.78},{name:"Lens Distort",value:0},{name:"Smooth",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"fq0wmhulj",objOut:"ftki1mjwy"}]}],objName:"Ops.Gl.ImageCompose.ChromaticAberration_v2"},{id:"ln0aa8bdw",uiAttribs:{},portsIn:[{name:"Passes",value:1},{name:"Clamp",value:1},{name:"direction index",value:0},{name:"direction",value:"both"},{name:"Mask Invert",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"dj3dre92a",objOut:"ln0aa8bdw"}]}],objName:"Ops.Gl.ImageCompose.FastBlur_v2"},{id:"fnkrattw0",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:3},{name:"Blend Mode",value:"multiply"},{name:"Amount",value:.211},{name:"Alpha Mask index",value:0},{name:"Alpha Mask",value:"Off"},{name:"smoothness",value:9.71},{name:"Harmonics index",value:0},{name:"Harmonics",value:"1"},{name:"scale",value:2.44},{name:"x",value:4.55},{name:"Offset Multiply",value:1},{name:"Offset X index",value:0},{name:"Offset X",value:"None"},{name:"Offset Y index",value:0},{name:"Offset Y",value:"None"},{name:"Offset Z index",value:1},{name:"Offset Z",value:"R"}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"ln0aa8bdw",objOut:"fnkrattw0"}]}],objName:"Ops.Gl.ImageCompose.Noise.SimplexNoise_v2"},{id:"8wu04nb2d",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"amount X",value:.005},{name:"amount Y",value:.005},{name:"Wrap index",value:1},{name:"Wrap",value:"Clamp"},{name:"Input index",value:1},{name:"Input",value:"RedGreen"},{name:"Zero Displace index",value:0},{name:"Zero Displace",value:"Grey"},{name:"Pixel Mapping index",value:0},{name:"Pixel Mapping",value:"Stretch"}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"cs1c3j7h0",objOut:"8wu04nb2d"}]}],objName:"Ops.Gl.ImageCompose.PixelDisplacement_v4"},{id:"fq0wmhulj",uiAttribs:{},portsIn:[{name:"Blend Mode index",value:0},{name:"Blend Mode",value:"normal"},{name:"Amount",value:1},{name:"amount X",value:1},{name:"amount Y",value:1},{name:"Wrap index",value:2},{name:"Wrap",value:"Repeat"},{name:"Input index",value:0},{name:"Input",value:"Luminance"},{name:"Zero Displace index",value:0},{name:"Zero Displace",value:"Grey"},{name:"Pixel Mapping index",value:0},{name:"Pixel Mapping",value:"Stretch"}],objName:"Ops.Gl.ImageCompose.PixelDisplacement_v4"},{id:"fhs8jtq6y",uiAttribs:{},portsIn:[{name:"amount",value:.32},{name:"direction index",value:0},{name:"direction",value:"both"},{name:"Fast",value:1}],objName:"Ops.Gl.ImageCompose.Blur"},{id:"apcax12x1",uiAttribs:{},portsIn:[{name:"amount",value:1},{name:"Invert Mask",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Render",portOut:"trigger",objIn:"0tt6337ws",objOut:"apcax12x1"}]}],objName:"Ops.Gl.ImageCompose.Desaturate"},{id:"a8dopflam",uiAttribs:{},portsIn:[{name:"Play",value:1},{name:"Sync to timeline",value:0}],portsOut:[{name:"Time",links:[{portIn:"y",portOut:"Time",objIn:"fnkrattw0",objOut:"a8dopflam"},{portIn:"time",portOut:"Time",objIn:"fnkrattw0",objOut:"a8dopflam"}]}],objName:"Ops.Anim.Timer_v2"},{id:"e5liaoq4k",uiAttribs:{},portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"fnkrattw0",objOut:"e5liaoq4k"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"t9kmmuq9t",uiAttribs:{},portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:.995},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"8wu04nb2d",objOut:"t9kmmuq9t"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"w3ipiovh5",uiAttribs:{},portsIn:[{name:"blendMode index",value:5},{name:"blendMode",value:"average"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"t9kmmuq9t",objOut:"w3ipiovh5"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"akn4w8vu7",uiAttribs:{},portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"ftki1mjwy",objOut:"akn4w8vu7"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"ujehm7o0m",uiAttribs:{},portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"pyswfg6af",uiAttribs:{},portsIn:[{name:"File",value:"assets/68a7f9708ae56546aab13d50_Water_2_A3_copy.jpg",display:"file"},{name:"Filter index",value:2},{name:"Filter",value:"mipmap"},{name:"Wrap index",value:0},{name:"Wrap",value:"repeat"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"Data Format index",value:3},{name:"Data Format",value:"RGBA"},{name:"Flip",value:0},{name:"Pre Multiplied Alpha",value:0},{name:"Active",value:1},{name:"Save Memory",value:1},{name:"Add Cachebuster",value:0}],portsOut:[{name:"Texture",links:[{portIn:"Image",portOut:"Texture",objIn:"ujehm7o0m",objOut:"pyswfg6af"}]},{name:"Width",value:4961},{name:"Height",value:3508},{name:"Aspect Ratio",value:1.4141961231470923},{name:"Loaded",value:1},{name:"Loading",value:0}],objName:"Ops.Gl.Texture_v2"},{id:"qlm1ca93a",uiAttribs:{},portsIn:[{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:0},{name:"Wrap",value:"clamp to edge"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Clear",value:1},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"5q4fi5ete",objOut:"qlm1ca93a"}]},{name:"texture_out",links:[{portIn:"Mask",portOut:"texture_out",objIn:"ftki1mjwy",objOut:"qlm1ca93a"}]},{name:"Aspect Ratio",value:1.4190751445086704},{name:"Texture Width",value:982},{name:"Texture Height",value:692}],objName:"Ops.Gl.ImageCompose.ImageCompose_v4"},{id:"7ei7eazy9",uiAttribs:{},portsIn:[{name:"Coordinates index",value:0},{name:"Coordinates",value:"-1 to 1"},{name:"Area index",value:0},{name:"Area",value:"Canvas"},{name:"flip y",value:1},{name:"right click prevent default",value:1},{name:"Touch support",value:1},{name:"Passive Events",value:0},{name:"Active",value:1}],portsOut:[{name:"x",links:[{portIn:"Pos X",portOut:"x",objIn:"cs1c3j7h0",objOut:"7ei7eazy9"}]},{name:"y",links:[{portIn:"Pos Y",portOut:"y",objIn:"cs1c3j7h0",objOut:"7ei7eazy9"}]},{name:"Button is down",value:0},{name:"Mouse is hovering",value:0},{name:"Movement X",value:-2.5},{name:"Movement Y",value:7}],objName:"Ops.Devices.Mouse.Mouse_v3"},{id:"wztscwpps",uiAttribs:{},portsIn:[{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:0},{name:"Wrap",value:"clamp to edge"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Clear",value:1},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"ujehm7o0m",objOut:"wztscwpps"}]},{name:"texture_out",links:[{portIn:"Image",portOut:"texture_out",objIn:"akn4w8vu7",objOut:"wztscwpps"},{portIn:"Image",portOut:"texture_out",objIn:"w3ipiovh5",objOut:"wztscwpps"}]},{name:"Aspect Ratio",value:1.4190751445086704},{name:"Texture Width",value:982},{name:"Texture Height",value:692}],objName:"Ops.Gl.ImageCompose.ImageCompose_v4"},{id:"mg8wzawq6",uiAttribs:{},portsIn:[{name:"URL",value:"assets/fr_fr_meteo_2.json",display:"file",title:"URL"},{name:"HTTP Method index",value:0},{name:"HTTP Method",value:"GET"},{name:"Request Body",value:""},{name:"Content-Type",value:"application/json"},{name:"Send Credentials",value:0},{name:"Response Content index",value:0},{name:"Response Content",value:"JSON",title:"Response Content"},{name:"Auto request",value:1},{name:"Empty output on change",value:1},{name:"Retry on error",value:1}],portsOut:[{name:"Response Json Object",links:[{portIn:"Object",portOut:"Response Json Object",objIn:"vwe0rr9zc",objOut:"mg8wzawq6"},{portIn:"Object",portOut:"Response Json Object",objIn:"nhr8ix8x2",objOut:"mg8wzawq6"},{portIn:"Object",portOut:"Response Json Object",objIn:"3i6hrti3j",objOut:"mg8wzawq6"},{portIn:"Object",portOut:"Response Json Object",objIn:"2cquipk79",objOut:"mg8wzawq6"}]},{name:"Status Code",value:200},{name:"Is Loading",value:0},{name:"Has Error",value:0},{name:"Error",value:""},{name:"Duration MS",value:140}],objName:"Ops.Json.HttpRequest_v4"},{id:"vwe0rr9zc",uiAttribs:{},portsIn:[{name:"Path",value:"current.wind.speed"}],portsOut:[{name:"Output",links:[{portIn:"Value 1",portOut:"Output",objIn:"fdrfzf925",objOut:"vwe0rr9zc"}]},{name:"Found",value:1}],objName:"Ops.Data.JsonPath.ObjectGetNumberByPath"},{id:"nhr8ix8x2",uiAttribs:{},portsIn:[{name:"Path",value:"history.2025-08-22.03:11.wind.speed"}],portsOut:[{name:"Output",links:[{portIn:"Value 1",portOut:"Output",objIn:"virn9wqis",objOut:"nhr8ix8x2"}]},{name:"Found",value:1}],objName:"Ops.Data.JsonPath.ObjectGetNumberByPath"},{id:"fdrfzf925",uiAttribs:{},portsIn:[{name:"Value 0",value:0},{name:"Value 2",value:0},{name:"Value 3",value:0},{name:"Value 4",value:0},{name:"Value 5",value:0},{name:"Value 6",value:0},{name:"Value 7",value:0},{name:"Value 8",value:0},{name:"Value 9",value:0},{name:"Value 10",value:0},{name:"Value 11",value:0},{name:"Value 12",value:0},{name:"Value 13",value:0},{name:"Value 14",value:0},{name:"Value 15",value:0}],portsOut:[{name:"Result",links:[{portIn:"Speed",portOut:"Result",objIn:"a8dopflam",objOut:"fdrfzf925"}]}],objName:"Ops.Number.SwitchNumber"},{id:"1vdh1scvz",uiAttribs:{},portsIn:[{name:"Text",value:"Day 1"},{name:"Input",value:0},{name:"Default",value:0},{name:"Grey Out",value:0},{name:"Visible",value:1}],portsOut:[{name:"Value",links:[{portIn:"Index",portOut:"Value",objIn:"fdrfzf925",objOut:"1vdh1scvz"}]}],objName:"Ops.Sidebar.Toggle_v4"},{id:"rufejzorz",uiAttribs:{},portsIn:[{name:"Text",value:"Day 2"},{name:"Input",value:0},{name:"Default",value:0},{name:"Grey Out",value:0},{name:"Visible",value:1}],portsOut:[{name:"Value",links:[{portIn:"Index",portOut:"Value",objIn:"virn9wqis",objOut:"rufejzorz"},{portIn:"Index",portOut:"Value",objIn:"x5arh872p",objOut:"rufejzorz"}]}],objName:"Ops.Sidebar.Toggle_v4"},{id:"virn9wqis",uiAttribs:{},portsIn:[{name:"Value 0",value:0},{name:"Value 2",value:0},{name:"Value 3",value:0},{name:"Value 4",value:0},{name:"Value 5",value:0},{name:"Value 6",value:0},{name:"Value 7",value:0},{name:"Value 8",value:0},{name:"Value 9",value:0},{name:"Value 10",value:0},{name:"Value 11",value:0},{name:"Value 12",value:0},{name:"Value 13",value:0},{name:"Value 14",value:0},{name:"Value 15",value:0}],portsOut:[{name:"Result",links:[{portIn:"Speed",portOut:"Result",objIn:"a8dopflam",objOut:"virn9wqis"}]}],objName:"Ops.Number.SwitchNumber"},{id:"3i6hrti3j",uiAttribs:{},portsIn:[{name:"Path",value:"history.2025-08-27.14:00.weather.main"}],portsOut:[{name:"Output",links:[{portIn:"Value 1",portOut:"Output",objIn:"p88mlh5bb",objOut:"3i6hrti3j"}]},{name:"Found",value:0}],objName:"Ops.Data.JsonPath.ObjectGetNumberByPath"},{id:"bbc3gg391",uiAttribs:{},portsIn:[{name:"Text",value:"Day 3"},{name:"Input",value:true},{name:"Default",value:1},{name:"Grey Out",value:0},{name:"Visible",value:1}],portsOut:[{name:"Value",links:[{portIn:"Index",portOut:"Value",objIn:"p88mlh5bb",objOut:"bbc3gg391"},{portIn:"scale",portOut:"Value",objIn:"4g0dcy2sk",objOut:"bbc3gg391"}]}],objName:"Ops.Sidebar.Toggle_v4"},{id:"p88mlh5bb",uiAttribs:{},portsIn:[{name:"Value 0",value:0},{name:"Value 2",value:0},{name:"Value 3",value:0},{name:"Value 4",value:0},{name:"Value 5",value:0},{name:"Value 6",value:0},{name:"Value 7",value:0},{name:"Value 8",value:0},{name:"Value 9",value:0},{name:"Value 10",value:0},{name:"Value 11",value:0},{name:"Value 12",value:0},{name:"Value 13",value:0},{name:"Value 14",value:0},{name:"Value 15",value:0}],portsOut:[{name:"Result",links:[{portIn:"Speed",portOut:"Result",objIn:"a8dopflam",objOut:"p88mlh5bb"}]}],objName:"Ops.Number.SwitchNumber"},{id:"5q4fi5ete",uiAttribs:{},portsIn:[{name:"blendMode index",value:0},{name:"blendMode",value:"normal"},{name:"amount",value:1},{name:"Premultiplied",value:0},{name:"Alpha Mask",value:0},{name:"removeAlphaSrc",value:0},{name:"Mask Src index",value:0},{name:"Mask Src",value:"alpha channel"},{name:"Invert alpha channel",value:0},{name:"Aspect Ratio",value:0},{name:"Stretch Axis index",value:0},{name:"Stretch Axis",value:"X"},{name:"Position",value:0},{name:"Crop",value:0},{name:"flip x",value:0},{name:"flip y",value:0},{name:"Transform",value:0},{name:"Scale X",value:1},{name:"Scale Y",value:1},{name:"Position X",value:0},{name:"Position Y",value:0},{name:"Rotation",value:0},{name:"Clip Repeat",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"apcax12x1",objOut:"5q4fi5ete"}]}],objName:"Ops.Gl.ImageCompose.DrawImage_v3"},{id:"wkit9x93u",uiAttribs:{},portsIn:[{name:"Size index",value:0},{name:"Size",value:"Auto"},{name:"Width",value:640},{name:"Height",value:480},{name:"Filter index",value:1},{name:"Filter",value:"linear"},{name:"Wrap index",value:0},{name:"Wrap",value:"clamp to edge"},{name:"Anisotropic index",value:0},{name:"Anisotropic",value:"0"},{name:"Pixel Format index",value:4},{name:"Pixel Format",value:"RGBA 8bit ubyte"},{name:"Clear",value:1},{name:"R",value:0},{name:"G",value:0},{name:"B",value:0},{name:"A",value:0}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"e5liaoq4k",objOut:"wkit9x93u"}]},{name:"texture_out",links:[{portIn:"displaceTex",portOut:"texture_out",objIn:"fq0wmhulj",objOut:"wkit9x93u"},{portIn:"displaceTex",portOut:"texture_out",objIn:"8wu04nb2d",objOut:"wkit9x93u"}]},{name:"Aspect Ratio",value:1.4190751445086704},{name:"Texture Width",value:982},{name:"Texture Height",value:692}],objName:"Ops.Gl.ImageCompose.ImageCompose_v4"},{id:"dj3dre92a",uiAttribs:{},portsIn:[{name:"Step",value:2.51},{name:"Red index",value:7},{name:"Red",value:"Horizontal Difference Red"},{name:"Red Flip",value:0},{name:"Green index",value:1},{name:"Green",value:"Vertical Difference Green"},{name:"Green Flip",value:0},{name:"Blue index",value:15},{name:"Blue",value:"Zero"},{name:"Blue Flip",value:0}],objName:"Ops.Gl.ImageCompose.PixelDifference"},{id:"x5arh872p",uiAttribs:{},portsIn:[{name:"Value 0",value:7},{name:"Value 2",value:0},{name:"Value 3",value:0},{name:"Value 4",value:0},{name:"Value 5",value:0},{name:"Value 6",value:0},{name:"Value 7",value:0},{name:"Value 8",value:0},{name:"Value 9",value:0},{name:"Value 10",value:0},{name:"Value 11",value:0},{name:"Value 12",value:0},{name:"Value 13",value:0},{name:"Value 14",value:0},{name:"Value 15",value:0}],portsOut:[{name:"Result",links:[{portIn:"Strength",portOut:"Result",objIn:"dj3dre92a",objOut:"x5arh872p"}]}],objName:"Ops.Number.SwitchNumber"},{id:"2cquipk79",uiAttribs:{},portsIn:[{name:"Path",value:"history.2025-08-22.03:11.atmosphere.visibility"}],portsOut:[{name:"Output",links:[{portIn:"Value 1",portOut:"Output",objIn:"x5arh872p",objOut:"2cquipk79"}]},{name:"Found",value:1}],objName:"Ops.Data.JsonPath.ObjectGetNumberByPath"},{id:"m5nen2vl8",uiAttribs:{},portsIn:[{name:"radius",value:1},{name:"percent",value:1},{name:"Absolute",value:1},{name:"Flip",value:0},{name:"Rotate",value:0}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"ecpapd3of",objOut:"m5nen2vl8"}]},{name:"index",links:[{portIn:"number2",portOut:"index",objIn:"1k1017fjn",objOut:"m5nen2vl8"},{portIn:"Value",portOut:"index",objIn:"7hr0p8b94",objOut:"m5nen2vl8"},{portIn:"Value",portOut:"index",objIn:"fhmvy959q",objOut:"m5nen2vl8"}]}],objName:"Ops.Extension.Deprecated.CircleTransform"},{id:"dhw9o12oh",uiAttribs:{},portsIn:[{name:"posX",value:-.01},{name:"posY",value:.2},{name:"posZ",value:0},{name:"scale",value:.9},{name:"rotX",value:-59},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"m5nen2vl8",objOut:"dhw9o12oh"}]}],objName:"Ops.Graphics.Transform"},{id:"nx6j3eypg",uiAttribs:{},portsIn:[{name:"radius",value:.98},{name:"innerRadius",value:.978},{name:"segments",value:484},{name:"percent",value:1},{name:"steps",value:-.72},{name:"invertSteps",value:0},{name:"mapping index",value:0},{name:"mapping",value:"flat"},{name:"Spline",value:1},{name:"Draw",value:1}],objName:"Ops.Graphics.Meshes.Circle"},{id:"3dyg1xjf0",uiAttribs:{},portsIn:[{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"colorizeTexture",value:0},{name:"billboard",value:0},{name:"Opacity TexCoords Transform",value:0},{name:"preMultiplied alpha",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"s76fguzm4",objOut:"3dyg1xjf0"}]}],objName:"Ops.Gl.Shader.BasicMaterial"},{id:"cw2b498yp",uiAttribs:{},portsIn:[{name:"Multiply",value:4}],portsOut:[{name:"result",links:[{portIn:"number1",portOut:"result",objIn:"70v01aa7v",objOut:"cw2b498yp"}]}],objName:"Ops.Extension.Deprecated.RelativeTime"},{id:"bpf8mank5",uiAttribs:{},portsIn:[{name:"value",value:8.06}],portsOut:[{name:"result",links:[{portIn:"segments",portOut:"result",objIn:"m5nen2vl8",objOut:"bpf8mank5"},{portIn:"old max",portOut:"result",objIn:"3mkzgvrrp",objOut:"bpf8mank5"},{portIn:"number2",portOut:"result",objIn:"anrg0xmae",objOut:"bpf8mank5"}]}],objName:"Ops.Number.Number"},{id:"qkl97sd94",uiAttribs:{},portsOut:[{name:"trigger 0",links:[{portIn:"render",portOut:"trigger 0",objIn:"dhw9o12oh",objOut:"qkl97sd94"}]},{name:"trigger 1",links:[{portIn:"exe",portOut:"trigger 1",objIn:"cw2b498yp",objOut:"qkl97sd94"}]},{name:"trigger 9",links:[{portIn:"exe",portOut:"trigger 9",objIn:"egykcc0n4",objOut:"qkl97sd94"}]}],objName:"Ops.Extension.Deprecated.Sequence"},{id:"3mkzgvrrp",uiAttribs:{},portsIn:[{name:"old min",value:0},{name:"new min",value:0},{name:"new max",value:1},{name:"Easing index",value:0},{name:"Easing",value:"Linear"},{name:"Clamp",value:1}],portsOut:[{name:"result",links:[{portIn:"value",portOut:"result",objIn:"2zwosrlak",objOut:"3mkzgvrrp"},{portIn:"value",portOut:"result",objIn:"bsy5kiw9l",objOut:"3mkzgvrrp"},{portIn:"Value",portOut:"result",objIn:"vnoskfym4",objOut:"3mkzgvrrp"},{portIn:"number1",portOut:"result",objIn:"e5y60ubmx",objOut:"3mkzgvrrp"}]}],objName:"Ops.Math.MapRange"},{id:"1k1017fjn",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"number1",portOut:"result",objIn:"anrg0xmae",objOut:"1k1017fjn"}]}],objName:"Ops.Math.Sum"},{id:"anrg0xmae",uiAttribs:{},portsIn:[{name:"pingpong",value:0}],portsOut:[{name:"result",links:[{portIn:"value",portOut:"result",objIn:"ocqhy1dd3",objOut:"anrg0xmae"}]}],objName:"Ops.Math.Modulo"},{id:"2zwosrlak",uiAttribs:{},portsIn:[{name:"old min",value:0},{name:"old max",value:1},{name:"new min",value:0},{name:"new max",value:.6},{name:"Easing index",value:0},{name:"Easing",value:"Linear"},{name:"Clamp",value:1}],portsOut:[{name:"result",links:[{portIn:"scale",portOut:"result",objIn:"s76fguzm4",objOut:"2zwosrlak"}]}],objName:"Ops.Math.MapRange"},{id:"bsy5kiw9l",uiAttribs:{},portsIn:[{name:"old min",value:0},{name:"old max",value:1},{name:"new min",value:.4},{name:"new max",value:0},{name:"Easing index",value:0},{name:"Easing",value:"Linear"},{name:"Clamp",value:1}],portsOut:[{name:"result",links:[{portIn:"a",portOut:"result",objIn:"3dyg1xjf0",objOut:"bsy5kiw9l"}]}],objName:"Ops.Math.MapRange"},{id:"ecpapd3of",uiAttribs:{},portsOut:[{name:"trigger 0",links:[{portIn:"render",portOut:"trigger 0",objIn:"3dyg1xjf0",objOut:"ecpapd3of"}]},{name:"trigger 2",links:[{portIn:"render",portOut:"trigger 2",objIn:"vzgp3e3yq",objOut:"ecpapd3of"}]},{name:"trigger 4",links:[{portIn:"render",portOut:"trigger 4",objIn:"9hcy509sb",objOut:"ecpapd3of"}]}],objName:"Ops.Extension.Deprecated.Sequence"},{id:"gkhqk6ek5",uiAttribs:{},portsIn:[{name:"x",value:0},{name:"y",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"ud56xwzgq",objOut:"gkhqk6ek5"}]}],objName:"Ops.Gl.Matrix.Translate"},{id:"udb0gwldk",uiAttribs:{},portsIn:[{name:"old min",value:0},{name:"old max",value:1},{name:"new min",value:.02},{name:"new max",value:2},{name:"Easing index",value:0},{name:"Easing",value:"Linear"},{name:"Clamp",value:1}],portsOut:[{name:"result",links:[{portIn:"z",portOut:"result",objIn:"gkhqk6ek5",objOut:"udb0gwldk"},{portIn:"number1",portOut:"result",objIn:"ddy0cvvji",objOut:"udb0gwldk"}]}],objName:"Ops.Math.MapRange"},{id:"vnoskfym4",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"value",portOut:"Result",objIn:"udb0gwldk",objOut:"vnoskfym4"}]}],objName:"Ops.Math.OneMinus"},{id:"vzgp3e3yq",uiAttribs:{},portsIn:[{name:"r",value:1},{name:"g",value:1},{name:"b",value:1},{name:"a",value:1},{name:"colorizeTexture",value:0},{name:"billboard",value:0},{name:"Opacity TexCoords Transform",value:0},{name:"preMultiplied alpha",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"gkhqk6ek5",objOut:"vzgp3e3yq"}]}],objName:"Ops.Gl.Shader.BasicMaterial"},{id:"g149a3h1v",uiAttribs:{},portsIn:[{name:"x",value:0},{name:"y",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"v10ltnhoa",objOut:"g149a3h1v"}]}],objName:"Ops.Gl.Matrix.Translate"},{id:"9hcy509sb",uiAttribs:{},portsIn:[{name:"r",value:.251},{name:"g",value:.059},{name:"b",value:.224},{name:"a",value:.202},{name:"colorizeTexture",value:0},{name:"billboard",value:0},{name:"Opacity TexCoords Transform",value:0},{name:"preMultiplied alpha",value:0},{name:"diffuseRepeatX",value:1},{name:"diffuseRepeatY",value:1},{name:"Tex Offset X",value:0},{name:"Tex Offset Y",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"g149a3h1v",objOut:"9hcy509sb"}]}],objName:"Ops.Gl.Shader.BasicMaterial"},{id:"ddy0cvvji",uiAttribs:{},portsIn:[{name:"number2",value:-1}],portsOut:[{name:"result",links:[{portIn:"z",portOut:"result",objIn:"g149a3h1v",objOut:"ddy0cvvji"}]}],objName:"Ops.Math.Multiply"},{id:"y50av29nl",uiAttribs:{},portsIn:[{name:"value",value:.06}],portsOut:[{name:"result",links:[{portIn:"number1",portOut:"result",objIn:"o4i0be7ri",objOut:"y50av29nl"},{portIn:"z",portOut:"result",objIn:"v10ltnhoa",objOut:"y50av29nl"}]}],objName:"Ops.Number.Number"},{id:"o4i0be7ri",uiAttribs:{},portsIn:[{name:"number2",value:-1}],portsOut:[{name:"result",links:[{portIn:"z",portOut:"result",objIn:"ud56xwzgq",objOut:"o4i0be7ri"}]}],objName:"Ops.Math.Multiply"},{id:"qo3hggvtj",uiAttribs:{},portsIn:[{name:"slices",value:4},{name:"stacks",value:2},{name:"radius",value:1},{name:"height",value:2},{name:"Start Slice",value:0}],objName:"Ops.Extension.Deprecated.Cylinder"},{id:"7a5dr5ucy",uiAttribs:{},portsIn:[{name:"slices",value:4},{name:"stacks",value:2},{name:"radius",value:1},{name:"height",value:2},{name:"Start Slice",value:0}],objName:"Ops.Extension.Deprecated.Cylinder"},{id:"8s4s8kh5m",uiAttribs:{},portsIn:[{name:"value",value:.008}],portsOut:[{name:"result",links:[{portIn:"x",portOut:"result",objIn:"ud56xwzgq",objOut:"8s4s8kh5m"},{portIn:"y",portOut:"result",objIn:"ud56xwzgq",objOut:"8s4s8kh5m"},{portIn:"x",portOut:"result",objIn:"v10ltnhoa",objOut:"8s4s8kh5m"},{portIn:"y",portOut:"result",objIn:"v10ltnhoa",objOut:"8s4s8kh5m"}]}],objName:"Ops.Number.Number"},{id:"azti8eq5p",uiAttribs:{},portsIn:[{name:"title",value:" copycat"},{name:"text",value:"original: https://twitter.com/archillect/status/964887190311460871"}],objName:"Ops.Ui.Comment"},{id:"e5y60ubmx",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"ktz2yixhu",objOut:"e5y60ubmx"}]}],objName:"Ops.Math.Compare.LessThan"},{id:"70v01aa7v",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"number1",portOut:"result",objIn:"1k1017fjn",objOut:"70v01aa7v"}]}],objName:"Ops.Math.Multiply"},{id:"egykcc0n4",uiAttribs:{},portsIn:[{name:"start",value:1},{name:"end",value:19.17},{name:"duration",value:30},{name:"loop",value:1},{name:"Wait for Reset",value:1},{name:"easing index",value:0},{name:"easing",value:"linear"}],portsOut:[{name:"result",links:[{portIn:"number2",portOut:"result",objIn:"70v01aa7v",objOut:"egykcc0n4"}]},{name:"finished",value:false}],objName:"Ops.Anim.SimpleAnim"},{id:"ocqhy1dd3",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"value",portOut:"result",objIn:"3mkzgvrrp",objOut:"ocqhy1dd3"}]}],objName:"Ops.Extension.Deprecated.ValueTrigger"},{id:"7hr0p8b94",uiAttribs:{},portsOut:[{name:"Trigger",links:[{portIn:"exe",portOut:"Trigger",objIn:"ocqhy1dd3",objOut:"7hr0p8b94"}]}],objName:"Ops.Extension.Deprecated.ValueChanged"},{id:"ud56xwzgq",uiAttribs:{},portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"qo3hggvtj",objOut:"ud56xwzgq"}]}],objName:"Ops.Extension.Deprecated.ScaleXYZ"},{id:"v10ltnhoa",uiAttribs:{},portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"7a5dr5ucy",objOut:"v10ltnhoa"}]}],objName:"Ops.Extension.Deprecated.ScaleXYZ"},{id:"s76fguzm4",uiAttribs:{},portsIn:[{name:"x",value:1.5},{name:"y",value:1.5},{name:"z",value:1}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"nx6j3eypg",objOut:"s76fguzm4"}]}],objName:"Ops.Gl.Matrix.Scale"},{id:"ktz2yixhu",uiAttribs:{},portsOut:[{name:"Became Zero Trigger",links:[{portIn:"Set Value",portOut:"Became Zero Trigger",objIn:"fhmvy959q",objOut:"ktz2yixhu"}]}],objName:"Ops.Trigger.ValueBecameZeroTrigger"},{id:"fhmvy959q",uiAttribs:{},portsOut:[{name:"Out Value",links:[{portIn:"Value",portOut:"Out Value",objIn:"meggi0nbh",objOut:"fhmvy959q"}]}],objName:"Ops.Extension.Deprecated.SetValueOnTrigger"},{id:"meggi0nbh",uiAttribs:{},objName:"Ops.Extension.Deprecated.ValueChanged"},{id:"ucpo2vjb9",uiAttribs:{},portsIn:[{name:"value",value:.1}],portsOut:[{name:"result",links:[{portIn:"number2",portOut:"result",objIn:"e5y60ubmx",objOut:"ucpo2vjb9"}]}],objName:"Ops.Number.Number"},{id:"4g0dcy2sk",uiAttribs:{},portsIn:[{name:"posX",value:-.15},{name:"posY",value:-.2},{name:"posZ",value:.47},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"exe",portOut:"trigger",objIn:"qkl97sd94",objOut:"4g0dcy2sk"}]}],objName:"Ops.Graphics.Transform"},{id:"798i1wrgc",uiAttribs:{},portsIn:[{name:"value",value:-.05},{name:"old min",value:-1},{name:"old max",value:1},{name:"Easing index",value:0},{name:"Easing",value:"Linear"},{name:"Clamp",value:1}],portsOut:[{name:"result",links:[{portIn:"number1",portOut:"result",objIn:"39q6xjwht",objOut:"798i1wrgc"}]}],objName:"Ops.Math.MapRange"},{id:"39q6xjwht",uiAttribs:{},portsIn:[{name:"number2",value:-1}],portsOut:[{name:"result",links:[{portIn:"rotX",portOut:"result",objIn:"4g0dcy2sk",objOut:"39q6xjwht"}]}],objName:"Ops.Math.Multiply"},{id:"7a1nuwh9r",uiAttribs:{},portsOut:[{name:"Is Mobile",links:[{portIn:"Use Value 1",portOut:"Is Mobile",objIn:"ymchzhhnn",objOut:"7a1nuwh9r"}]},{name:"Is IE",value:0},{name:"Is IE 10+",value:0},{name:"Is IE 11",value:0},{name:"Is Edge",value:0},{name:"Is Chrome",value:true},{name:"Is Firefox",value:false},{name:"Is Safari",value:0},{name:"Is Windows",value:0},{name:"Is Linux",value:0},{name:"Is Mac",value:true},{name:"Is iOS",value:0},{name:"Is Android",value:0},{name:"Language",value:"de-DE"}],objName:"Ops.Devices.Browser.BrowserInfo"},{id:"ymchzhhnn",uiAttribs:{},portsOut:[{name:"Out Value",links:[{portIn:"scale",portOut:"Out Value",objIn:"4g0dcy2sk",objOut:"ymchzhhnn"}]}],objName:"Ops.Boolean.BoolToNumber_v2"},{id:"8qbf8rd6j",uiAttribs:{},portsIn:[{name:"value",value:.7}],portsOut:[{name:"result",links:[{portIn:"Value 1",portOut:"result",objIn:"ymchzhhnn",objOut:"8qbf8rd6j"}]}],objName:"Ops.Number.Number"},{id:"dkftap0tf",uiAttribs:{},portsIn:[{name:"value",value:1}],portsOut:[{name:"result",links:[{portIn:"Value 0",portOut:"result",objIn:"ymchzhhnn",objOut:"dkftap0tf"}]}],objName:"Ops.Number.Number"},{id:"w23qqg3lp",uiAttribs:{},portsIn:[{name:"number2",value:2}],portsOut:[{name:"result",links:[{portIn:"new min",portOut:"result",objIn:"cc15zkke5",objOut:"w23qqg3lp"}]}],objName:"Ops.Math.Multiply"},{id:"4cescpiw5",uiAttribs:{},portsIn:[{name:"number2",value:2}],portsOut:[{name:"result",links:[{portIn:"new max",portOut:"result",objIn:"cc15zkke5",objOut:"4cescpiw5"}]}],objName:"Ops.Math.Multiply"},{id:"cc15zkke5",uiAttribs:{},portsIn:[{name:"value",value:0},{name:"old min",value:10},{name:"old max",value:60},{name:"Easing index",value:0},{name:"Easing",value:"Linear"},{name:"Clamp",value:1}],portsOut:[{name:"result",links:[{portIn:"rotX",portOut:"result",objIn:"4g0dcy2sk",objOut:"cc15zkke5"}]}],objName:"Ops.Math.MapRange"},{id:"aifeymtbc",uiAttribs:{},portsIn:[{name:"value",value:0},{name:"old min",value:-30},{name:"old max",value:30},{name:"Easing index",value:0},{name:"Easing",value:"Linear"},{name:"Clamp",value:1}],portsOut:[{name:"result",links:[{portIn:"rotY",portOut:"result",objIn:"4g0dcy2sk",objOut:"aifeymtbc"}]}],objName:"Ops.Math.MapRange"},{id:"nxshgtlo3",uiAttribs:{},portsIn:[{name:"value",value:1e3}],portsOut:[{name:"result",links:[{portIn:"number1",portOut:"result",objIn:"w23qqg3lp",objOut:"nxshgtlo3"},{portIn:"new max",portOut:"result",objIn:"798i1wrgc",objOut:"nxshgtlo3"},{portIn:"number1",portOut:"result",objIn:"ya1py3lxz",objOut:"nxshgtlo3"}]}],objName:"Ops.Number.Number"},{id:"ya1py3lxz",uiAttribs:{},portsIn:[{name:"number2",value:-1}],portsOut:[{name:"result",links:[{portIn:"number1",portOut:"result",objIn:"4cescpiw5",objOut:"ya1py3lxz"},{portIn:"new min",portOut:"result",objIn:"798i1wrgc",objOut:"ya1py3lxz"}]}],objName:"Ops.Math.Multiply"},{id:"h0q8o3067",uiAttribs:{},portsIn:[{name:"number2",value:-1}],portsOut:[{name:"result",links:[{portIn:"new max",portOut:"result",objIn:"aifeymtbc",objOut:"h0q8o3067"},{portIn:"new min",portOut:"result",objIn:"ccuy1a4mv",objOut:"h0q8o3067"}]}],objName:"Ops.Math.Multiply"},{id:"ygpjohsja",uiAttribs:{},portsIn:[{name:"value",value:0}],portsOut:[{name:"result",links:[{portIn:"new min",portOut:"result",objIn:"aifeymtbc",objOut:"ygpjohsja"},{portIn:"number1",portOut:"result",objIn:"h0q8o3067",objOut:"ygpjohsja"},{portIn:"new max",portOut:"result",objIn:"ccuy1a4mv",objOut:"ygpjohsja"}]}],objName:"Ops.Number.Number"},{id:"ccuy1a4mv",uiAttribs:{},portsIn:[{name:"value",value:-8.75},{name:"old min",value:-1},{name:"old max",value:1},{name:"Easing index",value:0},{name:"Easing",value:"Linear"},{name:"Clamp",value:1}],portsOut:[{name:"result",links:[{portIn:"rotY",portOut:"result",objIn:"4g0dcy2sk",objOut:"ccuy1a4mv"}]}],objName:"Ops.Math.MapRange"},{id:"jtyii9je8",uiAttribs:{},portsOut:[{name:"Trigger out",links:[{portIn:"render",portOut:"Trigger out",objIn:"www581ftl",objOut:"jtyii9je8"}]}],objName:"Ops.Trigger.GateTrigger"},{id:"j997it0sj",uiAttribs:{},portsIn:[{name:"Title",value:"Random spline"}],objName:"Ops.Ui.Area"},{id:"pr7zsukq4",uiAttribs:{},portsIn:[{name:"Index",value:0}],portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"wanq0975i",objOut:"pr7zsukq4"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"wanq0975i",objOut:"pr7zsukq4"}]},{name:"Z",value:0}],objName:"Ops.Array.Array3GetNumbers"},{id:"wanq0975i",uiAttribs:{},portsIn:[{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"Execute",portOut:"trigger",objIn:"jtyii9je8",objOut:"wanq0975i"},{portIn:"render",portOut:"trigger",objIn:"1rl13w99c",objOut:"wanq0975i"}]}],objName:"Ops.Graphics.Transform"},{id:"dns00lxd8",uiAttribs:{},portsIn:[{name:"Maximum",value:1}],portsOut:[{name:"result",links:[{portIn:"Max C",portOut:"result",objIn:"as5hfpfxc",objOut:"dns00lxd8"}]}],objName:"Ops.Math.Max"},{id:"9yed7uy6r",uiAttribs:{},portsIn:[{name:"Maximum",value:.6}],portsOut:[{name:"result",links:[{portIn:"Min C",portOut:"result",objIn:"as5hfpfxc",objOut:"9yed7uy6r"}]}],objName:"Ops.Math.Max"},{id:"zjf4lpr7g",uiAttribs:{},portsIn:[{name:"title",value:"Lerping"},{name:"text",value:""}],objName:"Ops.Ui.Comment_v2"},{id:"2tz9mannt",uiAttribs:{},portsIn:[{name:"title",value:"Point creation"},{name:"text",value:""}],objName:"Ops.Ui.Comment_v2"},{id:"ula77xu07",uiAttribs:{},portsIn:[{name:"Variable",value:"points angle"}],portsOut:[{name:"Value",links:[{portIn:"rotZ",portOut:"Value",objIn:"i9g4taloa",objOut:"ula77xu07"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"2051f21ds",uiAttribs:{},portsIn:[{name:"Variable",value:"points angle"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"vj57wzxkc",uiAttribs:{},portsIn:[{name:"Variable",value:"points distance"}],portsOut:[{name:"Value",links:[{portIn:"number1",portOut:"Value",objIn:"h8kxxengs",objOut:"vj57wzxkc"},{portIn:"number1",portOut:"Value",objIn:"cz2uj0ekq",objOut:"vj57wzxkc"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"7o3zyuntt",uiAttribs:{},portsIn:[{name:"Variable",value:"points distance"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"vjdipbvkw",uiAttribs:{},portsIn:[{name:"title",value:"Var"},{name:"text",value:""}],objName:"Ops.Ui.Comment_v2"},{id:"05rwi97js",uiAttribs:{},portsIn:[{name:"Variable",value:"lerp driver"}],portsOut:[{name:"Value",links:[{portIn:"perc",portOut:"Value",objIn:"axuprhoey",objOut:"05rwi97js"},{portIn:"perc",portOut:"Value",objIn:"9fg1rarcs",objOut:"05rwi97js"},{portIn:"perc",portOut:"Value",objIn:"ra4xdnyet",objOut:"05rwi97js"},{portIn:"perc",portOut:"Value",objIn:"d2h0bx7hk",objOut:"05rwi97js"},{portIn:"perc",portOut:"Value",objIn:"bfeby31lg",objOut:"05rwi97js"},{portIn:"perc",portOut:"Value",objIn:"x6hmk9do9",objOut:"05rwi97js"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"lbfxxhlcl",uiAttribs:{},portsIn:[{name:"Variable",value:"lerp driver"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"rrfs7ab7s",uiAttribs:{},portsIn:[{name:"number2",value:1e11}],portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"fk7rh4x9w",objOut:"rrfs7ab7s"}]}],objName:"Ops.Math.Multiply"},{id:"zmix6s0yf",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"number1",portOut:"result",objIn:"rrfs7ab7s",objOut:"zmix6s0yf"}]}],objName:"Ops.Math.Subtract"},{id:"96p95s8he",uiAttribs:{},portsOut:[{name:"Current Value",links:[{portIn:"number1",portOut:"Current Value",objIn:"zmix6s0yf",objOut:"96p95s8he"}]},{name:"Previous Value",links:[{portIn:"number2",portOut:"Previous Value",objIn:"zmix6s0yf",objOut:"96p95s8he"}]}],objName:"Ops.Number.PreviousNumberStore"},{id:"uc8plwxhr",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"96p95s8he",objOut:"uc8plwxhr"}]}],objName:"Ops.Math.Sqrt"},{id:"9sh50wqsv",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"Radius",portOut:"result",objIn:"k6rnodpyh",objOut:"9sh50wqsv"},{portIn:"Radius",portOut:"result",objIn:"jl5lzxbsr",objOut:"9sh50wqsv"}]}],objName:"Ops.Ui.Routing.RouteNumber"},{id:"ok930woak",uiAttribs:{},portsIn:[{name:"Index",value:0}],portsOut:[{name:"X",value:-.0700169535034929},{name:"Y",value:-.4872942386831276},{name:"Z",links:[{portIn:"X",portOut:"Z",objIn:"9xf8fqfnj",objOut:"ok930woak"},{portIn:"posX",portOut:"Z",objIn:"i9g4taloa",objOut:"ok930woak"}]},{name:"W",links:[{portIn:"Y",portOut:"W",objIn:"9xf8fqfnj",objOut:"ok930woak"},{portIn:"posY",portOut:"W",objIn:"i9g4taloa",objOut:"ok930woak"}]}],objName:"Ops.Array.Array4GetNumbers"},{id:"wwnsl9yoy",uiAttribs:{},portsIn:[{name:"Variable",value:"seed"}],portsOut:[{name:"Value",links:[{portIn:"Value",portOut:"Value",objIn:"whqu3gdyu",objOut:"wwnsl9yoy"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"7jb9avobv",uiAttribs:{},portsIn:[{name:"Variable",value:"seed"}],portsOut:[{name:"Value",links:[{portIn:"number1",portOut:"Value",objIn:"c414gf6ac",objOut:"7jb9avobv"},{portIn:"Random Seed ",portOut:"Value",objIn:"efg3c9jp4",objOut:"7jb9avobv"}]}],objName:"Ops.Vars.VarGetNumber_v2"},{id:"fk7rh4x9w",uiAttribs:{},portsIn:[{name:"Variable",value:"seed"}],objName:"Ops.Vars.VarSetNumber_v2"},{id:"t0tyml248",uiAttribs:{},portsIn:[{name:"Index",value:0}],portsOut:[{name:"X",value:-.009469307270233207},{name:"Y",links:[{portIn:"number1",portOut:"Y",objIn:"4ozemb117",objOut:"t0tyml248"}]},{name:"Z",links:[{portIn:"value",portOut:"Z",objIn:"9sh50wqsv",objOut:"t0tyml248"}]},{name:"W",links:[{portIn:"Value",portOut:"W",objIn:"k9a59zo7t",objOut:"t0tyml248"}]}],objName:"Ops.Array.Array4GetNumbers"},{id:"c414gf6ac",uiAttribs:{},portsIn:[{name:"number2",value:.5}],portsOut:[{name:"result",links:[{portIn:"Random Seed ",portOut:"result",objIn:"as5hfpfxc",objOut:"c414gf6ac"}]}],objName:"Ops.Math.Sum"},{id:"as5hfpfxc",uiAttribs:{},portsIn:[{name:"Num Values",value:1},{name:"Mode index",value:3},{name:"Mode",value:"ABCD"},{name:"Integer",value:0},{name:"Last == First",value:0},{name:"Min A",value:-1},{name:"Max A",value:1},{name:"Min B",value:.1},{name:"Max B",value:.2},{name:"Min D",value:-1},{name:"Max D",value:1}],portsOut:[{name:"Array Out",links:[{portIn:"Array",portOut:"Array Out",objIn:"t0tyml248",objOut:"as5hfpfxc"}]},{name:"Chunks Amount",value:1},{name:"Array length",value:4}],objName:"Ops.Array.RandomNumbersArray_v4"},{id:"efg3c9jp4",uiAttribs:{},portsIn:[{name:"Num Values",value:1},{name:"Mode index",value:3},{name:"Mode",value:"ABCD"},{name:"Integer",value:0},{name:"Last == First",value:0},{name:"Min B",value:-1},{name:"Max B",value:1},{name:"Min D",value:-1},{name:"Max D",value:1}],portsOut:[{name:"Array Out",links:[{portIn:"Array",portOut:"Array Out",objIn:"ok930woak",objOut:"efg3c9jp4"}]},{name:"Chunks Amount",value:1},{name:"Array length",value:4}],objName:"Ops.Array.RandomNumbersArray_v4"},{id:"h8kxxengs",uiAttribs:{},portsIn:[{name:"number2",value:.25}],portsOut:[{name:"result",links:[{portIn:"value",portOut:"result",objIn:"9yed7uy6r",objOut:"h8kxxengs"}]}],objName:"Ops.Math.Multiply"},{id:"cz2uj0ekq",uiAttribs:{},portsIn:[{name:"number2",value:.8}],portsOut:[{name:"result",links:[{portIn:"value",portOut:"result",objIn:"dns00lxd8",objOut:"cz2uj0ekq"}]}],objName:"Ops.Math.Multiply"},{id:"4ozemb117",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"Position",portOut:"result",objIn:"k6rnodpyh",objOut:"4ozemb117"},{portIn:"number1",portOut:"result",objIn:"42asld1v3",objOut:"4ozemb117"}]}],objName:"Ops.Math.Multiply"},{id:"k9a59zo7t",uiAttribs:{},portsIn:[{name:"Remove zero",value:0}],portsOut:[{name:"Result",links:[{portIn:"number2",portOut:"Result",objIn:"4ozemb117",objOut:"k9a59zo7t"}]}],objName:"Ops.Math.Sign"},{id:"qxoa3wbiz",uiAttribs:{},portsIn:[{name:"Expression",value:"atan2(d-b,c-a)*(180/PI)+90"}],portsOut:[{name:"Result",links:[{portIn:"Value",portOut:"Result",objIn:"2051f21ds",objOut:"qxoa3wbiz"}]},{name:"Expression Valid",value:true}],objName:"Ops.Math.MathExpression"},{id:"hhsoe9mfj",uiAttribs:{},portsOut:[{name:"distance",links:[{portIn:"Value",portOut:"distance",objIn:"7o3zyuntt",objOut:"hhsoe9mfj"}]}],objName:"Ops.Math.Distance2d"},{id:"agh7d0qs6",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"Min A",portOut:"Result",objIn:"efg3c9jp4",objOut:"agh7d0qs6"},{portIn:"Min C",portOut:"Result",objIn:"efg3c9jp4",objOut:"agh7d0qs6"}]}],objName:"Ops.Math.FlipSign"},{id:"6ru9nhrb1",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"agh7d0qs6",objOut:"6ru9nhrb1"},{portIn:"Max C",portOut:"result",objIn:"efg3c9jp4",objOut:"6ru9nhrb1"},{portIn:"Max A",portOut:"result",objIn:"efg3c9jp4",objOut:"6ru9nhrb1"}]}],objName:"Ops.Math.Divide"},{id:"8rgslr8js",uiAttribs:{},portsOut:[{name:"X",value:0},{name:"Y",value:0},{name:"Width",links:[{portIn:"number1",portOut:"Width",objIn:"6ru9nhrb1",objOut:"8rgslr8js"}]},{name:"Height",links:[{portIn:"number2",portOut:"Height",objIn:"6ru9nhrb1",objOut:"8rgslr8js"}]}],objName:"Ops.Gl.ViewPortSize"},{id:"2ajwhnqpz",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"9fg1rarcs",objOut:"2ajwhnqpz"},{portIn:"Array 1",portOut:"Array",objIn:"bfeby31lg",objOut:"2ajwhnqpz"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"axuprhoey",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"Array 1",portOut:"Result",objIn:"ra4xdnyet",objOut:"axuprhoey"}]}],objName:"Ops.Array.InterpolateArrays"},{id:"a4gfoi11r",uiAttribs:{},portsIn:[{name:"Index",value:2}],portsOut:[{name:"X",links:[{portIn:"X",portOut:"X",objIn:"2ajwhnqpz",objOut:"a4gfoi11r"}]},{name:"Y",links:[{portIn:"Y",portOut:"Y",objIn:"2ajwhnqpz",objOut:"a4gfoi11r"}]},{name:"Z",value:0}],objName:"Ops.Array.Array3GetNumbers"},{id:"9fg1rarcs",uiAttribs:{},portsOut:[{name:"Result",links:[{portIn:"Array 2",portOut:"Result",objIn:"axuprhoey",objOut:"9fg1rarcs"},{portIn:"Array 1",portOut:"Result",objIn:"d2h0bx7hk",objOut:"9fg1rarcs"}]}],objName:"Ops.Array.InterpolateArrays"},{id:"qic3aokxy",uiAttribs:{},portsIn:[{name:"Index",value:0}],portsOut:[{name:"X",links:[{portIn:"C",portOut:"X",objIn:"qxoa3wbiz",objOut:"qic3aokxy"},{portIn:"x2",portOut:"X",objIn:"hhsoe9mfj",objOut:"qic3aokxy"},{portIn:"X",portOut:"X",objIn:"5v5971msn",objOut:"qic3aokxy"}]},{name:"Y",links:[{portIn:"D",portOut:"Y",objIn:"qxoa3wbiz",objOut:"qic3aokxy"},{portIn:"y2",portOut:"Y",objIn:"hhsoe9mfj",objOut:"qic3aokxy"},{portIn:"Y",portOut:"Y",objIn:"5v5971msn",objOut:"qic3aokxy"}]},{name:"Z",value:0}],objName:"Ops.Array.Array3GetNumbers"},{id:"3hrxiu3s1",uiAttribs:{},portsIn:[{name:"Step",value:0}],portsOut:[{name:"Trigger",links:[{portIn:"exec",portOut:"Trigger",objIn:"lx8d9zc0w",objOut:"3hrxiu3s1"}]},{name:"Index",value:2},{name:"Value 1",links:[{portIn:"Value X",portOut:"Value 1",objIn:"lx8d9zc0w",objOut:"3hrxiu3s1"}]},{name:"Value 2",links:[{portIn:"Value Y",portOut:"Value 2",objIn:"lx8d9zc0w",objOut:"3hrxiu3s1"}]},{name:"Value 3",value:0}],objName:"Ops.Array.Array3Iterator"},{id:"710u35jub",uiAttribs:{},portsIn:[{name:"Z",value:0},{name:"W",value:1},{name:"Num index",value:2},{name:"Num",value:"3"}],objName:"Ops.Data.Compose.Array.CompArrayPushNumbers"},{id:"tr4ylnp13",uiAttribs:{},portsIn:[{name:"Z",value:0},{name:"W",value:1},{name:"Num index",value:2},{name:"Num",value:"3"}],portsOut:[{name:"Next",links:[{portIn:"Update",portOut:"Next",objIn:"710u35jub",objOut:"tr4ylnp13"}]}],objName:"Ops.Data.Compose.Array.CompArrayPushNumbers"},{id:"9xf8fqfnj",uiAttribs:{},portsIn:[{name:"Z",value:0},{name:"W",value:1},{name:"Num index",value:2},{name:"Num",value:"3"}],portsOut:[{name:"Next",links:[{portIn:"Update",portOut:"Next",objIn:"tr4ylnp13",objOut:"9xf8fqfnj"}]}],objName:"Ops.Data.Compose.Array.CompArrayPushNumbers"},{id:"whqu3gdyu",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Execute",portOut:"Next",objIn:"3hrxiu3s1",objOut:"whqu3gdyu"}]},{name:"Number",value:14747682478.235458}],objName:"Ops.Number.TriggerOnChangeNumber"},{id:"adsn8qjm8",uiAttribs:{},portsIn:[{name:"Index",value:1}],portsOut:[{name:"X",links:[{portIn:"X",portOut:"X",objIn:"dkb5w08kx",objOut:"adsn8qjm8"}]},{name:"Y",links:[{portIn:"Y",portOut:"Y",objIn:"dkb5w08kx",objOut:"adsn8qjm8"}]},{name:"Z",value:0}],objName:"Ops.Array.Array3GetNumbers"},{id:"kvll1b4ww",uiAttribs:{},portsIn:[{name:"Index",value:0}],portsOut:[{name:"X",links:[{portIn:"A",portOut:"X",objIn:"qxoa3wbiz",objOut:"kvll1b4ww"},{portIn:"x1",portOut:"X",objIn:"hhsoe9mfj",objOut:"kvll1b4ww"},{portIn:"X",portOut:"X",objIn:"0ltozziv7",objOut:"kvll1b4ww"}]},{name:"Y",links:[{portIn:"B",portOut:"Y",objIn:"qxoa3wbiz",objOut:"kvll1b4ww"},{portIn:"y1",portOut:"Y",objIn:"hhsoe9mfj",objOut:"kvll1b4ww"},{portIn:"Y",portOut:"Y",objIn:"0ltozziv7",objOut:"kvll1b4ww"}]},{name:"Z",value:0}],objName:"Ops.Array.Array3GetNumbers"},{id:"lx8d9zc0w",uiAttribs:{},portsIn:[{name:"Max Num Elements",value:3},{name:"Value Z",value:0}],portsOut:[{name:"Result",links:[{portIn:"Array",portOut:"Result",objIn:"adsn8qjm8",objOut:"lx8d9zc0w"},{portIn:"Array",portOut:"Result",objIn:"kvll1b4ww",objOut:"lx8d9zc0w"}]},{name:"Array length",value:9}],objName:"Ops.Array.ArrayBuffer3"},{id:"1yizzms4g",uiAttribs:{},portsOut:[{name:"X",links:[{portIn:"X",portOut:"X",objIn:"710u35jub",objOut:"1yizzms4g"}]},{name:"Y",links:[{portIn:"Y",portOut:"Y",objIn:"710u35jub",objOut:"1yizzms4g"}]},{name:"Z",value:0}],objName:"Ops.Gl.Matrix.Coordinates"},{id:"qm1ulyqot",uiAttribs:{},portsIn:[{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"1yizzms4g",objOut:"qm1ulyqot"}]}],objName:"Ops.Graphics.Transform"},{id:"sqa1pjg97",uiAttribs:{},portsOut:[{name:"X",links:[{portIn:"X",portOut:"X",objIn:"tr4ylnp13",objOut:"sqa1pjg97"}]},{name:"Y",links:[{portIn:"Y",portOut:"Y",objIn:"tr4ylnp13",objOut:"sqa1pjg97"}]},{name:"Z",value:0}],objName:"Ops.Gl.Matrix.Coordinates"},{id:"k6rnodpyh",uiAttribs:{},portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"qm1ulyqot",objOut:"k6rnodpyh"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"qm1ulyqot",objOut:"k6rnodpyh"}]}],objName:"Ops.Math.CircleCoordinates"},{id:"42asld1v3",uiAttribs:{},portsIn:[{name:"number2",value:.5}],portsOut:[{name:"result",links:[{portIn:"Position",portOut:"result",objIn:"jl5lzxbsr",objOut:"42asld1v3"}]}],objName:"Ops.Math.Sum"},{id:"4nge7hzgx",uiAttribs:{},portsIn:[{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0},{name:"rotZ",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"sqa1pjg97",objOut:"4nge7hzgx"}]}],objName:"Ops.Graphics.Transform"},{id:"jl5lzxbsr",uiAttribs:{},portsOut:[{name:"X",links:[{portIn:"posX",portOut:"X",objIn:"4nge7hzgx",objOut:"jl5lzxbsr"}]},{name:"Y",links:[{portIn:"posY",portOut:"Y",objIn:"4nge7hzgx",objOut:"jl5lzxbsr"}]}],objName:"Ops.Math.CircleCoordinates"},{id:"i9g4taloa",uiAttribs:{},portsIn:[{name:"posZ",value:0},{name:"scale",value:1},{name:"rotX",value:0},{name:"rotY",value:0}],portsOut:[{name:"trigger",links:[{portIn:"render",portOut:"trigger",objIn:"qm1ulyqot",objOut:"i9g4taloa"},{portIn:"render",portOut:"trigger",objIn:"4nge7hzgx",objOut:"i9g4taloa"}]}],objName:"Ops.Graphics.Transform"},{id:"a7mxhhjvc",uiAttribs:{},portsIn:[{name:"Active",value:1},{name:"Clear",value:1}],portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"i9g4taloa",objOut:"a7mxhhjvc"},{portIn:"Update",portOut:"Next",objIn:"9xf8fqfnj",objOut:"a7mxhhjvc"}]},{name:"Result",links:[{portIn:"Array",portOut:"Result",objIn:"a4gfoi11r",objOut:"a7mxhhjvc"},{portIn:"Array",portOut:"Result",objIn:"qic3aokxy",objOut:"a7mxhhjvc"},{portIn:"Array",portOut:"Result",objIn:"3hrxiu3s1",objOut:"a7mxhhjvc"}]}],objName:"Ops.Data.Compose.Array.CompArray"},{id:"si8mowdta",uiAttribs:{},portsIn:[{name:"Decimal Places",value:0}],portsOut:[{name:"result",links:[{portIn:"number",portOut:"result",objIn:"uc8plwxhr",objOut:"si8mowdta"},{portIn:"number1",portOut:"result",objIn:"t4wh6y50u",objOut:"si8mowdta"}]}],objName:"Ops.Math.Round"},{id:"0dhv1sl1p",uiAttribs:{},portsIn:[{name:"Speed",value:.5},{name:"Play",value:1},{name:"Sync to timeline",value:0}],portsOut:[{name:"Time",links:[{portIn:"number",portOut:"Time",objIn:"si8mowdta",objOut:"0dhv1sl1p"},{portIn:"number1",portOut:"Time",objIn:"kpjp0vnim",objOut:"0dhv1sl1p"}]}],objName:"Ops.Anim.Timer_v2"},{id:"ra4xdnyet",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"render",portOut:"Next",objIn:"wanq0975i",objOut:"ra4xdnyet"}]},{name:"Result",links:[{portIn:"Array",portOut:"Result",objIn:"pr7zsukq4",objOut:"ra4xdnyet"}]}],objName:"Ops.Array.InterpolateArrays"},{id:"d2h0bx7hk",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Exe",portOut:"Next",objIn:"ra4xdnyet",objOut:"d2h0bx7hk"}]},{name:"Result",links:[{portIn:"Array 2",portOut:"Result",objIn:"ra4xdnyet",objOut:"d2h0bx7hk"}]}],objName:"Ops.Array.InterpolateArrays"},{id:"bfeby31lg",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Exe",portOut:"Next",objIn:"d2h0bx7hk",objOut:"bfeby31lg"}]},{name:"Result",links:[{portIn:"Array 2",portOut:"Result",objIn:"d2h0bx7hk",objOut:"bfeby31lg"}]}],objName:"Ops.Array.InterpolateArrays"},{id:"5v5971msn",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 2",portOut:"Array",objIn:"bfeby31lg",objOut:"5v5971msn"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"i02nhhulh",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Exe",portOut:"Next",objIn:"9fg1rarcs",objOut:"i02nhhulh"},{portIn:"Exe",portOut:"Next",objIn:"bfeby31lg",objOut:"i02nhhulh"},{portIn:"Exe",portOut:"Next",objIn:"x6hmk9do9",objOut:"i02nhhulh"}]}],objName:"Ops.Ui.Routing.RouteTrigger"},{id:"dkb5w08kx",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"9fg1rarcs",objOut:"dkb5w08kx"},{portIn:"Array 2",portOut:"Array",objIn:"x6hmk9do9",objOut:"dkb5w08kx"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"0ltozziv7",uiAttribs:{},portsIn:[{name:"Num Triplets",value:1},{name:"Z",value:0}],portsOut:[{name:"Array",links:[{portIn:"Array 1",portOut:"Array",objIn:"x6hmk9do9",objOut:"0ltozziv7"}]},{name:"Total points",value:1},{name:"Array length",value:3}],objName:"Ops.Array.Array3"},{id:"x6hmk9do9",uiAttribs:{},portsOut:[{name:"Next",links:[{portIn:"Exe",portOut:"Next",objIn:"axuprhoey",objOut:"x6hmk9do9"}]},{name:"Result",links:[{portIn:"Array 1",portOut:"Result",objIn:"axuprhoey",objOut:"x6hmk9do9"}]}],objName:"Ops.Array.InterpolateArrays"},{id:"kpjp0vnim",uiAttribs:{},portsOut:[{name:"result",links:[{portIn:"Value",portOut:"result",objIn:"lbfxxhlcl",objOut:"kpjp0vnim"}]}],objName:"Ops.Math.Subtract"},{id:"t4wh6y50u",uiAttribs:{},portsIn:[{name:"number2",value:-.5}],portsOut:[{name:"result",links:[{portIn:"number2",portOut:"result",objIn:"kpjp0vnim",objOut:"t4wh6y50u"}]}],objName:"Ops.Math.Sum"},{id:"www581ftl",uiAttribs:{},portsIn:[{name:"radius",value:.02},{name:"innerRadius",value:0},{name:"segments",value:40},{name:"percent",value:1},{name:"steps",value:0},{name:"invertSteps",value:0},{name:"mapping index",value:0},{name:"mapping",value:"flat"},{name:"Spline",value:0},{name:"Draw",value:1,title:"Render mesh"}],objName:"Ops.Graphics.Meshes.Circle_v3"}],export:{time:"2026-01-28 10:46",service:"html",exportNumber:14}};if(!CABLES.exportedPatch){CABLES.exportedPatch=CABLES.exportedPatches["g9QGb8"]}"use strict";var CABLES=CABLES||{};CABLES.OPS=CABLES.OPS||{};var Ops=Ops||{};Ops.Gl=Ops.Gl||{};Ops.Ui=Ops.Ui||{};Ops.Anim=Ops.Anim||{};Ops.Data=Ops.Data||{};Ops.Json=Ops.Json||{};Ops.Math=Ops.Math||{};Ops.Vars=Ops.Vars||{};Ops.Array=Ops.Array||{};Ops.Color=Ops.Color||{};Ops.Number=Ops.Number||{};Ops.String=Ops.String||{};Ops.Boolean=Ops.Boolean||{};Ops.Devices=Ops.Devices||{};Ops.Sidebar=Ops.Sidebar||{};Ops.Trigger=Ops.Trigger||{};Ops.Graphics=Ops.Graphics||{};Ops.Extension=Ops.Extension||{};Ops.Gl.Matrix=Ops.Gl.Matrix||{};Ops.Gl.Meshes=Ops.Gl.Meshes||{};Ops.Gl.Shader=Ops.Gl.Shader||{};Ops.Ui.Routing=Ops.Ui.Routing||{};Ops.Gl.Textures=Ops.Gl.Textures||{};Ops.Data.Compose=Ops.Data.Compose||{};Ops.Math.Compare=Ops.Math.Compare||{};Ops.Data.JsonPath=Ops.Data.JsonPath||{};Ops.Devices.Mouse=Ops.Devices.Mouse||{};Ops.Devices.Browser=Ops.Devices.Browser||{};Ops.Gl.ImageCompose=Ops.Gl.ImageCompose||{};Ops.Graphics.Meshes=Ops.Graphics.Meshes||{};Ops.Array.PointArray=Ops.Array.PointArray||{};Ops.Graphics.Geometry=Ops.Graphics.Geometry||{};Ops.Data.Compose.Array=Ops.Data.Compose.Array||{};Ops.Extension.Deprecated=Ops.Extension.Deprecated||{};Ops.Gl.ImageCompose.Noise=Ops.Gl.ImageCompose.Noise||{};Ops.Number.Number=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("value"),r=e.outNumber("result");i.onChange=s;let n=false;i.onLinkChanged=()=>{if(!n&&i.isLinked())e.setUiAttribs({extendTitle:null});n=i.isLinked()};function s(){if(CABLES.UI&&!n)e.setUiAttribs({extendTitle:i.get()});r.set(Number(i.get()))}}};CABLES.OPS["8fb2bb5d-665a-4d0a-8079-12710ae453be"]={f:Ops.Number.Number,objName:"Ops.Number.Number"};Ops.Gl.MainLoop_v2=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={};const t=n.inFloat("Max Pixel Density (DPR)",2),i=n.inValue("FPS Limit",0),r=n.inValueBool("Reduce FPS unfocussed",false),s=n.inValueBool("Transparent",false),a=n.inValueBool("Active",1),o=n.inValueBool("Focus canvas",1),l=n.outTrigger("trigger"),u=n.outNumber("width"),h=n.outNumber("height"),c=n.outNumber("Pixel Density");n.onAnimFrame=C;t.onChange=T;const f=n.patch.cg=n.patch.cgl;let g=0;let d=0;let m=null;let p=false;if(!n.patch.cgl)n.uiAttr({error:"No webgl cgl context"});const _=vec3.create();vec3.set(_,0,0,0);const b=vec3.create();vec3.set(b,0,0,-2);let v=true;let x=null;let E=true;let A=true;window.addEventListener("blur",()=>{E=false});window.addEventListener("focus",()=>{E=true});document.addEventListener("visibilitychange",()=>{A=!document.hidden});R();n.patch.tempData.mainloopOp=this;function T(){I();if(CABLES.UI){if(t.get()<1)n.patch.cgl.canvas.style.imageRendering="pixelated"}n.patch.cgl.updateSize();if(CABLES.UI)gui.setLayout()}a.onChange=function(){n.patch.removeOnAnimFrame(n);if(a.get()){n.setUiAttrib({extendTitle:""});n.onAnimFrame=C;n.patch.addOnAnimFrame(n);n.log("adding again!")}else{n.setUiAttrib({extendTitle:"Inactive"})}};function O(){if(r.get()){if(!A)return 10;if(!E)return 30}return i.get()}n.onDelete=function(){f.gl.clearColor(0,0,0,0);f.gl.clear(f.gl.COLOR_BUFFER_BIT|f.gl.DEPTH_BUFFER_BIT)};function I(){if(t.get()!=0)n.patch.cgl.pixelDensity=Math.min(t.get(),window.devicePixelRatio);else n.patch.cgl.pixelDensity=window.devicePixelRatio}let S=-1;let M=0;function C(e,t,i){if(t===S){if(M<10)console.warn("duplicate frame?!");M++;return}S=t;if(!a.get())return;if(f.aborted||f.canvas.clientWidth===0||f.canvas.clientHeight===0)return;n.patch.cg=f;I();const r=performance.now();n.patch.config.fpsLimit=O();if(f.canvasWidth==-1){f.setCanvas(n.patch.config.glCanvasId);return}if(f.canvasWidth!=u.get()||f.canvasHeight!=h.get()){u.set(f.canvasWidth/1);h.set(f.canvasHeight/1)}if(CABLES.now()-d>1e3){CGL.fpsReport=CGL.fpsReport||[];if(n.patch.loading.getProgress()>=1&&d!==0)CGL.fpsReport.push(g);g=0;d=CABLES.now()}CGL.MESH.lastShader=null;CGL.MESH.lastMesh=null;f.renderStart(f,_,b);if(!s.get())f.gl.clearColor(0,0,0,1);else f.gl.clearColor(0,0,0,0);f.gl.clear(f.gl.COLOR_BUFFER_BIT|f.gl.DEPTH_BUFFER_BIT);l.trigger();if(CGL.MESH.lastMesh)CGL.MESH.lastMesh.unBind();if(CGL.Texture.previewTexture){if(!CGL.Texture.texturePreviewer)CGL.Texture.texturePreviewer=new CGL.Texture.texturePreview(f);CGL.Texture.texturePreviewer.render(CGL.Texture.previewTexture)}f.renderEnd(f);n.patch.cg=null;if(!s.get()){f.gl.clearColor(1,1,1,1);f.gl.colorMask(false,false,false,true);f.gl.clear(f.gl.COLOR_BUFFER_BIT);f.gl.colorMask(true,true,true,true)}if(!f.tempData.phong)f.tempData.phong={};g++;if(v){if(o.get())f.canvas.focus();v=false}c.set(n.patch.cgl.pixelDensity);n.patch.cgl.profileData.profileMainloopMs=performance.now()-r}function R(){clearTimeout(m);m=setTimeout(()=>{if(n.patch.getOpsByObjName(n.name).length>1){n.setUiError("multimainloop","there should only be one mainloop op!");if(!p)p=n.patch.addEventListener("onOpDelete",R)}else n.setUiError("multimainloop",null,1)},500)}}};CABLES.OPS["f1029550-d877-42da-9b1e-63a5163a0350"]={f:Ops.Gl.MainLoop_v2,objName:"Ops.Gl.MainLoop_v2"};Ops.Gl.Matrix.ScreenPosTo3d_v3=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Exec"),n=e.inValue("X"),s=e.inValue("Y"),r=e.inSwitch("Input Type",["Pixel","-1 to 1"],"Pixel"),a=e.outTrigger("Trigger out"),o=e.outNumber("Result X"),l=e.outNumber("Result Y");const u=mat4.create();const h=e.patch.cgl;i.onTriggered=f;let c=0;r.onChange=()=>{if(r.get()=="Pixel")c=0;else if(r.get()=="-1 to 1")c=1};function f(){let e=0;let t=0;let i=h.canvas.clientWidth/h.canvas.clientHeight;if(c===0){e=2*n.get()/h.canvas.clientWidth-1;t=-2*s.get()/h.canvas.clientHeight+1}else if(c===1){e=n.get();t=s.get()}let r=vec3.fromValues(e,t,0);mat4.mul(u,h.pMatrix,h.vMatrix);mat4.invert(u,u);vec3.transformMat4(r,r,u);o.set(r[0]*10);l.set(r[1]*10);a.trigger()}}};CABLES.OPS["48d72532-afa6-40c9-a895-00a43635a94b"]={f:Ops.Gl.Matrix.ScreenPosTo3d_v3,objName:"Ops.Gl.Matrix.ScreenPosTo3d_v3"};Ops.Devices.Mouse.Mouse_v3=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const F=t.attachments={};const e=t.inSwitch("Coordinates",["-1 to 1","Pixel Display","Pixel","0 to 1"],"-1 to 1"),n=t.inValueSelect("Area",["Canvas","Document","Parent Element","Canvas Area"],"Canvas"),s=t.inValueBool("flip y",true),i=t.inBool("right click prevent default",true),r=t.inValueBool("Touch support",true),a=t.inValueBool("Passive Events",false),o=t.inValueBool("Active",true),l=t.outNumber("x",0),u=t.outNumber("y",0),h=t.outTrigger("click"),c=t.outTrigger("click right"),f=t.outBoolNum("Button is down"),g=t.outBoolNum("Mouse is hovering"),d=t.outNumber("Movement X",0),m=t.outNumber("Movement Y",0);const p=t.patch.cgl;let _=1;let b=null;let v=null;a.onChange=n.onChange=w;e.onChange=D;t.onDelete=L;w();t.on("loadedValueSet",x);function x(){if(_==0){if(v.clientWidth===0)setTimeout(x,50);l.set(v.clientWidth/2);u.set(v.clientHeight/2)}else if(_==1){l.set(0);u.set(0)}else if(_==2){l.set(.5);u.set(.5)}else if(_==3){if(v.clientWidth===0){setTimeout(x,50)}l.set(v.clientWidth/2/p.pixelDensity);u.set(v.clientHeight/2/p.pixelDensity)}else console.error("unknown normalize mouse",_)}function k(n,s){n=n||0;s=s||0;if(_==0){l.set(n);u.set(s)}else if(_==3){l.set(n*p.pixelDensity);u.set(s*p.pixelDensity)}else{let i=v.clientWidth/p.pixelDensity;let r=v.clientHeight/p.pixelDensity;i=i||1;r=r||1;if(_==1){let e=n/i*2-1;let t=s/r*2-1;e=CABLES.clamp(e,-1,1);t=CABLES.clamp(t,-1,1);l.set(e);u.set(t)}else if(_==2){let e=n/i;let t=s/r;e=CABLES.clamp(e,0,1);t=CABLES.clamp(t,0,1);l.set(e);u.set(t)}}}function E(e){if(!v)return;const t=v.getBoundingClientRect();return e.clientX>t.left&&e.clientX<t.left+t.width&&e.clientY>t.top&&e.clientY<t.top+t.height}r.onChange=function(){L();w()};o.onChange=function(){if(b)L();if(o.get())w()};function D(){if(e.get()=="Pixel")_=0;else if(e.get()=="-1 to 1")_=1;else if(e.get()=="0 to 1")_=2;else if(e.get()=="Pixel Display")_=3}function A(e){f.set(false);g.set(E(e))}function T(e){if(!E(e))return;f.set(true)}function O(e){f.set(false)}function I(e){if(!E(e))return;c.trigger();if(i.get())e.preventDefault()}function S(e){if(!E(e))return;h.trigger()}function M(e){f.set(false);g.set(E(e))}function C(e){let t=e.clientX;let i=e.clientY;if(n.get()!="Document"){t=e.offsetX;i=e.offsetY}if(n.get()==="Canvas Area"){const r=v.getBoundingClientRect();t=e.clientX-r.left;i=e.clientY-r.top;if(t<0||t>r.width||i>r.height||i<0)return;t=CABLES.clamp(t,0,r.width);i=CABLES.clamp(i,0,r.height)}if(s.get())i=v.clientHeight-i;k(t/p.pixelDensity,i/p.pixelDensity)}function R(e){g.set(E(e));if(n.get()==="Canvas Area"){const t=v.getBoundingClientRect();const i=e.clientX-t.left;const r=e.clientY-t.top;if(i<0||i>t.width||r>t.height||r<0)return}C(e);d.set(e.movementX/p.pixelDensity);m.set(e.movementY/p.pixelDensity)}function N(e){if(event.touches&&event.touches.length>0)C(e.touches[0])}function y(e){f.set(true);if(e.touches&&e.touches.length>0)T(e.touches[0])}function P(e){f.set(false);O()}function L(){if(!b)return;b.removeEventListener("touchend",P);b.removeEventListener("touchstart",y);b.removeEventListener("touchmove",N);b.removeEventListener("click",S);b.removeEventListener("mousemove",R);b.removeEventListener("mouseleave",M);b.removeEventListener("mousedown",T);b.removeEventListener("mouseup",O);b.removeEventListener("mouseenter",A);b.removeEventListener("contextmenu",I);b=null}function w(){if(b||!o.get())L();if(!o.get())return;b=v=p.canvas;if(n.get()=="Canvas Area"){v=p.canvas.parentElement;b=document.body}if(n.get()=="Document")v=b=document.body;if(n.get()=="Parent Element")b=v=p.canvas.parentElement;if(!v){t.setUiError("noarea","could not find area element for mouse",2);return}t.setUiError("noarea",null);let e=false;if(a.get())e={passive:true};if(r.get()){b.addEventListener("touchend",P,e);b.addEventListener("touchstart",y,e);b.addEventListener("touchmove",N,e)}b.addEventListener("mousemove",R,e);b.addEventListener("mouseleave",M,e);b.addEventListener("mousedown",T,e);b.addEventListener("mouseup",O,e);b.addEventListener("mouseenter",A,e);b.addEventListener("contextmenu",I,e);b.addEventListener("click",S,e)}}};CABLES.OPS["6d1edbc0-088a-43d7-9156-918fb3d7f24b"]={f:Ops.Devices.Mouse.Mouse_v3,objName:"Ops.Devices.Mouse.Mouse_v3"};Ops.Anim.Smooth=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Update"),r=e.inBool("Separate inc/dec",false),n=e.inValue("Value"),s=e.outTrigger("Next"),a=e.inValue("Inc factor",4),o=e.inValue("Dec factor",4),l=e.outNumber("Result",0);let u=0;let h=0;let c=0;let f=0;e.toWorkPortsNeedToBeLinked(i);let g;let d;let m=4;let p=true;let _=0;const b=0;const v=1;x();E();r.setUiAttribs({hidePort:true});a.onChange=o.onChange=E;r.onChange=x;A();function x(){const e=r.get();if(!e)_=b;else _=v;if(_==b){o.setUiAttribs({greyout:true});a.setUiAttribs({title:"Inc/Dec factor"})}else if(_==v){o.setUiAttribs({greyout:false});a.setUiAttribs({title:"Inc factor"})}E();A()}function E(){if(_==b){g=a.get();d=a.get()}else if(_==v){g=a.get();d=o.get()}if(g<=.2||g!=g)g=.2;if(d<=.2||d!=d)d=.2}n.onChange=function(){p=false;let e=h;h=n.get()};a.onChange=function(){E()};function A(){let e=1;if(performance.now()-f>500||f===0)u=n.get()||0;else e=(performance.now()-f)/(performance.now()-f);f=performance.now();if(u!=u)u=0;if(m<=0)m=1e-4;const t=h-u;if(t>=0)u+=t/(d*e);else u+=t/(g*e);if(Math.abs(t)<1e-5)u=h;if(m!=m)u=0;if(u!=u||u==-Infinity||u==Infinity)u=n.get();if(c!=u){l.set(u);c=u}if(u==h&&!p){p=true;l.set(u)}}i.onTriggered=function(){A();s.trigger()}}};CABLES.OPS["5677b5b5-753a-4fbf-9e91-64c81ec68a2f"]={f:Ops.Anim.Smooth,objName:"Ops.Anim.Smooth"};Ops.Data.Compose.Array.CompArray=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("Update"),r=e.inBool("Active",true),n=e.inBool("Clear",true),s=e.inTriggerButton("Reset"),a=e.outTrigger("Next"),o=e.outArray("Result");s.onTriggered=()=>{l=[];o.setRef([])};let l=[];i.onTriggered=()=>{if(!r.get())return a.trigger();e.patch.tempData.compArray=e.patch.tempData.compArray||[];if(n.get()){l=[]}e.patch.tempData.compArray.push(l);a.trigger();o.setRef(e.patch.tempData.compArray.pop())}}};CABLES.OPS["16f1ce37-9e0d-4632-a9ba-dfd42c4eb254"]={f:Ops.Data.Compose.Array.CompArray,objName:"Ops.Data.Compose.Array.CompArray"};Ops.Trigger.Sequence=class extends CABLES.Op{constructor(){super(...arguments);const s=this;const e=s.attachments={};const t=s.inTrigger("exe"),i=s.inTriggerButton("Clean up connections");s.setUiAttrib({resizable:true,resizableY:false,stretchPorts:true});const r=[],a=[],n=16;let o=null,l=[];t.onTriggered=c;i.onTriggered=f;i.setUiAttribs({hideParam:true,hidePort:true});for(let t=0;t<n;t++){const g=s.outTrigger("trigger "+t);a.push(g);g.onLinkChanged=h;if(t<n-1){let e=s.inTrigger("exe "+t);e.onTriggered=c;r.push(e)}}u();function u(){l.length=0;for(let e=0;e<a.length;e++)if(a[e].links.length>0)l.push(a[e])}function h(){u();clearTimeout(o);o=setTimeout(()=>{let t=false;for(let e=0;e<a.length;e++)if(a[e].links.length>1)t=true;i.setUiAttribs({hideParam:!t});if(s.isCurrentUiOp())s.refreshParams()},60)}function c(){for(let e=0;e<l.length;e++)l[e].trigger()}function f(){let r=0;for(let i=0;i<a.length;i++){let t=[];if(a[i].links.length>1)for(let e=1;e<a[i].links.length;e++){while(a[r].links.length>0)r++;t.push(a[i].links[e]);const n=a[i].links[e].getOtherPort(a[i]);s.patch.link(s,"trigger "+r,n.op,n.name);r++}for(let e=0;e<t.length;e++)t[e].remove()}h();u()}}};CABLES.OPS["a466bc1f-06e9-4595-8849-bffb9fe22f99"]={f:Ops.Trigger.Sequence,objName:"Ops.Trigger.Sequence"};Ops.Data.Compose.Array.CompArraySnapshot=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inTrigger("Update"),r=t.outTrigger("Next"),n=t.outArray("Result");i.onTriggered=()=>{if(t.patch.tempData.compArray&&t.patch.tempData.compArray.length>0){try{n.setRef(JSON.parse(JSON.stringify(t.patch.tempData.compArray[t.patch.tempData.compArray.length-1])))}catch(e){t.log(e)}}r.trigger()}}};CABLES.OPS["3703008b-0500-4a54-ae9a-58561a82d8e3"]={f:Ops.Data.Compose.Array.CompArraySnapshot,objName:"Ops.Data.Compose.Array.CompArraySnapshot"};Ops.Math.Multiply=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("number1",1),r=e.inValueFloat("number2",1),n=e.outNumber("result");e.setUiAttribs({mathTitle:true});i.onChange=r.onChange=s;s();function s(){const e=i.get();const t=r.get();n.set(e*t)}}};CABLES.OPS["1bbdae06-fbb2-489b-9bcc-36c9d65bd441"]={f:Ops.Math.Multiply,objName:"Ops.Math.Multiply"};Ops.Trigger.Repeat_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Execute"),r=e.inValueInt("Repeats",5),n=e.inSwitch("Direction",["Forward","Backward"],"Forward"),s=e.outTrigger("Next"),a=e.addOutPort(new CABLES.Port(e,"index"));n.onChange=o;o();function o(){if(n.get()=="Forward")i.onTriggered=l;else i.onTriggered=u}function l(){const t=Math.floor(r.get());for(let e=0;e<t;e++){a.set(e);s.trigger()}}function u(){const t=Math.floor(r.get());for(let e=t-1;e>-1;e--){a.set(e);s.trigger()}}}};CABLES.OPS["a4deea80-db97-478f-ad1a-5ee30f2f47cc"]={f:Ops.Trigger.Repeat_v2,objName:"Ops.Trigger.Repeat_v2"};Ops.Data.Compose.Array.CompArrayPushNumbers=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inTrigger("Update"),r=t.inFloat("X",0),n=t.inFloat("Y",0),s=t.inFloat("Z",0),a=t.inFloat("W",1),o=t.inSwitch("Num",["1","2","3","4"],"4"),l=t.outTrigger("Next");let u=4;o.onChange=()=>{u=parseInt(o.get());n.setUiAttribs({greyout:u<2});s.setUiAttribs({greyout:u<3});a.setUiAttribs({greyout:u<4})};function h(){inDivisorDown.setUiAttribs({greyout:false})}i.onTriggered=()=>{if(t.patch.tempData.compArray&&t.patch.tempData.compArray.length>0){let e=t.patch.tempData.compArray[t.patch.tempData.compArray.length-1];if(e){if(u==4)e.push(r.get(),n.get(),s.get(),a.get());else if(u==3)e.push(r.get(),n.get(),s.get());else if(u==2)e.push(r.get(),n.get());else if(u==1)e.push(r.get())}}l.trigger()}}};CABLES.OPS["d356385a-ad48-4d74-8952-eeaf136b0c8c"]={f:Ops.Data.Compose.Array.CompArrayPushNumbers,objName:"Ops.Data.Compose.Array.CompArrayPushNumbers"};Ops.Array.Array3GetNumbers=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inArray("Array",3),r=e.inValueInt("Index"),n=e.outNumber("X"),s=e.outNumber("Y"),a=e.outNumber("Z");e.toWorkPortsNeedToBeLinked(i);i.onChange=r.onChange=o;function o(){let e=i.get();if(!e){n.set(0);s.set(0);a.set(0);return}let t=Math.min(e.length-3,r.get()*3);if(e){n.set(e[t+0]);s.set(e[t+1]);a.set(e[t+2])}}}};CABLES.OPS["56882cc4-c40d-4dc0-bf7c-db1b5a7acad0"]={f:Ops.Array.Array3GetNumbers,objName:"Ops.Array.Array3GetNumbers"};Ops.Math.Sum=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("number1",0),r=e.inValueFloat("number2",0),n=e.outNumber("result");e.setUiAttribs({mathTitle:true});i.onChange=r.onChange=s;s();function s(){const e=i.get()+r.get();if(!isNaN(e))n.set(e)}}};CABLES.OPS["c8fb181e-0b03-4b41-9e55-06b6267bc634"]={f:Ops.Math.Sum,objName:"Ops.Math.Sum"};Ops.Math.Subtract=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValue("number1",1),r=e.inValue("number2",1),n=e.outNumber("result");e.setUiAttribs({mathTitle:true});i.onChange=r.onChange=s;s();function s(){let e=i.get()-r.get();if(!isNaN(e))n.set(e)}}};CABLES.OPS["a4ffe852-d200-4b96-9347-68feb01122ca"]={f:Ops.Math.Subtract,objName:"Ops.Math.Subtract"};Ops.Ui.Comment_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inString("title","New comment"),r=e.inTextarea("text");i.setUiAttribs({hidePort:true});r.setUiAttribs({hidePort:true});e.init=i.onChange=r.onChange=e.onLoaded=n;n();function n(){if(CABLES.UI){e.uiAttr({comment_title:i.get(),comment_text:r.get(),extendTitle:i.get()})}}}};CABLES.OPS["93492eeb-bf35-4a62-98f7-d85b0b79bfe5"]={f:Ops.Ui.Comment_v2,objName:"Ops.Ui.Comment_v2"};Ops.Math.Distance2d=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValue("x1"),r=e.inValue("y1"),n=e.inValue("x2"),s=e.inValue("y2"),a=e.outNumber("distance");i.onChange=r.onChange=n.onChange=s.onChange=o;function o(){const e=n.get()-i.get();const t=s.get()-r.get();a.set(Math.sqrt(e*e+t*t))}}};CABLES.OPS["d181cc7c-adbb-467b-842b-e6a854c58bfc"]={f:Ops.Math.Distance2d,objName:"Ops.Math.Distance2d"};Ops.Math.MathExpression=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inFloat("A",0);const r=e.inFloat("B",1);const n=e.inFloat("C",2);const s=e.inFloat("D",3);e.setPortGroup("Parameters",[i,r,n,s]);const a=e.inString("Expression","a*(b+c+d)");e.setPortGroup("Expression",[a]);const o=e.outNumber("Result");const l=e.outBool("Expression Valid");let u=a.get();let h=false;const c=()=>{try{u=new Function("m","a","b","c","d",`with(m) { return ${a.get()} }`);h=true;f();l.set(h)}catch(e){h=false;l.set(h);if(e instanceof ReferenceError||e instanceof SyntaxError)return}};const f=()=>{if(h){o.set(u(Math,i.get(),r.get(),n.get(),s.get()));if(!a.get())o.set(0)}l.set(h)};i.onChange=r.onChange=n.onChange=s.onChange=f;a.onChange=c;c()}};CABLES.OPS["d2343a1e-64ea-45b2-99ed-46e167bbdcd3"]={f:Ops.Math.MathExpression,objName:"Ops.Math.MathExpression"};Ops.String.String_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inString("value",""),r=e.outString("String");i.setUiAttribs({display:"text"});i.onChange=function(){if(!i.isLinked())e.setUiAttrib({extendTitle:i.get()});r.set(i.get())}}};CABLES.OPS["d697ff82-74fd-4f31-8f54-295bc64e713d"]={f:Ops.String.String_v2,objName:"Ops.String.String_v2"};Ops.Array.ArrayFromNumbers=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inTrigger("Update"),r=t.inInt("Limit",30),n=t.inBool("Slider",false),s=t.outTrigger("Next"),a=t.outArray("Array");const o=[];for(let e=0;e<30;e++){const c=t.inFloat("Index "+e,0);o.push(c)}const l=[];let u=null;i.onTriggered=h;n.onChange=()=>{const e=r.get();for(let e=0;e<o.length;e++)if(n.get())o[e].setUiAttribs({display:"range"});else o[e].setUiAttribs({display:null});t.refreshParams()};r.onChange=()=>{clearTimeout(u);u=setTimeout(()=>{const t=r.get();for(let e=0;e<o.length;e++){o[e].setUiAttribs({greyout:e>=t})}},300)};function h(){const t=Math.max(0,Math.ceil(Math.min(r.get(),o.length)));l.length=t;for(let e=0;e<t;e++){l[e]=o[e].get()}a.set(null);a.set(l);s.trigger()}}};CABLES.OPS["fb698158-3cf8-49d6-805e-6ea38fdab8c1"]={f:Ops.Array.ArrayFromNumbers,objName:"Ops.Array.ArrayFromNumbers"};Ops.Math.CircleCoordinates=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inFloat("Position"),r=e.inFloat("Radius",1),n=e.outNumber("X"),s=e.outNumber("Y");i.onChange=r.onChange=a;function a(){const e=r.get();const t=360*i.get()*CGL.DEG2RAD;n.set(Math.sin(t)*e);s.set(Math.cos(t)*e)}}};CABLES.OPS["76fdea4d-1653-46d6-80f3-af34018f043d"]={f:Ops.Math.CircleCoordinates,objName:"Ops.Math.CircleCoordinates"};Ops.Graphics.Transform=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={};const t=i.inTrigger("render"),r=i.inValue("posX",0),n=i.inValue("posY",0),s=i.inValue("posZ",0),a=i.inValue("scale",1),o=i.inValue("rotX",0),l=i.inValue("rotY",0),u=i.inValue("rotZ",0),h=i.outTrigger("trigger");i.setPortGroup("Rotation",[o,l,u]);i.setPortGroup("Position",[r,n,s]);i.setPortGroup("Scale",[a]);i.setUiAxisPorts(r,n,s);i.toWorkPortsNeedToBeLinked(t,h);const c=vec3.create();const f=vec3.create();const g=mat4.create();mat4.identity(g);let d=false,m=false,p=true,_=true,b=true;o.onChange=l.onChange=u.onChange=O;r.onChange=n.onChange=s.onChange=A;a.onChange=T;t.onTriggered=function(){let e=false;if(p){x();e=true}if(_){E();e=true}if(b)e=true;if(e)v();const t=i.patch.cg||i.patch.cgl;t.pushModelMatrix();mat4.multiply(t.mMatrix,t.mMatrix,g);h.trigger();t.popModelMatrix();if(CABLES.UI){if(!r.isLinked()&&!n.isLinked()&&!s.isLinked()){gui.setTransform(i.id,r.get(),n.get(),s.get());if(i.isCurrentUiOp())gui.setTransformGizmo({posX:r,posY:n,posZ:s})}}};function v(){mat4.identity(g);if(m)mat4.translate(g,g,c);if(o.get()!==0)mat4.rotateX(g,g,o.get()*CGL.DEG2RAD);if(l.get()!==0)mat4.rotateY(g,g,l.get()*CGL.DEG2RAD);if(u.get()!==0)mat4.rotateZ(g,g,u.get()*CGL.DEG2RAD);if(d)mat4.scale(g,g,f);b=false}function x(){m=false;if(r.get()!==0||n.get()!==0||s.get()!==0)m=true;vec3.set(c,r.get(),n.get(),s.get());p=false}function E(){d=true;vec3.set(f,a.get(),a.get(),a.get());_=false}function A(){p=true}function T(){_=true}function O(){b=true}v()}};CABLES.OPS["650baeb1-db2d-4781-9af6-ab4e9d4277be"]={f:Ops.Graphics.Transform,objName:"Ops.Graphics.Transform"};Ops.Array.ArrayGetNumber=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inArray("array"),r=e.inValueInt("index"),n=e.inFloat("Value Invalid Index",0),s=e.outNumber("value"),a=e.outBoolNum("Valid Index",true);i.ignoreValueSerialize=true;e.toWorkPortsNeedToBeLinked(i);r.onChange=i.onChange=o;function o(){if(i.get()){const e=i.get()[r.get()];if(isNaN(e)){s.set(n.get());a.set(false)}else{a.set(true);s.set(parseFloat(e))}}}}};CABLES.OPS["d1189078-70cf-437d-9a37-b2ebe89acdaf"]={f:Ops.Array.ArrayGetNumber,objName:"Ops.Array.ArrayGetNumber"};Ops.Math.Divide=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("number1",1),r=e.inValueFloat("number2",2),n=e.outNumber("result");e.setUiAttribs({mathTitle:true});i.onChange=r.onChange=s;s();function s(){n.set(i.get()/r.get())}}};CABLES.OPS["86fcfd8c-038d-4b91-9820-a08114f6b7eb"]={f:Ops.Math.Divide,objName:"Ops.Math.Divide"};Ops.Gl.Matrix.Coordinates=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inTrigger("render"),r=t.outTrigger("trigger"),n=t.outNumber("X"),s=t.outNumber("Y"),a=t.outNumber("Z"),o=vec3.create(),l=vec3.create();i.onTriggered=function(){const e=t.patch.cg||t.patch.cgl;vec3.transformMat4(o,l,e.mMatrix);n.set(o[0]);s.set(o[1]);a.set(o[2]);r.trigger()}}};CABLES.OPS["390d0214-92a9-48e9-85b4-f3092ee9e043"]={f:Ops.Gl.Matrix.Coordinates,objName:"Ops.Gl.Matrix.Coordinates"};Ops.Array.ArrayBuffer=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("exec"),r=e.inValue("Value"),n=e.outTrigger("Trigger out"),s=e.outArray("Result"),a=e.outNumber("Array length");let o=[];let l=e.inInt("Max Length",100);let u=e.inTriggerButton("Reset");s.set(o);l.onChange=h;u.onTriggered=h;h();function h(){o.length=Math.abs(Math.floor(l.get()))||0;for(let e=0;e<o.length;e++)o[e]=0;s.set(null);s.set(o);a.set(0)}i.onTriggered=function(){for(let e=1;e<o.length;e++)o[e-1]=o[e];o[o.length-1]=r.get();s.setRef(o);a.set(o.length);n.trigger()}}};CABLES.OPS["332174c6-af8f-4c4a-9ea2-a0be249ecd72"]={f:Ops.Array.ArrayBuffer,objName:"Ops.Array.ArrayBuffer"};Ops.Array.ArrayIteratorNumbers=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("exe"),r=e.inArray("array"),n=e.outTrigger("trigger"),s=e.addOutPort(new CABLES.Port(e,"index")),a=e.addOutPort(new CABLES.Port(e,"value"));a.changeAlways=true;i.onTriggered=function(){if(!r.get())return;for(let e=0;e<r.get().length;e++){s.set(e);a.set(r.get()[e]);n.trigger()}}}};CABLES.OPS["ec280011-1190-4333-9a68-adb4904fca1a"]={f:Ops.Array.ArrayIteratorNumbers,objName:"Ops.Array.ArrayIteratorNumbers"};Ops.Data.Compose.Array.CompArrayPushNumber=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inTrigger("Update"),r=t.inFloat("Number",0),n=t.outTrigger("Next");i.onTriggered=()=>{if(t.patch.tempData.compArray&&t.patch.tempData.compArray.length>0){let e=t.patch.tempData.compArray[t.patch.tempData.compArray.length-1];if(e)e.push(r.get())}n.trigger()}}};CABLES.OPS["49741334-d249-4f62-96ea-3ff582f38598"]={f:Ops.Data.Compose.Array.CompArrayPushNumber,objName:"Ops.Data.Compose.Array.CompArrayPushNumber"};Ops.Array.ArrayUnpack2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inArray("Array in xyz"),r=e.outArray("Array 1 out"),n=e.outArray("Array 2 out"),s=e.outNumber("Array lengths");let a=false;const o=[];const l=[];i.onChange=u;function u(){let t=i.get();if(!t){r.set(null);return}if(t.length%2!==0){if(!a){e.uiAttr({error:"Arrays length not divisible by 2 !"});s.set(0);a=true}return}if(t.length===0){s.set(0);r.set(null);n.set(null)}if(a){a=false;e.uiAttr({error:null})}o.length=Math.floor(t.length/2);l.length=Math.floor(t.length/2);for(let e=0;e<t.length/2;e++){o[e]=t[e*2];l[e]=t[e*2+1]}r.setRef(o);n.setRef(l);s.set(o.length)}}};CABLES.OPS["3f789664-9937-4478-ba28-63ccb67e5114"]={f:Ops.Array.ArrayUnpack2,objName:"Ops.Array.ArrayUnpack2"};Ops.Array.ArrayMerge_v3=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=8;const r=[];for(let e=0;e<i;e++){r[e]=t.inArray("Array "+e);r[e].onChange=function(){o()}}const n=t.outArray("Result"),s=t.outNumber("Array length");let a=[];function o(){a.length=0;for(let e=0;e<i;e++){const t=r[e].get();if(t)a=a.concat(t)}n.setRef(a);s.set(a.length)}}};CABLES.OPS["753d053a-04a3-44c7-abf0-ae2676ced13e"]={f:Ops.Array.ArrayMerge_v3,objName:"Ops.Array.ArrayMerge_v3"};Ops.Array.Array2To3=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inArray("Array2x",2),r=e.outArray("Array3x",3),n=e.outNumber("Total points"),s=e.outNumber("Array length");let a=[];let o=false;i.onChange=function(){let t=i.get();if(!t){r.set(null);return}if(t.length%2!=0){if(!o){e.setUiError("warning","Arrays length not divisible by 2!");o=true}r.set(null);n.set(0);s.set(0);return}if(o){o=false;e.setUiError("warning",null)}if(t.length/2*3!=a.length){a.length=t.length/2*3}for(let e=0;e<t.length/2;e++){a[e*3+0]=t[e*2+0];a[e*3+1]=t[e*2+1];a[e*3+2]=0}r.setRef(a);n.set(a.length/3);s.set(a.length)}}};CABLES.OPS["9854162e-d415-4300-a47b-173772b454e9"]={f:Ops.Array.Array2To3,objName:"Ops.Array.Array2To3"};Ops.Array.ReverseArray3=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const n=e.inArray("Array"),s=e.outArray("Reversed Array",[]);n.onLinkChanged=()=>{if(n)n.copyLinkedUiAttrib("stride",s)};n.onChange=function(){let i=n.get();let r=[];if(i&&i.length>=3){let t=Math.floor(i.length/3)*3-3;for(let e=t;e>=0;e-=3){r.push(i[e],i[e+1],i[e+2])}}s.setRef(r)}}};CABLES.OPS["5b0feea0-06ee-4e9d-befb-41793ab4fa2c"]={f:Ops.Array.ReverseArray3,objName:"Ops.Array.ReverseArray3"};Ops.Array.PointArray.SubdivideArray3_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const c=e.inArray("Points"),f=e.inInt("Num Subdivs",5),g=e.inValueBool("Smooth",true),d=e.inValueBool("Loop",false),m=e.inValueBool("Bezier Start/End Points",true),p=e.outArray("Result");e.toWorkPortsNeedToBeLinked(c);let _=[];f.onChange=d.onChange=g.onChange=c.onChange=m.onChange=i;c.onLinkChanged=()=>{c.copyLinkedUiAttrib("stride",p)};function b(e,t,i,r){const n=e*(1-r)*(1-r)+2*t*(1-r)*r+i*r*r;return n}function i(){d.setUiAttribs({greyout:!g.get()});m.setUiAttribs({greyout:!g.get()});if(!c.get()){p.set(null);return}const i=Math.floor(f.get());const r=c.get();if(r.length<3)return;let n=0;let s=0;let a=0;let o=0;if(i>0&&!g.get()){const e=(r.length-3)*i+3;if(e!=_.length){_.length=e}o=0;for(n=0;n<r.length-3;n+=3){for(s=0;s<i;s++){for(a=0;a<3;a++){_[o]=r[n+a]+(r[n+a+3]-r[n+a])*s/i;o++}}}_[e-3]=r[r.length-3];_[e-2]=r[r.length-2];_[e-1]=r[r.length-1]}else if(i>0&&g.get()){let e=(r.length-6)*(i-1);if(m.get())e+=6;if(e!=_.length)_.length=Math.floor(Math.abs(e));o=0;if(m.get()){_[0]=r[0];_[1]=r[1];_[2]=r[2];o=3}const u=d.get();function l(e){if(u)return e%(r.length-3);else return e}let t=r.length-3;if(u)t=r.length;for(n=3;n<t;n+=3){for(s=0;s<i;s++){for(a=0;a<3;a++){const h=b((r[l(n+a-3)]+r[l(n+a)])/2,r[l(n+a+0)],(r[l(n+a+3)]+r[l(n+a+0)])/2,s/i);_[o]=h;o++}}}if(u){_[o+0]=_[0];_[o+1]=_[1];_[o+2]=_[2];o++;o++;o++}if(m.get()){_[o-0]=r[r.length-3];_[o+1]=r[r.length-2];_[o+2]=r[r.length-1]}}if(i==0){_=Array.from(r)}p.setRef(_)}}};CABLES.OPS["d8bb5727-35e4-4e2a-999b-112ebc659720"]={f:Ops.Array.PointArray.SubdivideArray3_v2,objName:"Ops.Array.PointArray.SubdivideArray3_v2"};Ops.Array.Array3To2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};let i=e.inArray("Array3x",3);let r=e.outArray("Array2x",2);let n=[];i.onChange=function(){let t=i.get();if(!t||t.length/3%1!=0){return}if(!t)return;if(t.length/3*2!=n.length){n.length=t.length/3*2}for(let e=0;e<t.length/3;e++){n[e*2+0]=t[e*3+0];n[e*2+1]=t[e*3+1]}r.set(null);r.set(n)}}};CABLES.OPS["c451ee12-67f4-4dc9-8fb8-7a6cc4295a4c"]={f:Ops.Array.Array3To2,objName:"Ops.Array.Array3To2"};Ops.Graphics.Meshes.Circle_v3=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("render"),N=e.inValue("radius",.5),y=e.inValueSlider("innerRadius",0),P=e.inValueInt("segments",40),L=e.inValueSlider("percent",1),w=e.inValue("steps",0),F=e.inValueBool("invertSteps",false),k=e.inSwitch("mapping",["flat","round"]),D=e.inValueBool("Spline",false),r=e.inValueBool("Draw",true),n=e.outTrigger("trigger"),U=e.outObject("geometry",null,"geometry");e.setPortGroup("Size",[N,y]);e.setPortGroup("Display",[L,w,F]);e.toWorkShouldNotBeChild("Ops.Gl.TextureEffects.ImageCompose",CABLES.OP_PORT_TYPE_FUNCTION);r.setUiAttribs({title:"Render mesh"});k.set("flat");k.onChange=P.onChange=N.onChange=y.onChange=L.onChange=w.onChange=F.onChange=D.onChange=c;U.ignoreValueSerialize=true;const s=e.patch.cgl;let B=new CGL.Geometry("circle");let V=null;const a=-1;let o=0;let l=null;let j=true;i.onTriggered=u;e.onDelete=function(){if(V)V.dispose()};e.preRender=()=>{u()};i.onLinkChanged=function(){if(!i.isLinked())U.set(null);else U.setRef(B)};function u(){if(!e.patch.cg)return;if(j)h();if(!CGL.TextureEffect.checkOpNotInTextureEffect(e))return;l=e.patch.cg.getShader();if(!l)return;o=l.glPrimitive;if(D.get())l.glPrimitive=s.gl.LINE_STRIP;if(r.get()&&V){V.render(l)}n.trigger();l.glPrimitive=o}function h(){const i=Math.max(3,Math.floor(P.get()));B.clear();const t=[];const r=[];const n=[];const s=[];const a=[];let o=0,l=0;let u=0,h=0;let c=0,f=0;let g=0,d=0;let m=0,p=0;let _=0,b=0;let v=0,x=0;let E=0,A=0;const T=Math.max(0,L.get());const O=[];if(D.get()){let e=0;let t=0;const I=[];for(o=0;o<=i*T;o++){l=360/i*o*CGL.DEG2RAD;E=Math.cos(l)*N.get();A=Math.sin(l)*N.get();x=.5;if(o>0){O.push(e);O.push(t);O.push(0);v=1-(o-1)/i;I.push(v,x)}O.push(E);O.push(A);O.push(0);e=E;t=A}B.setPointVertices(O)}else if(y.get()<=0){for(o=0;o<=i*T;o++){l=360/i*o*CGL.DEG2RAD;E=Math.cos(l)*N.get();A=Math.sin(l)*N.get();if(k.get()=="flat"){v=(Math.cos(l)+1)/2;x=1-(Math.sin(l)+1)/2;_=.5;b=.5}else if(k.get()=="round"){v=1-o/i;x=0;_=v;b=1}t.push([0,0,0],[u,h,0],[E,A,0]);r.push(_,b,c,f,v,x);n.push(0,0,1,0,0,1,0,0,1);s.push(1,0,0,1,0,0,1,0,0);a.push(0,-1,0,0,-1,0,0,-1,0);c=v;f=x;u=E;h=A}B=CGL.Geometry.buildFromFaces(t,"circle");B.vertexNormals=n;B.tangents=s;B.biTangents=a;B.texCoords=r}else{let e=0;const S=i*T;const M=0;for(o=0;o<=S;o++){e++;l=360/i*o*CGL.DEG2RAD;E=Math.cos(l)*N.get();A=Math.sin(l)*N.get();const C=Math.cos(l)*y.get()*N.get();const R=Math.sin(l)*y.get()*N.get();if(k.get()=="round"){v=1-o/i;x=0;_=v;b=1}if(w.get()===0||e%parseInt(w.get(),10)===0&&!F.get()||e%parseInt(w.get(),10)!==0&&F.get()){t.push([C,R,0],[u,h,0],[E,A,0]);t.push([g,d,0],[u,h,0],[C,R,0]);r.push(v,0,c,0,_,1,v,1,c,0,m,1);n.push(0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1);s.push(1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0);a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1)}m=_;p=b;c=v;f=x;u=E;h=A;g=C;d=R}B=CGL.Geometry.buildFromFaces(t,"circle");B.vertexNormals=n;B.tangents=s;B.biTangents=a;if(k.get()=="flat")B.mapTexCoords2d();else B.texCoords=r}U.setRef(B);if(B.vertices.length==0)return;if(V)V.dispose();V=null;if(e.patch.cg)V=e.patch.cg.createMesh(B,{opId:e.id});j=false}function c(){j=true}}};CABLES.OPS["ae07830b-91c3-4cbe-a7d6-d3b737392c16"]={f:Ops.Graphics.Meshes.Circle_v3,objName:"Ops.Graphics.Meshes.Circle_v3"};Ops.Gl.Shader.BasicMaterial_v3=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={basicmaterial_frag:"{{MODULES_HEAD}}\n\nIN vec2 texCoord;\n\n#ifdef VERTEX_COLORS\nIN vec4 vertCol;\n#endif\n\n#ifdef HAS_TEXTURES\n    IN vec2 texCoordOrig;\n    #ifdef HAS_TEXTURE_DIFFUSE\n        UNI sampler2D tex;\n    #endif\n    #ifdef HAS_TEXTURE_OPACITY\n        UNI sampler2D texOpacity;\n   #endif\n#endif\n\n\n\nvoid main()\n{\n    {{MODULE_BEGIN_FRAG}}\n    vec4 col=color;\n\n\n    #ifdef HAS_TEXTURES\n        vec2 uv=texCoord;\n\n        #ifdef CROP_TEXCOORDS\n            if(uv.x<0.0 || uv.x>1.0 || uv.y<0.0 || uv.y>1.0) discard;\n        #endif\n\n        #ifdef HAS_TEXTURE_DIFFUSE\n            col=texture(tex,uv);\n\n            #ifdef COLORIZE_TEXTURE\n                col.r*=color.r;\n                col.g*=color.g;\n                col.b*=color.b;\n            #endif\n        #endif\n        col.a*=color.a;\n        #ifdef HAS_TEXTURE_OPACITY\n            #ifdef TRANSFORMALPHATEXCOORDS\n                uv=texCoordOrig;\n            #endif\n            #ifdef ALPHA_MASK_IR\n                col.a*=1.0-texture(texOpacity,uv).r;\n            #endif\n            #ifdef ALPHA_MASK_IALPHA\n                col.a*=1.0-texture(texOpacity,uv).a;\n            #endif\n            #ifdef ALPHA_MASK_ALPHA\n                col.a*=texture(texOpacity,uv).a;\n            #endif\n            #ifdef ALPHA_MASK_LUMI\n                col.a*=dot(vec3(0.2126,0.7152,0.0722), texture(texOpacity,uv).rgb);\n            #endif\n            #ifdef ALPHA_MASK_R\n                col.a*=texture(texOpacity,uv).r;\n            #endif\n            #ifdef ALPHA_MASK_G\n                col.a*=texture(texOpacity,uv).g;\n            #endif\n            #ifdef ALPHA_MASK_B\n                col.a*=texture(texOpacity,uv).b;\n            #endif\n            // #endif\n        #endif\n    #endif\n\n    {{MODULE_COLOR}}\n\n    #ifdef DISCARDTRANS\n        if(col.a<0.2) discard;\n    #endif\n\n    #ifdef VERTEX_COLORS\n        col*=vertCol;\n    #endif\n\n    outColor = col;\n}\n",basicmaterial_vert:"\n{{MODULES_HEAD}}\n\nOUT vec2 texCoord;\nOUT vec2 texCoordOrig;\n\nUNI mat4 projMatrix;\nUNI mat4 modelMatrix;\nUNI mat4 viewMatrix;\n\n#ifdef HAS_TEXTURES\n    UNI float diffuseRepeatX;\n    UNI float diffuseRepeatY;\n    UNI float texOffsetX;\n    UNI float texOffsetY;\n#endif\n\n#ifdef VERTEX_COLORS\n    in vec4 attrVertColor;\n    out vec4 vertCol;\n\n#endif\n\n\nvoid main()\n{\n    mat4 mMatrix=modelMatrix;\n    mat4 modelViewMatrix;\n\n    norm=attrVertNormal;\n    texCoordOrig=attrTexCoord;\n    texCoord=attrTexCoord;\n    #ifdef HAS_TEXTURES\n        texCoord.x=texCoord.x*diffuseRepeatX+texOffsetX;\n        texCoord.y=(1.0-texCoord.y)*diffuseRepeatY+texOffsetY;\n    #endif\n\n    #ifdef VERTEX_COLORS\n        vertCol=attrVertColor;\n    #endif\n\n    vec4 pos = vec4(vPosition, 1.0);\n\n    #ifdef BILLBOARD\n       vec3 position=vPosition;\n       modelViewMatrix=viewMatrix*modelMatrix;\n\n       gl_Position = projMatrix * modelViewMatrix * vec4((\n           position.x * vec3(\n               modelViewMatrix[0][0],\n               modelViewMatrix[1][0],\n               modelViewMatrix[2][0] ) +\n           position.y * vec3(\n               modelViewMatrix[0][1],\n               modelViewMatrix[1][1],\n               modelViewMatrix[2][1]) ), 1.0);\n    #endif\n\n    {{MODULE_VERTEX_POSITION}}\n\n    #ifndef BILLBOARD\n        modelViewMatrix=viewMatrix * mMatrix;\n\n        {{MODULE_VERTEX_MODELVIEW}}\n\n    #endif\n\n    // mat4 modelViewMatrix=viewMatrix*mMatrix;\n\n    #ifndef BILLBOARD\n        // gl_Position = projMatrix * viewMatrix * modelMatrix * pos;\n        gl_Position = projMatrix * modelViewMatrix * pos;\n    #endif\n}\n"};const i=e.inTrigger("render");const r=e.outTrigger("trigger");const n=e.outObject("shader",null,"shader");n.ignoreValueSerialize=true;e.toWorkPortsNeedToBeLinked(i);e.toWorkShouldNotBeChild("Ops.Gl.TextureEffects.ImageCompose",CABLES.OP_PORT_TYPE_FUNCTION);const s=e.patch.cgl;const a=new CGL.Shader(s,"basicmaterial",this);a.addAttribute({type:"vec3",name:"vPosition"});a.addAttribute({type:"vec2",name:"attrTexCoord"});a.addAttribute({type:"vec3",name:"attrVertNormal",nameFrag:"norm"});a.addAttribute({type:"float",name:"attrVertIndex"});a.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"]);a.setSource(t.basicmaterial_vert,t.basicmaterial_frag);n.setRef(a);i.onTriggered=M;const o=e.inValueSlider("r",Math.random());const l=e.inValueSlider("g",Math.random());const u=e.inValueSlider("b",Math.random());const h=e.inValueSlider("a",1);o.setUiAttribs({colorPick:true});const c=a.addUniformFrag("4f","color",o,l,u,h);a.uniformColorDiffuse=c;const f=e.inTexture("texture");let g=null;f.onChange=R;const d=e.inValueBool("colorizeTexture",false);const m=e.inValueBool("Vertex Colors",false);const p=e.inTexture("textureOpacity");let _=null;const b=e.inSwitch("Alpha Mask Source",["Luminance","R","G","B","A","1-A","1-R"],"Luminance");b.setUiAttribs({greyout:true});p.onChange=C;const v=e.inValueBool("Opacity TexCoords Transform",false);const x=e.inValueBool("Discard Transparent Pixels");const E=e.inValue("diffuseRepeatX",1),A=e.inValue("diffuseRepeatY",1),T=e.inValue("Tex Offset X",0),O=e.inValue("Tex Offset Y",0),I=e.inBool("Crop TexCoords",false);a.addUniformFrag("f","diffuseRepeatX",E);a.addUniformFrag("f","diffuseRepeatY",A);a.addUniformFrag("f","texOffsetX",T);a.addUniformFrag("f","texOffsetY",O);const S=e.inValueBool("billboard",false);b.onChange=S.onChange=x.onChange=v.onChange=I.onChange=m.onChange=d.onChange=y;e.setPortGroup("Color",[o,l,u,h]);e.setPortGroup("Color Texture",[f,m,d]);e.setPortGroup("Opacity",[p,b,x,v]);e.setPortGroup("Texture Transform",[E,A,T,O,I]);C();R();e.preRender=function(){a.bind();M();if(!a)return};function M(){e.checkGraphicsApi();s.pushShader(a);a.popTextures();if(g&&f.get())a.pushTexture(g,f.get());if(_&&p.get())a.pushTexture(_,p.get());r.trigger();s.popShader()}function C(){if(p.get()){if(_!==null)return;a.removeUniform("texOpacity");a.define("HAS_TEXTURE_OPACITY");if(!_)_=new CGL.Uniform(a,"t","texOpacity")}else{a.removeUniform("texOpacity");a.removeDefine("HAS_TEXTURE_OPACITY");_=null}y()}function R(){if(f.get()){if(!a.hasDefine("HAS_TEXTURE_DIFFUSE"))a.define("HAS_TEXTURE_DIFFUSE");if(!g)g=new CGL.Uniform(a,"t","texDiffuse")}else{a.removeUniform("texDiffuse");a.removeDefine("HAS_TEXTURE_DIFFUSE");g=null}N()}function N(){const e=f.isLinked()||p.isLinked();E.setUiAttribs({greyout:!e});A.setUiAttribs({greyout:!e});T.setUiAttribs({greyout:!e});O.setUiAttribs({greyout:!e});d.setUiAttribs({greyout:!e});b.setUiAttribs({greyout:!p.get()});v.setUiAttribs({greyout:!p.get()});let t=true;t=f.get()&&!d.get();o.setUiAttribs({greyout:t});l.setUiAttribs({greyout:t});u.setUiAttribs({greyout:t})}function y(){a.toggleDefine("VERTEX_COLORS",m.get());a.toggleDefine("CROP_TEXCOORDS",I.get());a.toggleDefine("COLORIZE_TEXTURE",d.get());a.toggleDefine("TRANSFORMALPHATEXCOORDS",v.get());a.toggleDefine("DISCARDTRANS",x.get());a.toggleDefine("BILLBOARD",S.get());a.toggleDefine("ALPHA_MASK_ALPHA",b.get()=="A");a.toggleDefine("ALPHA_MASK_IALPHA",b.get()=="1-A");a.toggleDefine("ALPHA_MASK_IR",b.get()=="1-R");a.toggleDefine("ALPHA_MASK_LUMI",b.get()=="Luminance");a.toggleDefine("ALPHA_MASK_R",b.get()=="R");a.toggleDefine("ALPHA_MASK_G",b.get()=="G");a.toggleDefine("ALPHA_MASK_B",b.get()=="B");N()}}};CABLES.OPS["ec55d252-3843-41b1-b731-0482dbd9e72b"]={f:Ops.Gl.Shader.BasicMaterial_v3,objName:"Ops.Gl.Shader.BasicMaterial_v3"};Ops.Gl.ClearColor=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("render"),r=e.outTrigger("trigger"),n=e.inFloatSlider("r",.1),s=e.inFloatSlider("g",.1),a=e.inFloatSlider("b",.1),o=e.inFloatSlider("a",1);n.setUiAttribs({colorPick:true});const l=e.patch.cgl;i.onTriggered=function(){l.gl.clearColor(n.get(),s.get(),a.get(),o.get());l.gl.clear(l.gl.COLOR_BUFFER_BIT|l.gl.DEPTH_BUFFER_BIT);r.trigger()}}};CABLES.OPS["19b441eb-9f63-4f35-ba08-b87841517c4d"]={f:Ops.Gl.ClearColor,objName:"Ops.Gl.ClearColor"};Ops.Vars.VarSetNumber_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("Value",0);e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"number",i,e.varName)}};CABLES.OPS["b5249226-6095-4828-8a1c-080654e192fa"]={f:Ops.Vars.VarSetNumber_v2,objName:"Ops.Vars.VarSetNumber_v2"};Ops.Vars.VarGetNumber_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.outNumber("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"number",e.varName,i)}};CABLES.OPS["421f5b52-c0fa-47c4-8b7a-012b9e1c864a"]={f:Ops.Vars.VarGetNumber_v2,objName:"Ops.Vars.VarGetNumber_v2"};Ops.Trigger.TriggerOnce=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("Exec"),r=e.inTriggerButton("Reset"),n=e.outTrigger("Next"),s=e.outBoolNum("Was Triggered");let a=false;e.toWorkPortsNeedToBeLinked(i);r.onTriggered=function(){a=false;s.set(a)};i.onTriggered=function(){if(a)return;a=true;n.trigger();s.set(a)}}};CABLES.OPS["cf3544e4-e392-432b-89fd-fcfb5c974388"]={f:Ops.Trigger.TriggerOnce,objName:"Ops.Trigger.TriggerOnce"};Ops.Trigger.TriggerSend=class extends CABLES.Op{constructor(){super(...arguments);const r=this;const e=r.attachments={};const t=r.inTriggerButton("Trigger"),i=r.outTrigger("Next");r.varName=r.inValueSelect("Named Trigger",[],"",true);r.varName.onChange=s;t.onTriggered=a;r.patch.addEventListener("namedTriggersChanged",n);n();r.varName.setUiAttribs({_triggerSelect:true});function n(){if(CABLES.UI){let e=[];const t=r.patch.namedTriggers;e.push("+ create new one");for(const i in t)e.push(i);e=e.sort();r.varName.uiAttribs.values=e}}function s(){if(CABLES.UI){if(r.varName.get()=="+ create new one"){new CABLES.UI.ModalDialog({prompt:true,title:"New Trigger",text:"Enter a name for the new trigger",promptValue:"",promptOk:e=>{r.varName.set(e);r.patch.namedTriggers[e]=r.patch.namedTriggers[e]||[];n()}});return}r.refreshParams()}if(!r.patch.namedTriggers[r.varName.get()]){r.patch.namedTriggers[r.varName.get()]=r.patch.namedTriggers[r.varName.get()]||[];r.patch.emitEvent("namedTriggersChanged")}r.setTitle(">"+r.varName.get());r.refreshParams();r.patch.emitEvent("opTriggerNameChanged",r,r.varName.get())}function a(){const t=r.patch.namedTriggers[r.varName.get()];r.patch.emitEvent("namedTriggerSent",r.varName.get());if(!t){r.setUiError("unknowntrigger","unknown trigger");return}else r.setUiError("unknowntrigger",null);for(let e=0;e<t.length;e++){t[e]()}i.trigger()}}};CABLES.OPS["ce1eaf2b-943b-4dc0-ab5e-ee11b63c9ed0"]={f:Ops.Trigger.TriggerSend,objName:"Ops.Trigger.TriggerSend"};Ops.Trigger.TriggerReceive=class extends CABLES.Op{constructor(){super(...arguments);const r=this;const e=r.attachments={};const t=r.outTrigger("Triggered");r.varName=r.inValueSelect("Named Trigger",[],"",true);r.varName.setUiAttribs({_triggerSelect:true});s();r.patch.addEventListener("namedTriggersChanged",s);let i=null;function n(){t.trigger()}function s(){if(CABLES.UI){let t=[];let i=r.patch.namedTriggers;for(let e in i)t.push(e);t=t.sort();r.varName.uiAttribs.values=t}}r.varName.onChange=function(){if(i){let e=r.patch.namedTriggers[i];let t=e.indexOf(n);if(t!=-1)e.splice(t,1)}r.setTitle(">"+r.varName.get());r.patch.namedTriggers[r.varName.get()]=r.patch.namedTriggers[r.varName.get()]||[];let e=r.patch.namedTriggers[r.varName.get()];e.push(n);i=r.varName.get();a();r.patch.emitEvent("opTriggerNameChanged",r,r.varName.get())};r.on("uiParamPanel",a);function a(){if(!r.varName.get()){r.setUiError("unknowntrigger","unknown trigger")}else r.setUiError("unknowntrigger",null)}}};CABLES.OPS["0816c999-f2db-466b-9777-2814573574c5"]={f:Ops.Trigger.TriggerReceive,objName:"Ops.Trigger.TriggerReceive"};Ops.Gl.LayerSequence=class extends CABLES.Op{constructor(){super(...arguments);const s=this;const e=s.attachments={};const t=s.inTrigger("exe"),i=s.inTriggerButton("Clean up connections");const r=s.patch.cgl,a=[],n=16;let o=null;t.onTriggered=u;i.onTriggered=h;i.setUiAttribs({hidePort:true});i.setUiAttribs({hideParam:true});for(let e=0;e<n;e++){const c=s.outTrigger("trigger "+e);a.push(c);c.onLinkChanged=l}function l(){clearTimeout(o);o=setTimeout(()=>{let t=false;for(let e=0;e<a.length;e++)if(a[e].links.length>1)t=true;i.setUiAttribs({hideParam:!t});if(s.isCurrentUiOp())s.refreshParams()},60)}function u(){for(let e=0;e<a.length;e++){if(a[e].isLinked()){r.gl.clear(r.gl.DEPTH_BUFFER_BIT);a[e].trigger()}}}function h(){let r=0;for(let i=0;i<a.length;i++){let t=[];if(a[i].links.length>1)for(let e=1;e<a[i].links.length;e++){while(a[r].links.length>0)r++;t.push(a[i].links[e]);const n=a[i].links[e].getOtherPort(a[i]);s.patch.link(s,"trigger "+r,n.op,n.name);r++}for(let e=0;e<t.length;e++)t[e].remove()}l()}}};CABLES.OPS["09c33c7e-e282-468d-93e1-b8a7a0a4c4d2"]={f:Ops.Gl.LayerSequence,objName:"Ops.Gl.LayerSequence"};Ops.Vars.VarSetArray_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inArray("Value",null);e.varName=e.inDropDown("Variable",[],"",true);new CABLES.VarSetOpWrapper(e,"array",i,e.varName)}};CABLES.OPS["8088290f-45d4-4312-b4ca-184d34ca4667"]={f:Ops.Vars.VarSetArray_v2,objName:"Ops.Vars.VarSetArray_v2"};Ops.Vars.VarGetArray_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.outArray("Value");e.varName=e.inValueSelect("Variable",[],"",true);new CABLES.VarGetOpWrapper(e,"array",e.varName,i)}};CABLES.OPS["afa79294-aa9c-43bc-a49a-cade000a1de5"]={f:Ops.Vars.VarGetArray_v2,objName:"Ops.Vars.VarGetArray_v2"};Ops.Array.Array1toX=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const s=e.inArray("Array1x"),r=e.inSwitch("Format",["AB","ABC","ABCD"],"ABC"),n=e.inSwitch("A",["Input","index","0-1","-1-1","0","1"],"Input"),a=e.inSwitch("B",["Input","index","0-1","-1-1","0","1"],"0-1"),o=e.inSwitch("C",["Input","index","0-1","-1-1","0","1"],"0"),l=e.inSwitch("D",["Input","index","0-1","-1-1","0","1"],"0"),u=e.outArray("Array3x"),h=e.outNumber("Total points"),c=e.outNumber("Array length");const f=[];n.onChange=a.onChange=o.onChange=l.onChange=s.onChange=x;r.onChange=i;function i(){o.setUiAttribs({greyout:r.get().length<3});l.setUiAttribs({greyout:r.get().length<4});x()}function g(t,i,r){for(let e=0;e<i;e+=r){f[e+t]=0}}function d(t,i,r){for(let e=0;e<i;e+=r){f[e+t]=1}}function m(t,i,r){const n=s.get();for(let e=0;e<i;e+=r){f[e+t]=n[e/r]}}function p(t,i,r){for(let e=0;e<i;e+=r){f[e+t]=e/i*2-1||0}}function _(t,i,r){for(let e=0;e<i;e+=r){f[e+t]=e/i||0}}function b(t,i,r){for(let e=0;e<i;e+=r){f[e+t]=e/r}}function v(e,t,i){if(t=="0")g(e,f.length,i);if(t=="0-1")p(e,f.length,i);if(t=="1")d(e,f.length,i);if(t=="-1-1")_(e,f.length,i);if(t=="Input")m(e,f.length,i);if(t=="index")b(e,f.length,i)}function x(){const e=s.get();if(!e){u.set(null);h.set(0);c.set(0);return}const t=r.get().length;const i=e.length*t;f.length=i;if(t>=2)v(0,n.get(),t);if(t>=2)v(1,a.get(),t);if(t>=3)v(2,o.get(),t);if(t>=4)v(3,l.get(),t);u.setUiAttribs({stride:t});u.setRef(f);h.set(f.length/t);c.set(f.length)}}};CABLES.OPS["6a8947be-79c8-4998-9853-1e0912654800"]={f:Ops.Array.Array1toX,objName:"Ops.Array.Array1toX"};Ops.Number.SwitchNumberMultiPort=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inInt("Index",0),r=e.inMultiPort("Numbers",CABLES.OP_PORT_TYPE_NUMBER),n=e.outNumber("Number"),s=e.outNumber("Num Values");i.onChange=r.onChange=()=>{const e=r.get();const t=Math.ceil(Math.min(e.length-1,Math.max(0,i.get())));n.set(e[t].get());s.set(e.length)}}};CABLES.OPS["6061c7ae-ac4b-45e7-ba7c-06b14ada2f19"]={f:Ops.Number.SwitchNumberMultiPort,objName:"Ops.Number.SwitchNumberMultiPort"};Ops.Sidebar.Toggle_v4=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inObject("link"),r=t.inString("Text","Toggle"),n=t.inBool("Input",true),s=t.inTriggerButton("Set Default"),a=t.inBool("Default"),o=t.inBool("Grey Out",false),l=t.inBool("Visible",true),u=t.outObject("childs"),h=t.outBoolNum("Value",a.get()),c=t.outTrigger("Toggled");a.setUiAttribs({hidePort:true,greyout:true});const f="sidebar__toggle--active";const g=document.createElement("div");g.dataset.op=t.id;g.classList.add("cablesEle");g.classList.add("sidebar__item");g.classList.add("sidebar__toggle");g.classList.add("sidebar__reloadable");g.classList.add(f);const d=document.createTextNode(r.get());const m=document.createElement("div");m.classList.add("sidebar__item-label");m.appendChild(d);const p=document.createElement("a");h.set(a.get());p.classList.add("icon_toggle");p.addEventListener("click",A);p.addEventListener("keypress",E);p.setAttribute("tabindex",0);p.setAttribute("aria-label","toggle "+r.get());const _=document.createElement("div");_.classList.add("sidebar__greyout");_.style.display="none";g.appendChild(_);g.appendChild(p);g.appendChild(m);g.addEventListener("dblclick",b);t.init=()=>{b();x()};t.onDelete=C;i.onChange=I;r.onChange=O;n.onChange=T;s.onTriggered=v;function b(){h.set(a.get());n.set(a.get());c.trigger()}function v(){const e=n.get();a.set(e);h.set(e);c.trigger();t.refreshParams()}function x(){const e=h.get();if(e){p.classList.add("icon_toggle_true");p.classList.remove("icon_toggle_false")}else{p.classList.remove("icon_toggle_true");p.classList.add("icon_toggle_false")}}function E(e){if(e.code==="Enter")A()}function A(){g.classList.toggle(f);const e=g.classList.contains(f);h.set(e);n.set(e);x();c.trigger();t.refreshParams()}function T(){if(n.get())g.classList.add(f);else g.classList.remove(f);h.set(n.get());c.trigger()}function O(){const e=r.get();m.textContent=e;p.setAttribute("aria-label","toggle "+r.get());if(CABLES.UI)t.setUiAttrib({extendTitle:e})}function I(){u.set(null);const e=i.get();if(e&&e.parentElement){e.parentElement.appendChild(g);u.set(e)}else if(g.parentElement)g.parentElement.removeChild(g)}function S(e){if(e)e.style.display="block"}function M(e){if(e)e.style.display="none"}function C(){if(g&&g.parentNode&&g.parentNode.removeChild)g.parentNode.removeChild(g)}o.onChange=function(){_.style.display=o.get()?"block":"none"};l.onChange=function(){g.style.display=l.get()?"block":"none"}}};CABLES.OPS["247f5aaf-6438-4a37-9649-4c0fe9cc78c9"]={f:Ops.Sidebar.Toggle_v4,objName:"Ops.Sidebar.Toggle_v4"};Ops.Sidebar.Sidebar=class extends CABLES.Op{constructor(){super(...arguments);const a=this;const i=a.attachments={style_css:" /*\n * SIDEBAR\n  http://danielstern.ca/range.css/#/\n  https://developer.mozilla.org/en-US/docs/Web/CSS/::-webkit-progress-value\n */\n\n.sidebar-icon-undo\n{\n    width:10px;\n    height:10px;\n    background-image: url(\"data:image/svg+xml;charset=utf8, %3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='none' stroke='grey' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M3 7v6h6'/%3E%3Cpath d='M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13'/%3E%3C/svg%3E\");\n    background-size: 19px;\n    background-repeat: no-repeat;\n    top: -19px;\n    margin-top: -7px;\n}\n\n.icon-chevron-down {\n    top: 2px;\n    right: 9px;\n}\n\n.iconsidebar-chevron-up,.sidebar__close-button {\n\tbackground-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tdXAiPjxwb2x5bGluZSBwb2ludHM9IjE4IDE1IDEyIDkgNiAxNSI+PC9wb2x5bGluZT48L3N2Zz4=);\n}\n\n.iconsidebar-minimizebutton {\n    background-position: 98% center;\n    background-repeat: no-repeat;\n}\n\n.sidebar-cables-right\n{\n    right: 15px;\n    left: initial !important;\n}\n\n.sidebar-cables *\n{\n    color: #BBBBBB !important;\n    font-family: Arial;\n}\n\n.sidebar-cables {\n    --sidebar-color: #07f78c;\n    --sidebar-width: 220px;\n    --sidebar-border-radius: 10px;\n    --sidebar-monospace-font-stack: \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n    --sidebar-hover-transition-time: .2s;\n\n    position: absolute;\n    top: 15px;\n    left: 15px;\n    border-radius: var(--sidebar-border-radius);\n    z-index: 100000;\n    width: var(--sidebar-width);\n    max-height: 100%;\n    box-sizing: border-box;\n    overflow-y: auto;\n    overflow-x: hidden;\n    font-size: 13px;\n    line-height: 1em; /* prevent emojis from breaking height of the title */\n}\n\n.sidebar-cables::selection {\n    background-color: var(--sidebar-color);\n    color: #EEEEEE;\n}\n\n.sidebar-cables::-webkit-scrollbar {\n    background-color: transparent;\n    --cables-scrollbar-width: 8px;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables::-webkit-scrollbar-track {\n    background-color: transparent;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables::-webkit-scrollbar-thumb {\n    background-color: #333333;\n    border-radius: 4px;\n    width: var(--cables-scrollbar-width);\n}\n\n.sidebar-cables--closed {\n    width: auto;\n}\n\n.sidebar__close-button {\n    background-color: #222;\n    /*-webkit-user-select: none;  */\n    /*-moz-user-select: none;     */\n    /*-ms-user-select: none;      */\n    /*user-select: none;          */\n    /*transition: background-color var(--sidebar-hover-transition-time);*/\n    /*color: #CCCCCC;*/\n    height: 2px;\n    /*border-bottom:20px solid #222;*/\n\n    /*box-sizing: border-box;*/\n    /*padding-top: 2px;*/\n    /*text-align: center;*/\n    /*cursor: pointer;*/\n    /*border-radius: 0 0 var(--sidebar-border-radius) var(--sidebar-border-radius);*/\n    /*opacity: 1.0;*/\n    /*transition: opacity 0.3s;*/\n    /*overflow: hidden;*/\n}\n\n.sidebar__close-button-icon {\n    display: inline-block;\n    /*opacity: 0;*/\n    width: 20px;\n    height: 20px;\n    /*position: relative;*/\n    /*top: -1px;*/\n\n\n}\n\n.sidebar--closed {\n    width: auto;\n    margin-right: 20px;\n}\n\n.sidebar--closed .sidebar__close-button {\n    margin-top: 8px;\n    margin-left: 8px;\n    padding:10px;\n\n    height: 25px;\n    width:25px;\n    border-radius: 50%;\n    cursor: pointer;\n    opacity: 0.3;\n    background-repeat: no-repeat;\n    background-position: center center;\n    transform:rotate(180deg);\n}\n\n.sidebar--closed .sidebar__group\n{\n    display:none;\n\n}\n.sidebar--closed .sidebar__close-button-icon {\n    background-position: 0px 0px;\n}\n\n.sidebar__close-button:hover {\n    background-color: #111111;\n    opacity: 1.0 !important;\n}\n\n/*\n * SIDEBAR ITEMS\n */\n\n.sidebar__items {\n    /* max-height: 1000px; */\n    /* transition: max-height 0.5;*/\n    background-color: #222;\n    padding-bottom: 20px;\n}\n\n.sidebar--closed .sidebar__items {\n    /* max-height: 0; */\n    height: 0;\n    display: none;\n    pointer-interactions: none;\n}\n\n.sidebar__item__right {\n    float: right;\n}\n\n/*\n * SIDEBAR GROUP\n */\n\n.sidebar__group {\n    /*background-color: #1A1A1A;*/\n    overflow: hidden;\n    box-sizing: border-box;\n    animate: height;\n    /*background-color: #151515;*/\n    /* max-height: 1000px; */\n    /* transition: max-height 0.5s; */\n--sidebar-group-header-height: 33px;\n}\n\n.sidebar__group-items\n{\n    padding-top: 15px;\n    padding-bottom: 15px;\n}\n\n.sidebar__group--closed {\n    /* max-height: 13px; */\n    height: var(--sidebar-group-header-height);\n}\n\n.sidebar__group-header {\n    box-sizing: border-box;\n    color: #EEEEEE;\n    background-color: #151515;\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n\n    /*height: 100%;//var(--sidebar-group-header-height);*/\n\n    padding-top: 7px;\n    text-transform: uppercase;\n    letter-spacing: 0.08em;\n    cursor: pointer;\n    /*transition: background-color var(--sidebar-hover-transition-time);*/\n    position: relative;\n}\n\n.sidebar__group-header:hover {\n  background-color: #111111;\n}\n\n.sidebar__group-header-title {\n  /*float: left;*/\n  overflow: hidden;\n  padding: 0 15px;\n  padding-top:5px;\n  padding-bottom:10px;\n  font-weight:bold;\n}\n\n.sidebar__group-header-undo {\n    float: right;\n    overflow: hidden;\n    padding-right: 15px;\n    padding-top:5px;\n    font-weight:bold;\n  }\n\n.sidebar__group-header-icon {\n    width: 17px;\n    height: 14px;\n    background-repeat: no-repeat;\n    display: inline-block;\n    position: absolute;\n    background-size: cover;\n\n    /* icon open */\n    /* feather icon: chevron up */\n    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tdXAiPjxwb2x5bGluZSBwb2ludHM9IjE4IDE1IDEyIDkgNiAxNSI+PC9wb2x5bGluZT48L3N2Zz4=);\n    top: 4px;\n    right: 5px;\n    opacity: 0.0;\n    transition: opacity 0.3;\n}\n\n.sidebar__group-header:hover .sidebar__group-header-icon {\n    opacity: 1.0;\n}\n\n/* icon closed */\n.sidebar__group--closed .sidebar__group-header-icon {\n    /* feather icon: chevron down */\n    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tZG93biI+PHBvbHlsaW5lIHBvaW50cz0iNiA5IDEyIDE1IDE4IDkiPjwvcG9seWxpbmU+PC9zdmc+);\n    top: 4px;\n    right: 5px;\n}\n\n/*\n * SIDEBAR ITEM\n */\n\n.sidebar__item\n{\n    box-sizing: border-box;\n    padding: 7px;\n    padding-left:15px;\n    padding-right:15px;\n\n    overflow: hidden;\n    position: relative;\n}\n\n.sidebar__item-label {\n    display: inline-block;\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    width: calc(50% - 7px);\n    margin-right: 7px;\n    margin-top: 2px;\n    text-overflow: ellipsis;\n    /* overflow: hidden; */\n}\n\n.sidebar__item-value-label {\n    font-family: var(--sidebar-monospace-font-stack);\n    display: inline-block;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n    max-width: 60%;\n}\n\n.sidebar__item-value-label::selection {\n    background-color: var(--sidebar-color);\n    color: #EEEEEE;\n}\n\n.sidebar__item + .sidebar__item,\n.sidebar__item + .sidebar__group,\n.sidebar__group + .sidebar__item,\n.sidebar__group + .sidebar__group {\n    /*border-top: 1px solid #272727;*/\n}\n\n/*\n * SIDEBAR ITEM TOGGLE\n */\n\n/*.sidebar__toggle */\n.icon_toggle{\n    cursor: pointer;\n}\n\n.sidebar__toggle-input {\n    --sidebar-toggle-input-color: #CCCCCC;\n    --sidebar-toggle-input-color-hover: #EEEEEE;\n    --sidebar-toggle-input-border-size: 2px;\n    display: inline;\n    float: right;\n    box-sizing: border-box;\n    border-radius: 50%;\n    /*outline-style: solid;*/\n    /*outline-color:red;*/\n    cursor: pointer;\n    --toggle-size: 11px;\n    margin-top: 2px;\n    background-color: transparent !important;\n    border: var(--sidebar-toggle-input-border-size) solid var(--sidebar-toggle-input-color);\n    width: var(--toggle-size);\n    height: var(--toggle-size);\n    transition: background-color var(--sidebar-hover-transition-time);\n    transition: border-color var(--sidebar-hover-transition-time);\n}\n.sidebar__toggle:hover .sidebar__toggle-input {\n    border-color: var(--sidebar-toggle-input-color-hover);\n}\n\n.sidebar__toggle .sidebar__item-value-label {\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    max-width: calc(50% - 12px);\n}\n.sidebar__toggle-input::after { clear: both; }\n\n.sidebar__toggle--active .icon_toggle\n{\n\n    background-image: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE1cHgiIHdpZHRoPSIzMHB4IiBmaWxsPSIjMDZmNzhiIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzA2Zjc4YiIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCBjMTIuNjUsMCwyMy0xMC4zNSwyMy0yM2wwLDBjMC0xMi42NS0xMC4zNS0yMy0yMy0yM0gzMHogTTcwLDY3Yy05LjM4OSwwLTE3LTcuNjEtMTctMTdzNy42MTEtMTcsMTctMTdzMTcsNy42MSwxNywxNyAgICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PC9nPjwvZz48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMweiBNNzAsNjdjLTkuMzg5LDAtMTctNy42MS0xNy0xN3M3LjYxMS0xNywxNy0xN3MxNyw3LjYxLDE3LDE3ICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48cGF0aCBmaWxsPSIjMDZmNzhiIiBzdHJva2U9IiMwNmY3OGIiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNyw1MGMwLDEyLjY1LDEwLjM1LDIzLDIzLDIzaDQwICAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMwQzE3LjM1LDI3LDcsMzcuMzUsNyw1MEw3LDUweiI+PC9wYXRoPjwvZz48Y2lyY2xlIGRpc3BsYXk9ImlubGluZSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiMwNmY3OGIiIHN0cm9rZT0iIzA2Zjc4YiIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSI3MCIgY3k9IjUwIiByPSIxNyI+PC9jaXJjbGU+PC9nPjxnIGRpc3BsYXk9Im5vbmUiPjxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0iTTcwLDI1SDMwQzE2LjIxNSwyNSw1LDM2LjIxNSw1LDUwczExLjIxNSwyNSwyNSwyNWg0MGMxMy43ODUsMCwyNS0xMS4yMTUsMjUtMjVTODMuNzg1LDI1LDcwLDI1eiBNNzAsNzEgICBIMzBDMTguNDIxLDcxLDksNjEuNTc5LDksNTBzOS40MjEtMjEsMjEtMjFoNDBjMTEuNTc5LDAsMjEsOS40MjEsMjEsMjFTODEuNTc5LDcxLDcwLDcxeiBNNzAsMzFjLTEwLjQ3NywwLTE5LDguNTIzLTE5LDE5ICAgczguNTIzLDE5LDE5LDE5czE5LTguNTIzLDE5LTE5UzgwLjQ3NywzMSw3MCwzMXogTTcwLDY1Yy04LjI3MSwwLTE1LTYuNzI5LTE1LTE1czYuNzI5LTE1LDE1LTE1czE1LDYuNzI5LDE1LDE1Uzc4LjI3MSw2NSw3MCw2NXoiPjwvcGF0aD48L2c+PC9zdmc+);\n    opacity: 1;\n    transform: rotate(0deg);\n    background-position: -4px -9px;\n}\n\n\n.icon_toggle\n{\n    float: right;\n    width:40px;\n    height:18px;\n    background-image: url(data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE1cHgiIHdpZHRoPSIzMHB4IiBmaWxsPSIjYWFhYWFhIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI2FhYWFhYSIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCBjMTIuNjUsMCwyMy0xMC4zNSwyMy0yM2wwLDBjMC0xMi42NS0xMC4zNS0yMy0yMy0yM0gzMHogTTcwLDY3Yy05LjM4OSwwLTE3LTcuNjEtMTctMTdzNy42MTEtMTcsMTctMTdzMTcsNy42MSwxNywxNyAgICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PC9nPjwvZz48Zz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTMwLDI3QzE3LjM1LDI3LDcsMzcuMzUsNyw1MGwwLDBjMCwxMi42NSwxMC4zNSwyMywyMywyM2g0MCAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMweiBNNzAsNjdjLTkuMzg5LDAtMTctNy42MS0xNy0xN3M3LjYxMS0xNywxNy0xN3MxNyw3LjYxLDE3LDE3ICAgUzc5LjM4OSw2Nyw3MCw2N3oiPjwvcGF0aD48L2c+PGcgZGlzcGxheT0ibm9uZSI+PGcgZGlzcGxheT0iaW5saW5lIj48cGF0aCBmaWxsPSIjYWFhYWFhIiBzdHJva2U9IiNhYWFhYWEiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBkPSJNNyw1MGMwLDEyLjY1LDEwLjM1LDIzLDIzLDIzaDQwICAgIGMxMi42NSwwLDIzLTEwLjM1LDIzLTIzbDAsMGMwLTEyLjY1LTEwLjM1LTIzLTIzLTIzSDMwQzE3LjM1LDI3LDcsMzcuMzUsNyw1MEw3LDUweiI+PC9wYXRoPjwvZz48Y2lyY2xlIGRpc3BsYXk9ImlubGluZSIgZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiNhYWFhYWEiIHN0cm9rZT0iI2FhYWFhYSIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGN4PSI3MCIgY3k9IjUwIiByPSIxNyI+PC9jaXJjbGU+PC9nPjxnIGRpc3BsYXk9Im5vbmUiPjxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0iTTcwLDI1SDMwQzE2LjIxNSwyNSw1LDM2LjIxNSw1LDUwczExLjIxNSwyNSwyNSwyNWg0MGMxMy43ODUsMCwyNS0xMS4yMTUsMjUtMjVTODMuNzg1LDI1LDcwLDI1eiBNNzAsNzEgICBIMzBDMTguNDIxLDcxLDksNjEuNTc5LDksNTBzOS40MjEtMjEsMjEtMjFoNDBjMTEuNTc5LDAsMjEsOS40MjEsMjEsMjFTODEuNTc5LDcxLDcwLDcxeiBNNzAsMzFjLTEwLjQ3NywwLTE5LDguNTIzLTE5LDE5ICAgczguNTIzLDE5LDE5LDE5czE5LTguNTIzLDE5LTE5UzgwLjQ3NywzMSw3MCwzMXogTTcwLDY1Yy04LjI3MSwwLTE1LTYuNzI5LTE1LTE1czYuNzI5LTE1LDE1LTE1czE1LDYuNzI5LDE1LDE1Uzc4LjI3MSw2NSw3MCw2NXoiPjwvcGF0aD48L2c+PC9zdmc+);\n    background-size: 50px 37px;\n    background-position: -6px -10px;\n    transform: rotate(180deg);\n    opacity: 0.4;\n}\n\n\n\n/*.sidebar__toggle--active .sidebar__toggle-input {*/\n/*    transition: background-color var(--sidebar-hover-transition-time);*/\n/*    background-color: var(--sidebar-toggle-input-color);*/\n/*}*/\n/*.sidebar__toggle--active .sidebar__toggle-input:hover*/\n/*{*/\n/*    background-color: var(--sidebar-toggle-input-color-hover);*/\n/*    border-color: var(--sidebar-toggle-input-color-hover);*/\n/*    transition: background-color var(--sidebar-hover-transition-time);*/\n/*    transition: border-color var(--sidebar-hover-transition-time);*/\n/*}*/\n\n/*\n * SIDEBAR ITEM BUTTON\n */\n\n.sidebar__button {}\n\n.sidebar__button-input:active\n{\n    background-color: #555 !important;\n}\n\n.sidebar__button-input {\n    -webkit-user-select: none;  /* Chrome all / Safari all */\n    -moz-user-select: none;     /* Firefox all */\n    -ms-user-select: none;      /* IE 10+ */\n    user-select: none;          /* Likely future */\n    min-height: 24px;\n    background-color: transparent;\n    color: #CCCCCC;\n    box-sizing: border-box;\n    padding-top: 3px;\n    text-align: center;\n    border-radius: 125px;\n    border:2px solid #555;\n    cursor: pointer;\n    padding-bottom: 3px;\n    display:block;\n}\n\n.sidebar__button-input.plus, .sidebar__button-input.minus {\n    display: inline-block;\n    min-width: 20px;\n}\n\n.sidebar__button-input:hover {\n  background-color: #333;\n  border:2px solid var(--sidebar-color);\n}\n\n/*\n * VALUE DISPLAY (shows a value)\n */\n\n.sidebar__value-display {}\n\n/*\n * SLIDER\n */\n\n.sidebar__slider {\n    --sidebar-slider-input-height: 3px;\n}\n\n.sidebar__slider-input-wrapper {\n    width: 100%;\n\n    margin-top: 8px;\n    position: relative;\n}\n\n.sidebar__slider-input {\n    -webkit-appearance: none;\n    appearance: none;\n    margin: 0;\n    width: 100%;\n    height: var(--sidebar-slider-input-height);\n    background: #555;\n    cursor: pointer;\n    /*outline: 0;*/\n\n    -webkit-transition: .2s;\n    transition: background-color .2s;\n    border: none;\n}\n\n.sidebar__slider-input:focus, .sidebar__slider-input:hover {\n    border: none;\n}\n\n.sidebar__slider-input-active-track {\n    user-select: none;\n    position: absolute;\n    z-index: 11;\n    top: 0;\n    left: 0;\n    background-color: var(--sidebar-color);\n    pointer-events: none;\n    height: var(--sidebar-slider-input-height);\n    max-width: 100%;\n}\n\n/* Mouse-over effects */\n.sidebar__slider-input:hover {\n    /*background-color: #444444;*/\n}\n\n/*.sidebar__slider-input::-webkit-progress-value {*/\n/*    background-color: green;*/\n/*    color:green;*/\n\n/*    }*/\n\n/* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */\n\n.sidebar__slider-input::-moz-range-thumb\n{\n    position: absolute;\n    height: 15px;\n    width: 15px;\n    z-index: 900 !important;\n    border-radius: 20px !important;\n    cursor: pointer;\n    background: var(--sidebar-color) !important;\n    user-select: none;\n\n}\n\n.sidebar__slider-input::-webkit-slider-thumb\n{\n    position: relative;\n    appearance: none;\n    -webkit-appearance: none;\n    user-select: none;\n    height: 15px;\n    width: 15px;\n    display: block;\n    z-index: 900 !important;\n    border: 0;\n    border-radius: 20px !important;\n    cursor: pointer;\n    background: #777 !important;\n}\n\n.sidebar__slider-input:hover ::-webkit-slider-thumb {\n    background-color: #EEEEEE !important;\n}\n\n/*.sidebar__slider-input::-moz-range-thumb {*/\n\n/*    width: 0 !important;*/\n/*    height: var(--sidebar-slider-input-height);*/\n/*    background: #EEEEEE;*/\n/*    cursor: pointer;*/\n/*    border-radius: 0 !important;*/\n/*    border: none;*/\n/*    outline: 0;*/\n/*    z-index: 100 !important;*/\n/*}*/\n\n.sidebar__slider-input::-moz-range-track {\n    background-color: transparent;\n    z-index: 11;\n}\n\n.sidebar__slider input[type=text],\n.sidebar__slider input[type=paddword]\n{\n    box-sizing: border-box;\n    /*background-color: #333333;*/\n    text-align: right;\n    color: #BBBBBB;\n    display: inline-block;\n    background-color: transparent !important;\n\n    width: 40%;\n    height: 18px;\n    /*outline: none;*/\n    border: none;\n    border-radius: 0;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n}\n\n.sidebar__slider input[type=text]:active,\n.sidebar__slider input[type=text]:focus,\n.sidebar__slider input[type=text]:hover,\n.sidebar__slider input[type=password]:active,\n.sidebar__slider input[type=password]:focus,\n.sidebar__slider input[type=password]:hover\n{\n\n    color: #EEEEEE;\n}\n\n/*\n * TEXT / DESCRIPTION\n */\n\n.sidebar__text .sidebar__item-label {\n    width: auto;\n    display: block;\n    max-height: none;\n    margin-right: 0;\n    line-height: 1.1em;\n}\n\n/*\n * SIDEBAR INPUT\n */\n.sidebar__text-input textarea,\n.sidebar__text-input input[type=date],\n.sidebar__text-input input[type=datetime-local],\n.sidebar__text-input input[type=text],\n.sidebar__text-input input[type=search],\n.sidebar__text-input input[type=password] {\n    box-sizing: border-box;\n    background-color: #333333;\n    color: #BBBBBB;\n    display: inline-block;\n    width: 50%;\n    height: 18px;\n\n\n    border: none;\n    border-radius: 0;\n    border:1px solid #666;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n    color-scheme: dark;\n}\n\n.sidebar__text-input textarea:focus::placeholder {\n  color: transparent;\n}\n\n\n\n\n\n.sidebar__color-picker .sidebar__item-label\n{\n    width:45%;\n}\n\n.sidebar__text-input textarea,\n.sidebar__text-input input[type=text]:active,\n.sidebar__text-input input[type=text]:focus,\n.sidebar__text-input input[type=text]:hover,\n.sidebar__text-input input[type=search]:active,\n.sidebar__text-input input[type=search]:focus,\n.sidebar__text-input input[type=search]:hover,\n.sidebar__text-input input[type=password]:active,\n.sidebar__text-input input[type=password]:focus,\n.sidebar__text-input input[type=password]:hover {\n    background-color: transparent;\n    color: #EEEEEE;\n\n}\n\n.sidebar__text-input textarea\n{\n    margin-top:10px;\n    height:60px;\n    width:100%;\n}\n\n/*\n * SIDEBAR SELECT\n */\n\n\n\n .sidebar__select {}\n .sidebar__select-select {\n    color: #BBBBBB;\n    /*-webkit-appearance: none;*/\n    /*-moz-appearance: none;*/\n    appearance: none;\n    /*box-sizing: border-box;*/\n    width: 50%;\n    /*height: 20px;*/\n    background-color: #333333;\n    /*background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM4ODg4ODgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0iZmVhdGhlciBmZWF0aGVyLWNoZXZyb24tZG93biI+PHBvbHlsaW5lIHBvaW50cz0iNiA5IDEyIDE1IDE4IDkiPjwvcG9seWxpbmU+PC9zdmc+);*/\n    background-repeat: no-repeat;\n    background-position: right center;\n    background-size: 16px 16px;\n    margin: 0;\n    /*padding: 0 2 2 6px;*/\n    border-radius: 5px;\n    border: 1px solid #777;\n    background-color: #444;\n    cursor: pointer;\n    /*outline: none;*/\n    padding-left: 5px;\n\n }\n\n.sidebar__select-select:hover,\n.sidebar__select-select:active,\n.sidebar__select-select:inactive {\n    background-color: #444444;\n    color: #EEEEEE;\n}\n\n/*.sidebar__select-select option*/\n/*{*/\n/*    background-color: #444444;*/\n/*    color: #bbb;*/\n/*}*/\n\n.sidebar__select-select option:checked\n{\n    background-color: #000;\n    color: #FFF;\n}\n\n\n/*\n * COLOR PICKER\n */\n\n\n .sidebar__color-picker input[type=text] {\n    box-sizing: border-box;\n    background-color: #333333;\n    color: #BBBBBB;\n    display: inline-block;\n    width: calc(50% - 21px); /* 50% minus space of picker circle */\n    height: 18px;\n    /*outline: none;*/\n    border: none;\n    border-radius: 0;\n    padding: 0 0 0 4px !important;\n    margin: 0;\n    margin-right: 7px;\n}\n\n.sidebar__color-picker input[type=text]:active,\n.sidebar__color-picker input[type=text]:focus,\n.sidebar__color-picker input[type=text]:hover {\n    background-color: #444444;\n    color: #EEEEEE;\n}\n\ndiv.sidebar__color-picker-color-input,\n.sidebar__color-picker input[type=color],\n.sidebar__palette-picker input[type=color] {\n    display: inline-block;\n    border-radius: 100%;\n    height: 14px;\n    width: 14px;\n\n    padding: 0;\n    border: none;\n    /*border:2px solid red;*/\n    border-color: transparent;\n    outline: none;\n    background: none;\n    appearance: none;\n    -moz-appearance: none;\n    -webkit-appearance: none;\n    cursor: pointer;\n    position: relative;\n    top: 3px;\n}\n.sidebar__color-picker input[type=color]:focus,\n.sidebar__palette-picker input[type=color]:focus {\n    outline: none;\n}\n.sidebar__color-picker input[type=color]::-moz-color-swatch,\n.sidebar__palette-picker input[type=color]::-moz-color-swatch {\n    border: none;\n}\n.sidebar__color-picker input[type=color]::-webkit-color-swatch-wrapper,\n.sidebar__palette-picker input[type=color]::-webkit-color-swatch-wrapper {\n    padding: 0;\n}\n.sidebar__color-picker input[type=color]::-webkit-color-swatch,\n.sidebar__palette-picker input[type=color]::-webkit-color-swatch {\n    border: none;\n    border-radius: 100%;\n}\n\n/*\n * Palette Picker\n */\n.sidebar__palette-picker .sidebar__palette-picker-color-input.first {\n    margin-left: 0;\n}\n.sidebar__palette-picker .sidebar__palette-picker-color-input.last {\n    margin-right: 0;\n}\n.sidebar__palette-picker .sidebar__palette-picker-color-input {\n    margin: 0 4px;\n}\n\n.sidebar__palette-picker .circlebutton {\n    width: 14px;\n    height: 14px;\n    border-radius: 1em;\n    display: inline-block;\n    top: 3px;\n    position: relative;\n}\n\n/*\n * Preset\n */\n.sidebar__item-presets-preset\n{\n    padding:4px;\n    cursor:pointer;\n    padding-left:8px;\n    padding-right:8px;\n    margin-right:4px;\n    background-color:#444;\n}\n\n.sidebar__item-presets-preset:hover\n{\n    background-color:#666;\n}\n\n.sidebar__greyout\n{\n    background: #222;\n    opacity: 0.8;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    z-index: 1000;\n    right: 0;\n    top: 0;\n}\n\n.sidebar_tabs\n{\n    background-color: #151515;\n    padding-bottom: 0px;\n}\n\n.sidebar_switchs\n{\n    float: right;\n}\n\n.sidebar_tab\n{\n    float:left;\n    background-color: #151515;\n    border-bottom:1px solid transparent;\n    padding-right:7px;\n    padding-left:7px;\n    padding-bottom: 5px;\n    padding-top: 5px;\n    cursor:pointer;\n}\n\n.sidebar_tab_active\n{\n    background-color: #272727;\n    color:white;\n}\n\n.sidebar_tab:hover\n{\n    border-bottom:1px solid #777;\n    color:white;\n}\n\n\n.sidebar_switch\n{\n    float:left;\n    background-color: #444;\n    padding-right:7px;\n    padding-left:7px;\n    padding-bottom: 5px;\n    padding-top: 5px;\n    cursor:pointer;\n}\n\n.sidebar_switch:last-child\n{\n    border-top-right-radius: 7px;\n    border-bottom-right-radius: 7px;\n}\n\n.sidebar_switch:first-child\n{\n    border-top-left-radius: 7px;\n    border-bottom-left-radius: 7px;\n}\n\n\n.sidebar_switch_active\n{\n    background-color: #999;\n    color:white;\n}\n\n.sidebar_switch:hover\n{\n    color:white;\n}\n\n.sidebar__text-input-input::focus-visible,\n/*.sidebar__text-input-input:active,*/\n.sidebar__button-input:focus-visible,\n.sidebar__text-input:focus-visible\n/*.sidebar__text-input:active*/\n{\n    outline-style: solid;\n    outline-color:white;\n    outline-width: 1px;\n\n}\n\n"};const r="cables-sidebar-style";const n="cables-sidebar-dynamic-style";const o="sidebar-cables";const l="sidebar"+CABLES.uuid();const u="sidebar__items";const h="sidebar__close-button";const s="";const c="";let f=null;let F=null;let g=null;const e=a.inValueBool("Visible",true);const t=a.inValueSlider("Opacity",1);const d=a.inValueBool("Default Minimized");const m=a.inValueSlider("Minimized Opacity",.5);const p=a.inValueBool("Show undo button",false);const _=a.inValueBool("Show Minimize",false);const b=a.inString("Title","");const v=a.inValueBool("Side");const x=a.inValueBool("Default CSS",true);let E=a.patch.cgl.canvas.ownerDocument;const A=a.outObject("childs");A.setUiAttribs({title:"Children"});const T=a.outBool("Opfened");T.setUiAttribs({title:"Opened"});let O=E.querySelector("."+l);if(!O)O=D();const I=O.querySelector("."+u);A.set({parentElement:I,parentOp:a});N();w();P();x.onChange=()=>{w();P()};e.onChange=k;t.onChange=y;d.onChange=N;m.onChange=S;p.onChange=C;a.onDelete=B;function S(){P()}_.onChange=M;function M(e){if(!e||e.uiAttribs)e=E.querySelector(".sidebar-cables .sidebar__group-header");if(!e)return;const t=E.querySelector(".sidebar-cables .sidebar__group-header .sidebar__group-header-undo");if(_.get()){e.classList.add("iconsidebar-chevron-up");e.classList.add("iconsidebar-minimizebutton");if(t)t.style.marginRight="20px"}else{e.classList.remove("iconsidebar-chevron-up");e.classList.remove("iconsidebar-minimizebutton");if(t)t.style.marginRight="initial"}}v.onChange=function(){if(!O)return;if(v.get())O.classList.add("sidebar-cables-right");else O.classList.remove("sidebar-cables-right")};function C(){const e=E.querySelector(".sidebar-cables .sidebar__group-header");if(e){R(e)}}function R(e){if(e){const t=E.querySelector(".sidebar-cables .sidebar__group-header .sidebar__group-header-undo");if(t){if(!p.get()){t.remove()}}else{if(p.get()){const i=E.createElement("span");i.classList.add("sidebar__group-header-undo");i.classList.add("sidebar-icon-undo");i.addEventListener("click",function(e){e.stopPropagation();const t=E.querySelectorAll(".sidebar-cables .sidebar__reloadable");const i=E.createEvent("MouseEvents");i.initEvent("dblclick",true,true);t.forEach(e=>{e.dispatchEvent(i)})});e.appendChild(i)}}}M(e)}function N(){if(!f){return}if(d.get()){O.classList.add("sidebar--closed");if(e.get())T.set(false)}else{O.classList.remove("sidebar--closed");if(e.get())T.set(true)}}function y(){const e=t.get();O.style.opacity=e}function k(){if(!O)return;if(e.get()){O.style.display="block";if(!O.classList.contains("sidebar--closed"))T.set(true)}else{O.style.display="none";T.set(false)}}v.onChanged=function(){};function P(){const e=E.querySelectorAll("."+n);if(e){e.forEach(function(e){e.parentNode.removeChild(e)})}if(!x.get())return;const t=E.createElement("style");t.classList.add("cablesEle");t.classList.add(n);let i=".sidebar--closed .sidebar__close-button { ";i+="opacity: "+m.get();i+="}";const r=E.createTextNode(i);t.appendChild(r);E.body.appendChild(t)}function D(){const e=E.createElement("div");e.classList.add(o);e.classList.add(l);const t=a.patch.cgl.canvas.parentElement;const i=E.createElement("div");i.classList.add("sidebar__group");e.appendChild(i);const r=E.createElement("div");r.classList.add("sidebar__group-header");e.appendChild(r);const n=E.createElement("span");n.classList.add("sidebar__group-header-title");g=E.createElement("span");g.classList.add("sidebar__group-header-title-text");g.innerHTML=b.get();n.appendChild(g);r.appendChild(n);R(r);M(r);i.appendChild(r);e.appendChild(i);i.addEventListener("click",L);if(!t){a.warn("[sidebar] no canvas parentelement found...");return}t.appendChild(e);const s=E.createElement("div");s.classList.add(u);e.appendChild(s);f=E.createElement("div");f.classList.add(h);f.addEventListener("click",L);e.appendChild(f);return e}b.onChange=function(){if(g)g.innerHTML=b.get()};function U(e){}function L(e){e.stopPropagation();if(!O){a.logError("Sidebar could not be closed...");return}O.classList.toggle("sidebar--closed");const t=e.target;let i=s;if(O.classList.contains("sidebar--closed")){i=c;T.set(false)}else{T.set(true)}}function w(){const e=E.querySelectorAll("."+r);if(e){e.forEach(e=>{e.parentNode.removeChild(e)})}if(!x.get())return;const t=E.createElement("style");t.innerHTML=i.style_css;t.classList.add(r);t.classList.add("cablesEle");E.body.appendChild(t)}function B(){V(O)}function V(e){if(e&&e.parentNode&&e.parentNode.removeChild)e.parentNode.removeChild(e)}}};CABLES.OPS["5a681c35-78ce-4cb3-9858-bc79c34c6819"]={f:Ops.Sidebar.Sidebar,objName:"Ops.Sidebar.Sidebar"};Ops.Math.Sign=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const r=e.inValue("Value"),n=e.inBool("Remove zero",false),s=e.outNumber("Result");r.onChange=function(){let e=0;let t=r.get()*999;let i=n.get();if(!i){e=Math.round(Math.max(Math.min(t,1),-1))}else{e=t<0?-1:1}s.set(e)}}};CABLES.OPS["a0d6ed0e-9b6b-4d84-a599-882feeadd769"]={f:Ops.Math.Sign,objName:"Ops.Math.Sign"};Ops.Math.Interpolate=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inFloat("Value 1"),r=e.inFloat("Value 2"),n=e.inFloatSlider("Percentage"),s=e.outNumber("Result");i.onChange=r.onChange=n.onChange=a;function a(){s.set((r.get()-i.get())*n.get()+i.get())}}};CABLES.OPS["d126e2c8-221e-428f-8ff4-8b8c5f6b8905"]={f:Ops.Math.Interpolate,objName:"Ops.Math.Interpolate"};Ops.Ui.VizNumber=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inFloat("Number",0);const r=t.outNumber("Result");t.setUiAttrib({widthOnlyGrow:true});i.onChange=n;n();function n(){let e=i.get();t.setUiAttribs({extendTitle:i.getValueForDisplay()});r.set(e)}}};CABLES.OPS["2b60d12d-2884-4ad0-bda4-0caeb6882f5c"]={f:Ops.Ui.VizNumber,objName:"Ops.Ui.VizNumber"};Ops.Gl.FaceCulling_v2=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i="Front Sides",r="Back Sides",n="All",s=t.inTrigger("render"),a=t.outTrigger("trigger"),o=t.inSwitch("Discard",[r,i,n],r),l=t.inValueBool("Active",true),u=t.patch.cgl;t.setPortGroup("Face Fulling",[l,o]);let h=u.gl.BACK;let c=true;s.onTriggered=function(){const e=t.patch.cg;if(!e)return;if(c){h=e.CULL_MODES[CABLES.CG.CULL_BACK];if(o.get()==i)h=e.CULL_MODES[CABLES.CG.CULL_FRONT];else if(o.get()==n)h=e.CULL_MODES[CABLES.CG.CULL_BOTH]}e.pushCullFace(l.get());e.pushCullFaceFacing(h);a.trigger();e.popCullFace();e.popCullFaceFacing()};l.onChange=()=>{o.setUiAttribs({greyout:!l.get()})};o.onChange=()=>{c=true}}};CABLES.OPS["9dfd0ee4-81e1-438c-8a99-4894c64f41cb"]={f:Ops.Gl.FaceCulling_v2,objName:"Ops.Gl.FaceCulling_v2"};Ops.Ui.Routing.RouteTrigger=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Trigger"),r=e.outTrigger("Next");e.setUiAttribs({display:"reroute"});i.onTriggered=()=>{r.trigger()}}};CABLES.OPS["0a2dc648-3a02-4559-b9af-cf3d47701e66"]={f:Ops.Ui.Routing.RouteTrigger,objName:"Ops.Ui.Routing.RouteTrigger"};Ops.Number.GateNumber=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValue("Value In",0),r=e.inValueBool("Pass Through"),n=e.inSwitch("When False",["keep last number","custom"],"keep last number"),s=e.inFloat("Custom Value",0),a=e.outNumber("Value Out");i.onChange=l;r.onChange=l;s.onChange=l;i.changeAlways=a.changeAlways=true;n.onChange=o;function o(){s.setUiAttribs({greyout:n.get()!="custom"});l()}function l(){if(r.get()){a.set(i.get())}else{if(n.get()=="custom")a.set(s.get())}}}};CABLES.OPS["594105c8-1fdb-4f3c-bbd5-29b9ad6b33e0"]={f:Ops.Number.GateNumber,objName:"Ops.Number.GateNumber"};Ops.Boolean.IsZero=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValue("Value"),r=e.outBoolNum("Result",true);i.onChange=function(){r.set(i.get()==0)}}};CABLES.OPS["76d37c73-3c32-47bd-8b4a-4229db7e57f1"]={f:Ops.Boolean.IsZero,objName:"Ops.Boolean.IsZero"};Ops.Color.ColorValue=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueSlider("r",Math.random());const r=e.inValueSlider("g",Math.random());const n=e.inValueSlider("b",Math.random());i.setUiAttribs({colorPick:true});const s=e.inValueSlider("a",1);const a=e.outNumber("outr");const o=e.outNumber("outg");const l=e.outNumber("outb");const u=e.outNumber("outa");const h=e.outNumber("Hex","000000");const c=e.outArray("Array");i.onChange=r.onChange=n.onChange=s.onChange=g;function f(e){let t=Math.round(e*255).toString(16);if(t.length===1){t="0"+t}return t.toUpperCase()}function g(){a.set(i.get());o.set(r.get());l.set(n.get());u.set(s.get());let e=f(i.get())+f(r.get())+f(n.get());h.set(e);c.set([i.get(),r.get(),n.get(),s.get()])}g()}};CABLES.OPS["7caa37c8-f2a7-49f2-a29c-96af362abca0"]={f:Ops.Color.ColorValue,objName:"Ops.Color.ColorValue"};Ops.Gl.Meshes.SplineMeshMaterial_v2=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={splinemat_frag:"IN vec2 texCoord;\nIN float splineDoDrawFrag;\nUNI vec4 color;\nUNI sampler2D tex;\nUNI sampler2D texMask;\n\n{{MODULES_HEAD}}\n\nvoid main()\n{\n    vec4 col=color;\n\n    #ifdef USE_TEXTURE\n        #ifdef TEX_COLORIZE\n            col*=texture(tex,texCoord);\n        #endif\n        #ifndef TEX_COLORIZE\n            col=texture(tex,texCoord);\n        #endif\n    #endif\n\n    col.a=color.a;\n\n    #ifdef USE_TEXMASK\n        col.a*=texture(texMask,texCoord).r;\n        if(col.a==0.0) discard;\n    #endif\n\n    {{MODULE_COLOR}}\n\n    // if(splineDoDrawFrag==0.0) col.rgb=vec3(1.0,0.0,0.0);\n    if(splineDoDrawFrag==0.0) discard;\n\n    outColor = col;\n}",splinemat_vert:"{{MODULES_HEAD}}\n\nIN vec3 vPosition;\nIN float attrVertIndex;\nIN float splineProgress;\nIN vec3 spline,spline2,spline3;\nIN float splineDoDraw;\n\nOUT float splineDoDrawFrag;\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nUNI float width;\nUNI float texOffset;\nUNI float aspect;\n\n#define PI 3.1415926538\n\nvec2 rotate(vec2 v, float a)\n{\n\tfloat s = sin(a);\n\tfloat c = cos(a);\n\tmat2 m = mat2(c, -s, s, c);\n\treturn m * v;\n}\n\nvec2 fix( vec4 i )\n{\n    vec2 res = i.xy / i.w;\n    return res;\n}\n\nvoid main()\n{\n    texCoord=vPosition.xy;\n    texCoord.y=texCoord.y*0.5+0.5;\n    #ifdef TEX_MAP_FULL\n        texCoord.x=splineProgress;\n    #endif\n    texCoord.x+=texOffset;\n\n    mat4 mMatrix=modelMatrix;\n    mat4 mvMatrix=viewMatrix * mMatrix;\n\n    splineDoDrawFrag=splineDoDraw;\n\n    // vec4 pos=vec4((spline2+spline3+spline)/3.0*vPosition,1.0);\n    vec4 pos=vec4(spline2,1.0);\n\n    {{MODULE_VERTEX_POSITION}}\n\n    vec4 finalPosition  = projMatrix * mvMatrix * (vec4(spline2,1.0));\n    vec4 finalPosition2 = projMatrix * mvMatrix * (vec4(spline3,1.0));\n\n    vec2 screenPos =fix(projMatrix * mvMatrix * vec4(spline,1.0));\n    vec2 screenPos2=fix(projMatrix * mvMatrix * vec4(spline2,1.0));\n    vec2 screenPos3=fix(projMatrix * mvMatrix * vec4(spline3,1.0));\n\n    float wid=width/10.0;\n\n    #ifndef PERSPWIDTH\n        wid=width*finalPosition.w*0.0025;\n    #endif\n\n    vec2 dir1 = normalize( screenPos2 - screenPos );\n    vec2 dir2 = normalize( screenPos3 - screenPos2 );\n\n\tif( screenPos2 == screenPos ) dir1 = normalize( screenPos3 - screenPos2 );\n\n    vec2 normal = vec2( -dir1.y/aspect, dir1.x ) * 0.5 * wid;\n    vec2 normal2 = vec2( -dir2.y/aspect, dir2.x ) * 0.5 * wid;\n\n    vec4 offset = vec4( mix(normal,normal2,vPosition.x) * vPosition.y, 0.0, 1.0 );\n\n    finalPosition = mix(finalPosition,finalPosition2,vPosition.x);\n\tfinalPosition.xy += offset.xy;\n\n    gl_Position = finalPosition;\n}\n"};const t=i.inTrigger("Render"),r=i.inFloat("Width",.2),n=i.inBool("Width Perspective",true),s=i.inTexture("Texture"),a=i.inTexture("Texture Mask"),o=i.inSwitch("Mapping",["Full","Face"],"Full"),l=i.inBool("Colorize Texture",false),u=i.inFloat("Offset",0),h=i.inValueSlider("r",Math.random()),c=i.inValueSlider("g",Math.random()),f=i.inValueSlider("b",Math.random()),g=i.inValueSlider("a",1),d=i.outTrigger("Trigger"),m=i.outObject("Shader");h.setUiAttribs({colorPick:true});m.ignoreValueSerialize=true;const p=i.patch.cgl;i.toWorkPortsNeedToBeLinked(t);i.setPortGroup("Color",[h,c,f,g]);i.setPortGroup("Texture",[s,o,l]);const _=new CGL.Shader(p,"splinemesh_material",this);_.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);_.setSource(e.splinemat_vert,e.splinemat_frag);m.setRef(_);const b=_.addUniformFrag("t","tex");const v=_.addUniformFrag("t","texMask");let x=1.7777;_.addUniformFrag("4f","color",h,c,f,g);_.addUniformFrag("f","width",r);_.addUniformFrag("f","texOffset",u);_.addUniformFrag("f","aspect",x);_.toggleDefine("PERSPWIDTH",n);_.toggleDefine("USE_TEXTURE",s);_.toggleDefine("TEX_COLORIZE",l);_.toggleDefine("USE_TEXMASK",a);o.on("change",A);t.onTriggered=E;A();function E(){if(!_)return;const e=i.patch.cgl.getViewPort();const t=e[2]/e[3];if(t!=x){x=t;_.addUniformFrag("f","aspect",x)}p.pushShader(_);_.popTextures();if(b&&s.get())_.pushTexture(b,s.get().tex);if(v&&a.get())_.pushTexture(v,a.get().tex);d.trigger();p.popShader()}function A(){_.toggleDefine("TEX_MAP_FULL",o.get()==="Full")}}};CABLES.OPS["5ff7c643-cbea-44cc-9f34-fb18a44bcfff"]={f:Ops.Gl.Meshes.SplineMeshMaterial_v2,objName:"Ops.Gl.Meshes.SplineMeshMaterial_v2"};Ops.Gl.Meshes.SplineMesh_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Render"),a=e.inArray("Points"),o=e.inBool("Tesselate Edges",false),r=e.inBool("Render Mesh",true),n=e.outTrigger("Next");const s=new CGL.Geometry("splinemesh_2");s.vertices=[];s.clear();let l=[];const u=e.patch.cgl;let h=new Float32Array;let c=new Float32Array;let f=new Float32Array;let g=new Float32Array;let d=null;let m=new Float32Array;const p=new Float32Array;const _=[];const b=[0,0,0];let v=new CGL.Mesh(u,s);v.addVertexNumbers=true;let x=true;o.onChange=a.onChange=()=>{x=true};i.onTriggered=A;let E=null;function A(){if(x)O();if(v&&r.get()){if(E!=u.getShader()){E=u.getShader();if(!E)return;if(E.getName()!="splinemesh_material")e.setUiError("nosplinemat","Splinemesh needs a SplineMeshMaterial!");else e.setUiError("nosplinemat");E=u.getShader()}if(b.length>0)v.render(E)}n.trigger()}function T(){b.length=0;const t=1;const i=-t;for(let e=0;e<l.length/3;e++){b.push(t,i,0,0,i,0,t,t,0,0,i,0,0,t,0,t,t,0)}s.vertices=b;if(!v)v=new CGL.Mesh(u,s);v.addVertexNumbers=true;v.setGeom(s);v.addVertexNumbers=true}function O(){const r=a.get();if(!r||r.length===0){v=null;return}if(r[0]&&r[0].length){const s=[];d=[];let i=0;for(let t=0;t<r.length;t++){for(let e=0;e<r[t].length/3;e++){d[(i-3)/3]=t;s[i++]=r[t][e*3+0];s[i++]=r[t][e*3+1];s[i++]=r[t][e*3+2]}}l=s}else{d=null;l=r}if(o.get())l=S(l);T();const t=l.length*6;let i=0;let e=0;let n=0;if(h.length!=t){h=new Float32Array(t);c=new Float32Array(t);f=new Float32Array(t);g=new Float32Array(t/3);m=new Float32Array(t/3);for(let e=0;e<t/3;e++)m[e]=e/(t/3)}for(let t=0;t<l.length/3;t++){if(d){if(t>1&&e!=d[t])n=0;else n=1;e=d[t]}else n=1;for(let e=0;e<6;e++){g[i/3]=n;for(let e=0;e<3;e++){h[i]=l[Math.max(0,t-1)*3+e];c[i]=l[(t+0)*3+e];f[i]=l[(t+1)*3+e];i++}}}v.setAttribute("spline",h,3);v.setAttribute("spline2",c,3);v.setAttribute("spline3",f,3);v.setAttribute("splineDoDraw",g,1);v.setAttribute("splineProgress",m,1);x=false}function I(e,t,i){return e+i*(t-e)}function S(t){let i=0;const r=.001;const n=1-r;const e=t.length*3-3;_.length=e;const s=[];if(d)s[0]=d[1];for(let e=0;e<t.length-3;e+=3){_[i++]=t[e+0];_[i++]=t[e+1];_[i++]=t[e+2];if(d)s[i/3]=d[e/3];_[i++]=I(t[e+0],t[e+3],r);_[i++]=I(t[e+1],t[e+4],r);_[i++]=I(t[e+2],t[e+5],r);if(d)s[i/3]=d[e/3];_[i++]=I(t[e+0],t[e+3],n);_[i++]=I(t[e+1],t[e+4],n);_[i++]=I(t[e+2],t[e+5],n);if(d)s[i/3]=d[e/3]}if(d)d=s;return _}}};CABLES.OPS["287abf6c-5501-4bc9-a627-70ec3c3766d2"]={f:Ops.Gl.Meshes.SplineMesh_v2,objName:"Ops.Gl.Meshes.SplineMesh_v2"};Ops.Gl.RenderGeometry_v2=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inTrigger("render"),r=t.inObject("Geometry",null,"geometry"),n=t.inBool("Render Mesh",true),s=t.inBool("Add Vertex Numbers",true),a=t.outTrigger("trigger");t.toWorkPortsNeedToBeLinked(r,i);r.ignoreValueSerialize=true;let o=null;let l=true;r.onLinkChanged=s.onChange=r.onChange=()=>{l=true};i.onTriggered=function(){if(l)u();if(o&&n.get())o.render(t.patch.cgl.getShader());a.trigger()};function u(){l=false;const e=r.get();if(e&&e.isGeometry){if(o){o.dispose();o=null}if(!o){o=new CGL.Mesh(t.patch.cgl,e);o.addVertexNumbers=s.get();o.setGeom(e)}}else{o=null}}}};CABLES.OPS["0a9bdb39-8250-460e-8d99-50fe6825d956"]={f:Ops.Gl.RenderGeometry_v2,objName:"Ops.Gl.RenderGeometry_v2"};Ops.Graphics.Geometry.Triangulate2dPath=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("Update"),a=e.inDropDown("Combine",["Positive","Odd","Intersect","Negative"],"Positive"),o=e.inArray("2d Point Path"),l=e.inArray("Path 2"),u=e.inArray("Path 3"),h=e.outTrigger("Next"),c=e.outObject("Geometry");i.onTriggered=r;let f=null;function r(){let e=o.get();if(!e||e.length===0){c.set(null);return}let t=[e];let i=l.get();if(i&&i.length>0)t.push(i);let r=u.get();if(r&&r.length>0)t.push(r);let n=Tess2.WINDING_ODD;if(a.get()=="Positive"){n=Tess2.WINDING_POSITIVE}if(a.get()=="Negative"){n=Tess2.WINDING_NEGATIVE}if(a.get()=="Intersect"){n=Tess2.WINDING_ABS_GEQ_TWO}let s=null;try{s=Tess2.tesselate({contours:t,windingRule:n,elementType:Tess2.POLYGONS,polySize:3,vertexSize:2})}catch(e){}if(s){let e=true;if(f)e=f.vertices.length/3!=s.vertices.length/2;if(e){f=new CGL.Geometry("tess2geom")}let t=[];for(let e=0;e<s.vertices.length;e+=2){t.push(s.vertices[e+0],s.vertices[e+1],0)}f.vertices=t;f.verticesIndices=s.elements;f.calculateNormals();f.mapTexCoords2d();f.flipVertDir();c.setRef(f)}else c.set(null);h.trigger()}}};CABLES.OPS["6165a15f-abf3-4398-87f7-541bedc109e5"]={f:Ops.Graphics.Geometry.Triangulate2dPath,objName:"Ops.Graphics.Geometry.Triangulate2dPath"};Ops.Gl.Matrix.Scale=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inTrigger("render"),r=t.inValueFloat("scale",1),n=t.inValueFloat("x",1),s=t.inValueFloat("y",1),a=t.inValueFloat("z",1),o=t.outTrigger("trigger");t.setPortGroup("Axis",[n,s,a]);const l=vec3.create();n.onChange=s.onChange=a.onChange=r.onChange=u;u();i.onTriggered=function(){const e=t.patch.cg||t.patch.cgl;e.pushModelMatrix();mat4.scale(e.mMatrix,e.mMatrix,l);o.trigger();e.popModelMatrix()};function u(){const e=r.get();vec3.set(l,e*n.get(),e*s.get(),e*a.get())}}};CABLES.OPS["50e7f565-0cdb-47ca-912b-87c04e2f00e3"]={f:Ops.Gl.Matrix.Scale,objName:"Ops.Gl.Matrix.Scale"};Ops.Gl.Textures.CopyTexture_v3=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const k=t.attachments={copytexture_frag:"UNI float a;\nUNI sampler2D tex;\n\n#ifdef TEX_MASK\nUNI sampler2D texMask;\n#endif\n\nIN vec2 texCoord;\n\nvoid main()\n{\n    vec2 tc=texCoord;\n\n    #ifdef FLIPX\n        tc.x=1.0-tc.x;\n    #endif\n    #ifdef FLIPY\n        tc.y=1.0-tc.y;\n    #endif\n\n    vec4 col=texture(tex,tc);\n\n    #ifdef TEX_MASK\n        col.a=texture(texMask,tc).r;\n    #endif\n\n    #ifdef GREY_R\n        col.rgb=vec3(col.r);\n    #endif\n\n    #ifdef GREY_G\n        col.rgb=vec3(col.g);\n    #endif\n\n    #ifdef GREY_B\n        col.rgb=vec3(col.b);\n    #endif\n\n    #ifdef GREY_A\n        col.rgb=vec3(col.a);\n    #endif\n\n    #ifdef GREY_LUMI\n        col.rgb=vec3( dot(vec3(0.2126,0.7152,0.0722), col.rgb) );\n    #endif\n\n\n    #ifdef INVERT_A\n        col.a=1.0-col.a;\n    #endif\n\n    #ifdef INVERT_R\n        col.r=1.0-col.r;\n    #endif\n\n    #ifdef INVERT_G\n        col.g=1.0-col.g;\n    #endif\n\n    #ifdef INVERT_B\n        col.b=1.0-col.b;\n    #endif\n\n    #ifdef ALPHA_1\n        col.a=1.0;\n    #endif\n\n\n\n\n    outColor= col;\n}"};const e=t.inTriggerButton("render"),i=t.inTexture("Texture"),r=t.inTexture("Alpha Mask"),n=t.inValueBool("use original size",true),s=t.inValueInt("width",640),a=t.inValueInt("height",360),o=t.inSwitch("filter",["nearest","linear","mipmap"],"linear"),l=t.inDropDown("Pixel Format",CGL.Texture.PIXELFORMATS,CGL.Texture.PFORMATSTR_RGBA8UB),u=t.inSwitch("Anisotropic",["0","1","2","4","8","16"],"0"),h=t.inValueSelect("wrap",["clamp to edge","repeat","mirrored repeat"],"clamp to edge"),c=t.inSwitch("Alpha Mask Source",["A","1"],"A"),f=t.inSwitch("Convert Greyscale",["Off","R","G","B","A","Luminance"],"Off"),g=t.inBool("Invert R",false),d=t.inBool("Invert G",false),m=t.inBool("Invert B",false),D=t.inBool("Invert A",false),p=t.inBool("Flip X",false),_=t.inBool("Flip Y",false),b=t.outTrigger("trigger"),v=t.outTexture("texture_out",null),U=t.outNumber("Aspect Ratio");c.setUiAttribs({hidePort:true});f.setUiAttribs({hidePort:true});g.setUiAttribs({hidePort:true});d.setUiAttribs({hidePort:true});m.setUiAttribs({hidePort:true});let B=null;const x=t.patch.cgl;let E=null;let A=null;let T=null;let O=true;let I=null;let S=2,M=2;const C=[0,0,0,0];let R=true;t.toWorkPortsNeedToBeLinked(e,i);t.setPortGroup("Size",[n,s,a]);const N=new CGL.Shader(x,"copytexture");N.setSource(N.getDefaultVertexShader(),k.copytexture_frag);const V=new CGL.Uniform(N,"t","tex",0);let j=new CGL.Uniform(N,"t","texMask",1);let y=CGL.Texture.FILTER_LINEAR;let P=CGL.Texture.WRAP_CLAMP_TO_EDGE;p.onChange=_.onChange=c.onChange=u.onChange=f.onChange=g.onChange=d.onChange=m.onChange=h.onChange=o.onChange=l.onChange=e.onLinkChanged=r.onChange=i.onLinkChanged=()=>{w()};i.onChange=()=>{if(I!=i.get()){w()}I=i.get()};e.onTriggered=H;F();function L(){if(A)A.delete();if(T){T.delete();T=null}A=new CGL.TextureEffect(x,{pixelFormat:l.get(),clear:false});if(!T||T.width!=Math.floor(s.get())||T.height!=Math.floor(a.get())||T.wrap!=P||T.pixelFormat!=l.get()){const e=Math.min(x.maxAnisotropic,parseFloat(u.get()));if(T)T.delete();T=new CGL.Texture(x,{name:"copytexture_"+t.id,pixelFormat:l.get(),anisotropic:e,filter:y,wrap:P,width:Math.floor(s.get()),height:Math.floor(a.get())})}A.setSourceTexture(T);F();R=false}function w(){X();R=true;if(!e.isLinked()||!i.isLinked())v.setRef(CGL.Texture.getEmptyTexture(x))}function G(){if(!i.get()||i.get()==CGL.Texture.getEmptyTexture(x))return;if(!A)L();if(n.get()){S=i.get().width;M=i.get().height}else{S=Math.floor(s.get());M=Math.floor(a.get())}if((S!=T.width||M!=T.height)&&(S!==0&&M!==0)){a.set(M);s.set(S);T.filter=y;T.setSize(S,M);U.set(S/M);A.setSourceTexture(T)}O=false}function F(){if(!CABLES.UI)return;u.setUiAttribs({greyout:o.get()!="mipmap"});s.setUiAttribs({greyout:n.get()});a.setUiAttribs({greyout:n.get()})}function z(){O=true;w()}n.onChange=function(){F();if(n.get()){s.onChange=null;a.onChange=null}else{s.onChange=z;a.onChange=z}G()};function H(){if(!i.get()||i.get()==CGL.Texture.getEmptyTexture(x))v.setRef(CGL.Texture.getEmptyTexture(x));if(!i.get()||i.get()==CGL.Texture.getEmptyTexture(x)){E=null;b.trigger();return}else if(!A||R||E!=i.get()){L()}const e=x.getViewPort();C[0]=e[0];C[1]=e[1];C[2]=e[2];C[3]=e[3];G();E=i.get();const t=x.currentTextureEffect;x.currentTextureEffect=A;A.setSourceTexture(T);A.startEffect();x.pushShader(N);x.currentTextureEffect.bind();x.setTexture(0,i.get().tex);if(r.get())x.setTexture(1,r.get().tex);x.pushBlend(false);x.currentTextureEffect.finish();x.popShader();x.popBlend();v.setRef(A.getCurrentSourceTexture());A.endEffect();x.setViewPort(C[0],C[1],C[2],C[3]);x.currentTextureEffect=t;x.setTexture(0,CGL.Texture.getEmptyTexture(x).tex);b.trigger()}function X(){N.toggleDefine("FLIPX",p.get());N.toggleDefine("FLIPY",_.get());N.toggleDefine("TEX_MASK",r.get());N.toggleDefine("GREY_R",f.get()==="R");N.toggleDefine("GREY_G",f.get()==="G");N.toggleDefine("GREY_B",f.get()==="B");N.toggleDefine("GREY_A",f.get()==="A");N.toggleDefine("GREY_LUMI",f.get()==="Luminance");N.toggleDefine("ALPHA_1",c.get()==="1");N.toggleDefine("ALPHA_A",c.get()==="A");N.toggleDefine("INVERT_R",g.get());N.toggleDefine("INVERT_G",d.get());N.toggleDefine("INVERT_B",m.get());N.toggleDefine("INVERT_A",D.get());if(h.get()=="repeat")P=CGL.Texture.WRAP_REPEAT;else if(h.get()=="mirrored repeat")P=CGL.Texture.WRAP_MIRRORED_REPEAT;else if(h.get()=="clamp to edge")P=CGL.Texture.WRAP_CLAMP_TO_EDGE;if(o.get()=="nearest")y=CGL.Texture.FILTER_NEAREST;else if(o.get()=="linear")y=CGL.Texture.FILTER_LINEAR;else if(o.get()=="mipmap")y=CGL.Texture.FILTER_MIPMAP;if(N.needsRecompile()){R=true}if(T&&(T.width!=Math.floor(s.get())||T.height!=Math.floor(a.get())||T.wrap!=P||T.pixelFormat!=l.get())){R=true}}}};CABLES.OPS["25d77a01-ccfe-4b2e-b3c3-a09a8a018d0c"]={f:Ops.Gl.Textures.CopyTexture_v3,objName:"Ops.Gl.Textures.CopyTexture_v3"};Ops.Gl.ImageCompose.ImageCompose_v4=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={imgcomp_frag:"IN vec2 texCoord;\nUNI vec4 bgColor;\nUNI sampler2D tex;\n#ifdef USE_UVTEX\nUNI sampler2D UVTex;\n#endif\n\nvoid main()\n{\n\n    #ifndef USE_TEX\n        outColor=bgColor;\n    #endif\n    #ifdef USE_TEX\n        #ifndef USE_UVTEX\n        outColor=texture(tex,texCoord);\n        #else\n        outColor=texture(tex,texture(UVTex,texCoord).xy);\n        #endif\n    #endif\n\n\n\n}\n"};const t=i.patch.cgl,r=i.inTrigger("Render"),n=i.inTexture("Base Texture"),s=i.inTexture("UV Texture"),a=i.inSwitch("Size",["Auto","Canvas","Manual"],"Auto"),o=i.inValueInt("Width",640),l=i.inValueInt("Height",480),u=i.inSwitch("Filter",["nearest","linear","mipmap"],"linear"),h=i.inValueSelect("Wrap",["clamp to edge","repeat","mirrored repeat"],"repeat"),c=i.inSwitch("Anisotropic",["0","1","2","4","8","16"],"0"),f=i.inDropDown("Pixel Format",CGL.Texture.PIXELFORMATS,CGL.Texture.PFORMATSTR_RGBA8UB),g=i.inBool("Clear",true),d=i.inValueSlider("R",0),m=i.inValueSlider("G",0),p=i.inValueSlider("B",0),_=i.inValueSlider("A",0),b=i.outTrigger("Next"),v=i.outTexture("texture_out",CGL.Texture.getEmptyTexture(t)),x=i.outNumber("Aspect Ratio"),F=i.outNumber("Texture Width"),k=i.outNumber("Texture Height");i.setPortGroup("Texture Size",[a,o,l]);i.setPortGroup("Texture Parameters",[h,c,u,f]);d.setUiAttribs({colorPick:true});i.setPortGroup("Color",[d,m,p,_,g]);i.toWorkPortsNeedToBeLinked(r);const D=[0,0,0,0];let E=null;let A=null;let T=true;let U=false;let O=null;let B=null;let V=null;let j=null;h.onChange=u.onChange=c.onChange=f.onChange=G;n.onLinkChanged=g.onChange=a.onChange=s.onChange=P;r.onTriggered=i.preRender=w;P();function I(){if(E)E.delete();if(A)A.delete();A=null;E=new CGL.TextureEffect(t,{isFloatingPointTexture:CGL.Texture.isPixelFormatFloat(f.get()),name:i.name});const e=Math.min(t.maxAnisotropic,parseFloat(c.get()));A=new CGL.Texture(t,{anisotropic:e,name:"image_compose_v2_"+i.id,pixelFormat:f.get(),filter:S(),wrap:M(),width:C(),height:R()});E.setSourceTexture(A);F.set(C());k.set(R());x.set(C()/R());v.setRef(CGL.Texture.getEmptyTexture(t));T=false;P()}function S(){if(u.get()=="nearest")return CGL.Texture.FILTER_NEAREST;else if(u.get()=="linear")return CGL.Texture.FILTER_LINEAR;else if(u.get()=="mipmap")return CGL.Texture.FILTER_MIPMAP}function M(){if(h.get()=="repeat")return CGL.Texture.WRAP_REPEAT;else if(h.get()=="mirrored repeat")return CGL.Texture.WRAP_MIRRORED_REPEAT;else if(h.get()=="clamp to edge")return CGL.Texture.WRAP_CLAMP_TO_EDGE}function C(){let e=0;if(n.get()&&a.get()=="Auto")e=n.get().width;else if(a.get()=="Auto"||a.get()=="Canvas")e=t.canvasWidth;else if(a.get()=="ViewPort")e=t.getViewPort()[2];else e=Math.ceil(o.get());return i.patch.cgl.checkTextureSize(e)}function R(){let e=0;if(n.get()&&a.get()=="Auto")e=n.get().height;else if(a.get()=="Auto"||a.get()=="Canvas")e=t.canvasHeight;else if(a.get()=="ViewPort")e=t.getViewPort()[3];else e=Math.ceil(l.get());return i.patch.cgl.checkTextureSize(e)}function G(){T=true}function z(){if((C()!=A.width||R()!=A.height||A.pixelFormat!=f.get()||A.filter!=S()||A.wrap!=M())&&(C()!==0&&R()!==0)){I();E.setSourceTexture(A);v.setRef(A);N();L()}}function N(){let e=null;if(a.get()=="Manual"){e=null}else if(a.get()=="Auto"){if(n.get())e="Input Texture";else e="Canvas Size";e+=": "+C()+" x "+R()}let t=false;t=a.uiAttribs.info!=e;a.setUiAttribs({info:e});if(t)i.refreshParams()}function y(){if(O)O.toggleDefine("USE_TEX",n.isLinked()||!g.get());if(O)O.toggleDefine("USE_UVTEX",s.isLinked())}function P(){c.setUiAttribs({greyout:S()!=CGL.Texture.FILTER_MIPMAP});d.setUiAttribs({greyout:n.isLinked()});p.setUiAttribs({greyout:n.isLinked()});m.setUiAttribs({greyout:n.isLinked()});_.setUiAttribs({greyout:n.isLinked()});g.setUiAttribs({greyout:n.isLinked()});o.setUiAttribs({greyout:a.get()!="Manual"});l.setUiAttribs({greyout:a.get()!="Manual"});if(A)if(CGL.Texture.isPixelFormatFloat(f.get())&&S()==CGL.Texture.FILTER_MIPMAP)i.setUiError("fpmipmap","Don't use mipmap and 32bit at the same time, many systems do not support this.");else i.setUiError("fpmipmap",null);N();y();L()}function L(){if(A)if(n.isLinked()&&n.get()&&A.isFloatingPoint()<n.get().isFloatingPoint())i.setUiError("textypediff","Warning: Mixing floating point and non floating point texture can result in data/precision loss",1);else i.setUiError("textypediff",null)}i.preRender=()=>{w()};function H(){if(!O){O=new CGL.Shader(t,"copytextureshader");O.setSource(O.getDefaultVertexShader(),e.imgcomp_frag);B=new CGL.Uniform(O,"t","tex",0);V=new CGL.Uniform(O,"t","UVTex",1);j=new CGL.Uniform(O,"4f","bgColor",d,m,p,_);y()}t.pushShader(O);t.currentTextureEffect.bind();if(n.get())t.setTexture(0,n.get().tex);else if(!g.get()&&v.get())t.setTexture(0,v.get().tex);if(s.get())t.setTexture(1,s.get().tex);t.currentTextureEffect.finish();t.popShader()}function w(){if(!E||T)I();t.pushBlend(false);z();const e=t.currentTextureEffect;t.currentTextureEffect=E;t.currentTextureEffect.imgCompVer=3;t.currentTextureEffect.width=o.get();t.currentTextureEffect.height=l.get();E.setSourceTexture(A);E.startEffect(n.get()||CGL.Texture.getEmptyTexture(t,U),true);H();b.trigger();t.pushViewPort(0,0,o.get(),l.get());E.endEffect();v.setRef(E.getCurrentSourceTexture());t.popViewPort();t.popBlend();t.currentTextureEffect=e}}};CABLES.OPS["17212e2b-d692-464c-8f8d-2d511dd3410a"]={f:Ops.Gl.ImageCompose.ImageCompose_v4,objName:"Ops.Gl.ImageCompose.ImageCompose_v4"};Ops.Gl.Meshes.FullscreenRectangle_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={shader_frag:"UNI sampler2D tex;\nIN vec2 texCoord;\n\nvoid main()\n{\n    outColor= texture(tex,texCoord);\n}\n\n",shader_vert:"{{MODULES_HEAD}}\n\nIN vec3 vPosition;\nUNI mat4 projMatrix;\nUNI mat4 mvMatrix;\n\nOUT vec2 texCoord;\nIN vec2 attrTexCoord;\n\nvoid main()\n{\n   vec4 pos=vec4(vPosition,  1.0);\n\n   texCoord=vec2(attrTexCoord.x,(1.0-attrTexCoord.y));\n\n   gl_Position = projMatrix * mvMatrix * pos;\n}\n"};const i=e.inTrigger("render"),r=e.inSwitch("Scale",["Stretch","Fit"],"Fit"),n=e.inValueBool("Flip Y"),s=e.inValueBool("Flip X"),a=e.inTexture("Texture"),o=e.outTrigger("trigger");const l=e.patch.cgl;let u=null;let h=new CGL.Geometry("fullscreen rectangle");let c=0,f=0,g=0,d=0;e.toWorkShouldNotBeChild("Ops.Gl.TextureEffects.ImageCompose",CABLES.OP_PORT_TYPE_FUNCTION);e.toWorkPortsNeedToBeLinked(i);s.onChange=T;n.onChange=T;i.onTriggered=A;a.onLinkChanged=v;r.onChange=E;const m=new CGL.Shader(l,"fullscreenrectangle",this);m.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);m.setSource(t.shader_vert,t.shader_frag);m.fullscreenRectUniform=new CGL.Uniform(m,"t","tex",0);m.aspectUni=new CGL.Uniform(m,"f","aspectTex",0);let p=false;let _=true;let b=false;v();E();a.onChange=function(){_=true};function v(){if(!CABLES.UI)return;n.setUiAttribs({greyout:!a.isLinked()});s.setUiAttribs({greyout:!a.isLinked()});r.setUiAttribs({greyout:!a.isLinked()})}function x(){let e=a.get();if(e)p=true;else p=false}e.preRender=function(){x();m.bind();if(u)u.render(m);A()};function E(){b=r.get()=="Fit"}function A(){if(l.viewPort[2]!=g||l.viewPort[3]!=d||!u)O();if(_)x();l.pushPMatrix();mat4.identity(l.pMatrix);mat4.ortho(l.pMatrix,0,g,d,0,-10,1e3);l.pushModelMatrix();mat4.identity(l.mMatrix);l.pushViewMatrix();mat4.identity(l.vMatrix);if(b&&a.get()){const i=a.get().width/a.get().height;let e=d;let t=d*i;if(t>g){e=g*1/i;t=g}l.pushViewPort((g-t)/2,(d-e)/2,t,e)}if(p){if(a.get())l.setTexture(0,a.get().tex);u.render(m)}else{u.render(l.getShader())}l.gl.clear(l.gl.DEPTH_BUFFER_BIT);l.popPMatrix();l.popModelMatrix();l.popViewMatrix();if(b&&a.get())l.popViewPort();o.trigger()}function T(){u=null}function O(){if(l.viewPort[2]==g&&l.viewPort[3]==d&&u)return;let e=0,t=0;g=l.viewPort[2];d=l.viewPort[3];h.vertices=new Float32Array([e+g,t+d,0,e,t+d,0,e+g,t,0,e,t,0]);let i=null;if(n.get())i=new Float32Array([1,0,0,0,1,1,0,1]);else i=new Float32Array([1,1,0,1,1,0,0,0]);if(s.get()){i[0]=0;i[2]=1;i[4]=0;i[6]=1}h.setTexCoords(i);h.verticesIndices=new Uint16Array([2,1,0,3,1,2]);h.vertexNormals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]);h.tangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0]);h.biTangents==new Float32Array([0,-1,0,0,-1,0,0,-1,0,0,-1,0]);if(!u)u=new CGL.Mesh(l,h);else u.setGeom(h)}}};CABLES.OPS["fb70721a-eac2-4ff5-a5a2-5c59e2393972"]={f:Ops.Gl.Meshes.FullscreenRectangle_v2,objName:"Ops.Gl.Meshes.FullscreenRectangle_v2"};Ops.Gl.ImageCompose.CircleTexture_v4=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={circle_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\n\nUNI float amount;\nUNI float size;\nUNI float inner;\nUNI float fadeOut;\n\nUNI float r;\nUNI float g;\nUNI float b;\nUNI float a;\nUNI float aspect;\nUNI vec2 stretch;\n\n\nUNI float x;\nUNI float y;\n\n{{CGL.BLENDMODES3}}\n\nfloat dist(float x,float y,float x2,float y2)\n{\n\tfloat xd = x2-x;\n\tfloat yd = y2-y;\n\treturn abs(sqrt(xd*xd*(1.0-stretch.x) + yd*yd*(1.0-stretch.y)));\n}\n\nvoid main()\n{\n    vec4 base=texture(tex,texCoord);\n\n    vec4 col=vec4(r,g,b,1.0);\n    float dist = dist(x,y/aspect,(texCoord.x-0.5)*2.0,(texCoord.y-0.5)*2.0/aspect);\n\n    float sz=size*0.5/aspect;\n    float v=0.0;\n    float fade=fadeOut;\n\n    if(fade==0.0)\n    {\n        if(dist<sz && dist>inner*sz) v=(smoothstep(0.0,1.0,(dist-(inner*sz))/(fade)));\n    }\n\n    if(fade>=0.0)\n    {\n\n        #ifdef FALLOFF_SMOOTHSTEP\n            if(dist>inner*sz && dist<sz+fade)v=1.0-(smoothstep(0.0,1.0,(dist-sz)/(fade)));\n        #endif\n        #ifndef FALLOFF_SMOOTHSTEP\n            fade+=0.0001;\n            if(dist>inner*sz && dist<sz+fade)v=1.0-((dist-sz)/(fade));\n            v=pow(v,5.0);\n        #endif\n    }\n\n    v=clamp(v,0.0,1.0);\n\n    outColor=cgl_blendPixel(base,col,amount*v);\n\n    outColor.a-=(1.0-a)*v;\n\n    #ifdef WARN_OVERFLOW\n        float width=0.01;\n        if( texCoord.x>(1.0-width) || texCoord.y>(1.0-width) || texCoord.y<width || texCoord.x<width )\n            if(v>0.001*amount)outColor= vec4(1.0,0.0,0.0, 1.0);\n    #endif\n}\n"};const i=e.inTrigger("Render"),r=e.inValueSlider("Amount",1),n=CGL.TextureEffect.AddBlendSelect(e),s=CGL.TextureEffect.AddBlendAlphaMask(e),a=e.inValueSlider("Size",.25),o=e.inValueSlider("Inner"),l=e.inFloat("Stretch X"),u=e.inFloat("Stretch Y"),h=e.inValue("Pos X",0),c=e.inValue("Pos Y",0),f=e.inValueSelect("fallOff",["Linear","SmoothStep"],"Linear"),g=e.inValueSlider("fade Out"),d=e.inValueBool("warn overflow",false),m=e.inValueSlider("r",1),p=e.inValueSlider("g",1),_=e.inValueSlider("b",1),b=e.inValueSlider("a",1),v=e.outTrigger("Next");m.setUiAttribs({colorPick:true});e.setPortGroup("Size",[a,o,l,u]);e.setPortGroup("Position",[h,c]);e.setPortGroup("Style",[d,f,g]);let x=e.patch.cgl;let E=new CGL.Shader(x,"textureeffect stripes");E.setSource(E.getDefaultVertexShader(),t.circle_frag);w();let A=new CGL.Uniform(E,"t","tex",0),T=new CGL.Uniform(E,"f","amount",r),O=new CGL.Uniform(E,"2f","stretch",l,u),I=new CGL.Uniform(E,"f","size",a),S=new CGL.Uniform(E,"f","fadeOut",g),M=new CGL.Uniform(E,"f","inner",o),C=new CGL.Uniform(E,"f","aspect",1),R=new CGL.Uniform(E,"f","r",m),N=new CGL.Uniform(E,"f","g",p),y=new CGL.Uniform(E,"f","b",_),P=new CGL.Uniform(E,"f","a",b),L=new CGL.Uniform(E,"f","x",h),F=new CGL.Uniform(E,"f","y",c);f.onChange=d.onChange=w;CGL.TextureEffect.setupBlending(e,E,n,r,s);function w(){E.toggleDefine("FALLOFF_LINEAR",f.get()=="Linear");E.toggleDefine("FALLOFF_SMOOTHSTEP",f.get()=="SmoothStep");E.toggleDefine("WARN_OVERFLOW",d.get())}i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;C.set(x.currentTextureEffect.aspectRatio);x.pushShader(E);x.currentTextureEffect.bind();x.setTexture(0,x.currentTextureEffect.getCurrentSourceTexture().tex);x.currentTextureEffect.finish();x.popShader();v.trigger()}}};CABLES.OPS["9738c421-1ee0-42bf-be0b-f4a481385fbf"]={f:Ops.Gl.ImageCompose.CircleTexture_v4,objName:"Ops.Gl.ImageCompose.CircleTexture_v4"};Ops.Gl.ImageCompose.EdgeDetection_v4=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={edgedetect_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float width;\nUNI float strength;\nUNI float texWidth;\nUNI float texHeight;\nUNI float mulColor;\n\nconst vec4 lumcoeff = vec4(0.299,0.587,0.114, 0.);\n\nvec3 desaturate(vec3 color)\n{\n    return vec3(dot(vec3(0.2126,0.7152,0.0722), color));\n}\n\n{{CGL.BLENDMODES3}}\n\nvoid main()\n{\n    // vec4 col=vec4(1.0,0.0,0.0,1.0);\n\n    // float pixelX=0.27/texWidth;\n    // float pixelY=0.27/texHeight;\n    float pixelX=(width+0.01)*4.0/texWidth;\n    float pixelY=(width+0.01)*4.0/texHeight;\n\nvec2 tc=texCoord;\n// #ifdef OFFSETPIXEL\n    tc.x+=1.0/texWidth*0.5;\n    tc.y+=1.0/texHeight*0.5;\n// #endif\n    // col=texture(tex,texCoord);\n\n    float count=1.0;\n    vec4 base=texture(tex,texCoord);\n\n\tvec4 horizEdge = vec4( 0.0 );\n\thorizEdge -= texture( tex, vec2( tc.x - pixelX, tc.y - pixelY ) ) * 1.0;\n\thorizEdge -= texture( tex, vec2( tc.x - pixelX, tc.y     ) ) * 2.0;\n\thorizEdge -= texture( tex, vec2( tc.x - pixelX, tc.y + pixelY ) ) * 1.0;\n\thorizEdge += texture( tex, vec2( tc.x + pixelX, tc.y - pixelY ) ) * 1.0;\n\thorizEdge += texture( tex, vec2( tc.x + pixelX, tc.y     ) ) * 2.0;\n\thorizEdge += texture( tex, vec2( tc.x + pixelX, tc.y + pixelY ) ) * 1.0;\n\tvec4 vertEdge = vec4( 0.0 );\n\tvertEdge -= texture( tex, vec2( tc.x - pixelX, tc.y - pixelY ) ) * 1.0;\n\tvertEdge -= texture( tex, vec2( tc.x    , tc.y - pixelY ) ) * 2.0;\n\tvertEdge -= texture( tex, vec2( tc.x + pixelX, tc.y - pixelY ) ) * 1.0;\n\tvertEdge += texture( tex, vec2( tc.x - pixelX, tc.y + pixelY ) ) * 1.0;\n\tvertEdge += texture( tex, vec2( tc.x    , tc.y + pixelY ) ) * 2.0;\n\tvertEdge += texture( tex, vec2( tc.x + pixelX, tc.y + pixelY ) ) * 1.0;\n\n\thorizEdge*=base.a;\n\tvertEdge*=base.a;\n\n\n\tvec3 edge = sqrt((horizEdge.rgb/count * horizEdge.rgb/count) + (vertEdge.rgb/count * vertEdge.rgb/count));\n\n    edge=desaturate(edge);\n    edge*=strength;\n\n    if(mulColor>0.0) edge*=texture( tex, texCoord ).rgb*mulColor*4.0;\n    edge=max(min(edge,1.0),0.0);\n\n    //blend section\n    vec4 col=vec4(edge,base.a);\n\n    outColor=cgl_blendPixel(base,col,amount*base.a);\n}\n\n"};const i=e.inTrigger("Render"),r=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),n=e.inValueSlider("Amount",1),s=e.inFloat("Strength",4),a=e.inValueSlider("Width",.1),o=e.inValueSlider("Mul Color",0),l=e.outTrigger("Trigger");const u=e.patch.cgl;const h=new CGL.Shader(u,e.name,e);h.setSource(h.getDefaultVertexShader(),t.edgedetect_frag);const c=new CGL.Uniform(h,"t","tex",0),f=new CGL.Uniform(h,"f","amount",n),g=new CGL.Uniform(h,"f","strength",s),d=new CGL.Uniform(h,"f","width",a),m=new CGL.Uniform(h,"f","texWidth",128),p=new CGL.Uniform(h,"f","texHeight",128),_=new CGL.Uniform(h,"f","mulColor",o);CGL.TextureEffect.setupBlending(e,h,r,n);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;u.pushShader(h);u.currentTextureEffect.bind();u.setTexture(0,u.currentTextureEffect.getCurrentSourceTexture().tex);m.setValue(u.currentTextureEffect.getCurrentSourceTexture().width);p.setValue(u.currentTextureEffect.getCurrentSourceTexture().height);u.currentTextureEffect.finish();u.popShader();l.trigger()}}};CABLES.OPS["0240e26e-b86d-43b2-8c72-6795bb86dc76"]={f:Ops.Gl.ImageCompose.EdgeDetection_v4,objName:"Ops.Gl.ImageCompose.EdgeDetection_v4"};Ops.Gl.ImageCompose.Levels_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={levels_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float inMin;\nUNI float inMax;\nUNI float midPoint;\nUNI float outMax;\nUNI float outMin;\n\nvoid main()\n{\n    vec4 baseRGBA=texture(tex,texCoord);\n    vec3 base=baseRGBA.rgb;\n    vec3 inputRange = min(max(base - vec3(inMin), vec3(0.0)) / (vec3(inMax) - vec3(inMin)), vec3(outMax));\n\n    inputRange = pow(inputRange, vec3(1.0 / (1.5 - midPoint)));\n\n    outColor= vec4(mix(vec3(outMin), vec3(1.0), inputRange) ,baseRGBA.a);\n}"};const i=e.inTrigger("Render"),r=e.inValueSlider("In Min",0),n=e.inValueSlider("Midpoint",.5),s=e.inValueSlider("In Max",1),a=e.inValueSlider("Out Min",0),o=e.inValueSlider("Out Max",1),l=e.outTrigger("Next");const u=e.patch.cgl;const h=new CGL.Shader(u,e.name,e);const c=new CGL.Uniform(h,"f","inMin",r),f=new CGL.Uniform(h,"f","midPoint",n),g=new CGL.Uniform(h,"f","inMax",s),d=new CGL.Uniform(h,"f","outMin",a),m=new CGL.Uniform(h,"f","outMax",o),p=new CGL.Uniform(h,"t","tex",0);h.setSource(h.getDefaultVertexShader(),t.levels_frag);i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;u.pushShader(h);u.currentTextureEffect.bind();u.setTexture(0,u.currentTextureEffect.getCurrentSourceTexture().tex);u.currentTextureEffect.finish();u.popShader();l.trigger()}}};CABLES.OPS["cf49063c-a010-4e2b-add6-f8dea50392b5"]={f:Ops.Gl.ImageCompose.Levels_v2,objName:"Ops.Gl.ImageCompose.Levels_v2"};Ops.Gl.ImageCompose.ChromaticAberration_v2=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={chromatic_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float pixel;\nUNI float onePixel;\nUNI float amount;\nUNI float lensDistort;\n\n#ifdef MASK\nUNI sampler2D texMask;\n#endif\n\n{{CGL.BLENDMODES3}}\n\nvoid main()\n{\n   vec4 base=texture(tex,texCoord);\n   vec4 col=texture(tex,texCoord);\n\n   vec2 tc=texCoord;;\n   float pix = pixel;\n   if(lensDistort>0.0)\n   {\n       float dist = distance(texCoord, vec2(0.5,0.5));\n       tc-=0.5;\n       tc *=smoothstep(-0.9,1.0*lensDistort,1.0-dist);\n       tc+=0.5;\n   }\n\n    #ifdef MASK\n        vec4 m=texture(texMask,texCoord);\n        pix*=m.r*m.a;\n    #endif\n\n    #ifdef SMOOTH\n    #ifdef WEBGL2\n        float numSamples=round(pix/onePixel/4.0+1.0);\n        col.r=0.0;\n        col.b=0.0;\n\n        for(float off=0.0;off<numSamples;off++)\n        {\n            float diff=(pix/numSamples)*off;\n            col.r+=texture(tex,vec2(tc.x+diff,tc.y)).r/numSamples;\n            col.b+=texture(tex,vec2(tc.x-diff,tc.y)).b/numSamples;\n        }\n    #endif\n    #endif\n\n    #ifndef SMOOTH\n        col.r=texture(tex,vec2(tc.x+pix,tc.y)).r;\n        col.b=texture(tex,vec2(tc.x-pix,tc.y)).b;\n    #endif\n\n   outColor= cgl_blendPixel(base,col,amount);\n\n}\n"};const i=t.inTrigger("render"),r=CGL.TextureEffect.AddBlendSelect(t,"Blend Mode","normal"),n=t.inValueSlider("Amount",1),s=t.inValue("Pixel",5),a=t.inValueSlider("Lens Distort",0),o=t.inValueBool("Smooth",false),l=t.inTexture("Mask"),u=t.outTrigger("trigger");const h=t.patch.cgl;const c=new CGL.Shader(h,"chromatic");CGL.TextureEffect.setupBlending(t,c,r,n);c.setSource(c.getDefaultVertexShader(),e.chromatic_frag);const f=new CGL.Uniform(c,"t","tex",0),g=new CGL.Uniform(c,"f","pixel",0),d=new CGL.Uniform(c,"f","onePixel",0),m=new CGL.Uniform(c,"t","texMask",1),p=new CGL.Uniform(c,"f","amount",n),_=new CGL.Uniform(c,"f","lensDistort",a);o.onChange=function(){if(o.get())c.define("SMOOTH");else c.removeDefine("SMOOTH")};l.onChange=function(){if(l.get())c.define("MASK");else c.removeDefine("MASK")};i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(t,3))return;let e=h.currentTextureEffect.getCurrentSourceTexture();g.setValue(s.get()*(1/e.width));d.setValue(1/e.width);h.pushShader(c);h.currentTextureEffect.bind();h.setTexture(0,e.tex);if(l.get())h.setTexture(1,l.get().tex);h.currentTextureEffect.finish();h.popShader();u.trigger()}}};CABLES.OPS["07701f81-1a98-44c0-b1ef-592db3cbb5d3"]={f:Ops.Gl.ImageCompose.ChromaticAberration_v2,objName:"Ops.Gl.ImageCompose.ChromaticAberration_v2"};Ops.Gl.ImageCompose.FastBlur_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={blur_frag:"\nUNI sampler2D tex;\n#ifdef USE_MASK\n    UNI sampler2D texMask;\n#endif\nUNI float amount;\nUNI float pass;\n\nIN vec2 texCoord;\n\nUNI float dirX;\nUNI float dirY;\nUNI float width;\nUNI float height;\n\nIN vec2 coord0;\nIN vec2 coord1;\nIN vec2 coord2;\nIN vec2 coord3;\nIN vec2 coord4;\nIN vec2 coord5;\nIN vec2 coord6;\n\n#ifdef HAS_MASK\n    UNI sampler2D imageMask;\n#endif\n\nvoid main()\n{\n    vec4 color = vec4(0.0);\n\n    #ifdef USE_MASK\n        #ifdef MASK_INVERT\n            if(texture(texMask,texCoord).r<0.5)\n            {\n                outColor= texture(tex, texCoord);\n                return;\n            }\n        #endif\n\n        #ifndef MASK_INVERT\n            if(texture(texMask,texCoord).r>0.5)\n            {\n                outColor= texture(tex, texCoord);\n                return;\n            }\n        #endif\n    #endif\n\n    color += texture(tex, coord0) * 0.06927096443792478;\n    color += texture(tex, coord1) * 0.1383328848652136;\n    color += texture(tex, coord2) * 0.21920904690397863;\n    color += texture(tex, coord3) * 0.14637421;\n    color += texture(tex, coord4) * 0.21920904690397863;\n    color += texture(tex, coord5) * 0.1383328848652136;\n    color += texture(tex, coord6) * 0.06927096443795711;\n\n    outColor= color;\n}",blur_vert:"\nIN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 mvMatrix;\nUNI mat4 modelMatrix;\n\nUNI float pass;\nUNI float dirX;\nUNI float dirY;\nUNI float width;\nUNI float height;\n\nOUT vec2 coord0;\nOUT vec2 coord1;\nOUT vec2 coord2;\nOUT vec2 coord3;\nOUT vec2 coord4;\nOUT vec2 coord5;\nOUT vec2 coord6;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    {{MODULE_VERTEX_POSITION}}\n\n    vec2 dir=vec2(dirX,dirY);\n    vec2 res=vec2( (1.) / width , (1.) / height )*dir;\n\n    coord3= attrTexCoord;\n\n    coord0= attrTexCoord + (-3.0368997744118595 * res);\n    coord1= attrTexCoord + (-2.089778445362373 * res);\n    coord2= attrTexCoord + (-1.2004366090034069 * res);\n    coord4= attrTexCoord + (1.2004366090034069 * res);\n    coord5= attrTexCoord + (2.089778445362373* res);\n    coord6= attrTexCoord + (3.0368997744118595 * res);\n\n    #ifdef CLAMP\n        coord0=clamp(coord0,0.0,1.0);\n        coord1=clamp(coord1,0.0,1.0);\n        coord2=clamp(coord2,0.0,1.0);\n        coord3=clamp(coord3,0.0,1.0);\n        coord4=clamp(coord4,0.0,1.0);\n        coord5=clamp(coord5,0.0,1.0);\n        coord6=clamp(coord6,0.0,1.0);\n    #endif\n\n    gl_Position = projMatrix * mvMatrix * pos;\n}\n"};const i=e.inTrigger("render"),r=e.outTrigger("trigger"),n=e.inInt("Passes",3),s=e.inBool("Clamp",false),a=e.inDropDown("direction",["both","vertical","horizontal"],"both"),o=e.inTexture("Mask"),l=e.inBool("Mask Invert",false);const u=e.patch.cgl;const h=new CGL.Shader(u,"fastblur");e.setPortGroup("Mask",[o,l]);h.setSource(t.blur_vert,t.blur_frag);const c=new CGL.Uniform(h,"t","tex",0),f=new CGL.Uniform(h,"f","dirX",0),g=new CGL.Uniform(h,"f","dirY",0),d=new CGL.Uniform(h,"f","width",0),m=new CGL.Uniform(h,"f","height",0),p=new CGL.Uniform(h,"f","pass",0),_=new CGL.Uniform(h,"f","amount",n.get()),b=new CGL.Uniform(h,"t","texMask",1);n.onChange=()=>{_.setValue(n.get())};let v=0;a.onChange=()=>{if(a.get()=="both")v=0;if(a.get()=="horizontal")v=1;if(a.get()=="vertical")v=2};s.onChange=()=>{h.toggleDefine("CLAMP",s.get())};l.onChange=o.onChange=x;x();function x(){h.toggleDefine("USE_MASK",o.isLinked());h.toggleDefine("MASK_INVERT",l.get());l.setUiAttribs({greyout:!o.isLinked()})}i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;d.setValue(u.currentTextureEffect.getCurrentSourceTexture().width);m.setValue(u.currentTextureEffect.getCurrentSourceTexture().height);const t=n.get();if(o.get())u.setTexture(1,o.get().tex);for(let e=0;e<t;e++){u.pushShader(h);p.setValue(e/t);if(v===0||v==2){u.currentTextureEffect.bind();u.setTexture(0,u.currentTextureEffect.getCurrentSourceTexture().tex);f.setValue(0);g.setValue(1+e*e);u.currentTextureEffect.finish()}if(v===0||v==1){u.currentTextureEffect.bind();u.setTexture(0,u.currentTextureEffect.getCurrentSourceTexture().tex);f.setValue(1+e*e);g.setValue(0);u.currentTextureEffect.finish()}u.popShader()}r.trigger()}}};CABLES.OPS["61ed277f-d096-43b2-9de8-dc87fb3a9169"]={f:Ops.Gl.ImageCompose.FastBlur_v2,objName:"Ops.Gl.ImageCompose.FastBlur_v2"};Ops.Gl.ImageCompose.Noise.SimplexNoise_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={simplexnoise_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\nUNI float smoothness;\nUNI float scale;\nUNI float seed;\nUNI float x;\nUNI float y;\nUNI float time;\nUNI float aspect;\nUNI float harmonics;\n\n#ifdef HAS_TEX_OFFSETMAP\n    UNI sampler2D texOffsetZ;\n    UNI float offMul;\n#endif\n\n\n#ifdef HAS_TEX_MASK\n    UNI sampler2D texMask;\n#endif\n\n\n\n{{CGL.BLENDMODES3}}\n\nvoid FAST32_hash_3D(    vec3 gridcell,\n                        vec3 v1_mask,       //  user definable v1 and v2.  ( 0s and 1s )\n                        vec3 v2_mask,\n                        out vec4 hash_0,\n                        out vec4 hash_1,\n                        out vec4 hash_2 )       //  generates 3 random numbers for each of the 4 3D cell corners.  cell  corners:  v0=0,0,0  v3=1,1,1  the other two are user definable\n{\n    //    gridcell is assumed to be an integer coordinate\n\n    //  TODO:   these constants need tweaked to find the best possible noise.\n    //          probably requires some kind of brute force computational searching or something....\n    const vec2 OFFSET = vec2( 50.0, 161.0 );\n    const float DOMAIN = 69.0;\n    const vec3 SOMELARGEFLOATS = vec3( 635.298681, 682.357502, 668.926525 );\n    const vec3 ZINC = vec3( 48.500388, 65.294118, 63.934599 );\n\n    //  truncate the domain\n    gridcell.xyz = gridcell.xyz - floor(gridcell.xyz * ( 1.0 / DOMAIN )) * DOMAIN;\n    vec3 gridcell_inc1 = step( gridcell, vec3( DOMAIN - 1.5 ) ) * ( gridcell + 1.0 );\n\n    //  compute x*x*y*y for the 4 corners\n    vec4 P = vec4( gridcell.xy, gridcell_inc1.xy ) + OFFSET.xyxy;\n    P *= P;\n    vec4 V1xy_V2xy = mix( P.xyxy, P.zwzw, vec4( v1_mask.xy, v2_mask.xy ) );     //  appl y mask for v1 and v2\n    P = vec4( P.x, V1xy_V2xy.xz, P.z ) * vec4( P.y, V1xy_V2xy.yw, P.w );\n\n    //  get the lowz and highz mods\n    vec3 lowz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + gridcell.zzz * ZINC.xyz ) );\n    vec3 highz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + gridcell_inc1.zzz * ZINC.xyz ) );\n\n    //  appl mask for v1 and v2 mod values\n    v1_mask = ( v1_mask.z < 0.5 ) ? lowz_mods : highz_mods;\n    v2_mask = ( v2_mask.z < 0.5 ) ? lowz_mods : highz_mods;\n\n    //  compute the final hash\n    hash_0 = fract( P * vec4( lowz_mods.x, v1_mask.x, v2_mask.x, highz_mods.x ) );\n    hash_1 = fract( P * vec4( lowz_mods.y, v1_mask.y, v2_mask.y, highz_mods.y ) );\n    hash_2 = fract( P * vec4( lowz_mods.z, v1_mask.z, v2_mask.z, highz_mods.z ) );\n}\n\n\n//\n//  Given an arbitrary 3D point this calculates the 4 vectors from the corners of the simplex pyramid to the point\n//  It also returns the integer grid index information for the corners\n//\nvoid Simplex3D_GetCornerVectors(    vec3 P,                 //  input point\n                                    out vec3 Pi,            //  integer grid index for the origin\n                                    out vec3 Pi_1,          //  offsets for the 2nd and 3rd corners.  ( the 4th = Pi + 1.0 )\n                                    out vec3 Pi_2,\n                                    out vec4 v1234_x,       //  vectors from the 4 corners to the intput point\n                                    out vec4 v1234_y,\n                                    out vec4 v1234_z )\n{\n    //\n    //  Simplex math from Stefan Gustavsons and Ian McEwans work at...\n    //  http://github.com/ashima/webgl-noise\n    //\n\n    //  simplex math constants\n    const float SKEWFACTOR = 1.0/3.0;\n    const float UNSKEWFACTOR = 1.0/6.0;\n    const float SIMPLEX_CORNER_POS = 0.5;\n    const float SIMPLEX_PYRAMID_HEIGHT = 0.70710678118654752440084436210485;    // sqrt( 0.5 )  height of simplex pyramid.\n\n    P *= SIMPLEX_PYRAMID_HEIGHT;        // scale space so we can have an approx feature size of 1.0  ( optional )\n\n    //  Find the vectors to the corners of our simplex pyramid\n    Pi = floor( P + dot( P, vec3( SKEWFACTOR) ) );\n    vec3 x0 = P - Pi + dot(Pi, vec3( UNSKEWFACTOR ) );\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    Pi_1 = min( g.xyz, l.zxy );\n    Pi_2 = max( g.xyz, l.zxy );\n    vec3 x1 = x0 - Pi_1 + UNSKEWFACTOR;\n    vec3 x2 = x0 - Pi_2 + SKEWFACTOR;\n    vec3 x3 = x0 - SIMPLEX_CORNER_POS;\n\n    //  pack them into a parallel-friendly arrangement\n    v1234_x = vec4( x0.x, x1.x, x2.x, x3.x );\n    v1234_y = vec4( x0.y, x1.y, x2.y, x3.y );\n    v1234_z = vec4( x0.z, x1.z, x2.z, x3.z );\n}\n\n//\n//  Calculate the weights for the 3D simplex surflet\n//\nvec4 Simplex3D_GetSurfletWeights(   vec4 v1234_x,\n                                    vec4 v1234_y,\n                                    vec4 v1234_z )\n{\n    //  perlins original implementation uses the surlet falloff formula of (0.6-x*x)^4.\n    //  This is buggy as it can cause discontinuities along simplex faces.  (0.5-x*x)^3 solves this and gives an almost identical curve\n\n    //  evaluate surflet. f(x)=(0.5-x*x)^3\n    vec4 surflet_weights = v1234_x * v1234_x + v1234_y * v1234_y + v1234_z * v1234_z;\n    surflet_weights = max(0.5 - surflet_weights, 0.0);      //  0.5 here represents the closest distance (squared) of any simplex pyramid corner to any of its planes.  ie, SIMPLEX_PYRAMID_HEIGHT^2\n    return surflet_weights*surflet_weights*surflet_weights;\n}\n\n\n\n//\n//  SimplexPerlin3D  ( simplex gradient noise )\n//  Perlin noise over a simplex (tetrahedron) grid\n//  Return value range of -1.0->1.0\n//  http://briansharpe.files.wordpress.com/2012/01/simplexperlinsample.jpg\n//\n//  Implementation originally based off Stefan Gustavsons and Ian McEwans work at...\n//  http://github.com/ashima/webgl-noise\n//\nfloat SimplexPerlin3D(vec3 P)\n{\n    //  calculate the simplex vector and index math\n    vec3 Pi;\n    vec3 Pi_1;\n    vec3 Pi_2;\n    vec4 v1234_x;\n    vec4 v1234_y;\n    vec4 v1234_z;\n    Simplex3D_GetCornerVectors( P, Pi, Pi_1, Pi_2, v1234_x, v1234_y, v1234_z );\n\n    //  generate the random vectors\n    //  ( various hashing methods listed in order of speed )\n    vec4 hash_0;\n    vec4 hash_1;\n    vec4 hash_2;\n    FAST32_hash_3D( Pi, Pi_1, Pi_2, hash_0, hash_1, hash_2 );\n    //SGPP_hash_3D( Pi, Pi_1, Pi_2, hash_0, hash_1, hash_2 );\n    hash_0 -= 0.49999;\n    hash_1 -= 0.49999;\n    hash_2 -= 0.49999;\n\n    //  evaluate gradients\n    vec4 grad_results = inversesqrt( hash_0 * hash_0 + hash_1 * hash_1 + hash_2 * hash_2 ) * ( hash_0 * v1234_x + hash_1 * v1234_y + hash_2 * v1234_z );\n\n    //  Normalization factor to scale the final result to a strict 1.0->-1.0 range\n    //  x = sqrt( 0.75 ) * 0.5\n    //  NF = 1.0 / ( x * ( ( 0.5 * x*x ) ^ 3 ) * 2.0 )\n    //  http://briansharpe.wordpress.com/2012/01/13/simplex-noise/#comment-36\n     float FINAL_NORMALIZATION = 37.837227241611314102871574478976*smoothness;\n\n    //  sum with the surflet and return\n    return dot( Simplex3D_GetSurfletWeights( v1234_x, v1234_y, v1234_z ), grad_results ) * FINAL_NORMALIZATION;\n}\n\nvoid main()\n{\n    vec2 p=vec2(texCoord.x-0.5,texCoord.y-0.5);\n\n    p.x*=aspect;\n    p=p*scale;\n\n    p=vec2(p.x+0.5-x,p.y+0.5-y);\n\n    vec3 offset;\n    #ifdef HAS_TEX_OFFSETMAP\n        vec4 offMap=texture(texOffsetZ,texCoord);\n\n        #ifdef OFFSET_X_R\n            offset.x=offMap.r;\n        #endif\n        #ifdef OFFSET_X_G\n            offset.x=offMap.g;\n        #endif\n        #ifdef OFFSET_X_B\n            offset.x=offMap.b;\n        #endif\n\n        #ifdef OFFSET_Y_R\n            offset.y=offMap.r;\n        #endif\n        #ifdef OFFSET_Y_G\n            offset.y=offMap.g;\n        #endif\n        #ifdef OFFSET_Y_B\n            offset.y=offMap.b;\n        #endif\n\n        #ifdef OFFSET_Z_R\n            offset.z=offMap.r;\n        #endif\n        #ifdef OFFSET_Z_G\n            offset.z=offMap.g;\n        #endif\n        #ifdef OFFSET_Z_B\n            offset.z=offMap.b;\n        #endif\n\n        offset*=offMul;\n    #endif\n\n    float v=SimplexPerlin3D(vec3(p.x,p.y,time)+offset)*0.5+0.5;\n\n\n    if (harmonics >= 2.0) v += SimplexPerlin3D(vec3(p.x,p.y,time)*2.3+offset) * 0.5;\n    if (harmonics >= 3.0) v += SimplexPerlin3D(vec3(p.x,p.y,time)*4.2+offset) * 0.25;\n    if (harmonics >= 4.0) v += SimplexPerlin3D(vec3(p.x,p.y,time)*8.1+offset) * 0.125;\n    if (harmonics >= 5.0) v += SimplexPerlin3D(vec3(p.x,p.y,time)*16.7+offset) * 0.0625;\n\n\n\n    //blend section\n    vec4 col=vec4(v,v,v,1.0);\n\n    vec4 base=texture(tex,texCoord);\n\n    // outColor=cgl_blend(base,col,amount);\n\n\n    float str=1.0;\n    #ifdef HAS_TEX_MASK\n        str=texture(texMask,texCoord).r;\n    #endif\n\n    outColor=cgl_blendPixel(base,col,amount*str);\n\n}"};const i=e.inTrigger("render"),r=e.inTexture("Mask"),n=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),s=e.inValueSlider("Amount",1),a=CGL.TextureEffect.AddBlendAlphaMask(e),o=e.inValue("smoothness",1),l=e.inSwitch("Harmonics",["1","2","3","4","5"],"1"),u=e.inValue("scale",7),h=e.outTrigger("trigger"),c=e.inValue("x"),f=e.inValue("y"),g=e.inValue("time",0);const d=e.inTexture("Offset"),m=e.inFloat("Offset Multiply",1),p=e.inSwitch("Offset X",["None","R","G","B"],"None"),_=e.inSwitch("Offset Y",["None","R","G","B"],"None"),b=e.inSwitch("Offset Z",["None","R","G","B"],"R");e.setPortGroup("Offset Map",[d,b,_,p,m]);const v=e.patch.cgl;const x=new CGL.Shader(v,e.name,e);x.setSource(x.getDefaultVertexShader(),t.simplexnoise_frag);const E=new CGL.Uniform(x,"t","tex",0),A=new CGL.Uniform(x,"t","texOffsetZ",1),T=new CGL.Uniform(x,"t","texMask",2),O=new CGL.Uniform(x,"f","amount",s),I=new CGL.Uniform(x,"f","smoothness",o),S=new CGL.Uniform(x,"f","scale",u),M=new CGL.Uniform(x,"f","x",c),C=new CGL.Uniform(x,"f","y",f),R=new CGL.Uniform(x,"f","aspect",1),N=new CGL.Uniform(x,"f","time",g),y=new CGL.Uniform(x,"f","offMul",m),P=new CGL.Uniform(x,"f","harmonics",0);l.onChange=()=>{P.setValue(parseFloat(l.get()))};CGL.TextureEffect.setupBlending(e,x,n,s,a);p.onChange=_.onChange=b.onChange=r.onChange=d.onChange=L;L();function L(){x.toggleDefine("HAS_TEX_OFFSETMAP",d.get());x.toggleDefine("HAS_TEX_MASK",r.get());x.toggleDefine("OFFSET_X_R",p.get()=="R");x.toggleDefine("OFFSET_X_G",p.get()=="G");x.toggleDefine("OFFSET_X_B",p.get()=="B");x.toggleDefine("OFFSET_Y_R",_.get()=="R");x.toggleDefine("OFFSET_Y_G",_.get()=="G");x.toggleDefine("OFFSET_Y_B",_.get()=="B");x.toggleDefine("OFFSET_Z_R",b.get()=="R");x.toggleDefine("OFFSET_Z_G",b.get()=="G");x.toggleDefine("OFFSET_Z_B",b.get()=="B");p.setUiAttribs({greyout:!d.isLinked()});_.setUiAttribs({greyout:!d.isLinked()});b.setUiAttribs({greyout:!d.isLinked()});m.setUiAttribs({greyout:!d.isLinked()})}i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;v.pushShader(x);v.currentTextureEffect.bind();R.setValue(v.currentTextureEffect.aspectRatio);v.setTexture(0,v.currentTextureEffect.getCurrentSourceTexture().tex);if(d.get())v.setTexture(1,d.get().tex);if(r.get())v.setTexture(2,r.get().tex);v.currentTextureEffect.finish();v.popShader();h.trigger()}}};CABLES.OPS["0f4a8d04-89b0-437a-9da8-b4098772d250"]={f:Ops.Gl.ImageCompose.Noise.SimplexNoise_v2,objName:"Ops.Gl.ImageCompose.Noise.SimplexNoise_v2"};Ops.Gl.ImageCompose.PixelDisplacement_v4=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={pixeldisplace3_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI sampler2D displaceTex;\nUNI float amountX;\nUNI float amountY;\nUNI float amount;\n\n#ifdef MAPPING_REPEAT\n    UNI vec2 repeat;\n#endif\n\n{{CGL.BLENDMODES3}}\n\nvec3 getOffset(vec3 offset)\n{\n    #ifdef ZERO_BLACK\n        return offset;\n    #endif\n\n    #ifdef ZERO_GREY\n        return offset*2.0-1.0;\n    #endif\n}\n\nfloat getOffset(float offset)\n{\n    #ifdef ZERO_BLACK\n        return offset;\n    #endif\n\n    #ifdef ZERO_GREY\n        return offset*2.0-1.0;\n    #endif\n}\n\nvoid main()\n{\n    #ifndef MAPPING_REPEAT\n        vec4 rgba=texture(displaceTex,texCoord);\n    #endif\n    #ifdef MAPPING_REPEAT\n        vec4 rgba=texture(displaceTex,texCoord*repeat);\n    #endif\n\n    vec3 offset=rgba.rgb*rgba.a;\n    float x,y;\n\n    #ifdef INPUT_REDGREEN\n        offset=getOffset(offset);\n        x=offset.r*amountX+texCoord.x;\n        y=offset.g*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_RED\n        offset=getOffset(offset);\n        x=offset.r*amountX+texCoord.x;\n        y=offset.r*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_GREEN\n        offset=getOffset(offset);\n        x=offset.g*amountX+texCoord.x;\n        y=offset.g*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_BLUE\n        offset=getOffset(offset);\n        x=offset.b*amountX+texCoord.x;\n        y=offset.b*amountY+texCoord.y;\n    #endif\n    #ifdef INPUT_LUMINANCE\n        float o=dot(vec3(0.2126,0.7152,0.0722), offset);\n        o=getOffset(o);\n        x=o*amountX+texCoord.x;\n        y=o*amountY+texCoord.y;\n    #endif\n    #ifdef WRAP_CLAMP\n        x=clamp(x,0.0,1.0);\n        y=clamp(y,0.0,1.0);\n    #endif\n    #ifdef WRAP_REPEAT\n        x=mod(x,1.0);\n        y=mod(y,1.0);\n    #endif\n    #ifdef WRAP_MIRROR\n        float mx=mod(x,2.0);\n        float my=mod(y,2.0);\n        x=abs((floor(mx)-fract(mx)));\n        y=abs((floor(my)-fract(my)));\n    #endif\n\n\n\n    vec4 col=texture(tex,vec2(x,y));\n    vec4 base=texture(tex,texCoord);\n\n    base.a=0.0;\n\n    outColor=cgl_blendPixel(base,col,amount);\n}\n\n\n//////"};const i=e.inTrigger("render"),r=e.inTexture("displaceTex"),n=CGL.TextureEffect.AddBlendSelect(e,"Blend Mode","normal"),s=e.inValueSlider("Amount",1),a=e.inValueSlider("amount X",.2),o=e.inValueSlider("amount Y",.2),l=e.inSwitch("Wrap",["Mirror","Clamp","Repeat"],"Mirror"),u=e.inValueSelect("Input",["Luminance","RedGreen","Red","Green","Blue"],"Luminance"),h=e.inSwitch("Zero Displace",["Grey","Black"],"Grey"),c=e.inSwitch("Pixel Mapping",["Stretch","Repeat"],"Stretch"),f=e.outTrigger("trigger");e.setPortGroup("Axis Displacement Strength",[a,o]);e.setPortGroup("Modes",[l,u]);e.toWorkPortsNeedToBeLinked(r);const g=e.patch.cgl,d=new CGL.Shader(g,e.name,e);d.setSource(d.getDefaultVertexShader(),t.pixeldisplace3_frag);const m=new CGL.Uniform(d,"t","tex",0),p=new CGL.Uniform(d,"t","displaceTex",1),_=new CGL.Uniform(d,"f","amountX",a),b=new CGL.Uniform(d,"f","amountY",o),v=new CGL.Uniform(d,"2f","repeat",1,1),x=new CGL.Uniform(d,"f","amount",s);c.onChange=h.onChange=l.onChange=u.onChange=E;E();CGL.TextureEffect.setupBlending(e,d,n,s);function E(){d.toggleDefine("MAPPING_REPEAT",c.get()=="Repeat");d.removeDefine("ZERO_BLACK");d.removeDefine("ZERO_GREY");d.define("ZERO_"+(h.get()+"").toUpperCase());d.removeDefine("WRAP_CLAMP");d.removeDefine("WRAP_REPEAT");d.removeDefine("WRAP_MIRROR");d.define("WRAP_"+(l.get()+"").toUpperCase());d.removeDefine("INPUT_LUMINANCE");d.removeDefine("INPUT_REDGREEN");d.removeDefine("INPUT_RED");d.define("INPUT_"+(u.get()+"").toUpperCase())}i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e,3))return;if(r.get()){g.pushShader(d);g.currentTextureEffect.bind();v.setValue([g.currentTextureEffect.getCurrentSourceTexture().width/r.get().width,g.currentTextureEffect.getCurrentSourceTexture().height/r.get().height]);g.setTexture(0,g.currentTextureEffect.getCurrentSourceTexture().tex);if(r.get())g.setTexture(1,r.get().tex);g.currentTextureEffect.finish();g.popShader()}f.trigger()}}};CABLES.OPS["c00f79f2-0505-4b4f-b0bf-10ef7875dd87"]={f:Ops.Gl.ImageCompose.PixelDisplacement_v4,objName:"Ops.Gl.ImageCompose.PixelDisplacement_v4"};Ops.Gl.ImageCompose.Blur=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={blur_frag:"IN vec2 texCoord;\nUNI sampler2D tex;\nUNI float dirX;\nUNI float dirY;\nUNI float amount;\n\n#ifdef HAS_MASK\n    UNI sampler2D imageMask;\n#endif\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main()\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float am=amount;\n    #ifdef HAS_MASK\n        am=amount*texture(imageMask,texCoord).r;\n        if(am<=0.02)\n        {\n            outColor=texture(tex, texCoord);\n            return;\n        }\n    #endif\n\n    vec2 delta=vec2(dirX*am*0.01,dirY*am*0.01);\n\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n    #ifdef MOBILE\n        offset = 0.1;\n    #endif\n\n    #if defined(FASTBLUR) && !defined(MOBILE)\n        const float range=5.0;\n    #else\n        const float range=20.0;\n    #endif\n\n    for (float t = -range; t <= range; t+=1.0)\n    {\n        float percent = (t + offset - 0.5) / range;\n        float weight = 1.0 - abs(percent);\n        vec4 smpl = texture(tex, texCoord + delta * percent);\n\n        smpl.rgb *= smpl.a;\n\n        color += smpl * weight;\n        total += weight;\n    }\n\n    outColor= color / total;\n\n    outColor.rgb /= outColor.a + 0.00001;\n\n\n\n}\n"};const i=e.inTrigger("render");const r=e.outTrigger("trigger");const n=e.inValueFloat("amount");const s=e.inSwitch("direction",["both","vertical","horizontal"],"both");const a=e.inValueBool("Fast",true);const o=e.patch.cgl;n.set(10);let l=new CGL.Shader(o,"blur");l.define("FASTBLUR");a.onChange=function(){if(a.get())l.define("FASTBLUR");else l.removeDefine("FASTBLUR")};l.setSource(l.getDefaultVertexShader(),t.blur_frag);let u=new CGL.Uniform(l,"t","tex",0);let h=new CGL.Uniform(l,"f","dirX",0);let c=new CGL.Uniform(l,"f","dirY",0);let f=new CGL.Uniform(l,"f","width",0);let g=new CGL.Uniform(l,"f","height",0);let d=new CGL.Uniform(l,"f","amount",n.get());n.onChange=function(){d.setValue(n.get())};let m=new CGL.Uniform(l,"t","imageMask",1);let p=false;function _(){if(o.currentTextureEffect.getCurrentSourceTexture().width==o.canvasWidth&&o.currentTextureEffect.getCurrentSourceTexture().height==o.canvasHeight){e.setUiError("warning","Full screen blurs are slow! Try reducing the resolution to 1/2 or a 1/4",0)}else{e.setUiError("warning",null)}}let b=0;s.onChange=function(){if(s.get()=="both")b=0;if(s.get()=="horizontal")b=1;if(s.get()=="vertical")b=2};let v=e.inTexture("mask");v.onChange=function(){if(v.get()&&v.get().tex)l.define("HAS_MASK");else l.removeDefine("HAS_MASK")};i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;o.pushShader(l);f.setValue(o.currentTextureEffect.getCurrentSourceTexture().width);g.setValue(o.currentTextureEffect.getCurrentSourceTexture().height);_();if(b===0||b==2){o.currentTextureEffect.bind();o.setTexture(0,o.currentTextureEffect.getCurrentSourceTexture().tex);if(v.get()&&v.get().tex){o.setTexture(1,v.get().tex)}h.setValue(0);c.setValue(1);o.currentTextureEffect.finish()}if(b===0||b==1){o.currentTextureEffect.bind();o.setTexture(0,o.currentTextureEffect.getCurrentSourceTexture().tex);if(v.get()&&v.get().tex){o.setTexture(1,v.get().tex)}h.setValue(1);c.setValue(0);o.currentTextureEffect.finish()}o.popShader();r.trigger()}}};CABLES.OPS["54f26f53-f637-44c1-9bfb-a2f2b722e998"]={f:Ops.Gl.ImageCompose.Blur,objName:"Ops.Gl.ImageCompose.Blur"};Ops.Gl.ImageCompose.Desaturate=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={desaturate_frag:"\nIN vec2 texCoord;\nUNI sampler2D tex;\nUNI float amount;\n\n#ifdef MASK\n    UNI sampler2D mask;\n#endif\n\nvec3 desaturate(vec3 color, float amount)\n{\n   vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), color));\n   return vec3(mix(color, gray, amount));\n}\n\nvoid main()\n{\n    vec4 col=texture(tex,texCoord);\n\n    float am=amount;\n    #ifdef MASK\n        am*=1.0-texture(mask,texCoord).r;\n        #ifdef INVERTMASK\n        am=1.0-am;\n        #endif\n    #endif\n\n    col.rgb=desaturate(col.rgb,am);\n    outColor= col;\n}"};const i=e.inTrigger("render");const r=e.outTrigger("trigger");const n=e.inValueSlider("amount",1);const s=e.inTexture("Mask");const a=e.inValueBool("Invert Mask");const o=e.patch.cgl;const l=new CGL.Shader(o,e.name,e);l.setSource(l.getDefaultVertexShader(),t.desaturate_frag);let u=new CGL.Uniform(l,"t","tex",0);let h=new CGL.Uniform(l,"t","mask",1);let c=new CGL.Uniform(l,"f","amount",n);a.onChange=function(){if(a.get())l.define("INVERTMASK");else l.removeDefine("INVERTMASK")};s.onChange=function(){if(s.get())l.define("MASK");else l.removeDefine("MASK")};i.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(e))return;o.pushShader(l);o.currentTextureEffect.bind();o.setTexture(0,o.currentTextureEffect.getCurrentSourceTexture().tex);if(s.get())o.setTexture(1,s.get().tex);o.currentTextureEffect.finish();o.popShader();r.trigger()}}};CABLES.OPS["340efbd5-be53-4bd5-92ad-8f38d8eeecf1"]={f:Ops.Gl.ImageCompose.Desaturate,objName:"Ops.Gl.ImageCompose.Desaturate"};Ops.Anim.Timer_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const s=e.inValue("Speed",1),i=e.inValueBool("Play",true),r=e.inTriggerButton("Reset"),n=e.inValueBool("Sync to timeline",false),a=e.outNumber("Time");e.setPortGroup("Controls",[i,r,s]);const o=new CABLES.Timer;let l=null;let u=0;let h=false;i.onChange=c;c();function c(){if(i.get()){o.play();e.patch.addOnAnimFrame(e)}else{o.pause();e.patch.removeOnAnimFrame(e)}}r.onTriggered=f;function f(){u=0;l=null;o.setTime(0);a.set(0)}n.onChange=function(){h=n.get();i.setUiAttribs({greyout:h});r.setUiAttribs({greyout:h})};e.onAnimFrame=function(e,t,i){if(o.isPlaying()){if(CABLES.overwriteTime!==undefined){a.set(CABLES.overwriteTime*s.get())}else if(h){a.set(e*s.get())}else{o.update();const r=o.get();if(l===null){l=r;return}const n=Math.abs(r-l);l=r;u+=n*s.get();if(u!=u)u=0;a.set(u)}}}}};CABLES.OPS["aac7f721-208f-411a-adb3-79adae2e471a"]={f:Ops.Anim.Timer_v2,objName:"Ops.Anim.Timer_v2"};Ops.Gl.ImageCompose.DrawImage_v3=class extends CABLES.Op{constructor(){super(...arguments);const r=this;const e=r.attachments={drawimage_frag:"#ifdef HAS_TEXTURES\n    IN vec2 texCoord;\n    UNI sampler2D tex;\n    UNI sampler2D image;\n#endif\n\n#ifdef TEX_TRANSFORM\n    IN mat3 transform;\n#endif\n// UNI float rotate;\n\n{{CGL.BLENDMODES}}\n\n#ifdef HAS_TEXTUREALPHA\n   UNI sampler2D imageAlpha;\n#endif\n\nUNI float amount;\n\n#ifdef ASPECT_RATIO\n    UNI float aspectTex;\n    UNI float aspectPos;\n#endif\n\nvoid main()\n{\n    vec4 blendRGBA=vec4(0.0,0.0,0.0,1.0);\n\n    #ifdef HAS_TEXTURES\n        vec2 tc=texCoord;\n\n        #ifdef TEX_FLIP_X\n            tc.x=1.0-tc.x;\n        #endif\n        #ifdef TEX_FLIP_Y\n            tc.y=1.0-tc.y;\n        #endif\n\n        #ifdef ASPECT_RATIO\n            #ifdef ASPECT_AXIS_X\n                tc.y=(1.0-aspectPos)-(((1.0-aspectPos)-tc.y)*aspectTex);\n            #endif\n            #ifdef ASPECT_AXIS_Y\n                tc.x=(1.0-aspectPos)-(((1.0-aspectPos)-tc.x)/aspectTex);\n            #endif\n        #endif\n\n        #ifdef TEX_TRANSFORM\n            vec3 coordinates=vec3(tc.x, tc.y,1.0);\n            tc=(transform * coordinates ).xy;\n        #endif\n\n        blendRGBA=texture(image,tc);\n\n        vec3 blend=blendRGBA.rgb;\n        vec4 baseRGBA=texture(tex,texCoord);\n        vec3 base=baseRGBA.rgb;\n\n\n        #ifdef PREMUL\n            blend.rgb = (blend.rgb) + (base.rgb * (1.0 - blendRGBA.a));\n        #endif\n\n        vec3 colNew=_blend(base,blend);\n\n\n\n\n        #ifdef REMOVE_ALPHA_SRC\n            blendRGBA.a=1.0;\n        #endif\n\n        #ifdef HAS_TEXTUREALPHA\n            vec4 colImgAlpha=texture(imageAlpha,tc);\n            float colImgAlphaAlpha=colImgAlpha.a;\n\n            #ifdef ALPHA_FROM_LUMINANCE\n                vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), colImgAlpha.rgb ));\n                colImgAlphaAlpha=(gray.r+gray.g+gray.b)/3.0;\n            #endif\n\n            #ifdef ALPHA_FROM_INV_UMINANCE\n                vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), colImgAlpha.rgb ));\n                colImgAlphaAlpha=1.0-(gray.r+gray.g+gray.b)/3.0;\n            #endif\n\n            #ifdef INVERT_ALPHA\n                colImgAlphaAlpha=clamp(colImgAlphaAlpha,0.0,1.0);\n                colImgAlphaAlpha=1.0-colImgAlphaAlpha;\n            #endif\n\n            blendRGBA.a=colImgAlphaAlpha*blendRGBA.a;\n        #endif\n    #endif\n\n    float am=amount;\n\n    #ifdef CLIP_REPEAT\n        if(tc.y>1.0 || tc.y<0.0 || tc.x>1.0 || tc.x<0.0)\n        {\n            // colNew.rgb=vec3(0.0);\n            am=0.0;\n        }\n    #endif\n\n    #ifdef ASPECT_RATIO\n        #ifdef ASPECT_CROP\n            if(tc.y>1.0 || tc.y<0.0 || tc.x>1.0 || tc.x<0.0)\n            {\n                colNew.rgb=base.rgb;\n                am=0.0;\n            }\n\n        #endif\n    #endif\n\n\n\n    #ifndef PREMUL\n        blendRGBA.rgb=mix(colNew,base,1.0-(am*blendRGBA.a));\n        blendRGBA.a=clamp(baseRGBA.a+(blendRGBA.a*am),0.,1.);\n    #endif\n\n    #ifdef PREMUL\n        // premultiply\n        // blendRGBA.rgb = (blendRGBA.rgb) + (baseRGBA.rgb * (1.0 - blendRGBA.a));\n        blendRGBA=vec4(\n            mix(colNew.rgb,base,1.0-(am*blendRGBA.a)),\n            blendRGBA.a*am+baseRGBA.a\n            );\n    #endif\n\n    #ifdef ALPHA_MASK\n    blendRGBA.a=baseRGBA.a;\n    #endif\n\n    outColor=blendRGBA;\n}\n\n\n\n\n\n\n\n",drawimage_vert:"IN vec3 vPosition;\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\n\nUNI mat4 projMatrix;\nUNI mat4 mvMatrix;\n\nOUT vec2 texCoord;\n// OUT vec3 norm;\n\n#ifdef TEX_TRANSFORM\n    UNI float posX;\n    UNI float posY;\n    UNI float scaleX;\n    UNI float scaleY;\n    UNI float rotate;\n    OUT mat3 transform;\n#endif\n\nvoid main()\n{\n   texCoord=attrTexCoord;\n//   norm=attrVertNormal;\n\n   #ifdef TEX_TRANSFORM\n        vec3 coordinates=vec3(attrTexCoord.x, attrTexCoord.y,1.0);\n        float angle = radians( rotate );\n        vec2 scale= vec2(scaleX,scaleY);\n        vec2 translate= vec2(posX,posY);\n\n        transform = mat3(   scale.x * cos( angle ), scale.x * sin( angle ), 0.0,\n            - scale.y * sin( angle ), scale.y * cos( angle ), 0.0,\n            - 0.5 * scale.x * cos( angle ) + 0.5 * scale.y * sin( angle ) - 0.5 * translate.x*2.0 + 0.5,  - 0.5 * scale.x * sin( angle ) - 0.5 * scale.y * cos( angle ) - 0.5 * translate.y*2.0 + 0.5, 1.0);\n   #endif\n\n   gl_Position = projMatrix * mvMatrix * vec4(vPosition,  1.0);\n}\n"};const t=r.inTrigger("render"),i=CGL.TextureEffect.AddBlendSelect(r,"blendMode"),n=r.inValueSlider("amount",1),s=r.inTexture("Image"),a=r.inValueBool("Premultiplied",false),o=r.inValueBool("Alpha Mask",false),l=r.inValueBool("removeAlphaSrc",false),u=r.inTexture("Mask"),h=r.inValueSelect("Mask Src",["alpha channel","luminance","luminance inv"],"luminance"),c=r.inBool("Invert alpha channel"),f=r.inValueBool("Aspect Ratio",false),g=r.inValueSelect("Stretch Axis",["X","Y"],"X"),d=r.inValueSlider("Position",0),m=r.inValueBool("Crop",false),p=r.outTrigger("trigger");i.set("normal");const _=r.patch.cgl;const b=new CGL.Shader(_,"drawimage");u.onLinkChanged=v;r.setPortGroup("Aspect Ratio",[f,d,m,g]);r.setPortGroup("Mask",[u,h,c]);function v(){if(u.isLinked()){l.setUiAttribs({greyout:true});h.setUiAttribs({greyout:false});c.setUiAttribs({greyout:false})}else{l.setUiAttribs({greyout:false});h.setUiAttribs({greyout:true});c.setUiAttribs({greyout:true})}}r.toWorkPortsNeedToBeLinked(s);b.setSource(e.drawimage_vert,e.drawimage_frag);const x=new CGL.Uniform(b,"t","tex",0),F=new CGL.Uniform(b,"t","image",1),k=new CGL.Uniform(b,"t","imageAlpha",2),E=new CGL.Uniform(b,"f","aspectTex",1),D=new CGL.Uniform(b,"f","aspectPos",d);f.onChange=m.onChange=g.onChange=A;function A(){b.removeDefine("ASPECT_AXIS_X");b.removeDefine("ASPECT_AXIS_Y");b.removeDefine("ASPECT_CROP");d.setUiAttribs({greyout:!f.get()});m.setUiAttribs({greyout:!f.get()});g.setUiAttribs({greyout:!f.get()});if(f.get()){b.define("ASPECT_RATIO");if(m.get())b.define("ASPECT_CROP");if(g.get()=="X")b.define("ASPECT_AXIS_X");if(g.get()=="Y")b.define("ASPECT_AXIS_Y")}else{b.removeDefine("ASPECT_RATIO");if(m.get())b.define("ASPECT_CROP");if(g.get()=="X")b.define("ASPECT_AXIS_X");if(g.get()=="Y")b.define("ASPECT_AXIS_Y")}}const T=r.inValueBool("flip x");const O=r.inValueBool("flip y");let I=r.inValueBool("Transform");let S=r.inValueSlider("Scale X",1);let M=r.inValueSlider("Scale Y",1);let C=r.inValue("Position X",0);let R=r.inValue("Position Y",0);let N=r.inValue("Rotation",0);const y=r.inValueBool("Clip Repeat",false);const U=new CGL.Uniform(b,"f","scaleX",S);const B=new CGL.Uniform(b,"f","scaleY",M);const V=new CGL.Uniform(b,"f","posX",C);const j=new CGL.Uniform(b,"f","posY",R);const G=new CGL.Uniform(b,"f","rotate",N);I.onChange=P;function P(){b.toggleDefine("TEX_TRANSFORM",I.get());S.setUiAttribs({greyout:!I.get()});M.setUiAttribs({greyout:!I.get()});C.setUiAttribs({greyout:!I.get()});R.setUiAttribs({greyout:!I.get()});N.setUiAttribs({greyout:!I.get()})}CGL.TextureEffect.setupBlending(r,b,i,n);const z=new CGL.Uniform(b,"f","amount",n);t.onTriggered=w;y.onChange=u.onChange=a.onChange=o.onChange=c.onChange=O.onChange=T.onChange=l.onChange=h.onChange=L;P();v();A();L();function L(){b.toggleDefine("REMOVE_ALPHA_SRC",l.get());b.toggleDefine("ALPHA_MASK",o.get());b.toggleDefine("CLIP_REPEAT",y.get());b.toggleDefine("HAS_TEXTUREALPHA",u.get()&&u.get().tex);b.toggleDefine("TEX_FLIP_X",T.get());b.toggleDefine("TEX_FLIP_Y",O.get());b.toggleDefine("INVERT_ALPHA",c.get());b.toggleDefine("ALPHA_FROM_LUMINANCE",h.get()=="luminance");b.toggleDefine("ALPHA_FROM_INV_UMINANCE",h.get()=="luminance_inv");b.toggleDefine("PREMUL",a.get())}function w(){if(!CGL.TextureEffect.checkOpInEffect(r))return;const e=s.get();if(e&&e.tex&&n.get()>0){_.pushShader(b);_.currentTextureEffect.bind();const t=_.currentTextureEffect.getCurrentSourceTexture();_.setTexture(0,t.tex);const i=1/(_.currentTextureEffect.getWidth()/_.currentTextureEffect.getHeight())*(e.width/e.height);E.setValue(i);_.setTexture(1,e.tex);if(u.get()&&u.get().tex){_.setTexture(2,u.get().tex)}_.pushBlendMode(CGL.BLEND_NONE,true);_.currentTextureEffect.finish();_.popBlendMode();_.popShader()}p.trigger()}}};CABLES.OPS["8f6b2f15-fcb0-4597-90c0-e5173f2969fe"]={f:Ops.Gl.ImageCompose.DrawImage_v3,objName:"Ops.Gl.ImageCompose.DrawImage_v3"};Ops.Gl.Texture_v2=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={};const s=n.inUrl("File",[".jpg",".png",".webp",".jpeg",".avif"]),t=n.inSwitch("Filter",["nearest","linear","mipmap"]),i=n.inValueSelect("Wrap",["repeat","mirrored repeat","clamp to edge"],"clamp to edge"),r=n.inSwitch("Anisotropic",["0","1","2","4","8","16"],"0"),a=n.inSwitch("Data Format",["R","RG","RGB","RGBA","SRGBA"],"RGBA"),o=n.inValueBool("Flip",false),l=n.inValueBool("Pre Multiplied Alpha",false),u=n.inValueBool("Active",true),h=n.inBool("Save Memory",true),c=n.outTexture("Texture"),f=n.inBool("Add Cachebuster",false),g=n.inTriggerButton("Reload"),d=n.outNumber("Width"),m=n.outNumber("Height"),p=n.outNumber("Aspect Ratio"),_=n.outBoolNum("Loaded",0),b=n.outBoolNum("Loading",0);const v=n.patch.cgl;n.toWorkPortsNeedToBeLinked(c);n.setPortGroup("Size",[d,m]);let x=null;let E=null;let A=null;let T=CGL.Texture.FILTER_MIPMAP;let O=CGL.Texture.WRAP_REPEAT;let I=0;let S=0;l.setUiAttribs({hidePort:true});l.onChange=s.onChange=a.onChange=f.onChange=o.onChange=C;r.onChange=t.onChange=y;i.onChange=P;t.set("mipmap");i.set("repeat");c.setRef(CGL.Texture.getEmptyTexture(v));g.onTriggered=C;u.onChange=function(){if(u.get()){if(x!=s.get()||!A)C();else c.setRef(A)}else{c.setRef(CGL.Texture.getEmptyTexture(v));d.set(CGL.Texture.getEmptyTexture(v).width);m.set(CGL.Texture.getEmptyTexture(v).height);if(A)A.delete();n.setUiAttrib({extendTitle:""});A=null}};const M=function(){const e=CGL.Texture.getTempTexture(v);c.setRef(e)};function C(e){clearTimeout(S);S=setTimeout(function(){N(e)},1)}function R(){if(a.get()=="R")return CGL.Texture.PFORMATSTR_R8UB;if(a.get()=="RG")return CGL.Texture.PFORMATSTR_RG8UB;if(a.get()=="RGB")return CGL.Texture.PFORMATSTR_RGB8UB;if(a.get()=="SRGBA")return CGL.Texture.PFORMATSTR_SRGBA8;return CGL.Texture.PFORMATSTR_RGBA8UB}function N(e){n.checkMainloopExists();if(!u.get())return;if(E)E=v.patch.loading.finished(E);E=v.patch.loading.start(n.objName,s.get(),n);let t=n.patch.getFilePath(String(s.get()));if(f.get()||e===true)t=CABLES.cacheBust(t);if(String(s.get()).indexOf("data:")==0)t=s.get();let i=false;x=s.get();if(s.get()&&s.get().length>1){_.set(false);b.set(true);const r=s.get();n.setUiAttrib({extendTitle:CABLES.basename(t)});if(i)n.refreshParams();v.patch.loading.addAssetLoadingTask(()=>{n.setUiError("urlerror",null);CGL.Texture.load(v,t,function(e,t){if(s.get()!=r){E=v.patch.loading.finished(E);return}if(A)A.delete();if(e){const i=CGL.Texture.getErrorTexture(v);c.setRef(i);n.setUiError("urlerror",'could not load texture: "'+s.get()+'"',2);E=v.patch.loading.finished(E);return}d.set(t.width);m.set(t.height);p.set(t.width/t.height);A=t;c.setRef(A);b.set(false);_.set(true);if(h.get())A.image=null;if(E){E=v.patch.loading.finished(E)}n.checkMainloopExists()},{anisotropic:I,wrap:O,flip:o.get(),unpackAlpha:l.get(),pixelFormat:R(),filter:T});n.checkMainloopExists()})}else{M();E=v.patch.loading.finished(E)}}function y(){if(t.get()=="nearest")T=CGL.Texture.FILTER_NEAREST;else if(t.get()=="linear")T=CGL.Texture.FILTER_LINEAR;else if(t.get()=="mipmap")T=CGL.Texture.FILTER_MIPMAP;else if(t.get()=="Anisotropic")T=CGL.Texture.FILTER_ANISOTROPIC;r.setUiAttribs({greyout:T!=CGL.Texture.FILTER_MIPMAP});I=parseFloat(r.get());C()}function P(){if(i.get()=="repeat")O=CGL.Texture.WRAP_REPEAT;if(i.get()=="mirrored repeat")O=CGL.Texture.WRAP_MIRRORED_REPEAT;if(i.get()=="clamp to edge")O=CGL.Texture.WRAP_CLAMP_TO_EDGE;C()}n.onFileChanged=function(e){if(s.get()&&s.get().indexOf(e)>-1){c.setRef(CGL.Texture.getEmptyTexture(n.patch.cgl));c.setRef(CGL.Texture.getTempTexture(v));N(true)}}}};CABLES.OPS["790f3702-9833-464e-8e37-6f0f813f7e16"]={f:Ops.Gl.Texture_v2,objName:"Ops.Gl.Texture_v2"};Ops.Json.HttpRequest_v4=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={};const r=i.inUrl("URL"),a=i.inDropDown("HTTP Method",["GET","POST","PUT","DELETE","PATCH","HEAD","CONNECT","OPTIONS","TRACE"],"GET"),o=i.inStringEditor("Request Body",""),l=i.inString("Content-Type","application/json"),u=i.inBool("Send Credentials",false),h=i.inObject("headers",{}),c=i.inSwitch("Response Content",["JSON","String","Binary Base64"],"JSON"),f=i.inBool("Auto request",true),g=i.inBool("Empty output on change",true),n=i.inBool("Retry on error",true),t=i.inTriggerButton("Reload"),d=i.outObject("Response Json Object"),m=i.outString("Response String"),p=i.outString("Response Data Url"),_=i.outNumber("Status Code",0),b=i.outBoolNum("Is Loading",false),v=i.outBoolNum("Has Error",false),x=i.outString("Error"),E=i.outNumber("Duration MS",0),A=i.outObject("Fetch Response"),s=i.outTrigger("Loaded");c.setUiAttribs({title:"Response Content"});r.setUiAttribs({title:"URL"});t.setUiAttribs({buttonTitle:"trigger request"});i.setPortGroup("Request",[a,r,l,o,u,h]);i.setPortGroup("Response",[c]);d.ignoreValueSerialize=true;m.ignoreValueSerialize=true;p.ignoreValueSerialize=true;let T=0;let O=0;let I=false;m.onLinkChanged=p.onLinkChanged=d.onLinkChanged=C;f.onChange=r.onChange=h.onChange=o.onChange=a.onChange=()=>{S();M(false)};c.onChange=()=>{M(false);S()};t.onTriggered=()=>{if(b.get()){console.log("already loading, waiting...");I=true;return}M(true)};i.onFileChanged=e=>{if(r.get()&&r.get().indexOf(e)>-1)P(true)};i.onDelete=()=>{clearTimeout(O)};function S(){a.setUiAttribs({greyout:c.get().includes("Binary")});o.setUiAttribs({greyout:a.get()=="GET"});m.setUiAttribs({greyout:c.get()!="String"});d.setUiAttribs({greyout:c.get()!="JSON"});p.setUiAttribs({greyout:c.get()!="Binary Base64"})}function M(e=false){clearTimeout(T);T=setTimeout(()=>{P(null,e)},30)}function C(){if(!r.get())i.setUiError("nourl","URL is empty",1);else i.setUiError("nourl",null)}function R(e,t){i.setUiError("jsonerr","Problem while loading data:<br/>"+t,1);x.set(t);b.set(false);d.setRef(null);v.set(true);m.set("");s.trigger();i.patch.loading.finished(e);if(v.get()&&n.get()){clearTimeout(O);O=setTimeout(M,3e3)}}function N(e){i.patch.loading.finished(e);b.set(false);s.trigger();if(I){I=false;P(null,true)}x.set("")}function y(){d.set({});p.set("");m.set("");x.set("")}function P(e,t=false){if(!f.get()&&!t)return;if(g.get())y();C();if(!r.get())return y();const n=i.patch.loading.start(i.objName,""+r.get(),i);b.set(true);v.set(false);i.setUiAttrib({extendTitle:CABLES.basename(r.get())});i.setUiError("jsonerr",null);i.setUiError("jsonParse",null);let s=i.patch.getFilePath(r.get());if(e)s+="?rnd="+CABLES.generateUUID();i.patch.loading.addAssetLoadingTask(()=>{const e=o.get();const t=performance.now();const i={method:a.get()};if(a.get()!="GET")i.body=o.get();if(u.get())i.credentials="include";if(h.isLinked())i.headers=h.get();if(!i.headers)i.headers={};if(!i.headers["Content-Type"])i.headers["Content-Type"]=l.get();const r=c.get();fetch(s,i).then(e=>{E.set(Math.round(performance.now()-t));_.set(e.status);A.set(e);if(!e.ok)x.set(e.statusText||"request fail");if(A.isLinked()){y();N(n)}else if(r=="JSON"){e.json().then(e=>{y();d.set(e);N(n)}).catch(e=>{R(n,e);if(!x.get())x.set("Could not parse json")})}else if(r=="String"){e.text().then(e=>{y();m.set(e);N(n)}).catch(e=>{R(n,e)})}else if(r.includes("Binary")){e.blob().then(e=>{y();p.set(URL.createObjectURL(e));if(r.includes("Base64")){const t=new FileReader;t.onloadend=function(){const e=t.result;p.set(e);N(n)};t.readAsDataURL(e)}else console.log("unknown content type "+r)}).catch(e=>{R(n,e)})}}).catch(e=>{R(n,e)})})}}};CABLES.OPS["af548d59-d2d8-4ee6-b938-15e79200817c"]={f:Ops.Json.HttpRequest_v4,objName:"Ops.Json.HttpRequest_v4"};Ops.Data.JsonPath.ObjectGetNumberByPath=class extends CABLES.Op{constructor(){super(...arguments);const n=this;const e=n.attachments={};const s=n.inObject("Object"),a=n.inString("Path"),o=n.outNumber("Output"),l=n.outBoolNum("Found");s.onChange=t;a.onChange=t;n.toWorkPortsNeedToBeLinked(s);n.toWorkPortsNeedsString(a);a.setUiAttribs({stringTrim:true});function t(){const t=s.get();const i=a.get();n.setUiError("missing",null);n.setUiError("notiterable",null);if(t&&i){if(!Array.isArray(t)&&!(typeof t==="object")){l.set(false);n.setUiError("notiterable","input object of type "+typeof t+" is not traversable by path")}else{n.setUiAttrib({extendTitle:i});let e=u(i,t);if(e===undefined){const r="could not find element at path "+i;l.set(false);e=null;n.setUiError("missing",r,1)}else if(typeof e!=="number"){const r="element at path "+i+" is not a number";l.set(false);e=null;n.setUiError("missing",r,1)}else{l.set(true)}o.set(e)}}else{l.set(false)}}function u(e,t=self,i="."){const r=Array.isArray(e)?e:e.split(i);return r.reduce((e,t)=>{return e&&e[t]},t)}}};CABLES.OPS["ec736baf-feb8-4d8d-b04c-173fc197759c"]={f:Ops.Data.JsonPath.ObjectGetNumberByPath,objName:"Ops.Data.JsonPath.ObjectGetNumberByPath"};Ops.Number.SwitchNumber=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={};const t=i.inValueInt("Index");const r=[];const n=i.outNumber("Result");t.onChange=s;for(let t=0;t<16;t++){let e=i.inValueFloat("Value "+t);r.push(e);e.onChange=s}function s(){const e=t.get();if(e>=0&&r[e]){n.set(r[e].get())}}}};CABLES.OPS["fbb89f72-f2e3-4d34-ad01-7d884a1bcdc0"]={f:Ops.Number.SwitchNumber,objName:"Ops.Number.SwitchNumber"};Ops.Gl.ImageCompose.PixelDifference=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={slope_frag:"\nIN vec2 texCoord;\nUNI sampler2D tex;\nUNI vec2 pixel;\nUNI float strength;\nUNI float sstep;\n\nfloat lum(vec3 c)\n{\n    return dot(vec3(0.2126,0.7152,0.0722),c);\n}\n\nvoid main()\n{\n    vec4 a,b;\n    // vec4 px=texture(tex, texCoord);\n    vec4 pxl=texture(tex, texCoord + vec2(-sstep*pixel.x, 0.0));\n    vec4 pxr=texture(tex, texCoord + vec2( sstep*pixel.x, 0.0));\n    vec4 pxt=texture(tex, texCoord + vec2(0.0, -sstep*pixel.y));\n    vec4 pxb=texture(tex, texCoord + vec2(0.0,  sstep*pixel.y));\n\n    vec4 col=vec4(0.5);\n\n    #ifdef DIR_R_HORIZONTAL\n        a=pxl;\n        b=pxr;\n    #endif\n    #ifndef DIR_R_HORIZONTAL // VERTICAL\n        a=pxt;\n        b=pxb;\n    #endif\n    #ifdef FLIP_R\n        vec4 c=a;\n        a=b;\n        b=c;\n    #endif\n    #ifdef METH_R_DIFF\n        #ifdef METH_R_R\n            col.r+=(b.r-a.r)*strength;\n        #endif\n        #ifdef METH_R_G\n            col.r+=(b.g-a.g)*strength;\n        #endif\n        #ifdef METH_R_B\n            col.r+=(b.b-a.b)*strength;\n        #endif\n    #endif\n    #ifdef METH_R_AVG\n        #ifdef METH_R_R\n            col.r+=(((b.r+a.r-0.5)/2.0))*strength;\n        #endif\n        #ifdef METH_R_G\n            col.r+=(((b.g+a.g-0.5)/2.0))*strength;\n        #endif\n        #ifdef METH_R_B\n            col.r+=(((b.b+a.b-0.5)/2.0))*strength;\n        #endif\n    #endif\n    #ifdef METH_R_LUMI\n        col.r+=(lum(b.rgb)-lum(a.rgb))*strength;\n    #endif\n    #ifdef METH_R_ONE\n        col.r=1.0;\n    #endif\n    #ifdef METH_R_ZERO\n        col.r=0.0;\n    #endif\n\n\n    ////////////////////////\n\n    #ifdef DIR_G_HORIZONTAL\n        a=pxl;\n        b=pxr;\n    #endif\n    #ifndef DIR_G_HORIZONTAL // VERTICAL\n        a=pxt;\n        b=pxb;\n    #endif\n    #ifdef FLIP_G\n        vec4 c3=a;\n        a=b;\n        b=c3;\n    #endif\n    #ifdef METH_G_DIFF\n        #ifdef METH_G_R\n            col.g+=(b.r-a.r)*strength;\n        #endif\n        #ifdef METH_G_G\n            col.g+=(b.g-a.g)*strength;\n        #endif\n        #ifdef METH_G_B\n            col.g+=(b.b-a.b)*strength;\n        #endif\n    #endif\n    #ifdef METH_G_AVG\n        #ifdef METH_G_R\n            col.g+=(((b.r+a.r-0.5)/2.0))*strength;\n        #endif\n        #ifdef METH_G_G\n            col.g+=(((b.g+a.g-0.5)/2.0))*strength;\n        #endif\n        #ifdef METH_G_B\n            col.g+=(((b.b+a.b-0.5)/2.0))*strength;\n        #endif\n    #endif\n    #ifdef METH_G_LUMI\n        col.g+=(lum(b.rgb)-lum(a.rgb))*strength;\n    #endif\n    #ifdef METH_G_ONE\n        col.g=1.0;\n    #endif\n    #ifdef METH_G_ZERO\n        col.g=0.0;\n    #endif\n\n\n    ////////////////////////\n\n    #ifdef DIR_B_HORIZONTAL\n        a=pxl;\n        b=pxr;\n    #endif\n    #ifndef DIR_B_HORIZONTAL // VERTICAL\n        a=pxt;\n        b=pxb;\n    #endif\n    #ifdef FLIP_B\n        vec4 c2=a;\n        a=b;\n        b=c2;\n    #endif\n    #ifdef METH_B_DIFF\n        #ifdef METH_B_R\n            col.b+=(b.r-a.r)*strength;\n        #endif\n        #ifdef METH_B_G\n            col.b+=(b.g-a.g)*strength;\n        #endif\n        #ifdef METH_B_B\n            col.b+=(b.b-a.b)*strength;\n        #endif\n    #endif\n    #ifdef METH_B_AVG\n        #ifdef METH_B_R\n            col.b+=(((b.r+a.r-0.5)/2.0))*strength;\n        #endif\n        #ifdef METH_B_G\n            col.b+=(((b.g+a.g-0.5)/2.0))*strength;\n        #endif\n        #ifdef METH_B_B\n            col.b+=(((b.b+a.b-0.5)/2.0))*strength;\n        #endif\n    #endif\n    #ifdef METH_B_LUMI\n        col.b+=(lum(b.rgb)-lum(a.rgb))*strength;\n    #endif\n    #ifdef METH_B_ONE\n        col.b=1.0;\n    #endif\n    #ifdef METH_B_ZERO\n        col.b=0.0;\n    #endif\n\n\n\n    col.a=1.0;\n\n    outColor= col;\n\n}\n"};const i=["Vertical Difference Red","Vertical Difference Green","Vertical Difference Blue","Vertical Average Red","Vertical Average Green","Vertical Average Blue","Vertical Luminance","Horizontal Difference Red","Horizontal Difference Green","Horizontal Difference Blue","Horizontal Average Red","Horizontal Average Green","Horizontal Average Blue","Horizontal Luminance","Midpoint","Zero","One"];const r=t.inTrigger("render"),n=t.inValue("Strength",4),s=t.inValue("Step",1),a=t.inDropDown("Red",i,"Horizontal Difference Red"),o=t.inBool("Red Flip",false),l=t.inDropDown("Green",i,"Vertical Difference Green"),u=t.inBool("Green Flip",false),h=t.inDropDown("Blue",i,"Midpoint"),c=t.inBool("Blue Flip",false),f=t.outTrigger("trigger");t.setPortGroup("Method",[o,u,c,a,l,h]);o.onChange=u.onChange=c.onChange=a.onChange=l.onChange=h.onChange=v;const g=t.patch.cgl;const d=new CGL.Shader(g,t.name,t);d.setSource(d.getDefaultVertexShader(),e.slope_frag);const m=new CGL.Uniform(d,"t","tex",0),p=new CGL.Uniform(d,"f","strength",n),_=new CGL.Uniform(d,"f","sstep",s),b=new CGL.Uniform(d,"2f","pixel");v();function v(){d.toggleDefine("DIR_R_HORIZONTAL",(a.get()+"").indexOf("Horizontal")!=-1);d.toggleDefine("DIR_G_HORIZONTAL",(l.get()+"").indexOf("Horizontal")!=-1);d.toggleDefine("DIR_B_HORIZONTAL",(h.get()+"").indexOf("Horizontal")!=-1);d.toggleDefine("METH_R_DIFF",(a.get()+"").indexOf("Difference")!=-1);d.toggleDefine("METH_G_DIFF",(l.get()+"").indexOf("Difference")!=-1);d.toggleDefine("METH_B_DIFF",(h.get()+"").indexOf("Difference")!=-1);d.toggleDefine("METH_R_AVG",(a.get()+"").indexOf("Average")!=-1);d.toggleDefine("METH_G_AVG",(l.get()+"").indexOf("Average")!=-1);d.toggleDefine("METH_B_AVG",(h.get()+"").indexOf("Average")!=-1);d.toggleDefine("METH_R_R",(a.get()+"").indexOf("Red")!=-1);d.toggleDefine("METH_G_R",(l.get()+"").indexOf("Red")!=-1);d.toggleDefine("METH_B_R",(h.get()+"").indexOf("Red")!=-1);d.toggleDefine("METH_R_G",(a.get()+"").indexOf("Green")!=-1);d.toggleDefine("METH_G_G",(l.get()+"").indexOf("Green")!=-1);d.toggleDefine("METH_B_G",(h.get()+"").indexOf("Green")!=-1);d.toggleDefine("METH_R_B",(a.get()+"").indexOf("Blue")!=-1);d.toggleDefine("METH_G_B",(l.get()+"").indexOf("Blue")!=-1);d.toggleDefine("METH_B_B",(h.get()+"").indexOf("Blue")!=-1);d.toggleDefine("METH_R_LUMI",(a.get()+"").indexOf("Luminance")!=-1);d.toggleDefine("METH_G_LUMI",(l.get()+"").indexOf("Luminance")!=-1);d.toggleDefine("METH_B_LUMI",(h.get()+"").indexOf("Luminance")!=-1);d.toggleDefine("METH_R_MID",(a.get()+"").indexOf("Midpoint")!=-1);d.toggleDefine("METH_G_MID",(l.get()+"").indexOf("Midpoint")!=-1);d.toggleDefine("METH_B_MID",(h.get()+"").indexOf("Midpoint")!=-1);d.toggleDefine("METH_R_ZERO",(a.get()+"").indexOf("Zero")!=-1);d.toggleDefine("METH_G_ZERO",(l.get()+"").indexOf("Zero")!=-1);d.toggleDefine("METH_B_ZERO",(h.get()+"").indexOf("Zero")!=-1);d.toggleDefine("METH_R_ONE",(a.get()+"").indexOf("One")!=-1);d.toggleDefine("METH_G_ONE",(l.get()+"").indexOf("One")!=-1);d.toggleDefine("METH_B_ONE",(h.get()+"").indexOf("One")!=-1);d.toggleDefine("FLIP_R",o.get());d.toggleDefine("FLIP_G",u.get());d.toggleDefine("FLIP_B",c.get())}r.onTriggered=function(){if(!CGL.TextureEffect.checkOpInEffect(t))return;g.pushShader(d);g.currentTextureEffect.bind();const e=g.currentTextureEffect.getCurrentSourceTexture();b.set([1/e.width,1/e.height]);g.setTexture(0,e.tex);g.currentTextureEffect.finish();g.popShader();f.trigger()}}};CABLES.OPS["f4e53fd9-d4c3-4d0e-839a-78543c38b8db"]={f:Ops.Gl.ImageCompose.PixelDifference,objName:"Ops.Gl.ImageCompose.PixelDifference"};Ops.Extension.Deprecated.CircleTransform=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("render"),a=e.inValueInt("segments",40),o=e.inValueFloat("radius",1),l=e.inValueSlider("percent",1),u=e.inBool("Absolute",true),h=e.inBool("Flip",false),r=e.inValueBool("Rotate"),n=e.outTrigger("trigger"),s=e.outNumber("index");const c=e.patch.cgl;a.set(40);o.set(1);l.set(1);const f=[];h.onChange=u.onChange=a.onChange=o.onChange=l.onChange=m;let g=true;i.onTriggered=d;function d(){if(g)p();const t=r.get();const i=l.get();for(let e=0;e<f.length;e++){c.pushModelMatrix();mat4.translate(c.mMatrix,c.mMatrix,f[e]);if(t)mat4.rotateZ(c.mMatrix,c.mMatrix,e/f.length*i*CGL.DEG2RAD*-360);s.set(e);n.trigger();c.popModelMatrix()}}function m(){g=true}function p(){f.length=0;let e=0,t=0;let i=a.get();if(i<1)i=1;let r=Math.round(i*l.get());let n=360/Math.round(i);if(!u.get()){r=i;n=360/Math.round(i)*l.get()}const s=h.get();for(e=0;e<r;e++){if(s)t=(360-n*e)*CGL.DEG2RAD;else t=n*e*CGL.DEG2RAD;f.push([Math.sin(t)*o.get(),Math.cos(t)*o.get(),0])}g=false}}};CABLES.OPS["4e96d5a2-a1ec-4f83-954d-7c34a9021e9c"]={f:Ops.Extension.Deprecated.CircleTransform,objName:"Ops.Extension.Deprecated.CircleTransform"};Ops.Graphics.Meshes.Circle=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("render"),N=e.inValue("radius",.5),y=e.inValueSlider("innerRadius",0),P=e.inValueInt("segments",40),L=e.inValueSlider("percent",1),w=e.inValue("steps",0),F=e.inValueBool("invertSteps",false),k=e.inSwitch("mapping",["flat","round"]),D=e.inValueBool("Spline",false),r=e.inValueBool("Draw",true),n=e.outTrigger("trigger"),U=e.outObject("geometry",null,"geometry");e.setPortGroup("Size",[N,y]);e.setPortGroup("Display",[L,w,F]);k.set("flat");k.onChange=P.onChange=N.onChange=y.onChange=L.onChange=w.onChange=F.onChange=D.onChange=h;U.ignoreValueSerialize=true;const B=e.patch.cgl;let V=new CGL.Geometry("circle");let j=null;const s=-1;let a=0;let o=null;let G=true;i.onTriggered=l;e.preRender=()=>{l()};function l(){if(!CGL.TextureEffect.checkOpNotInTextureEffect(e))return;if(G)u();o=B.getShader();if(!o)return;a=o.glPrimitive;if(D.get())o.glPrimitive=B.gl.LINE_STRIP;if(r.get())j.render(o);n.trigger();o.glPrimitive=a}function u(){const i=Math.max(3,Math.floor(P.get()));V.clear();const t=[];const r=[];const n=[];const s=[];const a=[];let o=0,l=0;let u=0,h=0;let c=0,f=0;let g=0,d=0;let m=0,p=0;let _=0,b=0;let v=0,x=0;let E=0,A=0;const T=Math.max(0,L.get());const O=[];if(D.get()){let e=0;let t=0;const I=[];for(o=0;o<=i*T;o++){l=360/i*o*CGL.DEG2RAD;E=Math.cos(l)*N.get();A=Math.sin(l)*N.get();x=.5;if(o>0){O.push(e);O.push(t);O.push(0);v=1-(o-1)/i;I.push(v,x)}O.push(E);O.push(A);O.push(0);e=E;t=A}V.setPointVertices(O)}else if(y.get()<=0){for(o=0;o<=i*T;o++){l=360/i*o*CGL.DEG2RAD;E=Math.cos(l)*N.get();A=Math.sin(l)*N.get();if(k.get()=="flat"){v=(Math.cos(l)+1)/2;x=1-(Math.sin(l)+1)/2;_=.5;b=.5}else if(k.get()=="round"){v=1-o/i;x=0;_=v;b=1}t.push([E,A,0],[u,h,0],[0,0,0]);r.push(v,x,c,f,_,b);n.push(0,0,1,0,0,1,0,0,1);s.push(1,0,0,1,0,0,1,0,0);a.push(0,1,0,0,1,0,0,1,0);c=v;f=x;u=E;h=A}V=CGL.Geometry.buildFromFaces(t,"circle");V.vertexNormals=n;V.tangents=s;V.biTangents=a;V.texCoords=r}else{let e=0;const S=i*T;const M=0;for(o=0;o<=S;o++){e++;l=360/i*o*CGL.DEG2RAD;E=Math.cos(l)*N.get();A=Math.sin(l)*N.get();const C=Math.cos(l)*y.get()*N.get();const R=Math.sin(l)*y.get()*N.get();if(k.get()=="round"){v=1-o/i;x=0;_=v;b=1}if(w.get()===0||e%parseInt(w.get(),10)===0&&!F.get()||e%parseInt(w.get(),10)!==0&&F.get()){t.push([E,A,0],[u,h,0],[C,R,0]);t.push([C,R,0],[u,h,0],[g,d,0]);r.push(v,0,c,0,_,1,v,1,c,0,m,1);n.push(0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1);s.push(1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0);a.push(0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0)}m=_;p=b;c=v;f=x;u=E;h=A;g=C;d=R}V=CGL.Geometry.buildFromFaces(t,"circle");V.vertexNormals=n;V.tangents=s;V.biTangents=a;if(k.get()=="flat")V.mapTexCoords2d();else V.texCoords=r}U.set(null);U.set(V);if(V.vertices.length==0)return;if(j)j.dispose();j=null;j=new CGL.Mesh(B,V);G=false}function h(){G=true}e.onDelete=function(){if(j)j.dispose()}}};CABLES.OPS["4db917cc-2cef-43f4-83d5-38c4572fe943"]={f:Ops.Graphics.Meshes.Circle,objName:"Ops.Graphics.Meshes.Circle"};Ops.Gl.Shader.BasicMaterial=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={shader_frag:"{{MODULES_HEAD}}\n\nIN vec2 texCoord;\n#ifdef HAS_TEXTURES\n    IN vec2 texCoordOrig;\n    #ifdef HAS_TEXTURE_DIFFUSE\n        UNI sampler2D tex;\n    #endif\n    #ifdef HAS_TEXTURE_OPACITY\n        UNI sampler2D texOpacity;\n   #endif\n#endif\nUNI float r;\nUNI float g;\nUNI float b;\nUNI float a;\n\nvoid main()\n{\n    {{MODULE_BEGIN_FRAG}}\n    vec4 col=vec4(r,g,b,a);\n\n    #ifdef HAS_TEXTURES\n        #ifdef HAS_TEXTURE_DIFFUSE\n\n           col=texture(tex,vec2(texCoord.x,(1.0-texCoord.y)));\n\n           #ifdef COLORIZE_TEXTURE\n               col.r*=r;\n               col.g*=g;\n               col.b*=b;\n           #endif\n        #endif\n\n        col.a*=a;\n        #ifdef HAS_TEXTURE_OPACITY\n            #ifdef TRANSFORMALPHATEXCOORDS\n                col.a*=texture(texOpacity,vec2(texCoordOrig.s,1.0-texCoordOrig.t)).g;\n            #endif\n            #ifndef TRANSFORMALPHATEXCOORDS\n                col.a*=texture(texOpacity,vec2(texCoord.s,1.0-texCoord.t)).g;\n            #endif\n       #endif\n\n    #endif\n\n    {{MODULE_COLOR}}\n\n    outColor = col;\n\n\n}\n",shader_vert:"{{MODULES_HEAD}}\n\nIN vec3 vPosition;\nIN vec3 attrVertNormal;\nIN vec2 attrTexCoord;\n\nOUT vec3 norm;\nOUT vec2 texCoord;\nOUT vec2 texCoordOrig;\n\nUNI mat4 projMatrix;\nUNI mat4 modelMatrix;\nUNI mat4 viewMatrix;\n\n#ifdef HAS_TEXTURES\n    #ifdef TEXTURE_REPEAT\n        UNI float diffuseRepeatX;\n        UNI float diffuseRepeatY;\n        UNI float texOffsetX;\n        UNI float texOffsetY;\n    #endif\n#endif\n\n\nvoid main()\n{\n    mat4 mMatrix=modelMatrix;\n    mat4 mvMatrix;\n\n    texCoordOrig=attrTexCoord;\n    texCoord=attrTexCoord;\n    #ifdef HAS_TEXTURES\n        #ifdef TEXTURE_REPEAT\n            texCoord.x=texCoord.x*diffuseRepeatX+texOffsetX;\n            texCoord.y=texCoord.y*diffuseRepeatY+texOffsetY;\n        #endif\n    #endif\n\n    vec4 pos = vec4( vPosition, 1. );\n\n\n    #ifdef BILLBOARD\n       vec3 position=vPosition;\n       mvMatrix=viewMatrix*modelMatrix;\n\n       gl_Position = projMatrix * mvMatrix * vec4((\n           position.x * vec3(\n               mvMatrix[0][0],\n               mvMatrix[1][0],\n               mvMatrix[2][0] ) +\n           position.y * vec3(\n               mvMatrix[0][1],\n               mvMatrix[1][1],\n               mvMatrix[2][1]) ), 1.0);\n    #endif\n\n    {{MODULE_VERTEX_POSITION}}\n\n    #ifndef BILLBOARD\n        mvMatrix=viewMatrix * mMatrix;\n    #endif\n\n\n    #ifndef BILLBOARD\n        // gl_Position = projMatrix * viewMatrix * modelMatrix * pos;\n        gl_Position = projMatrix * mvMatrix * pos;\n    #endif\n}\n"};const i=t.inTrigger("render"),r=t.outTrigger("trigger"),n=t.outObject("shader");n.ignoreValueSerialize=true;const s=t.patch.cgl;let a=new CGL.Shader(s,"BasicMaterial");a.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG"]);a.bindTextures=u;a.setSource(e.shader_vert,e.shader_frag);n.setRef(a);i.onTriggered=h;let o=null;let l=null;function u(){if(c.get())s.setTexture(0,c.get().tex);if(o.get())s.setTexture(1,o.get().tex)}t.preRender=function(){a.bind();h()};function h(){if(!a)return;s.pushShader(a);a.bindTextures();r.trigger();s.popShader()}{const T=t.inValueSlider("r",Math.random()),O=t.inValueSlider("g",Math.random()),I=t.inValueSlider("b",Math.random()),S=t.inValueSlider("a",1);T.setUiAttribs({colorPick:true});S.uniform=new CGL.Uniform(a,"f","a",S);I.uniform=new CGL.Uniform(a,"f","b",I);T.uniform=new CGL.Uniform(a,"f","r",T);O.uniform=new CGL.Uniform(a,"f","g",O);t.setPortGroup("Color",[T,O,I,S])}{var c=t.inTexture("texture");let e=null;a.bindTextures=u;c.onChange=function(){if(c.get()){if(!a.hasDefine("HAS_TEXTURE_DIFFUSE"))a.define("HAS_TEXTURE_DIFFUSE");if(!e)e=new CGL.Uniform(a,"t","texDiffuse",0);d()}else{a.removeUniform("texDiffuse");a.removeDefine("HAS_TEXTURE_DIFFUSE");e=null}}}{o=t.inTexture("textureOpacity");o.onChange=function(){if(o.get()){if(l!==null)return;a.removeUniform("texOpacity");a.define("HAS_TEXTURE_OPACITY");if(!l)l=new CGL.Uniform(a,"t","texOpacity",1)}else{a.removeUniform("texOpacity");a.removeDefine("HAS_TEXTURE_OPACITY");l=null}}}t.colorizeTexture=t.inValueBool("colorizeTexture");t.colorizeTexture.set(false);t.colorizeTexture.onChange=function(){if(t.colorizeTexture.get())a.define("COLORIZE_TEXTURE");else a.removeDefine("COLORIZE_TEXTURE")};t.doBillboard=t.inValueBool("billboard");t.doBillboard.set(false);t.doBillboard.onChange=function(){if(t.doBillboard.get())a.define("BILLBOARD");else a.removeDefine("BILLBOARD")};let f=t.inValueBool("Opacity TexCoords Transform",false);f.onChange=function(){if(f.get())a.define("TRANSFORMALPHATEXCOORDS");else a.removeDefine("TRANSFORMALPHATEXCOORDS")};let g=t.inValueBool("preMultiplied alpha");function d(){if(!v){v=new CGL.Uniform(a,"f","diffuseRepeatX",m);x=new CGL.Uniform(a,"f","diffuseRepeatY",p);E=new CGL.Uniform(a,"f","texOffsetX",_);A=new CGL.Uniform(a,"f","texOffsetY",b)}v.setValue(m.get());x.setValue(p.get());E.setValue(_.get());A.setValue(b.get())}{var m=t.inValueFloat("diffuseRepeatX",1);var p=t.inValueFloat("diffuseRepeatY",1);var _=t.inValueFloat("Tex Offset X");var b=t.inValueFloat("Tex Offset Y");t.setPortGroup("Transform Texture",[m,p,_,b]);m.onChange=d;p.onChange=d;b.onChange=d;_.onChange=d;var v=null;var x=null;var E=null;var A=null;a.define("TEXTURE_REPEAT");_.set(0);b.set(0);m.set(1);p.set(1)}d()}};CABLES.OPS["85ae5cfa-5eca-4dd8-8b30-850ac34f7cd5"]={f:Ops.Gl.Shader.BasicMaterial,objName:"Ops.Gl.Shader.BasicMaterial"};Ops.Extension.Deprecated.RelativeTime=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("exe"),r=e.inValue("Multiply",1),n=e.outTrigger("Trigger out"),s=e.outNumber("result");i.onTriggered=a;a();function a(){s.set(e.patch.freeTimer.get()*r.get());n.trigger()}}};CABLES.OPS["917df27b-7cc3-465f-986d-bcf5a7e125a7"]={f:Ops.Extension.Deprecated.RelativeTime,objName:"Ops.Extension.Deprecated.RelativeTime"};Ops.Extension.Deprecated.Sequence=class extends CABLES.Op{constructor(){super(...arguments);const i=this;const e=i.attachments={};let t=i.addInPort(new CABLES.Port(i,"exe",CABLES.OP_PORT_TYPE_FUNCTION));let r=[];let n=[];let s=function(){for(let e=0;e<n.length;e++)n[e].trigger()};t.onTriggered=s;let a=16;for(let t=0;t<a;t++){n.push(i.addOutPort(new CABLES.Port(i,"trigger "+t,CABLES.OP_PORT_TYPE_FUNCTION)));if(t<a-1){let e=i.addInPort(new CABLES.Port(i,"exe "+t,CABLES.OP_PORT_TYPE_FUNCTION));e.onTriggered=s;r.push(e)}}}};CABLES.OPS["99ea068f-37c0-410c-8c73-02572d583122"]={f:Ops.Extension.Deprecated.Sequence,objName:"Ops.Extension.Deprecated.Sequence"};Ops.Math.MapRange=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const f=e.inValueFloat("value",0),g=e.inValueFloat("old min",0),d=e.inValueFloat("old max",1),m=e.inValueFloat("new min",0),p=e.inValueFloat("new max",1),i=e.inValueSelect("Easing",["Linear","Smoothstep","Smootherstep"],"Linear"),r=e.inBool("Clamp",true),_=e.outNumber("result",0);e.setPortGroup("Input Range",[g,d]);e.setPortGroup("Output Range",[m,p]);let b=true;let v=0;let x=0;f.onChange=g.onChange=d.onChange=m.onChange=p.onChange=n;n();r.onChange=()=>{b=r.get();n()};i.onChange=function(){if(i.get()=="Smoothstep")v=1;else if(i.get()=="Smootherstep")v=2;else v=0};function n(){const e=m.get();const t=p.get();const i=g.get();const r=d.get();let n=f.get();if(b){if(n>=Math.max(r,i)){_.set(t);return}else if(n<=Math.min(r,i)){_.set(e);return}}let s=false;const a=Math.min(i,r);const o=Math.max(i,r);if(a!=i)s=true;let l=false;const u=Math.min(e,t);const h=Math.max(e,t);if(u!=e)l=true;let c=0;if(s)c=(o-n)*(h-u)/(o-a);else c=(n-a)*(h-u)/(o-a);if(l)x=h-c;else x=c+u;if(v===0){_.set(x)}else if(v==1){n=Math.max(0,Math.min(1,(x-e)/(t-e)));_.set(e+n*n*(3-2*n)*(t-e))}else if(v==2){n=Math.max(0,Math.min(1,(x-e)/(t-e)));_.set(e+n*n*n*(n*(n*6-15)+10)*(t-e))}}}};CABLES.OPS["2617b407-60a0-4ff6-b4a7-18136cfa7817"]={f:Ops.Math.MapRange,objName:"Ops.Math.MapRange"};Ops.Math.Modulo=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("number1",1),r=e.inValueFloat("number2",2),n=e.inValueBool("pingpong"),s=e.outNumber("result");let a=l;i.onChange=r.onChange=o;n.onChange=h;o();function o(){let e=r.get();let t=i.get();s.set(a(t,e))}function l(e,t){let i=(e%t+t)%t;if(i!=i)i=0;return i}function u(e,t){let i=2*t;e%=i;if(e>=t)return i-e;else return e}function h(){if(n.get())a=u;else a=l}}};CABLES.OPS["ebc13b25-3705-4265-8f06-5f985b6a7bb1"]={f:Ops.Math.Modulo,objName:"Ops.Math.Modulo"};Ops.Gl.Matrix.Translate=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inTrigger("render"),r=t.outTrigger("trigger"),n=t.inValue("x"),s=t.inValue("y"),a=t.inValue("z");const o=vec3.create();i.onTriggered=function(){const e=t.patch.cg||t.patch.cgl;vec3.set(o,n.get(),s.get(),a.get());e.pushModelMatrix();mat4.translate(e.mMatrix,e.mMatrix,o);r.trigger();e.popModelMatrix()}}};CABLES.OPS["1f89ba0e-e7eb-46d7-8c66-7814b7c528b9"]={f:Ops.Gl.Matrix.Translate,objName:"Ops.Gl.Matrix.Translate"};Ops.Math.OneMinus=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValue("Value"),r=e.outNumber("Result");i.onChange=n;n();function n(){r.set(1-i.get())}}};CABLES.OPS["f34d019d-59ae-40d6-a55d-a7691bbc40e0"]={f:Ops.Math.OneMinus,objName:"Ops.Math.OneMinus"};Ops.Extension.Deprecated.Cylinder=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};let i=e.inTrigger("render");let r=e.addInPort(new CABLES.Port(e,"slices",CABLES.OP_PORT_TYPE_VALUE));let n=e.addInPort(new CABLES.Port(e,"stacks",CABLES.OP_PORT_TYPE_VALUE));let s=e.addInPort(new CABLES.Port(e,"radius",CABLES.OP_PORT_TYPE_VALUE));let a=e.addInPort(new CABLES.Port(e,"height",CABLES.OP_PORT_TYPE_VALUE));let l=e.inValueInt("Start Slice",0);let o=e.outTrigger("trigger");let u=e.addOutPort(new CABLES.Port(e,"geometry",CABLES.OP_PORT_TYPE_OBJECT));a.set(2);r.set(32);n.set(5);s.set(1);u.ignoreValueSerialize=true;let h=e.patch.cgl;let c=null;let f=null;let g=0,d=0;let m=0;n.onChange=p;r.onChange=p;s.onChange=p;a.onChange=p;l.onChange=p;i.onTriggered=function(){if(c!==null)c.render(h.getShader());o.trigger()};function p(){let e=Math.round(n.get());let t=Math.round(r.get());if(e<2)e=2;if(t<2)t=2;let i=s.get();b(i,a.get(),e,t)}p();function _(e,t){let i;let r=Math.abs(e);let n=(t?1:2)*Math.PI/e;let s=[];let a=[];s[0]=0;a[0]=1;let o=l.get();if(o<0)o=0;if(o>r-1)o=r-1;for(i=o;i<r;i++){s[i]=Math.sin(n*i);a[i]=Math.cos(n*i)}if(t){s[r]=0;a[r]=-1}else{s[r]=s[0];a[r]=a[0]}return{cost:a,sint:s}}function b(e,t,i,r){let n=new CGL.Geometry;let s=_(-r,false);let a=0;let o=0;let l=t/(i>0?i:1);n.vertices[0]=0;n.vertices[1]=0;n.vertices[2]=0;n.vertexNormals[0]=0;n.vertexNormals[1]=0;n.vertexNormals[2]=-1;a=3;for(d=0;d<r;d++,a+=3){n.vertices[a]=s.cost[d]*e;n.vertices[a+1]=s.sint[d]*e;n.vertices[a+2]=o;n.vertexNormals[a]=0;n.vertexNormals[a+1]=0;n.vertexNormals[a+2]=-1}for(g=0;g<i+1;g++){for(d=0;d<r;d++,a+=3){n.vertices[a]=s.cost[d]*e;n.vertices[a+1]=s.sint[d]*e;n.vertices[a+2]=o;n.vertexNormals[a]=s.cost[d];n.vertexNormals[a+1]=s.sint[d];n.vertexNormals[a+2]=0}o+=l}o-=l;for(d=0;d<r;d++,a+=3){n.vertices[a]=s.cost[d]*e;n.vertices[a+1]=s.sint[d]*e;n.vertices[a+2]=o;n.vertexNormals[a]=0;n.vertexNormals[a+1]=0;n.vertexNormals[a+2]=1}n.vertices[a]=0;n.vertices[a+1]=0;n.vertices[a+2]=t;n.vertexNormals[a]=0;n.vertexNormals[a+1]=0;n.vertexNormals[a+2]=1;for(d=0,a=0;d<r;d++,a+=2){n.verticesIndices[a]=0;n.verticesIndices[a+1]=d+1}n.verticesIndices[a]=0;n.verticesIndices[a+1]=1;a+=2;for(g=0;g<i;g++,a+=2){m=1+(g+1)*r;for(d=0;d<r;d++,a+=2){n.verticesIndices[a]=m+d;n.verticesIndices[a+1]=m+d+r}n.verticesIndices[a]=m;n.verticesIndices[a+1]=m+r}m=1+(i+2)*r;for(d=0;d<r;d++,a+=2){n.verticesIndices[a]=m+d;n.verticesIndices[a+1]=n.vertices.length/3-1}n.verticesIndices[a]=m;n.verticesIndices[a+1]=n.vertices.length/3-1;u.set(n);c=new CGL.Mesh(h,n,h.gl.TRIANGLE_STRIP)}}};CABLES.OPS["2af1489e-ffd6-4bdb-96f8-42b7cddceaf5"]={f:Ops.Extension.Deprecated.Cylinder,objName:"Ops.Extension.Deprecated.Cylinder"};Ops.Ui.Comment=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};e.inTitle=e.inString("title"," ");e.text=e.inTextarea("text");e.text.set(" ");e.name=" ";e.inTitle.set("new comment");e.inTitle.onChange=i;e.text.onChange=i;e.onLoaded=i;i();function i(){if(CABLES.UI){e.uiAttr({comment_title:e.inTitle.get(),comment_text:e.text.get()});e.name=e.inTitle.get()}}}};CABLES.OPS["9de0c04f-666b-47cd-9722-a8cf36ab4720"]={f:Ops.Ui.Comment,objName:"Ops.Ui.Comment"};Ops.Math.Compare.LessThan=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValue("number1");const r=e.inValue("number2");const n=e.outBoolNum("result");e.setUiAttribs({mathTitle:true});i.onChange=s;r.onChange=s;s();function s(){n.set(i.get()<r.get())}}};CABLES.OPS["04fd113f-ade1-43fb-99fa-f8825f8814c0"]={f:Ops.Math.Compare.LessThan,objName:"Ops.Math.Compare.LessThan"};Ops.Anim.SimpleAnim=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("exe"),r=e.inTriggerButton("reset"),n=e.inTriggerButton("rewind"),s=e.inValueFloat("start",0),a=e.inValueFloat("end",1),o=e.inValueFloat("duration",.5),l=e.inValueBool("loop"),u=e.inValueBool("Wait for Reset",true),h=e.outTrigger("Next"),c=e.outNumber("result"),f=e.outNumber("finished"),g=e.outTrigger("Finished Trigger");const d=new CABLES.Anim;let m=false;let p=-1;d.createPort(e,"easing",_);l.onChange=_;_();o.onChange=_;function _(){if(d.keys.length!=3){d.setValue(0,0);d.setValue(1,0);d.setValue(2,0)}d.keys[0].time=CABLES.now()/1e3;d.keys[0].value=s.get();if(d.defaultEasing!=p)d.keys[0].setEasing(d.defaultEasing);d.keys[1].time=o.get()+CABLES.now()/1e3;d.keys[1].value=a.get();if(d.defaultEasing!=p)d.keys[1].setEasing(d.defaultEasing);d.loop=l.get();if(d.loop){}else{d.keys[2].time=d.keys[1].time;d.keys[2].value=d.keys[1].value;if(d.defaultEasing!=p)d.keys[2].setEasing(d.defaultEasing)}f.set(false);p=d.defaultEasing}r.onTriggered=function(){m=true;_()};n.onTriggered=function(){d.keys[0].time=CABLES.now()/1e3;d.keys[0].value=s.get();d.keys[1].time=CABLES.now()/1e3;d.keys[1].value=s.get();d.keys[2].time=CABLES.now()/1e3;d.keys[2].value=s.get();c.set(s.get())};i.onTriggered=function(){if(u.get()&&!m){c.set(s.get());h.trigger();return}let e=CABLES.now()/1e3;let t=d.getValue(e);c.set(t);if(d.hasEnded(e)){if(!f.get())g.trigger();f.set(true)}h.trigger()}}};CABLES.OPS["5b244b6e-c505-4743-b2cc-8119ef720028"]={f:Ops.Anim.SimpleAnim,objName:"Ops.Anim.SimpleAnim"};Ops.Extension.Deprecated.ValueTrigger=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTriggerButton("exe"),r=e.inValue("value"),n=e.outTrigger("Next"),s=e.addOutPort(new CABLES.Port(e,"result"));i.onTriggered=a;s.changeAlways=true;e.toWorkPortsNeedToBeLinked(i);function a(){s.set(r.get());n.trigger()}}};CABLES.OPS["d9d010c2-2bc9-4eb5-8514-f2adef7ceae4"]={f:Ops.Extension.Deprecated.ValueTrigger,objName:"Ops.Extension.Deprecated.ValueTrigger"};Ops.Extension.Deprecated.ValueChanged=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("Value");const r=e.outTrigger("Trigger");i.onChange=function(){r.trigger()}}};CABLES.OPS["c62cb6f6-77be-4d5e-818b-89a8eb596797"]={f:Ops.Extension.Deprecated.ValueChanged,objName:"Ops.Extension.Deprecated.ValueChanged"};Ops.Extension.Deprecated.ScaleXYZ=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inTrigger("render"),r=t.inValueFloat("x",1),n=t.inValueFloat("y",1),s=t.inValueFloat("z",1),a=t.outTrigger("trigger");const o=vec3.create();let l=true;r.onChange=n.onChange=s.onChange=h;h();i.onTriggered=u;function u(){const e=t.patch.cg||t.patch.cgl;if(l){vec3.set(o,r.get(),n.get(),s.get());l=false}e.pushModelMatrix();mat4.scale(e.mMatrix,e.mMatrix,o);a.trigger();e.popModelMatrix()}function h(){l=true}}};CABLES.OPS["9ba52457-5f0d-4b20-a97c-4ec4856b8e29"]={f:Ops.Extension.Deprecated.ScaleXYZ,objName:"Ops.Extension.Deprecated.ScaleXYZ"};Ops.Trigger.ValueBecameZeroTrigger=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};let i=-1;let r=e.inValue("Value",-1);let n=e.outTrigger("Became Zero Trigger");r.onChange=function(){let e=r.get();if(i!=0&e==0){n.trigger()}i=e}}};CABLES.OPS["822f925c-33e8-4b8a-8a89-be5d2e358ed7"]={f:Ops.Trigger.ValueBecameZeroTrigger,objName:"Ops.Trigger.ValueBecameZeroTrigger"};Ops.Extension.Deprecated.SetValueOnTrigger=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};let i=e.inValueString("Value");let r=e.inTrigger("Set Value");let n=e.outValue("Out Value");n.changeAlways=true;r.onTriggered=function(){n.set(i.get())}}};CABLES.OPS["1143b9b7-9c4e-479d-bc6c-b010ee3ab2a2"]={f:Ops.Extension.Deprecated.SetValueOnTrigger,objName:"Ops.Extension.Deprecated.SetValueOnTrigger"};Ops.Devices.Browser.BrowserInfo=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};let i=e.outValue("Is Mobile",false);let r=e.outValue("Is IE",false);let n=e.outValue("Is IE 10+",false);let s=e.outValue("Is IE 11",false);let a=e.outValue("Is Edge",false);let o=e.outValue("Is Chrome",false);let l=e.outValue("Is Firefox",false);let u=e.outValue("Is Safari",false);let h=e.outValue("Is Windows",false);let c=e.outValue("Is Linux",false);let f=e.outValue("Is Mac",false);let g=e.outValue("Is iOS",false);let d=e.outValue("Is Android",false);let m=e.outValue("Language");m.set(navigator.language||navigator.userLanguage);l.set(!!navigator.userAgent.search("Firefox"));if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){u.set(true)}if(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)){r.set(true);l.set(false);if(/MSIE 9/i.test(navigator.userAgent)){n.set(false);s.set(false)}else if(/MSIE 10/i.test(navigator.userAgent)){n.set(true);s.set(false)}else if(/rv:11.0/i.test(navigator.userAgent)){n.set(false);s.set(true)}}if(/Edge\/\d./i.test(navigator.userAgent)){a.set(true);l.set(false)}let p=window.chrome,_=window.navigator,b=_.vendor,v=_.userAgent.indexOf("OPR")>-1,x=_.userAgent.indexOf("Edge")>-1,E=_.userAgent.match("CriOS");if(E||p!==null&&p!==undefined&&b==="Google Inc."&&v===false&&x===false){o.set(true);l.set(false)}else{}if(window.navigator.userAgent.indexOf("Windows")!=-1){h.set(true)}if(window.navigator.userAgent.indexOf("Linux")!=-1){h.set(false);c.set(true)}if(window.navigator.userAgent.indexOf("Mac")!=-1){h.set(false);f.set(true)}g.set(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream);if(window.navigator.userAgent.toLowerCase().indexOf("android")!=-1)d.set(true);i.set(false);if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))i.set(true)}};CABLES.OPS["6e2ff98b-1e85-4b89-b125-fb8da727ba0c"]={f:Ops.Devices.Browser.BrowserInfo,objName:"Ops.Devices.Browser.BrowserInfo"};Ops.Boolean.BoolToNumber_v2=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inBool("Use Value 1",false),r=e.inFloat("Value 0",0),n=e.inFloat("Value 1",1),s=e.outNumber("Out Value",0);r.onChange=n.onChange=i.onChange=a;function a(){const e=i.get();if(e){s.set(n.get())}else{s.set(r.get())}}}};CABLES.OPS["400eea7d-5a68-4dda-a94d-2bb2ee7c2331"]={f:Ops.Boolean.BoolToNumber_v2,objName:"Ops.Boolean.BoolToNumber_v2"};Ops.Trigger.GateTrigger=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Execute"),r=e.inValueBool("Pass Through",true),n=e.outTrigger("Trigger out");i.onTriggered=function(){if(r.get())n.trigger()}}};CABLES.OPS["65e8b8a2-ba13-485f-883a-2bcf377989da"]={f:Ops.Trigger.GateTrigger,objName:"Ops.Trigger.GateTrigger"};Ops.Ui.Area=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inString("Title",""),r=e.inTriggerButton("Delete");i.setUiAttribs({hidePort:true});e.setUiAttrib({hasArea:true});e.init=i.onChange=e.onLoaded=n;n();function n(){if(CABLES.UI){gui.savedState.setUnSaved("areaOp",e.getSubPatch());e.uiAttr({comment_title:i.get()||" "});e.name=i.get()}}r.onTriggered=()=>{e.patch.deleteOp(e.id)}}};CABLES.OPS["38f79614-b0de-4960-8da5-2827e7f43415"]={f:Ops.Ui.Area,objName:"Ops.Ui.Area"};Ops.Math.Max=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("value",1),r=e.inValueFloat("Maximum",1),n=e.outNumber("result");r.onChange=i.onChange=s;s();function s(){let e=Math.max(i.get(),r.get());if(e==e)n.set(e)}}};CABLES.OPS["07f0be49-c226-4029-8039-3b620145dc2a"]={f:Ops.Math.Max,objName:"Ops.Math.Max"};Ops.Number.PreviousNumberStore=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("Value"),r=e.outNumber("Current Value"),n=e.outNumber("Previous Value");let s=0;i.onChange=function(){n.set(s);s=i.get();r.set(i.get())}}};CABLES.OPS["01716872-67bd-4b31-a4a2-e0ccadf48411"]={f:Ops.Number.PreviousNumberStore,objName:"Ops.Number.PreviousNumberStore"};Ops.Math.Sqrt=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValue("number"),r=e.outNumber("result");i.onChange=function(){let e=Math.sqrt(i.get());if(isNaN(e))e=0;r.set(e)}}};CABLES.OPS["dec567c3-231d-4146-964d-891fde8924f1"]={f:Ops.Math.Sqrt,objName:"Ops.Math.Sqrt"};Ops.Ui.Routing.RouteNumber=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("value"),r=e.outNumber("result");i.onChange=s;let n=false;e.setUiAttribs({display:"reroute"});function s(){r.set(i.get())}}};CABLES.OPS["afff634a-b581-4449-b6f7-9ec7863c5d4d"]={f:Ops.Ui.Routing.RouteNumber,objName:"Ops.Ui.Routing.RouteNumber"};Ops.Array.Array4GetNumbers=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inArray("Array"),r=e.inValueInt("Index"),n=e.outNumber("X"),s=e.outNumber("Y"),a=e.outNumber("Z"),o=e.outNumber("W");e.toWorkPortsNeedToBeLinked(i);i.onChange=r.onChange=l;function l(){let e=i.get();if(!e){n.set(0);s.set(0);a.set(0);o.set(0);return}let t=Math.min(e.length-4,r.get()*4);if(e&&e.length>t+3){n.set(e[t+0]);s.set(e[t+1]);a.set(e[t+2]);o.set(e[t+3])}}}};CABLES.OPS["95e5c82e-6cc2-4cd3-9f68-f94062e620fa"]={f:Ops.Array.Array4GetNumbers,objName:"Ops.Array.Array4GetNumbers"};Ops.Array.RandomNumbersArray_v4=class extends CABLES.Op{constructor(){super(...arguments);const h=this;const e=h.attachments={};const c=h.inValueInt("Num Values",100),f=h.inSwitch("Mode",["A","AB","ABC","ABCD"],"A"),g=h.inValueFloat("Random Seed ",0),d=h.inBool("Integer",false),m=h.inValueBool("Last == First"),p=h.outArray("Array Out"),_=h.outNumber("Chunks Amount"),b=h.outNumber("Array length");const t=["A","B","C","D"];const v=[];const x=t.map(function(e){return{min:h.inValueFloat("Min "+e,-1),max:h.inValueFloat("Max "+e,1)}});for(let e=0;e<x.length;e+=1){const i=x[e];const n=Object.keys(i);h.setPortGroup("Value Range "+t[e],n.map(function(e){return i[e]}));if(e>0)n.forEach(function(e){i[e].setUiAttribs({greyout:true})})}f.onChange=function(){const e=f.get();const t=f.uiAttribs.values;p.setUiAttribs({stride:f.get().length});const n=t.indexOf(e);x.forEach(function(i,r){const e=Object.keys(i);e.forEach(function(e,t){if(r<=n)i[e].setUiAttribs({greyout:false});else i[e].setUiAttribs({greyout:true})})});r()};p.ignoreValueSerialize=true;m.onChange=c.onChange=g.onChange=d.onChange=r;const E=[];r();function r(){const e=f.get();const t=f.uiAttribs.values;const i=t.indexOf(e);const r=Math.floor(Math.abs(c.get()));Math.randomSeed=g.get();h.setUiAttrib({extendTitle:r+"*"+e.length});const n=i+1;const s=r*n;v.length=s;const a=s/n;const o=d.get();for(let t=0;t<n;t+=1){const e=x[t];const l=e.max.get();const u=e.min.get();E[t]=[u,l]}for(let t=0;t<a;t+=1){for(let e=0;e<n;e+=1){const u=E[e][0];const l=E[e][1];const i=t*n+e;if(o)v[i]=Math.floor(Math.seededRandom()*(l+1-u)+u);else v[i]=Math.seededRandom()*(l-u)+u}}if(m.get()&&v.length>n){for(let e=0;e<n;e++)v[v.length-3+e]=v[e]}p.setRef(v);_.set(v.length/n);b.set(v.length)}x.forEach(function(i){Object.keys(i).forEach(function(e){const t=i[e];t.onChange=r})})}};CABLES.OPS["8a9fa2c6-c229-49a9-9dc8-247001539217"]={f:Ops.Array.RandomNumbersArray_v4,objName:"Ops.Array.RandomNumbersArray_v4"};Ops.Math.FlipSign=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("Value",1),r=e.outNumber("Result");i.onChange=n;n();function n(){r.set(i.get()*-1)}}};CABLES.OPS["f5c858a2-2654-4108-86fe-319efa70ecec"]={f:Ops.Math.FlipSign,objName:"Ops.Math.FlipSign"};Ops.Gl.ViewPortSize=class extends CABLES.Op{constructor(){super(...arguments);const t=this;const e=t.attachments={};const i=t.inTrigger("Exec"),r=t.outTrigger("Next"),n=t.outNumber("X"),s=t.outNumber("Y"),a=t.outNumber("Width"),o=t.outNumber("Height");i.onTriggered=function(){const e=t.patch.cgl.viewPort;n.set(e[0]);s.set(e[1]);a.set(e[2]);o.set(e[3]);r.trigger()}}};CABLES.OPS["7cb99d8f-d7ef-478e-902b-54e054e387a0"]={f:Ops.Gl.ViewPortSize,objName:"Ops.Gl.ViewPortSize"};Ops.Array.Array3=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const s=e.inValueInt("Num Triplets",100),a=e.inValueFloat("X",0),o=e.inValueFloat("Y",0),l=e.inValueFloat("Z",0),u=e.outArray("Array",null,3),h=e.outNumber("Total points"),c=e.outNumber("Array length");s.onChange=a.onChange=o.onChange=l.onChange=i;let f=[];i();function i(){let t=Math.floor(s.get()*3);if(t<0)t=0;if(f.length!=t)f.length=t;const i=a.get();const r=o.get();const n=l.get();for(let e=0;e<t;e+=3){f[e]=i;f[e+1]=r;f[e+2]=n}u.setRef(f);h.set(t/3);c.set(t)}}};CABLES.OPS["2766606a-3ea0-4204-8613-b8950a124435"]={f:Ops.Array.Array3,objName:"Ops.Array.Array3"};Ops.Array.InterpolateArrays=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Exe"),o=e.inArray("Array 1"),l=e.inArray("Array 2"),u=e.inValueSlider("perc"),h=e.outTrigger("Next"),c=e.outArray("Result");let f=true;let g=[];e.toWorkPortsNeedToBeLinked(o,l);o.onChange=l.onChange=u.onChange=r;i.onTriggered=n;function r(){f=true}function n(){let i=o.get();let r=l.get();let n;let s;let a;if(!i||!r||i.length<r.length){c.set(null);return}if(f){if(g.length!=i.length)g.length=i.length;let t=u.get();for(let e=0;e<i.length;e++){n=i[e];s=r[e];a=(s-n)*t+n;g[e]=a}f=false;c.setRef(g)}h.trigger()}o.onLinkChanged=l.onLinkChanged=function(){let e=o.get();let t=l.get();if(!e||!t){c.set(null);return}let i=e[0];let r=t[0];if(typeof i==="string"||typeof r==="string"){c.set(null)}}}};CABLES.OPS["09296117-7312-4f80-982b-7b4a81d22cf8"]={f:Ops.Array.InterpolateArrays,objName:"Ops.Array.InterpolateArrays"};Ops.Array.Array3Iterator=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("Execute"),r=e.inArray("Array"),n=e.inValue("Step"),s=e.outTrigger("Trigger"),a=e.outNumber("Index"),o=e.outNumber("Value 1"),l=e.outNumber("Value 2"),u=e.outNumber("Value 3");let h=r.get()||[];let c=1;n.onChange=d;d();let f=0;let g=0;r.onChange=function(){h=r.get()||[]};function d(){c=n.get()||1;if(c<1)c=1;c=3*c}i.onTriggered=function(){g=0;for(let e=0,t=h.length;e<t;e+=c){a.set(g);o.set(h[e+0]);l.set(h[e+1]);u.set(h[e+2]);s.trigger();g++}}}};CABLES.OPS["3f7db864-7409-418f-8c03-b2c966c050b3"]={f:Ops.Array.Array3Iterator,objName:"Ops.Array.Array3Iterator"};Ops.Number.TriggerOnChangeNumber=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inFloat("Value"),r=e.outTrigger("Next"),n=e.outNumber("Number");i.onChange=function(){n.set(i.get());r.trigger()}}};CABLES.OPS["f5c8c433-ce13-49c4-9a33-74e98f110ed0"]={f:Ops.Number.TriggerOnChangeNumber,objName:"Ops.Number.TriggerOnChangeNumber"};Ops.Array.ArrayBuffer3=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inTrigger("exec"),r=e.inValue("Max Num Elements",100),n=e.inValue("Value X"),s=e.inValue("Value Y"),a=e.inValue("Value Z"),o=e.inTriggerButton("Reset"),l=e.outTrigger("Trigger out"),u=e.outArray("Result",[],3),h=e.outNumber("Array length");let c=[];let f=true;u.set(c);r.onChange=g;o.onTriggered=g;g();function g(){if(r===0){c.set(null);h.set(0);return}c.length=Math.abs(Math.floor(r.get()*3))||0;for(let e=0;e<c.length;e++)c[e]=0;f=true;u.set(null);u.set(c)}i.onTriggered=function(){if(f){for(let e=0,t=c.length;e<t;e+=3){c[e+0]=n.get();c[e+1]=s.get();c[e+2]=a.get()}f=false}for(let e=0,t=c.length;e<t;e++)c[e-3]=c[e];c[c.length-3]=n.get();c[c.length-2]=s.get();c[c.length-1]=a.get();u.set(null);u.set(c);h.set(c.length);l.trigger()}}};CABLES.OPS["156762c6-1c10-4e9b-9cca-8dbc329a82bd"]={f:Ops.Array.ArrayBuffer3,objName:"Ops.Array.ArrayBuffer3"};Ops.Math.Round=class extends CABLES.Op{constructor(){super(...arguments);const e=this;const t=e.attachments={};const i=e.inValueFloat("number"),r=e.inInt("Decimal Places",0),n=e.outNumber("result");let s=0;i.onChange=o;r.onChange=a;a();function a(){s=Math.pow(10,r.get());o()}function o(){n.set(Math.round(i.get()*s)/s)}}};CABLES.OPS["1a1ef636-6d02-42ba-ae1e-627b917d0d2b"]={f:Ops.Math.Round,objName:"Ops.Math.Round"};window.addEventListener("load",function(e){CABLES.jsLoaded=new Event("CABLES.jsLoaded");document.dispatchEvent(CABLES.jsLoaded)});!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Tess2=e()}}(function(){var e,t,i;return function s(a,o,l){function u(i,e){if(!o[i]){if(!a[i]){var t=typeof require=="function"&&require;if(!e&&t)return t(i,!0);if(h)return h(i,!0);var r=new Error("Cannot find module '"+i+"'");throw r.code="MODULE_NOT_FOUND",r}var n=o[i]={exports:{}};a[i][0].call(n.exports,function(e){var t=a[i][1][e];return u(t?t:e)},n,n.exports,s,a,o,l)}return o[i].exports}var h=typeof require=="function"&&require;for(var e=0;e<l.length;e++)u(l[e]);return u}({1:[function(e,t,i){t.exports=e("./src/tess2")},{"./src/tess2":2}],2:[function(e,t,i){"use strict";var m={};t.exports=m;m.WINDING_ODD=0;m.WINDING_NONZERO=1;m.WINDING_POSITIVE=2;m.WINDING_NEGATIVE=3;m.WINDING_ABS_GEQ_TWO=4;m.POLYGONS=0;m.CONNECTED_POLYGONS=1;m.BOUNDARY_CONTOURS=2;m.tesselate=function(e){var t=e.debug||false;var i=new f;for(var r=0;r<e.contours.length;r++){i.addContour(e.vertexSize||2,e.contours[r])}i.tesselate(e.windingRule||m.WINDING_ODD,e.elementType||m.POLYGONS,e.polySize||3,e.vertexSize||2,e.normal||[0,0,1]);return{vertices:i.vertices,vertexIndices:i.vertexIndices,vertexCount:i.vertexCount,elements:i.elements,elementCount:i.elementCount,mesh:t?i.mesh:undefined}};var p=function(e){if(!e){throw"Assertion Failed!"}};function d(){this.next=null;this.prev=null;this.anEdge=null;this.coords=[0,0,0];this.s=0;this.t=0;this.pqHandle=0;this.n=0;this.idx=0}function a(){this.next=null;this.prev=null;this.anEdge=null;this.trail=null;this.n=0;this.marked=false;this.inside=false}function n(e){this.next=null;this.Sym=null;this.Onext=null;this.Lnext=null;this.Org=null;this.Lface=null;this.activeRegion=null;this.winding=0;this.side=e}n.prototype={get Rface(){return this.Sym.Lface},set Rface(e){this.Sym.Lface=e},get Dst(){return this.Sym.Org},set Dst(e){this.Sym.Org=e},get Oprev(){return this.Sym.Lnext},set Oprev(e){this.Sym.Lnext=e},get Lprev(){return this.Onext.Sym},set Lprev(e){this.Onext.Sym=e},get Dprev(){return this.Lnext.Sym},set Dprev(e){this.Lnext.Sym=e},get Rprev(){return this.Sym.Onext},set Rprev(e){this.Sym.Onext=e},get Dnext(){return this.Sym.Onext.Sym},set Dnext(e){this.Sym.Onext.Sym=e},get Rnext(){return this.Sym.Lnext.Sym},set Rnext(e){this.Sym.Lnext.Sym=e}};function s(){var e=new d;var t=new a;var i=new n(0);var r=new n(1);e.next=e.prev=e;e.anEdge=null;t.next=t.prev=t;t.anEdge=null;t.trail=null;t.marked=false;t.inside=false;i.next=i;i.Sym=r;i.Onext=null;i.Lnext=null;i.Org=null;i.Lface=null;i.winding=0;i.activeRegion=null;r.next=r;r.Sym=i;r.Onext=null;r.Lnext=null;r.Org=null;r.Lface=null;r.winding=0;r.activeRegion=null;this.vHead=e;this.fHead=t;this.eHead=i;this.eHeadSym=r}s.prototype={makeEdge_:function(e){var t=new n(0);var i=new n(1);if(e.Sym.side<e.side){e=e.Sym}var r=e.Sym.next;i.next=r;r.Sym.next=t;t.next=e;e.Sym.next=i;t.Sym=i;t.Onext=t;t.Lnext=i;t.Org=null;t.Lface=null;t.winding=0;t.activeRegion=null;i.Sym=t;i.Onext=i;i.Lnext=t;i.Org=null;i.Lface=null;i.winding=0;i.activeRegion=null;return t},splice_:function(e,t){var i=e.Onext;var r=t.Onext;i.Sym.Lnext=t;r.Sym.Lnext=e;e.Onext=r;t.Onext=i},makeVertex_:function(e,t,i){var r=e;p(r!==null);var n=i.prev;r.prev=n;n.next=r;r.next=i;i.prev=r;r.anEdge=t;var s=t;do{s.Org=r;s=s.Onext}while(s!==t)},makeFace_:function(e,t,i){var r=e;p(r!==null);var n=i.prev;r.prev=n;n.next=r;r.next=i;i.prev=r;r.anEdge=t;r.trail=null;r.marked=false;r.inside=i.inside;var s=t;do{s.Lface=r;s=s.Lnext}while(s!==t)},killEdge_:function(e){if(e.Sym.side<e.side){e=e.Sym}var t=e.next;var i=e.Sym.next;t.Sym.next=i;i.Sym.next=t},killVertex_:function(e,t){var i=e.anEdge;var r=i;do{r.Org=t;r=r.Onext}while(r!==i);var n=e.prev;var s=e.next;s.prev=n;n.next=s},killFace_:function(e,t){var i=e.anEdge;var r=i;do{r.Lface=t;r=r.Lnext}while(r!==i);var n=e.prev;var s=e.next;s.prev=n;n.next=s},makeEdge:function(){var e=new d;var t=new d;var i=new a;var r=this.makeEdge_(this.eHead);this.makeVertex_(e,r,this.vHead);this.makeVertex_(t,r.Sym,this.vHead);this.makeFace_(i,r,this.fHead);return r},splice:function(e,t){var i=false;var r=false;if(e===t)return;if(t.Org!==e.Org){r=true;this.killVertex_(t.Org,e.Org)}if(t.Lface!==e.Lface){i=true;this.killFace_(t.Lface,e.Lface)}this.splice_(t,e);if(!r){var n=new d;this.makeVertex_(n,t,e.Org);e.Org.anEdge=e}if(!i){var s=new a;this.makeFace_(s,t,e.Lface);e.Lface.anEdge=e}},delete:function(e){var t=e.Sym;var i=false;if(e.Lface!==e.Rface){i=true;this.killFace_(e.Lface,e.Rface)}if(e.Onext===e){this.killVertex_(e.Org,null)}else{e.Rface.anEdge=e.Oprev;e.Org.anEdge=e.Onext;this.splice_(e,e.Oprev);if(!i){var r=new a;this.makeFace_(r,e,e.Lface)}}if(t.Onext===t){this.killVertex_(t.Org,null);this.killFace_(t.Lface,null)}else{e.Lface.anEdge=t.Oprev;t.Org.anEdge=t.Onext;this.splice_(t,t.Oprev)}this.killEdge_(e)},addEdgeVertex:function(e){var t=this.makeEdge_(e);var i=t.Sym;this.splice_(t,e.Lnext);t.Org=e.Dst;var r=new d;this.makeVertex_(r,i,t.Org);t.Lface=i.Lface=e.Lface;return t},splitEdge:function(e,t){var i=this.addEdgeVertex(e);var r=i.Sym;this.splice_(e.Sym,e.Sym.Oprev);this.splice_(e.Sym,r);e.Dst=r.Org;r.Dst.anEdge=r.Sym;r.Rface=e.Rface;r.winding=e.winding;r.Sym.winding=e.Sym.winding;return r},connect:function(e,t){var i=false;var r=this.makeEdge_(e);var n=r.Sym;if(t.Lface!==e.Lface){i=true;this.killFace_(t.Lface,e.Lface)}this.splice_(r,e.Lnext);this.splice_(n,t);r.Org=e.Dst;n.Org=t.Org;r.Lface=n.Lface=e.Lface;e.Lface.anEdge=n;if(!i){var s=new a;this.makeFace_(s,r,e.Lface)}return r},zapFace:function(e){var t=e.anEdge;var i,r,n;var s,a;r=t.Lnext;do{i=r;r=i.Lnext;i.Lface=null;if(i.Rface===null){if(i.Onext===i){this.killVertex_(i.Org,null)}else{i.Org.anEdge=i.Onext;this.splice_(i,i.Oprev)}n=i.Sym;if(n.Onext===n){this.killVertex_(n.Org,null)}else{n.Org.anEdge=n.Onext;this.splice_(n,n.Oprev)}this.killEdge_(i)}}while(i!=t);s=e.prev;a=e.next;a.prev=s;s.next=a},countFaceVerts_:function(e){var t=e.anEdge;var i=0;do{i++;t=t.Lnext}while(t!==e.anEdge);return i},mergeConvexFaces:function(e){var t;var i,r,n;var s;var a,o;for(t=this.fHead.next;t!==this.fHead;t=t.next){if(!t.inside)continue;i=t.anEdge;s=i.Org;while(true){r=i.Lnext;n=i.Sym;if(n&&n.Lface&&n.Lface.inside){a=this.countFaceVerts_(t);o=this.countFaceVerts_(n.Lface);if(a+o-2<=e){if(_.vertCCW(i.Lprev.Org,i.Org,n.Lnext.Lnext.Org)&&_.vertCCW(n.Lprev.Org,n.Org,i.Lnext.Lnext.Org)){r=n.Lnext;this.delete(n);i=null;n=null}}}if(i&&i.Lnext.Org===s)break;i=r}}return true},check:function(){var e=this.fHead;var t=this.vHead;var i=this.eHead;var r,n,s,a,o,l;n=e;for(n=e;(r=n.next)!==e;n=r){p(r.prev===n);o=r.anEdge;do{p(o.Sym!==o);p(o.Sym.Sym===o);p(o.Lnext.Onext.Sym===o);p(o.Onext.Sym.Lnext===o);p(o.Lface===r);o=o.Lnext}while(o!==r.anEdge)}p(r.prev===n&&r.anEdge===null);a=t;for(a=t;(s=a.next)!==t;a=s){p(s.prev===a);o=s.anEdge;do{p(o.Sym!==o);p(o.Sym.Sym===o);p(o.Lnext.Onext.Sym===o);p(o.Onext.Sym.Lnext===o);p(o.Org===s);o=o.Onext}while(o!==s.anEdge)}p(s.prev===a&&s.anEdge===null);l=i;for(l=i;(o=l.next)!==i;l=o){p(o.Sym.next===l.Sym);p(o.Sym!==o);p(o.Sym.Sym===o);p(o.Org!==null);p(o.Dst!==null);p(o.Lnext.Onext.Sym===o);p(o.Onext.Sym.Lnext===o)}p(o.Sym.next===l.Sym&&o.Sym===this.eHeadSym&&o.Sym.Sym===o&&o.Org===null&&o.Dst===null&&o.Lface===null&&o.Rface===null)}};var _={};_.vertEq=function(e,t){return e.s===t.s&&e.t===t.t};_.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t};_.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s};_.edgeGoesLeft=function(e){return _.vertLeq(e.Dst,e.Org)};_.edgeGoesRight=function(e){return _.vertLeq(e.Org,e.Dst)};_.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)};_.edgeEval=function(e,t,i){p(_.vertLeq(e,t)&&_.vertLeq(t,i));var r=t.s-e.s;var n=i.s-t.s;if(r+n>0){if(r<n){return t.t-e.t+(e.t-i.t)*(r/(r+n))}else{return t.t-i.t+(i.t-e.t)*(n/(r+n))}}return 0};_.edgeSign=function(e,t,i){p(_.vertLeq(e,t)&&_.vertLeq(t,i));var r=t.s-e.s;var n=i.s-t.s;if(r+n>0){return(t.t-i.t)*r+(t.t-e.t)*n}return 0};_.transEval=function(e,t,i){p(_.transLeq(e,t)&&_.transLeq(t,i));var r=t.t-e.t;var n=i.t-t.t;if(r+n>0){if(r<n){return t.s-e.s+(e.s-i.s)*(r/(r+n))}else{return t.s-i.s+(i.s-e.s)*(n/(r+n))}}return 0};_.transSign=function(e,t,i){p(_.transLeq(e,t)&&_.transLeq(t,i));var r=t.t-e.t;var n=i.t-t.t;if(r+n>0){return(t.s-i.s)*r+(t.s-e.s)*n}return 0};_.vertCCW=function(e,t,i){return e.s*(t.t-i.t)+t.s*(i.t-e.t)+i.s*(e.t-t.t)>=0};_.interpolate=function(e,t,i,r){return e=e<0?0:e,i=i<0?0:i,e<=i?i==0?(t+r)/2:t+(r-t)*(e/(e+i)):r+(t-r)*(i/(e+i))};_.intersect=function(e,t,i,r,n){var s,a;var o;if(!_.vertLeq(e,t)){o=e;e=t;t=o}if(!_.vertLeq(i,r)){o=i;i=r;r=o}if(!_.vertLeq(e,i)){o=e;e=i;i=o;o=t;t=r;r=o}if(!_.vertLeq(i,t)){n.s=(i.s+t.s)/2}else if(_.vertLeq(t,r)){s=_.edgeEval(e,i,t);a=_.edgeEval(i,t,r);if(s+a<0){s=-s;a=-a}n.s=_.interpolate(s,i.s,a,t.s)}else{s=_.edgeSign(e,i,t);a=-_.edgeSign(e,r,t);if(s+a<0){s=-s;a=-a}n.s=_.interpolate(s,i.s,a,r.s)}if(!_.transLeq(e,t)){o=e;e=t;t=o}if(!_.transLeq(i,r)){o=i;i=r;r=o}if(!_.transLeq(e,i)){o=e;e=i;i=o;o=t;t=r;r=o}if(!_.transLeq(i,t)){n.t=(i.t+t.t)/2}else if(_.transLeq(t,r)){s=_.transEval(e,i,t);a=_.transEval(i,t,r);if(s+a<0){s=-s;a=-a}n.t=_.interpolate(s,i.t,a,t.t)}else{s=_.transSign(e,i,t);a=-_.transSign(e,r,t);if(s+a<0){s=-s;a=-a}n.t=_.interpolate(s,i.t,a,r.t)}};function r(){this.key=null;this.next=null;this.prev=null}function o(e,t){this.head=new r;this.head.next=this.head;this.head.prev=this.head;this.frame=e;this.leq=t}o.prototype={min:function(){return this.head.next},max:function(){return this.head.prev},insert:function(e){return this.insertBefore(this.head,e)},search:function(e){var t=this.head;do{t=t.next}while(t.key!==null&&!this.leq(this.frame,e,t.key));return t},insertBefore:function(e,t){do{e=e.prev}while(e.key!==null&&!this.leq(this.frame,e.key,t));var i=new r;i.key=t;i.next=e.next;e.next.prev=i;i.prev=e;e.next=i;return i},delete:function(e){e.next.prev=e.prev;e.prev.next=e.next}};function l(){this.handle=null}function u(){this.key=null;this.node=null}function h(e,t){this.size=0;this.max=e;this.nodes=[];this.nodes.length=e+1;for(var i=0;i<this.nodes.length;i++)this.nodes[i]=new l;this.handles=[];this.handles.length=e+1;for(var i=0;i<this.handles.length;i++)this.handles[i]=new u;this.initialized=false;this.freeList=0;this.leq=t;this.nodes[1].handle=1;this.handles[1].key=null}h.prototype={floatDown_:function(e){var t=this.nodes;var i=this.handles;var r,n;var s;r=t[e].handle;for(;;){s=e<<1;if(s<this.size&&this.leq(i[t[s+1].handle].key,i[t[s].handle].key)){++s}p(s<=this.max);n=t[s].handle;if(s>this.size||this.leq(i[r].key,i[n].key)){t[e].handle=r;i[r].node=e;break}t[e].handle=n;i[n].node=e;e=s}},floatUp_:function(e){var t=this.nodes;var i=this.handles;var r,n;var s;r=t[e].handle;for(;;){s=e>>1;n=t[s].handle;if(s==0||this.leq(i[n].key,i[r].key)){t[e].handle=r;i[r].node=e;break}t[e].handle=n;i[n].node=e;e=s}},init:function(){for(var e=this.size;e>=1;--e){this.floatDown_(e)}this.initialized=true},min:function(){return this.handles[this.nodes[1].handle].key},isEmpty:function(){this.size===0},insert:function(e){var t;var i;t=++this.size;if(t*2>this.max){this.max*=2;var r;r=this.nodes.length;this.nodes.length=this.max+1;for(var n=r;n<this.nodes.length;n++)this.nodes[n]=new l;r=this.handles.length;this.handles.length=this.max+1;for(var n=r;n<this.handles.length;n++)this.handles[n]=new u}if(this.freeList===0){i=t}else{i=this.freeList;this.freeList=this.handles[i].node}this.nodes[t].handle=i;this.handles[i].node=t;this.handles[i].key=e;if(this.initialized){this.floatUp_(t)}return i},extractMin:function(){var e=this.nodes;var t=this.handles;var i=e[1].handle;var r=t[i].key;if(this.size>0){e[1].handle=e[this.size].handle;t[e[1].handle].node=1;t[i].key=null;t[i].node=this.freeList;this.freeList=i;--this.size;if(this.size>0){this.floatDown_(1)}}return r},delete:function(e){var t=this.nodes;var i=this.handles;var r;p(e>=1&&e<=this.max&&i[e].key!==null);r=i[e].node;t[r].handle=t[this.size].handle;i[t[r].handle].node=r;--this.size;if(r<=this.size){if(r<=1||this.leq(i[t[r>>1].handle].key,i[t[r].handle].key)){this.floatDown_(r)}else{this.floatUp_(r)}}i[e].key=null;i[e].node=this.freeList;this.freeList=e}};function c(){this.eUp=null;this.nodeUp=null;this.windingNumber=0;this.inside=false;this.sentinel=false;this.dirty=false;this.fixUpperEdge=false}var b={};b.regionBelow=function(e){return e.nodeUp.prev.key};b.regionAbove=function(e){return e.nodeUp.next.key};b.debugEvent=function(e){};b.addWinding=function(e,t){e.winding+=t.winding;e.Sym.winding+=t.Sym.winding};b.edgeLeq=function(e,t,i){var r=e.event;var n,s;var a=t.eUp;var o=i.eUp;if(a.Dst===r){if(o.Dst===r){if(_.vertLeq(a.Org,o.Org)){return _.edgeSign(o.Dst,a.Org,o.Org)<=0}return _.edgeSign(a.Dst,o.Org,a.Org)>=0}return _.edgeSign(o.Dst,r,o.Org)<=0}if(o.Dst===r){return _.edgeSign(a.Dst,r,a.Org)>=0}var n=_.edgeEval(a.Dst,r,a.Org);var s=_.edgeEval(o.Dst,r,o.Org);return n>=s};b.deleteRegion=function(e,t){if(t.fixUpperEdge){p(t.eUp.winding===0)}t.eUp.activeRegion=null;e.dict.delete(t.nodeUp)};b.fixUpperEdge=function(e,t,i){p(t.fixUpperEdge);e.mesh.delete(t.eUp);t.fixUpperEdge=false;t.eUp=i;i.activeRegion=t};b.topLeftRegion=function(e,t){var i=t.eUp.Org;var r;do{t=b.regionAbove(t)}while(t.eUp.Org===i);if(t.fixUpperEdge){r=e.mesh.connect(b.regionBelow(t).eUp.Sym,t.eUp.Lnext);if(r===null)return null;b.fixUpperEdge(e,t,r);t=b.regionAbove(t)}return t};b.topRightRegion=function(e){var t=e.eUp.Dst;var e=null;do{e=b.regionAbove(e)}while(e.eUp.Dst===t);return e};b.addRegionBelow=function(e,t,i){var r=new c;r.eUp=i;r.nodeUp=e.dict.insertBefore(t.nodeUp,r);r.fixUpperEdge=false;r.sentinel=false;r.dirty=false;i.activeRegion=r;return r};b.isWindingInside=function(e,t){switch(e.windingRule){case m.WINDING_ODD:return(t&1)!=0;case m.WINDING_NONZERO:return t!=0;case m.WINDING_POSITIVE:return t>0;case m.WINDING_NEGATIVE:return t<0;case m.WINDING_ABS_GEQ_TWO:return t>=2||t<=-2}p(false);return false};b.computeWinding=function(e,t){t.windingNumber=b.regionAbove(t).windingNumber+t.eUp.winding;t.inside=b.isWindingInside(e,t.windingNumber)};b.finishRegion=function(e,t){var i=t.eUp;var r=i.Lface;r.inside=t.inside;r.anEdge=i;b.deleteRegion(e,t)};b.finishLeftRegions=function(e,t,i){var r,n;var s=null;var a=t;var n=t.eUp;while(a!==i){a.fixUpperEdge=false;s=b.regionBelow(a);r=s.eUp;if(r.Org!=n.Org){if(!s.fixUpperEdge){b.finishRegion(e,a);break}r=e.mesh.connect(n.Lprev,r.Sym);b.fixUpperEdge(e,s,r)}if(n.Onext!==r){e.mesh.splice(r.Oprev,r);e.mesh.splice(n,r)}b.finishRegion(e,a);n=s.eUp;a=s}return n};b.addRightEdges=function(e,t,i,r,n,s){var a,o;var l,u;var h=true;l=i;do{p(_.vertLeq(l.Org,l.Dst));b.addRegionBelow(e,t,l.Sym);l=l.Onext}while(l!==r);if(n===null){n=b.regionBelow(t).eUp.Rprev}o=t;u=n;for(;;){a=b.regionBelow(o);l=a.eUp.Sym;if(l.Org!==u.Org)break;if(l.Onext!==u){e.mesh.splice(l.Oprev,l);e.mesh.splice(u.Oprev,l)}a.windingNumber=o.windingNumber-l.winding;a.inside=b.isWindingInside(e,a.windingNumber);o.dirty=true;if(!h&&b.checkForRightSplice(e,o)){b.addWinding(l,u);b.deleteRegion(e,o);e.mesh.delete(u)}h=false;o=a;u=l}o.dirty=true;p(o.windingNumber-l.winding===a.windingNumber);if(s){b.walkDirtyRegions(e,o)}};b.spliceMergeVertices=function(e,t,i){e.mesh.splice(t,i)};b.vertexWeights=function(e,t,i){var r=_.vertL1dist(t,e);var n=_.vertL1dist(i,e);var s=.5*n/(r+n);var a=.5*r/(r+n);e.coords[0]+=s*t.coords[0]+a*i.coords[0];e.coords[1]+=s*t.coords[1]+a*i.coords[1];e.coords[2]+=s*t.coords[2]+a*i.coords[2]};b.getIntersectData=function(e,t,i,r,n,s){t.coords[0]=t.coords[1]=t.coords[2]=0;t.idx=-1;b.vertexWeights(t,i,r);b.vertexWeights(t,n,s)};b.checkForRightSplice=function(e,t){var i=b.regionBelow(t);var r=t.eUp;var n=i.eUp;if(_.vertLeq(r.Org,n.Org)){if(_.edgeSign(n.Dst,r.Org,n.Org)>0)return false;if(!_.vertEq(r.Org,n.Org)){e.mesh.splitEdge(n.Sym);e.mesh.splice(r,n.Oprev);t.dirty=i.dirty=true}else if(r.Org!==n.Org){e.pq.delete(r.Org.pqHandle);b.spliceMergeVertices(e,n.Oprev,r)}}else{if(_.edgeSign(r.Dst,n.Org,r.Org)<0)return false;b.regionAbove(t).dirty=t.dirty=true;e.mesh.splitEdge(r.Sym);e.mesh.splice(n.Oprev,r)}return true};b.checkForLeftSplice=function(e,t){var i=b.regionBelow(t);var r=t.eUp;var n=i.eUp;var s;p(!_.vertEq(r.Dst,n.Dst));if(_.vertLeq(r.Dst,n.Dst)){if(_.edgeSign(r.Dst,n.Dst,r.Org)<0)return false;b.regionAbove(t).dirty=t.dirty=true;s=e.mesh.splitEdge(r);e.mesh.splice(n.Sym,s);s.Lface.inside=t.inside}else{if(_.edgeSign(n.Dst,r.Dst,n.Org)>0)return false;t.dirty=i.dirty=true;s=e.mesh.splitEdge(n);e.mesh.splice(r.Lnext,n.Sym);s.Rface.inside=t.inside}return true};b.checkForIntersect=function(e,t){var i=b.regionBelow(t);var r=t.eUp;var n=i.eUp;var s=r.Org;var a=n.Org;var o=r.Dst;var l=n.Dst;var u,h;var c=new d,f;var g;p(!_.vertEq(l,o));p(_.edgeSign(o,e.event,s)<=0);p(_.edgeSign(l,e.event,a)>=0);p(s!==e.event&&a!==e.event);p(!t.fixUpperEdge&&!i.fixUpperEdge);if(s===a)return false;u=Math.min(s.t,o.t);h=Math.max(a.t,l.t);if(u>h)return false;if(_.vertLeq(s,a)){if(_.edgeSign(l,s,a)>0)return false}else{if(_.edgeSign(o,a,s)<0)return false}b.debugEvent(e);_.intersect(o,s,l,a,c);p(Math.min(s.t,o.t)<=c.t);p(c.t<=Math.max(a.t,l.t));p(Math.min(l.s,o.s)<=c.s);p(c.s<=Math.max(a.s,s.s));if(_.vertLeq(c,e.event)){c.s=e.event.s;c.t=e.event.t}f=_.vertLeq(s,a)?s:a;if(_.vertLeq(f,c)){c.s=f.s;c.t=f.t}if(_.vertEq(c,s)||_.vertEq(c,a)){b.checkForRightSplice(e,t);return false}if(!_.vertEq(o,e.event)&&_.edgeSign(o,e.event,c)>=0||!_.vertEq(l,e.event)&&_.edgeSign(l,e.event,c)<=0){if(l===e.event){e.mesh.splitEdge(r.Sym);e.mesh.splice(n.Sym,r);t=b.topLeftRegion(e,t);r=b.regionBelow(t).eUp;b.finishLeftRegions(e,b.regionBelow(t),i);b.addRightEdges(e,t,r.Oprev,r,r,true);return TRUE}if(o===e.event){e.mesh.splitEdge(n.Sym);e.mesh.splice(r.Lnext,n.Oprev);i=t;t=b.topRightRegion(t);g=b.regionBelow(t).eUp.Rprev;i.eUp=n.Oprev;n=b.finishLeftRegions(e,i,null);b.addRightEdges(e,t,n.Onext,r.Rprev,g,true);return true}if(_.edgeSign(o,e.event,c)>=0){b.regionAbove(t).dirty=t.dirty=true;e.mesh.splitEdge(r.Sym);r.Org.s=e.event.s;r.Org.t=e.event.t}if(_.edgeSign(l,e.event,c)<=0){t.dirty=i.dirty=true;e.mesh.splitEdge(n.Sym);n.Org.s=e.event.s;n.Org.t=e.event.t}return false}e.mesh.splitEdge(r.Sym);e.mesh.splitEdge(n.Sym);e.mesh.splice(n.Oprev,r);r.Org.s=c.s;r.Org.t=c.t;r.Org.pqHandle=e.pq.insert(r.Org);b.getIntersectData(e,r.Org,s,o,a,l);b.regionAbove(t).dirty=t.dirty=i.dirty=true;return false};b.walkDirtyRegions=function(e,t){var i=b.regionBelow(t);var r,n;for(;;){while(i.dirty){t=i;i=b.regionBelow(i)}if(!t.dirty){i=t;t=b.regionAbove(t);if(t==null||!t.dirty){return}}t.dirty=false;r=t.eUp;n=i.eUp;if(r.Dst!==n.Dst){if(b.checkForLeftSplice(e,t)){if(i.fixUpperEdge){b.deleteRegion(e,i);e.mesh.delete(n);i=b.regionBelow(t);n=i.eUp}else if(t.fixUpperEdge){b.deleteRegion(e,t);e.mesh.delete(r);t=b.regionAbove(i);r=t.eUp}}}if(r.Org!==n.Org){if(r.Dst!==n.Dst&&!t.fixUpperEdge&&!i.fixUpperEdge&&(r.Dst===e.event||n.Dst===e.event)){if(b.checkForIntersect(e,t)){return}}else{b.checkForRightSplice(e,t)}}if(r.Org===n.Org&&r.Dst===n.Dst){b.addWinding(n,r);b.deleteRegion(e,t);e.mesh.delete(r);t=b.regionAbove(i)}}};b.connectRightVertex=function(e,t,i){var r;var n=i.Onext;var s=b.regionBelow(t);var a=t.eUp;var o=s.eUp;var l=false;if(a.Dst!==o.Dst){b.checkForIntersect(e,t)}if(_.vertEq(a.Org,e.event)){e.mesh.splice(n.Oprev,a);t=b.topLeftRegion(e,t);n=b.regionBelow(t).eUp;b.finishLeftRegions(e,b.regionBelow(t),s);l=true}if(_.vertEq(o.Org,e.event)){e.mesh.splice(i,o.Oprev);i=b.finishLeftRegions(e,s,null);l=true}if(l){b.addRightEdges(e,t,i.Onext,n,n,true);return}if(_.vertLeq(o.Org,a.Org)){r=o.Oprev}else{r=a}r=e.mesh.connect(i.Lprev,r);b.addRightEdges(e,t,r,r.Onext,r.Onext,false);r.Sym.activeRegion.fixUpperEdge=true;b.walkDirtyRegions(e,t)};b.connectLeftDegenerate=function(e,t,i){var r,n,s,a;var o;r=t.eUp;if(_.vertEq(r.Org,i)){p(false);b.spliceMergeVertices(e,r,i.anEdge);return}if(!_.vertEq(r.Dst,i)){e.mesh.splitEdge(r.Sym);if(t.fixUpperEdge){e.mesh.delete(r.Onext);t.fixUpperEdge=false}e.mesh.splice(i.anEdge,r);b.sweepEvent(e,i);return}p(false);t=b.topRightRegion(t);o=b.regionBelow(t);s=o.eUp.Sym;n=a=s.Onext;if(o.fixUpperEdge){p(n!==s);b.deleteRegion(e,o);e.mesh.delete(s);s=n.Oprev}e.mesh.splice(i.anEdge,s);if(!_.edgeGoesLeft(n)){n=null}b.addRightEdges(e,t,s.Onext,a,n,true)};b.connectLeftVertex=function(e,t){var i,r,n;var s,a,o;var l=new c;l.eUp=t.anEdge.Sym;i=e.dict.search(l).key;r=b.regionBelow(i);if(!r){return}s=i.eUp;a=r.eUp;if(_.edgeSign(s.Dst,t,s.Org)===0){b.connectLeftDegenerate(e,i,t);return}n=_.vertLeq(a.Dst,s.Dst)?i:r;if(i.inside||n.fixUpperEdge){if(n===i){o=e.mesh.connect(t.anEdge.Sym,s.Lnext)}else{var u=e.mesh.connect(a.Dnext,t.anEdge);o=u.Sym}if(n.fixUpperEdge){b.fixUpperEdge(e,n,o)}else{b.computeWinding(e,b.addRegionBelow(e,i,o))}b.sweepEvent(e,t)}else{b.addRightEdges(e,i,t.anEdge,t.anEdge,null,true)}};b.sweepEvent=function(e,t){e.event=t;b.debugEvent(e);var i=t.anEdge;while(i.activeRegion===null){i=i.Onext;if(i==t.anEdge){b.connectLeftVertex(e,t);return}}var r=b.topLeftRegion(e,i.activeRegion);p(r!==null);var n=b.regionBelow(r);var s=n.eUp;var a=b.finishLeftRegions(e,n,null);if(a.Onext===s){b.connectRightVertex(e,r,a)}else{b.addRightEdges(e,r,a.Onext,s,s,true)}};b.addSentinel=function(e,t,i,r){var n=new c;var s=e.mesh.makeEdge();s.Org.s=i;s.Org.t=r;s.Dst.s=t;s.Dst.t=r;e.event=s.Dst;n.eUp=s;n.windingNumber=0;n.inside=false;n.fixUpperEdge=false;n.sentinel=true;n.dirty=false;n.nodeUp=e.dict.insert(n)};b.initEdgeDict=function(e){e.dict=new o(e,b.edgeLeq);var t=e.bmax[0]-e.bmin[0];var i=e.bmax[1]-e.bmin[1];var r=e.bmin[0]-t;var n=e.bmax[0]+t;var s=e.bmin[1]-i;var a=e.bmax[1]+i;b.addSentinel(e,r,n,s);b.addSentinel(e,r,n,a)};b.doneEdgeDict=function(e){var t;var i=0;while((t=e.dict.min().key)!==null){if(!t.sentinel){p(t.fixUpperEdge);p(++i==1)}p(t.windingNumber==0);b.deleteRegion(e,t)}};b.removeDegenerateEdges=function(e){var t,i,r;var n=e.mesh.eHead;for(t=n.next;t!==n;t=i){i=t.next;r=t.Lnext;if(_.vertEq(t.Org,t.Dst)&&t.Lnext.Lnext!==t){b.spliceMergeVertices(e,r,t);e.mesh.delete(t);t=r;r=t.Lnext}if(r.Lnext===t){if(r!==t){if(r===i||r===i.Sym){i=i.next}e.mesh.delete(r)}if(t===i||t===i.Sym){i=i.next}e.mesh.delete(t)}}};b.initPriorityQ=function(e){var t;var i,r;var n=0;r=e.mesh.vHead;for(i=r.next;i!==r;i=i.next){n++}n+=8;t=e.pq=new h(n,_.vertLeq);r=e.mesh.vHead;for(i=r.next;i!==r;i=i.next){i.pqHandle=t.insert(i)}if(i!==r){return false}t.init();return true};b.donePriorityQ=function(e){e.pq=null};b.removeDegenerateFaces=function(e,t){var i,r;var n;for(i=t.fHead.next;i!==t.fHead;i=r){r=i.next;n=i.anEdge;p(n.Lnext!==n);if(n.Lnext.Lnext===n){b.addWinding(n.Onext,n);e.mesh.delete(n)}}return true};b.computeInterior=function(e){var t,i;b.removeDegenerateEdges(e);if(!b.initPriorityQ(e))return false;b.initEdgeDict(e);while((t=e.pq.extractMin())!==null){for(;;){i=e.pq.min();if(i===null||!_.vertEq(i,t))break;i=e.pq.extractMin();b.spliceMergeVertices(e,t.anEdge,i.anEdge)}b.sweepEvent(e,t)}e.event=e.dict.min().key.eUp.Org;b.debugEvent(e);b.doneEdgeDict(e);b.donePriorityQ(e);if(!b.removeDegenerateFaces(e,e.mesh))return false;e.mesh.check();return true};function f(){this.mesh=null;this.normal=[0,0,0];this.sUnit=[0,0,0];this.tUnit=[0,0,0];this.bmin=[0,0];this.bmax=[0,0];this.windingRule=m.WINDING_ODD;this.dict=null;this.pq=null;this.event=null;this.vertexIndexCounter=0;this.vertices=[];this.vertexIndices=[];this.vertexCount=0;this.elements=[];this.elementCount=0}f.prototype={dot_:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},normalize_:function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];p(t>0);t=Math.sqrt(t);e[0]/=t;e[1]/=t;e[2]/=t},longAxis_:function(e){var t=0;if(Math.abs(e[1])>Math.abs(e[0])){t=1}if(Math.abs(e[2])>Math.abs(e[t])){t=2}return t},computeNormal_:function(e){var t,i,r;var n,s,a;var o=[0,0,0],l=[0,0,0],u=[0,0,0],h=[0,0,0],c=[0,0,0];var f=[null,null,null],g=[null,null,null];var d=this.mesh.vHead;var m;t=d.next;for(m=0;m<3;++m){n=t.coords[m];l[m]=n;g[m]=t;o[m]=n;f[m]=t}for(t=d.next;t!==d;t=t.next){for(m=0;m<3;++m){n=t.coords[m];if(n<l[m]){l[m]=n;g[m]=t}if(n>o[m]){o[m]=n;f[m]=t}}}m=0;if(o[1]-l[1]>o[0]-l[0]){m=1}if(o[2]-l[2]>o[m]-l[m]){m=2}if(l[m]>=o[m]){e[0]=0;e[1]=0;e[2]=1;return}a=0;i=g[m];r=f[m];u[0]=i.coords[0]-r.coords[0];u[1]=i.coords[1]-r.coords[1];u[2]=i.coords[2]-r.coords[2];for(t=d.next;t!==d;t=t.next){h[0]=t.coords[0]-r.coords[0];h[1]=t.coords[1]-r.coords[1];h[2]=t.coords[2]-r.coords[2];c[0]=u[1]*h[2]-u[2]*h[1];c[1]=u[2]*h[0]-u[0]*h[2];c[2]=u[0]*h[1]-u[1]*h[0];s=c[0]*c[0]+c[1]*c[1]+c[2]*c[2];if(s>a){a=s;e[0]=c[0];e[1]=c[1];e[2]=c[2]}}if(a<=0){e[0]=e[1]=e[2]=0;e[this.longAxis_(u)]=1}},checkOrientation_:function(){var e;var t,i=this.mesh.fHead;var r,n=this.mesh.vHead;var s;e=0;for(t=i.next;t!==i;t=t.next){s=t.anEdge;if(s.winding<=0)continue;do{e+=(s.Org.s-s.Dst.s)*(s.Org.t+s.Dst.t);s=s.Lnext}while(s!==t.anEdge)}if(e<0){for(r=n.next;r!==n;r=r.next){r.t=-r.t}this.tUnit[0]=-this.tUnit[0];this.tUnit[1]=-this.tUnit[1];this.tUnit[2]=-this.tUnit[2]}},projectPolygon_:function(){var e,t=this.mesh.vHead;var i=[0,0,0];var r,n;var s,a,o=false;i[0]=this.normal[0];i[1]=this.normal[1];i[2]=this.normal[2];if(i[0]===0&&i[1]===0&&i[2]===0){this.computeNormal_(i);o=true}r=this.sUnit;n=this.tUnit;s=this.longAxis_(i);r[s]=0;r[(s+1)%3]=1;r[(s+2)%3]=0;n[s]=0;n[(s+1)%3]=0;n[(s+2)%3]=i[s]>0?1:-1;for(e=t.next;e!==t;e=e.next){e.s=this.dot_(e.coords,r);e.t=this.dot_(e.coords,n)}if(o){this.checkOrientation_()}a=true;for(e=t.next;e!==t;e=e.next){if(a){this.bmin[0]=this.bmax[0]=e.s;this.bmin[1]=this.bmax[1]=e.t;a=false}else{if(e.s<this.bmin[0])this.bmin[0]=e.s;if(e.s>this.bmax[0])this.bmax[0]=e.s;if(e.t<this.bmin[1])this.bmin[1]=e.t;if(e.t>this.bmax[1])this.bmax[1]=e.t}}},addWinding_:function(e,t){e.winding+=t.winding;e.Sym.winding+=t.Sym.winding},tessellateMonoRegion_:function(e,t){var i,r;i=t.anEdge;p(i.Lnext!==i&&i.Lnext.Lnext!==i);for(;_.vertLeq(i.Dst,i.Org);i=i.Lprev);for(;_.vertLeq(i.Org,i.Dst);i=i.Lnext);r=i.Lprev;while(i.Lnext!==r){if(_.vertLeq(i.Dst,r.Org)){while(r.Lnext!==i&&(_.edgeGoesLeft(r.Lnext)||_.edgeSign(r.Org,r.Dst,r.Lnext.Dst)<=0)){var n=e.connect(r.Lnext,r);r=n.Sym}r=r.Lprev}else{while(r.Lnext!=i&&(_.edgeGoesRight(i.Lprev)||_.edgeSign(i.Dst,i.Org,i.Lprev.Org)>=0)){var n=e.connect(i,i.Lprev);i=n.Sym}i=i.Lnext}}p(r.Lnext!==i);while(r.Lnext.Lnext!==i){var n=e.connect(r.Lnext,r);r=n.Sym}return true},tessellateInterior_:function(e){var t,i;for(t=e.fHead.next;t!==e.fHead;t=i){i=t.next;if(t.inside){if(!this.tessellateMonoRegion_(e,t))return false}}return true},discardExterior_:function(e){var t,i;for(t=e.fHead.next;t!==e.fHead;t=i){i=t.next;if(!t.inside){e.zapFace(t)}}},setWindingNumber_:function(e,t,i){var r,n;for(r=e.eHead.next;r!==e.eHead;r=n){n=r.next;if(r.Rface.inside!==r.Lface.inside){r.winding=r.Lface.inside?t:-t}else{if(!i){r.winding=0}else{e.delete(r)}}}},getNeighbourFace_:function(e){if(!e.Rface)return-1;if(!e.Rface.inside)return-1;return e.Rface.n},outputPolymesh_:function(e,t,i,r){var n;var s;var a;var o=0;var l=0;var u,h;var c=0;var f;if(i>3){e.mergeConvexFaces(i)}for(n=e.vHead.next;n!==e.vHead;n=n.next)n.n=-1;for(s=e.fHead.next;s!=e.fHead;s=s.next){s.n=-1;if(!s.inside)continue;a=s.anEdge;u=0;do{n=a.Org;if(n.n===-1){n.n=l;l++}u++;a=a.Lnext}while(a!==s.anEdge);p(u<=i);s.n=o;++o}this.elementCount=o;if(t==m.CONNECTED_POLYGONS)o*=2;this.elements=[];this.elements.length=o*i;this.vertexCount=l;this.vertices=[];this.vertices.length=l*r;this.vertexIndices=[];this.vertexIndices.length=l;for(n=e.vHead.next;n!==e.vHead;n=n.next){if(n.n!=-1){var g=n.n*r;this.vertices[g+0]=n.coords[0];this.vertices[g+1]=n.coords[1];if(r>2)this.vertices[g+2]=n.coords[2];this.vertexIndices[n.n]=n.idx}}var d=0;for(s=e.fHead.next;s!==e.fHead;s=s.next){if(!s.inside)continue;a=s.anEdge;u=0;do{n=a.Org;this.elements[d++]=n.n;u++;a=a.Lnext}while(a!==s.anEdge);for(h=u;h<i;++h)this.elements[d++]=-1;if(t==m.CONNECTED_POLYGONS){a=s.anEdge;do{this.elements[d++]=this.getNeighbourFace_(a);a=a.Lnext}while(a!==s.anEdge);for(h=u;h<i;++h)this.elements[d++]=-1}}},outputContours_:function(e,t){var i;var r;var n;var s;var a;var o;var l=0;var u=0;this.vertexCount=0;this.elementCount=0;for(i=e.fHead.next;i!==e.fHead;i=i.next){if(!i.inside)continue;n=r=i.anEdge;do{this.vertexCount++;r=r.Lnext}while(r!==n);this.elementCount++}this.elements=[];this.elements.length=this.elementCount*2;this.vertices=[];this.vertices.length=this.vertexCount*t;this.vertexIndices=[];this.vertexIndices.length=this.vertexCount;var h=0;var c=0;var f=0;l=0;for(i=e.fHead.next;i!==e.fHead;i=i.next){if(!i.inside)continue;u=0;n=r=i.anEdge;do{this.vertices[h++]=r.Org.coords[0];this.vertices[h++]=r.Org.coords[1];if(t>2)this.vertices[h++]=r.Org.coords[2];this.vertexIndices[c++]=r.Org.idx;u++;r=r.Lnext}while(r!==n);this.elements[f++]=l;this.elements[f++]=u;l+=u}},addContour:function(e,t){var i;var r;if(this.mesh===null)this.mesh=new s;if(e<2)e=2;if(e>3)e=3;i=null;for(r=0;r<t.length;r+=e){if(i==null){i=this.mesh.makeEdge();this.mesh.splice(i,i.Sym)}else{this.mesh.splitEdge(i);i=i.Lnext}i.Org.coords[0]=t[r+0];i.Org.coords[1]=t[r+1];if(e>2)i.Org.coords[2]=t[r+2];else i.Org.coords[2]=0;i.Org.idx=this.vertexIndexCounter++;i.winding=1;i.Sym.winding=-1}},tesselate:function(e,t,i,r,n){this.vertices=[];this.elements=[];this.vertexIndices=[];this.vertexIndexCounter=0;if(n){this.normal[0]=n[0];this.normal[1]=n[1];this.normal[2]=n[2]}this.windingRule=e;if(r<2)r=2;if(r>3)r=3;if(!this.mesh){return false}this.projectPolygon_();b.computeInterior(this);var s=this.mesh;if(t==m.BOUNDARY_CONTOURS){this.setWindingNumber_(s,1,true)}else{this.tessellateInterior_(s)}s.check();if(t==m.BOUNDARY_CONTOURS){this.outputContours_(s,r)}else{this.outputPolymesh_(s,t,i,r)}return true}}},{}]},{},[1])(1)});(()=>{var La={};(()=>{La.d=(e,t)=>{for(var i in t){if(La.o(t,i)&&!La.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{La.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{La.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var wa={};(()=>{"use strict";La.r(wa);La.d(wa,{CGL:()=>Pa,Framebuffer2:()=>xa,Geometry:()=>c,Mesh:()=>p,Shader:()=>x,Texture:()=>E,Uniform:()=>m});var C={};La.r(C);La.d(C,{ARRAY_TYPE:()=>_,EPSILON:()=>w,RANDOM:()=>u,equals:()=>Z,setMatrixArrayType:()=>Y,toRadian:()=>W});var R={};La.r(R);La.d(R,{LDU:()=>ge,add:()=>de,adjoint:()=>ne,clone:()=>Q,copy:()=>J,create:()=>K,determinant:()=>se,equals:()=>_e,exactEquals:()=>pe,frob:()=>fe,fromRotation:()=>ue,fromScaling:()=>he,fromValues:()=>ee,identity:()=>$,invert:()=>re,mul:()=>xe,multiply:()=>ae,multiplyScalar:()=>be,multiplyScalarAndAdd:()=>ve,rotate:()=>oe,scale:()=>le,set:()=>te,str:()=>ce,sub:()=>Ee,subtract:()=>me,transpose:()=>ie});var N={};La.r(N);La.d(N,{add:()=>Be,clone:()=>Te,copy:()=>Oe,create:()=>Ae,determinant:()=>Re,equals:()=>He,exactEquals:()=>ze,frob:()=>Ue,fromRotation:()=>we,fromScaling:()=>Fe,fromTranslation:()=>ke,fromValues:()=>Se,identity:()=>Ie,invert:()=>Ce,mul:()=>Xe,multiply:()=>Ne,multiplyScalar:()=>je,multiplyScalarAndAdd:()=>Ge,rotate:()=>ye,scale:()=>Pe,set:()=>Me,str:()=>De,sub:()=>Ye,subtract:()=>Ve,translate:()=>Le});var y={};La.r(y);La.d(y,{add:()=>_t,adjoint:()=>it,clone:()=>Ze,copy:()=>Ke,create:()=>qe,determinant:()=>rt,equals:()=>At,exactEquals:()=>Et,frob:()=>pt,fromMat2d:()=>ct,fromMat4:()=>We,fromQuat:()=>ft,fromRotation:()=>ut,fromScaling:()=>ht,fromTranslation:()=>lt,fromValues:()=>Qe,identity:()=>$e,invert:()=>tt,mul:()=>Tt,multiply:()=>nt,multiplyScalar:()=>vt,multiplyScalarAndAdd:()=>xt,normalFromMat4:()=>gt,projection:()=>dt,rotate:()=>at,scale:()=>ot,set:()=>Je,str:()=>mt,sub:()=>Ot,subtract:()=>bt,translate:()=>st,transpose:()=>et});var P={};La.r(P);La.d(P,{add:()=>ai,adjoint:()=>Nt,clone:()=>It,copy:()=>St,create:()=>r,determinant:()=>yt,equals:()=>ci,exactEquals:()=>hi,frob:()=>si,fromQuat:()=>Qt,fromQuat2:()=>Xt,fromRotation:()=>Vt,fromRotationTranslation:()=>Ht,fromRotationTranslationScale:()=>Zt,fromRotationTranslationScaleOrigin:()=>Kt,fromScaling:()=>Bt,fromTranslation:()=>Ut,fromValues:()=>Mt,fromXRotation:()=>jt,fromYRotation:()=>Gt,fromZRotation:()=>zt,frustum:()=>Jt,getRotation:()=>Wt,getScaling:()=>qt,getTranslation:()=>Yt,identity:()=>T,invert:()=>t,lookAt:()=>ii,mul:()=>fi,multiply:()=>Pt,multiplyScalar:()=>li,multiplyScalarAndAdd:()=>ui,ortho:()=>ti,perspective:()=>$t,perspectiveFromFieldOfView:()=>ei,rotate:()=>wt,rotateX:()=>Ft,rotateY:()=>kt,rotateZ:()=>Dt,scale:()=>Lt,set:()=>Ct,str:()=>ni,sub:()=>gi,subtract:()=>oi,targetTo:()=>ri,translate:()=>n,transpose:()=>Rt});var L={};La.r(L);La.d(L,{add:()=>_i,angle:()=>Gi,bezier:()=>wi,ceil:()=>xi,clone:()=>di,copy:()=>pi,create:()=>D,cross:()=>G,dist:()=>Ki,distance:()=>Mi,div:()=>Zi,divide:()=>vi,dot:()=>j,equals:()=>Yi,exactEquals:()=>Xi,floor:()=>Ei,forEach:()=>er,fromValues:()=>o,hermite:()=>Li,inverse:()=>yi,len:()=>Ji,length:()=>mi,lerp:()=>Pi,max:()=>Ti,min:()=>Ai,mul:()=>Wi,multiply:()=>bi,negate:()=>Ni,normalize:()=>V,random:()=>Fi,rotateX:()=>Bi,rotateY:()=>Vi,rotateZ:()=>ji,round:()=>Oi,scale:()=>Ii,scaleAndAdd:()=>Si,set:()=>U,sqrDist:()=>Qi,sqrLen:()=>$i,squaredDistance:()=>Ci,squaredLength:()=>Ri,str:()=>Hi,sub:()=>qi,subtract:()=>B,transformMat3:()=>Di,transformMat4:()=>ki,transformQuat:()=>Ui,zero:()=>zi});var F={};La.r(F);La.d(F,{add:()=>ar,ceil:()=>hr,clone:()=>ir,copy:()=>nr,create:()=>tr,cross:()=>Ir,dist:()=>Dr,distance:()=>_r,div:()=>kr,divide:()=>ur,dot:()=>Or,equals:()=>Lr,exactEquals:()=>Pr,floor:()=>cr,forEach:()=>jr,fromValues:()=>rr,inverse:()=>Ar,len:()=>Br,length:()=>vr,lerp:()=>Sr,max:()=>gr,min:()=>fr,mul:()=>Fr,multiply:()=>lr,negate:()=>Er,normalize:()=>Tr,random:()=>Mr,round:()=>dr,scale:()=>mr,scaleAndAdd:()=>pr,set:()=>sr,sqrDist:()=>Ur,sqrLen:()=>Vr,squaredDistance:()=>br,squaredLength:()=>xr,str:()=>yr,sub:()=>wr,subtract:()=>or,transformMat4:()=>Cr,transformQuat:()=>Rr,zero:()=>Nr});var k={};La.r(k);La.d(k,{add:()=>cn,calculateW:()=>Kr,clone:()=>on,conjugate:()=>rn,copy:()=>un,create:()=>s,dot:()=>dn,equals:()=>An,exactEquals:()=>En,exp:()=>Qr,fromEuler:()=>sn,fromMat3:()=>nn,fromValues:()=>ln,getAngle:()=>Xr,getAxisAngle:()=>Hr,identity:()=>Gr,invert:()=>tn,len:()=>_n,length:()=>pn,lerp:()=>mn,ln:()=>Jr,mul:()=>fn,multiply:()=>Yr,normalize:()=>xn,pow:()=>$r,random:()=>en,rotateX:()=>qr,rotateY:()=>Wr,rotateZ:()=>Zr,rotationTo:()=>Tn,scale:()=>gn,set:()=>hn,setAxes:()=>In,setAxisAngle:()=>zr,slerp:()=>l,sqlerp:()=>On,sqrLen:()=>vn,squaredLength:()=>bn,str:()=>an});var H={};La.r(H);La.d(H,{add:()=>Zn,clone:()=>Mn,conjugate:()=>is,copy:()=>wn,create:()=>Sn,dot:()=>$n,equals:()=>us,exactEquals:()=>ls,fromMat4:()=>Ln,fromRotation:()=>Pn,fromRotationTranslation:()=>Nn,fromRotationTranslationValues:()=>Rn,fromTranslation:()=>yn,fromValues:()=>Cn,getDual:()=>Un,getReal:()=>Dn,getTranslation:()=>jn,identity:()=>Fn,invert:()=>ts,len:()=>ns,length:()=>rs,lerp:()=>es,mul:()=>Qn,multiply:()=>Kn,normalize:()=>as,rotateAroundAxis:()=>Wn,rotateByQuatAppend:()=>Yn,rotateByQuatPrepend:()=>qn,rotateX:()=>zn,rotateY:()=>Hn,rotateZ:()=>Xn,scale:()=>Jn,set:()=>kn,setDual:()=>Vn,setReal:()=>Bn,sqrLen:()=>ss,squaredLength:()=>f,str:()=>os,translate:()=>Gn});var X={};La.r(X);La.d(X,{add:()=>gs,angle:()=>Vs,ceil:()=>_s,clone:()=>hs,copy:()=>fs,create:()=>e,cross:()=>Ps,dist:()=>Zs,distance:()=>Os,div:()=>Ws,divide:()=>ps,dot:()=>ys,equals:()=>Hs,exactEquals:()=>zs,floor:()=>bs,forEach:()=>Js,fromValues:()=>cs,inverse:()=>Rs,len:()=>Xs,length:()=>Ss,lerp:()=>Ls,max:()=>xs,min:()=>vs,mul:()=>qs,multiply:()=>ms,negate:()=>Cs,normalize:()=>Ns,random:()=>ws,rotate:()=>Bs,round:()=>Es,scale:()=>As,scaleAndAdd:()=>Ts,set:()=>z,sqrDist:()=>Ks,sqrLen:()=>Qs,squaredDistance:()=>Is,squaredLength:()=>Ms,str:()=>Gs,sub:()=>Ys,subtract:()=>ds,transformMat2:()=>Fs,transformMat2d:()=>ks,transformMat3:()=>Ds,transformMat4:()=>Us,zero:()=>js});const A=CABLES;const h=CABLES.SHARED;var w=1e-6;var _=typeof Float32Array!=="undefined"?Float32Array:Array;var u=Math.random;function Y(e){_=e}var q=Math.PI/180;function W(e){return e*q}function Z(e,t){return Math.abs(e-t)<=w*Math.max(1,Math.abs(e),Math.abs(t))}if(!Math.hypot)Math.hypot=function(){var e=0,t=arguments.length;while(t--){e+=arguments[t]*arguments[t]}return Math.sqrt(e)};function K(){var e=new _(4);if(_!=Float32Array){e[1]=0;e[2]=0}e[0]=1;e[3]=1;return e}function Q(e){var t=new _(4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}function J(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}function $(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;return e}function ee(e,t,i,r){var n=new _(4);n[0]=e;n[1]=t;n[2]=i;n[3]=r;return n}function te(e,t,i,r,n){e[0]=t;e[1]=i;e[2]=r;e[3]=n;return e}function ie(e,t){if(e===t){var i=t[1];e[1]=t[2];e[2]=i}else{e[0]=t[0];e[1]=t[2];e[2]=t[1];e[3]=t[3]}return e}function re(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=i*s-n*r;if(!a){return null}a=1/a;e[0]=s*a;e[1]=-r*a;e[2]=-n*a;e[3]=i*a;return e}function ne(e,t){var i=t[0];e[0]=t[3];e[1]=-t[1];e[2]=-t[2];e[3]=i;return e}function se(e){return e[0]*e[3]-e[2]*e[1]}function ae(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3];var o=i[0],l=i[1],u=i[2],h=i[3];e[0]=r*o+s*l;e[1]=n*o+a*l;e[2]=r*u+s*h;e[3]=n*u+a*h;return e}function oe(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3];var o=Math.sin(i);var l=Math.cos(i);e[0]=r*l+s*o;e[1]=n*l+a*o;e[2]=r*-o+s*l;e[3]=n*-o+a*l;return e}function le(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3];var o=i[0],l=i[1];e[0]=r*o;e[1]=n*o;e[2]=s*l;e[3]=a*l;return e}function ue(e,t){var i=Math.sin(t);var r=Math.cos(t);e[0]=r;e[1]=i;e[2]=-i;e[3]=r;return e}function he(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=t[1];return e}function ce(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function fe(e){return Math.hypot(e[0],e[1],e[2],e[3])}function ge(e,t,i,r){e[2]=r[2]/r[0];i[0]=r[0];i[1]=r[1];i[3]=r[3]-e[2]*i[1];return[e,t,i]}function de(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];return e}function me(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];return e}function pe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function _e(e,t){var i=e[0],r=e[1],n=e[2],s=e[3];var a=t[0],o=t[1],l=t[2],u=t[3];return Math.abs(i-a)<=w*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-o)<=w*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-l)<=w*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-u)<=w*Math.max(1,Math.abs(s),Math.abs(u))}function be(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;return e}function ve(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;e[3]=t[3]+i[3]*r;return e}var xe=ae;var Ee=me;function Ae(){var e=new _(6);if(_!=Float32Array){e[1]=0;e[2]=0;e[4]=0;e[5]=0}e[0]=1;e[3]=1;return e}function Te(e){var t=new _(6);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];return t}function Oe(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];return e}function Ie(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;return e}function Se(e,t,i,r,n,s){var a=new _(6);a[0]=e;a[1]=t;a[2]=i;a[3]=r;a[4]=n;a[5]=s;return a}function Me(e,t,i,r,n,s,a){e[0]=t;e[1]=i;e[2]=r;e[3]=n;e[4]=s;e[5]=a;return e}function Ce(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=t[4],o=t[5];var l=i*s-r*n;if(!l){return null}l=1/l;e[0]=s*l;e[1]=-r*l;e[2]=-n*l;e[3]=i*l;e[4]=(n*o-s*a)*l;e[5]=(r*a-i*o)*l;return e}function Re(e){return e[0]*e[3]-e[1]*e[2]}function Ne(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var u=i[0],h=i[1],c=i[2],f=i[3],g=i[4],d=i[5];e[0]=r*u+s*h;e[1]=n*u+a*h;e[2]=r*c+s*f;e[3]=n*c+a*f;e[4]=r*g+s*d+o;e[5]=n*g+a*d+l;return e}function ye(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var u=Math.sin(i);var h=Math.cos(i);e[0]=r*h+s*u;e[1]=n*h+a*u;e[2]=r*-u+s*h;e[3]=n*-u+a*h;e[4]=o;e[5]=l;return e}function Pe(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var u=i[0],h=i[1];e[0]=r*u;e[1]=n*u;e[2]=s*h;e[3]=a*h;e[4]=o;e[5]=l;return e}function Le(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var u=i[0],h=i[1];e[0]=r;e[1]=n;e[2]=s;e[3]=a;e[4]=r*u+s*h+o;e[5]=n*u+a*h+l;return e}function we(e,t){var i=Math.sin(t),r=Math.cos(t);e[0]=r;e[1]=i;e[2]=-i;e[3]=r;e[4]=0;e[5]=0;return e}function Fe(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=t[1];e[4]=0;e[5]=0;return e}function ke(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=t[0];e[5]=t[1];return e}function De(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function Ue(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function Be(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];return e}function Ve(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];return e}function je(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;return e}function Ge(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;e[3]=t[3]+i[3]*r;e[4]=t[4]+i[4]*r;e[5]=t[5]+i[5]*r;return e}function ze(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function He(e,t){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5];var l=t[0],u=t[1],h=t[2],c=t[3],f=t[4],g=t[5];return Math.abs(i-l)<=w*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-u)<=w*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-h)<=w*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(s-c)<=w*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(a-f)<=w*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-g)<=w*Math.max(1,Math.abs(o),Math.abs(g))}var Xe=Ne;var Ye=Ve;function qe(){var e=new _(9);if(_!=Float32Array){e[1]=0;e[2]=0;e[3]=0;e[5]=0;e[6]=0;e[7]=0}e[0]=1;e[4]=1;e[8]=1;return e}function We(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[4];e[4]=t[5];e[5]=t[6];e[6]=t[8];e[7]=t[9];e[8]=t[10];return e}function Ze(e){var t=new _(9);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t}function Ke(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e}function Qe(e,t,i,r,n,s,a,o,l){var u=new _(9);u[0]=e;u[1]=t;u[2]=i;u[3]=r;u[4]=n;u[5]=s;u[6]=a;u[7]=o;u[8]=l;return u}function Je(e,t,i,r,n,s,a,o,l,u){e[0]=t;e[1]=i;e[2]=r;e[3]=n;e[4]=s;e[5]=a;e[6]=o;e[7]=l;e[8]=u;return e}function $e(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function et(e,t){if(e===t){var i=t[1],r=t[2],n=t[5];e[1]=t[3];e[2]=t[6];e[3]=i;e[5]=t[7];e[6]=r;e[7]=n}else{e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8]}return e}function tt(e,t){var i=t[0],r=t[1],n=t[2];var s=t[3],a=t[4],o=t[5];var l=t[6],u=t[7],h=t[8];var c=h*a-o*u;var f=-h*s+o*l;var g=u*s-a*l;var d=i*c+r*f+n*g;if(!d){return null}d=1/d;e[0]=c*d;e[1]=(-h*r+n*u)*d;e[2]=(o*r-n*a)*d;e[3]=f*d;e[4]=(h*i-n*l)*d;e[5]=(-o*i+n*s)*d;e[6]=g*d;e[7]=(-u*i+r*l)*d;e[8]=(a*i-r*s)*d;return e}function it(e,t){var i=t[0],r=t[1],n=t[2];var s=t[3],a=t[4],o=t[5];var l=t[6],u=t[7],h=t[8];e[0]=a*h-o*u;e[1]=n*u-r*h;e[2]=r*o-n*a;e[3]=o*l-s*h;e[4]=i*h-n*l;e[5]=n*s-i*o;e[6]=s*u-a*l;e[7]=r*l-i*u;e[8]=i*a-r*s;return e}function rt(e){var t=e[0],i=e[1],r=e[2];var n=e[3],s=e[4],a=e[5];var o=e[6],l=e[7],u=e[8];return t*(u*s-a*l)+i*(-u*n+a*o)+r*(l*n-s*o)}function nt(e,t,i){var r=t[0],n=t[1],s=t[2];var a=t[3],o=t[4],l=t[5];var u=t[6],h=t[7],c=t[8];var f=i[0],g=i[1],d=i[2];var m=i[3],p=i[4],_=i[5];var b=i[6],v=i[7],x=i[8];e[0]=f*r+g*a+d*u;e[1]=f*n+g*o+d*h;e[2]=f*s+g*l+d*c;e[3]=m*r+p*a+_*u;e[4]=m*n+p*o+_*h;e[5]=m*s+p*l+_*c;e[6]=b*r+v*a+x*u;e[7]=b*n+v*o+x*h;e[8]=b*s+v*l+x*c;return e}function st(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=t[8],f=i[0],g=i[1];e[0]=r;e[1]=n;e[2]=s;e[3]=a;e[4]=o;e[5]=l;e[6]=f*r+g*a+u;e[7]=f*n+g*o+h;e[8]=f*s+g*l+c;return e}function at(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=t[8],f=Math.sin(i),g=Math.cos(i);e[0]=g*r+f*a;e[1]=g*n+f*o;e[2]=g*s+f*l;e[3]=g*a-f*r;e[4]=g*o-f*n;e[5]=g*l-f*s;e[6]=u;e[7]=h;e[8]=c;return e}function ot(e,t,i){var r=i[0],n=i[1];e[0]=r*t[0];e[1]=r*t[1];e[2]=r*t[2];e[3]=n*t[3];e[4]=n*t[4];e[5]=n*t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e}function lt(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=t[0];e[7]=t[1];e[8]=1;return e}function ut(e,t){var i=Math.sin(t),r=Math.cos(t);e[0]=r;e[1]=i;e[2]=0;e[3]=-i;e[4]=r;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function ht(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=0;e[4]=t[1];e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function ct(e,t){e[0]=t[0];e[1]=t[1];e[2]=0;e[3]=t[2];e[4]=t[3];e[5]=0;e[6]=t[4];e[7]=t[5];e[8]=1;return e}function ft(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=i+i;var o=r+r;var l=n+n;var u=i*a;var h=r*a;var c=r*o;var f=n*a;var g=n*o;var d=n*l;var m=s*a;var p=s*o;var _=s*l;e[0]=1-c-d;e[3]=h-_;e[6]=f+p;e[1]=h+_;e[4]=1-u-d;e[7]=g-m;e[2]=f-p;e[5]=g+m;e[8]=1-u-c;return e}function gt(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=t[4],o=t[5],l=t[6],u=t[7];var h=t[8],c=t[9],f=t[10],g=t[11];var d=t[12],m=t[13],p=t[14],_=t[15];var b=i*o-r*a;var v=i*l-n*a;var x=i*u-s*a;var E=r*l-n*o;var A=r*u-s*o;var T=n*u-s*l;var O=h*m-c*d;var I=h*p-f*d;var S=h*_-g*d;var M=c*p-f*m;var C=c*_-g*m;var R=f*_-g*p;var N=b*R-v*C+x*M+E*S-A*I+T*O;if(!N){return null}N=1/N;e[0]=(o*R-l*C+u*M)*N;e[1]=(l*S-a*R-u*I)*N;e[2]=(a*C-o*S+u*O)*N;e[3]=(n*C-r*R-s*M)*N;e[4]=(i*R-n*S+s*I)*N;e[5]=(r*S-i*C-s*O)*N;e[6]=(m*T-p*A+_*E)*N;e[7]=(p*x-d*T-_*v)*N;e[8]=(d*A-m*x+_*b)*N;return e}function dt(e,t,i){e[0]=2/t;e[1]=0;e[2]=0;e[3]=0;e[4]=-2/i;e[5]=0;e[6]=-1;e[7]=1;e[8]=1;return e}function mt(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function pt(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function _t(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];e[8]=t[8]+i[8];return e}function bt(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];e[6]=t[6]-i[6];e[7]=t[7]-i[7];e[8]=t[8]-i[8];return e}function vt(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;e[8]=t[8]*i;return e}function xt(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;e[3]=t[3]+i[3]*r;e[4]=t[4]+i[4]*r;e[5]=t[5]+i[5]*r;e[6]=t[6]+i[6]*r;e[7]=t[7]+i[7]*r;e[8]=t[8]+i[8]*r;return e}function Et(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function At(e,t){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7],h=e[8];var c=t[0],f=t[1],g=t[2],d=t[3],m=t[4],p=t[5],_=t[6],b=t[7],v=t[8];return Math.abs(i-c)<=w*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(r-f)<=w*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-g)<=w*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(s-d)<=w*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-m)<=w*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(o-p)<=w*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(l-_)<=w*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(u-b)<=w*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(h-v)<=w*Math.max(1,Math.abs(h),Math.abs(v))}var Tt=nt;var Ot=bt;function r(){var e=new _(16);if(_!=Float32Array){e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[11]=0;e[12]=0;e[13]=0;e[14]=0}e[0]=1;e[5]=1;e[10]=1;e[15]=1;return e}function It(e){var t=new _(16);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];t[9]=e[9];t[10]=e[10];t[11]=e[11];t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15];return t}function St(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e}function Mt(e,t,i,r,n,s,a,o,l,u,h,c,f,g,d,m){var p=new _(16);p[0]=e;p[1]=t;p[2]=i;p[3]=r;p[4]=n;p[5]=s;p[6]=a;p[7]=o;p[8]=l;p[9]=u;p[10]=h;p[11]=c;p[12]=f;p[13]=g;p[14]=d;p[15]=m;return p}function Ct(e,t,i,r,n,s,a,o,l,u,h,c,f,g,d,m,p){e[0]=t;e[1]=i;e[2]=r;e[3]=n;e[4]=s;e[5]=a;e[6]=o;e[7]=l;e[8]=u;e[9]=h;e[10]=c;e[11]=f;e[12]=g;e[13]=d;e[14]=m;e[15]=p;return e}function T(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Rt(e,t){if(e===t){var i=t[1],r=t[2],n=t[3];var s=t[6],a=t[7];var o=t[11];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=i;e[6]=t[9];e[7]=t[13];e[8]=r;e[9]=s;e[11]=t[14];e[12]=n;e[13]=a;e[14]=o}else{e[0]=t[0];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=t[1];e[5]=t[5];e[6]=t[9];e[7]=t[13];e[8]=t[2];e[9]=t[6];e[10]=t[10];e[11]=t[14];e[12]=t[3];e[13]=t[7];e[14]=t[11];e[15]=t[15]}return e}function t(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=t[4],o=t[5],l=t[6],u=t[7];var h=t[8],c=t[9],f=t[10],g=t[11];var d=t[12],m=t[13],p=t[14],_=t[15];var b=i*o-r*a;var v=i*l-n*a;var x=i*u-s*a;var E=r*l-n*o;var A=r*u-s*o;var T=n*u-s*l;var O=h*m-c*d;var I=h*p-f*d;var S=h*_-g*d;var M=c*p-f*m;var C=c*_-g*m;var R=f*_-g*p;var N=b*R-v*C+x*M+E*S-A*I+T*O;if(!N){return null}N=1/N;e[0]=(o*R-l*C+u*M)*N;e[1]=(n*C-r*R-s*M)*N;e[2]=(m*T-p*A+_*E)*N;e[3]=(f*A-c*T-g*E)*N;e[4]=(l*S-a*R-u*I)*N;e[5]=(i*R-n*S+s*I)*N;e[6]=(p*x-d*T-_*v)*N;e[7]=(h*T-f*x+g*v)*N;e[8]=(a*C-o*S+u*O)*N;e[9]=(r*S-i*C-s*O)*N;e[10]=(d*A-m*x+_*b)*N;e[11]=(c*x-h*A-g*b)*N;e[12]=(o*I-a*M-l*O)*N;e[13]=(i*M-r*I+n*O)*N;e[14]=(m*v-d*E-p*b)*N;e[15]=(h*E-c*v+f*b)*N;return e}function Nt(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=t[4],o=t[5],l=t[6],u=t[7];var h=t[8],c=t[9],f=t[10],g=t[11];var d=t[12],m=t[13],p=t[14],_=t[15];e[0]=o*(f*_-g*p)-c*(l*_-u*p)+m*(l*g-u*f);e[1]=-(r*(f*_-g*p)-c*(n*_-s*p)+m*(n*g-s*f));e[2]=r*(l*_-u*p)-o*(n*_-s*p)+m*(n*u-s*l);e[3]=-(r*(l*g-u*f)-o*(n*g-s*f)+c*(n*u-s*l));e[4]=-(a*(f*_-g*p)-h*(l*_-u*p)+d*(l*g-u*f));e[5]=i*(f*_-g*p)-h*(n*_-s*p)+d*(n*g-s*f);e[6]=-(i*(l*_-u*p)-a*(n*_-s*p)+d*(n*u-s*l));e[7]=i*(l*g-u*f)-a*(n*g-s*f)+h*(n*u-s*l);e[8]=a*(c*_-g*m)-h*(o*_-u*m)+d*(o*g-u*c);e[9]=-(i*(c*_-g*m)-h*(r*_-s*m)+d*(r*g-s*c));e[10]=i*(o*_-u*m)-a*(r*_-s*m)+d*(r*u-s*o);e[11]=-(i*(o*g-u*c)-a*(r*g-s*c)+h*(r*u-s*o));e[12]=-(a*(c*p-f*m)-h*(o*p-l*m)+d*(o*f-l*c));e[13]=i*(c*p-f*m)-h*(r*p-n*m)+d*(r*f-n*c);e[14]=-(i*(o*p-l*m)-a*(r*p-n*m)+d*(r*l-n*o));e[15]=i*(o*f-l*c)-a*(r*f-n*c)+h*(r*l-n*o);return e}function yt(e){var t=e[0],i=e[1],r=e[2],n=e[3];var s=e[4],a=e[5],o=e[6],l=e[7];var u=e[8],h=e[9],c=e[10],f=e[11];var g=e[12],d=e[13],m=e[14],p=e[15];var _=t*a-i*s;var b=t*o-r*s;var v=t*l-n*s;var x=i*o-r*a;var E=i*l-n*a;var A=r*l-n*o;var T=u*d-h*g;var O=u*m-c*g;var I=u*p-f*g;var S=h*m-c*d;var M=h*p-f*d;var C=c*p-f*m;return _*C-b*M+v*S+x*I-E*O+A*T}function Pt(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3];var o=t[4],l=t[5],u=t[6],h=t[7];var c=t[8],f=t[9],g=t[10],d=t[11];var m=t[12],p=t[13],_=t[14],b=t[15];var v=i[0],x=i[1],E=i[2],A=i[3];e[0]=v*r+x*o+E*c+A*m;e[1]=v*n+x*l+E*f+A*p;e[2]=v*s+x*u+E*g+A*_;e[3]=v*a+x*h+E*d+A*b;v=i[4];x=i[5];E=i[6];A=i[7];e[4]=v*r+x*o+E*c+A*m;e[5]=v*n+x*l+E*f+A*p;e[6]=v*s+x*u+E*g+A*_;e[7]=v*a+x*h+E*d+A*b;v=i[8];x=i[9];E=i[10];A=i[11];e[8]=v*r+x*o+E*c+A*m;e[9]=v*n+x*l+E*f+A*p;e[10]=v*s+x*u+E*g+A*_;e[11]=v*a+x*h+E*d+A*b;v=i[12];x=i[13];E=i[14];A=i[15];e[12]=v*r+x*o+E*c+A*m;e[13]=v*n+x*l+E*f+A*p;e[14]=v*s+x*u+E*g+A*_;e[15]=v*a+x*h+E*d+A*b;return e}function n(e,t,i){var r=i[0],n=i[1],s=i[2];var a,o,l,u;var h,c,f,g;var d,m,p,_;if(t===e){e[12]=t[0]*r+t[4]*n+t[8]*s+t[12];e[13]=t[1]*r+t[5]*n+t[9]*s+t[13];e[14]=t[2]*r+t[6]*n+t[10]*s+t[14];e[15]=t[3]*r+t[7]*n+t[11]*s+t[15]}else{a=t[0];o=t[1];l=t[2];u=t[3];h=t[4];c=t[5];f=t[6];g=t[7];d=t[8];m=t[9];p=t[10];_=t[11];e[0]=a;e[1]=o;e[2]=l;e[3]=u;e[4]=h;e[5]=c;e[6]=f;e[7]=g;e[8]=d;e[9]=m;e[10]=p;e[11]=_;e[12]=a*r+h*n+d*s+t[12];e[13]=o*r+c*n+m*s+t[13];e[14]=l*r+f*n+p*s+t[14];e[15]=u*r+g*n+_*s+t[15]}return e}function Lt(e,t,i){var r=i[0],n=i[1],s=i[2];e[0]=t[0]*r;e[1]=t[1]*r;e[2]=t[2]*r;e[3]=t[3]*r;e[4]=t[4]*n;e[5]=t[5]*n;e[6]=t[6]*n;e[7]=t[7]*n;e[8]=t[8]*s;e[9]=t[9]*s;e[10]=t[10]*s;e[11]=t[11]*s;e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e}function wt(e,t,i,r){var n=r[0],s=r[1],a=r[2];var o=Math.hypot(n,s,a);var l,u,h;var c,f,g,d;var m,p,_,b;var v,x,E,A;var T,O,I;var S,M,C;var R,N,y;if(o<w){return null}o=1/o;n*=o;s*=o;a*=o;l=Math.sin(i);u=Math.cos(i);h=1-u;c=t[0];f=t[1];g=t[2];d=t[3];m=t[4];p=t[5];_=t[6];b=t[7];v=t[8];x=t[9];E=t[10];A=t[11];T=n*n*h+u;O=s*n*h+a*l;I=a*n*h-s*l;S=n*s*h-a*l;M=s*s*h+u;C=a*s*h+n*l;R=n*a*h+s*l;N=s*a*h-n*l;y=a*a*h+u;e[0]=c*T+m*O+v*I;e[1]=f*T+p*O+x*I;e[2]=g*T+_*O+E*I;e[3]=d*T+b*O+A*I;e[4]=c*S+m*M+v*C;e[5]=f*S+p*M+x*C;e[6]=g*S+_*M+E*C;e[7]=d*S+b*M+A*C;e[8]=c*R+m*N+v*y;e[9]=f*R+p*N+x*y;e[10]=g*R+_*N+E*y;e[11]=d*R+b*N+A*y;if(t!==e){e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}return e}function Ft(e,t,i){var r=Math.sin(i);var n=Math.cos(i);var s=t[4];var a=t[5];var o=t[6];var l=t[7];var u=t[8];var h=t[9];var c=t[10];var f=t[11];if(t!==e){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[4]=s*n+u*r;e[5]=a*n+h*r;e[6]=o*n+c*r;e[7]=l*n+f*r;e[8]=u*n-s*r;e[9]=h*n-a*r;e[10]=c*n-o*r;e[11]=f*n-l*r;return e}function kt(e,t,i){var r=Math.sin(i);var n=Math.cos(i);var s=t[0];var a=t[1];var o=t[2];var l=t[3];var u=t[8];var h=t[9];var c=t[10];var f=t[11];if(t!==e){e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=s*n-u*r;e[1]=a*n-h*r;e[2]=o*n-c*r;e[3]=l*n-f*r;e[8]=s*r+u*n;e[9]=a*r+h*n;e[10]=o*r+c*n;e[11]=l*r+f*n;return e}function Dt(e,t,i){var r=Math.sin(i);var n=Math.cos(i);var s=t[0];var a=t[1];var o=t[2];var l=t[3];var u=t[4];var h=t[5];var c=t[6];var f=t[7];if(t!==e){e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=s*n+u*r;e[1]=a*n+h*r;e[2]=o*n+c*r;e[3]=l*n+f*r;e[4]=u*n-s*r;e[5]=h*n-a*r;e[6]=c*n-o*r;e[7]=f*n-l*r;return e}function Ut(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=t[0];e[13]=t[1];e[14]=t[2];e[15]=1;return e}function Bt(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=t[1];e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=t[2];e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Vt(e,t,i){var r=i[0],n=i[1],s=i[2];var a=Math.hypot(r,n,s);var o,l,u;if(a<w){return null}a=1/a;r*=a;n*=a;s*=a;o=Math.sin(t);l=Math.cos(t);u=1-l;e[0]=r*r*u+l;e[1]=n*r*u+s*o;e[2]=s*r*u-n*o;e[3]=0;e[4]=r*n*u-s*o;e[5]=n*n*u+l;e[6]=s*n*u+r*o;e[7]=0;e[8]=r*s*u+n*o;e[9]=n*s*u-r*o;e[10]=s*s*u+l;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function jt(e,t){var i=Math.sin(t);var r=Math.cos(t);e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=r;e[6]=i;e[7]=0;e[8]=0;e[9]=-i;e[10]=r;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Gt(e,t){var i=Math.sin(t);var r=Math.cos(t);e[0]=r;e[1]=0;e[2]=-i;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=i;e[9]=0;e[10]=r;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function zt(e,t){var i=Math.sin(t);var r=Math.cos(t);e[0]=r;e[1]=i;e[2]=0;e[3]=0;e[4]=-i;e[5]=r;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Ht(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3];var o=r+r;var l=n+n;var u=s+s;var h=r*o;var c=r*l;var f=r*u;var g=n*l;var d=n*u;var m=s*u;var p=a*o;var _=a*l;var b=a*u;e[0]=1-(g+m);e[1]=c+b;e[2]=f-_;e[3]=0;e[4]=c-b;e[5]=1-(h+m);e[6]=d+p;e[7]=0;e[8]=f+_;e[9]=d-p;e[10]=1-(h+g);e[11]=0;e[12]=i[0];e[13]=i[1];e[14]=i[2];e[15]=1;return e}function Xt(e,t){var i=new _(3);var r=-t[0],n=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7];var c=r*r+n*n+s*s+a*a;if(c>0){i[0]=(o*a+h*r+l*s-u*n)*2/c;i[1]=(l*a+h*n+u*r-o*s)*2/c;i[2]=(u*a+h*s+o*n-l*r)*2/c}else{i[0]=(o*a+h*r+l*s-u*n)*2;i[1]=(l*a+h*n+u*r-o*s)*2;i[2]=(u*a+h*s+o*n-l*r)*2}Ht(e,t,i);return e}function Yt(e,t){e[0]=t[12];e[1]=t[13];e[2]=t[14];return e}function qt(e,t){var i=t[0];var r=t[1];var n=t[2];var s=t[4];var a=t[5];var o=t[6];var l=t[8];var u=t[9];var h=t[10];e[0]=Math.hypot(i,r,n);e[1]=Math.hypot(s,a,o);e[2]=Math.hypot(l,u,h);return e}function Wt(e,t){var i=new _(3);qt(i,t);var r=1/i[0];var n=1/i[1];var s=1/i[2];var a=t[0]*r;var o=t[1]*n;var l=t[2]*s;var u=t[4]*r;var h=t[5]*n;var c=t[6]*s;var f=t[8]*r;var g=t[9]*n;var d=t[10]*s;var m=a+h+d;var p=0;if(m>0){p=Math.sqrt(m+1)*2;e[3]=.25*p;e[0]=(c-g)/p;e[1]=(f-l)/p;e[2]=(o-u)/p}else if(a>h&&a>d){p=Math.sqrt(1+a-h-d)*2;e[3]=(c-g)/p;e[0]=.25*p;e[1]=(o+u)/p;e[2]=(f+l)/p}else if(h>d){p=Math.sqrt(1+h-a-d)*2;e[3]=(f-l)/p;e[0]=(o+u)/p;e[1]=.25*p;e[2]=(c+g)/p}else{p=Math.sqrt(1+d-a-h)*2;e[3]=(o-u)/p;e[0]=(f+l)/p;e[1]=(c+g)/p;e[2]=.25*p}return e}function Zt(e,t,i,r){var n=t[0],s=t[1],a=t[2],o=t[3];var l=n+n;var u=s+s;var h=a+a;var c=n*l;var f=n*u;var g=n*h;var d=s*u;var m=s*h;var p=a*h;var _=o*l;var b=o*u;var v=o*h;var x=r[0];var E=r[1];var A=r[2];e[0]=(1-(d+p))*x;e[1]=(f+v)*x;e[2]=(g-b)*x;e[3]=0;e[4]=(f-v)*E;e[5]=(1-(c+p))*E;e[6]=(m+_)*E;e[7]=0;e[8]=(g+b)*A;e[9]=(m-_)*A;e[10]=(1-(c+d))*A;e[11]=0;e[12]=i[0];e[13]=i[1];e[14]=i[2];e[15]=1;return e}function Kt(e,t,i,r,n){var s=t[0],a=t[1],o=t[2],l=t[3];var u=s+s;var h=a+a;var c=o+o;var f=s*u;var g=s*h;var d=s*c;var m=a*h;var p=a*c;var _=o*c;var b=l*u;var v=l*h;var x=l*c;var E=r[0];var A=r[1];var T=r[2];var O=n[0];var I=n[1];var S=n[2];var M=(1-(m+_))*E;var C=(g+x)*E;var R=(d-v)*E;var N=(g-x)*A;var y=(1-(f+_))*A;var P=(p+b)*A;var L=(d+v)*T;var w=(p-b)*T;var F=(1-(f+m))*T;e[0]=M;e[1]=C;e[2]=R;e[3]=0;e[4]=N;e[5]=y;e[6]=P;e[7]=0;e[8]=L;e[9]=w;e[10]=F;e[11]=0;e[12]=i[0]+O-(M*O+N*I+L*S);e[13]=i[1]+I-(C*O+y*I+w*S);e[14]=i[2]+S-(R*O+P*I+F*S);e[15]=1;return e}function Qt(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=i+i;var o=r+r;var l=n+n;var u=i*a;var h=r*a;var c=r*o;var f=n*a;var g=n*o;var d=n*l;var m=s*a;var p=s*o;var _=s*l;e[0]=1-c-d;e[1]=h+_;e[2]=f-p;e[3]=0;e[4]=h-_;e[5]=1-u-d;e[6]=g+m;e[7]=0;e[8]=f+p;e[9]=g-m;e[10]=1-u-c;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Jt(e,t,i,r,n,s,a){var o=1/(i-t);var l=1/(n-r);var u=1/(s-a);e[0]=s*2*o;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=s*2*l;e[6]=0;e[7]=0;e[8]=(i+t)*o;e[9]=(n+r)*l;e[10]=(a+s)*u;e[11]=-1;e[12]=0;e[13]=0;e[14]=a*s*2*u;e[15]=0;return e}function $t(e,t,i,r,n){var s=1/Math.tan(t/2),a;e[0]=s/i;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=s;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[11]=-1;e[12]=0;e[13]=0;e[15]=0;if(n!=null&&n!==Infinity){a=1/(r-n);e[10]=(n+r)*a;e[14]=2*n*r*a}else{e[10]=-1;e[14]=-2*r}return e}function ei(e,t,i,r){var n=Math.tan(t.upDegrees*Math.PI/180);var s=Math.tan(t.downDegrees*Math.PI/180);var a=Math.tan(t.leftDegrees*Math.PI/180);var o=Math.tan(t.rightDegrees*Math.PI/180);var l=2/(a+o);var u=2/(n+s);e[0]=l;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=u;e[6]=0;e[7]=0;e[8]=-((a-o)*l*.5);e[9]=(n-s)*u*.5;e[10]=r/(i-r);e[11]=-1;e[12]=0;e[13]=0;e[14]=r*i/(i-r);e[15]=0;return e}function ti(e,t,i,r,n,s,a){var o=1/(t-i);var l=1/(r-n);var u=1/(s-a);e[0]=-2*o;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=-2*l;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=2*u;e[11]=0;e[12]=(t+i)*o;e[13]=(n+r)*l;e[14]=(a+s)*u;e[15]=1;return e}function ii(e,t,i,r){var n,s,a,o,l,u,h,c,f,g;var d=t[0];var m=t[1];var p=t[2];var _=r[0];var b=r[1];var v=r[2];var x=i[0];var E=i[1];var A=i[2];if(Math.abs(d-x)<w&&Math.abs(m-E)<w&&Math.abs(p-A)<w){return T(e)}h=d-x;c=m-E;f=p-A;g=1/Math.hypot(h,c,f);h*=g;c*=g;f*=g;n=b*f-v*c;s=v*h-_*f;a=_*c-b*h;g=Math.hypot(n,s,a);if(!g){n=0;s=0;a=0}else{g=1/g;n*=g;s*=g;a*=g}o=c*a-f*s;l=f*n-h*a;u=h*s-c*n;g=Math.hypot(o,l,u);if(!g){o=0;l=0;u=0}else{g=1/g;o*=g;l*=g;u*=g}e[0]=n;e[1]=o;e[2]=h;e[3]=0;e[4]=s;e[5]=l;e[6]=c;e[7]=0;e[8]=a;e[9]=u;e[10]=f;e[11]=0;e[12]=-(n*d+s*m+a*p);e[13]=-(o*d+l*m+u*p);e[14]=-(h*d+c*m+f*p);e[15]=1;return e}function ri(e,t,i,r){var n=t[0],s=t[1],a=t[2],o=r[0],l=r[1],u=r[2];var h=n-i[0],c=s-i[1],f=a-i[2];var g=h*h+c*c+f*f;if(g>0){g=1/Math.sqrt(g);h*=g;c*=g;f*=g}var d=l*f-u*c,m=u*h-o*f,p=o*c-l*h;g=d*d+m*m+p*p;if(g>0){g=1/Math.sqrt(g);d*=g;m*=g;p*=g}e[0]=d;e[1]=m;e[2]=p;e[3]=0;e[4]=c*p-f*m;e[5]=f*d-h*p;e[6]=h*m-c*d;e[7]=0;e[8]=h;e[9]=c;e[10]=f;e[11]=0;e[12]=n;e[13]=s;e[14]=a;e[15]=1;return e}function ni(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function si(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function ai(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];e[8]=t[8]+i[8];e[9]=t[9]+i[9];e[10]=t[10]+i[10];e[11]=t[11]+i[11];e[12]=t[12]+i[12];e[13]=t[13]+i[13];e[14]=t[14]+i[14];e[15]=t[15]+i[15];return e}function oi(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];e[6]=t[6]-i[6];e[7]=t[7]-i[7];e[8]=t[8]-i[8];e[9]=t[9]-i[9];e[10]=t[10]-i[10];e[11]=t[11]-i[11];e[12]=t[12]-i[12];e[13]=t[13]-i[13];e[14]=t[14]-i[14];e[15]=t[15]-i[15];return e}function li(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;e[8]=t[8]*i;e[9]=t[9]*i;e[10]=t[10]*i;e[11]=t[11]*i;e[12]=t[12]*i;e[13]=t[13]*i;e[14]=t[14]*i;e[15]=t[15]*i;return e}function ui(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;e[3]=t[3]+i[3]*r;e[4]=t[4]+i[4]*r;e[5]=t[5]+i[5]*r;e[6]=t[6]+i[6]*r;e[7]=t[7]+i[7]*r;e[8]=t[8]+i[8]*r;e[9]=t[9]+i[9]*r;e[10]=t[10]+i[10]*r;e[11]=t[11]+i[11]*r;e[12]=t[12]+i[12]*r;e[13]=t[13]+i[13]*r;e[14]=t[14]+i[14]*r;e[15]=t[15]+i[15]*r;return e}function hi(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function ci(e,t){var i=e[0],r=e[1],n=e[2],s=e[3];var a=e[4],o=e[5],l=e[6],u=e[7];var h=e[8],c=e[9],f=e[10],g=e[11];var d=e[12],m=e[13],p=e[14],_=e[15];var b=t[0],v=t[1],x=t[2],E=t[3];var A=t[4],T=t[5],O=t[6],I=t[7];var S=t[8],M=t[9],C=t[10],R=t[11];var N=t[12],y=t[13],P=t[14],L=t[15];return Math.abs(i-b)<=w*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(r-v)<=w*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(n-x)<=w*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(s-E)<=w*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(a-A)<=w*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(o-T)<=w*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(l-O)<=w*Math.max(1,Math.abs(l),Math.abs(O))&&Math.abs(u-I)<=w*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(h-S)<=w*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(c-M)<=w*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(f-C)<=w*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(g-R)<=w*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(d-N)<=w*Math.max(1,Math.abs(d),Math.abs(N))&&Math.abs(m-y)<=w*Math.max(1,Math.abs(m),Math.abs(y))&&Math.abs(p-P)<=w*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(_-L)<=w*Math.max(1,Math.abs(_),Math.abs(L))}var fi=Pt;var gi=oi;function D(){var e=new _(3);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0}return e}function di(e){var t=new _(3);t[0]=e[0];t[1]=e[1];t[2]=e[2];return t}function mi(e){var t=e[0];var i=e[1];var r=e[2];return Math.hypot(t,i,r)}function o(e,t,i){var r=new _(3);r[0]=e;r[1]=t;r[2]=i;return r}function pi(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];return e}function U(e,t,i,r){e[0]=t;e[1]=i;e[2]=r;return e}function _i(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];return e}function B(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];return e}function bi(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];e[2]=t[2]*i[2];return e}function vi(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];e[2]=t[2]/i[2];return e}function xi(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);e[2]=Math.ceil(t[2]);return e}function Ei(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);e[2]=Math.floor(t[2]);return e}function Ai(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);e[2]=Math.min(t[2],i[2]);return e}function Ti(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);e[2]=Math.max(t[2],i[2]);return e}function Oi(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);e[2]=Math.round(t[2]);return e}function Ii(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;return e}function Si(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;return e}function Mi(e,t){var i=t[0]-e[0];var r=t[1]-e[1];var n=t[2]-e[2];return Math.hypot(i,r,n)}function Ci(e,t){var i=t[0]-e[0];var r=t[1]-e[1];var n=t[2]-e[2];return i*i+r*r+n*n}function Ri(e){var t=e[0];var i=e[1];var r=e[2];return t*t+i*i+r*r}function Ni(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];return e}function yi(e,t){e[0]=1/t[0];e[1]=1/t[1];e[2]=1/t[2];return e}function V(e,t){var i=t[0];var r=t[1];var n=t[2];var s=i*i+r*r+n*n;if(s>0){s=1/Math.sqrt(s)}e[0]=t[0]*s;e[1]=t[1]*s;e[2]=t[2]*s;return e}function j(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function G(e,t,i){var r=t[0],n=t[1],s=t[2];var a=i[0],o=i[1],l=i[2];e[0]=n*l-s*o;e[1]=s*a-r*l;e[2]=r*o-n*a;return e}function Pi(e,t,i,r){var n=t[0];var s=t[1];var a=t[2];e[0]=n+r*(i[0]-n);e[1]=s+r*(i[1]-s);e[2]=a+r*(i[2]-a);return e}function Li(e,t,i,r,n,s){var a=s*s;var o=a*(2*s-3)+1;var l=a*(s-2)+s;var u=a*(s-1);var h=a*(3-2*s);e[0]=t[0]*o+i[0]*l+r[0]*u+n[0]*h;e[1]=t[1]*o+i[1]*l+r[1]*u+n[1]*h;e[2]=t[2]*o+i[2]*l+r[2]*u+n[2]*h;return e}function wi(e,t,i,r,n,s){var a=1-s;var o=a*a;var l=s*s;var u=o*a;var h=3*s*o;var c=3*l*a;var f=l*s;e[0]=t[0]*u+i[0]*h+r[0]*c+n[0]*f;e[1]=t[1]*u+i[1]*h+r[1]*c+n[1]*f;e[2]=t[2]*u+i[2]*h+r[2]*c+n[2]*f;return e}function Fi(e,t){t=t||1;var i=u()*2*Math.PI;var r=u()*2-1;var n=Math.sqrt(1-r*r)*t;e[0]=Math.cos(i)*n;e[1]=Math.sin(i)*n;e[2]=r*t;return e}function ki(e,t,i){var r=t[0],n=t[1],s=t[2];var a=i[3]*r+i[7]*n+i[11]*s+i[15];a=a||1;e[0]=(i[0]*r+i[4]*n+i[8]*s+i[12])/a;e[1]=(i[1]*r+i[5]*n+i[9]*s+i[13])/a;e[2]=(i[2]*r+i[6]*n+i[10]*s+i[14])/a;return e}function Di(e,t,i){var r=t[0],n=t[1],s=t[2];e[0]=r*i[0]+n*i[3]+s*i[6];e[1]=r*i[1]+n*i[4]+s*i[7];e[2]=r*i[2]+n*i[5]+s*i[8];return e}function Ui(e,t,i){var r=i[0],n=i[1],s=i[2],a=i[3];var o=t[0],l=t[1],u=t[2];var h=n*u-s*l,c=s*o-r*u,f=r*l-n*o;var g=n*f-s*c,d=s*h-r*f,m=r*c-n*h;var p=a*2;h*=p;c*=p;f*=p;g*=2;d*=2;m*=2;e[0]=o+h+g;e[1]=l+c+d;e[2]=u+f+m;return e}function Bi(e,t,i,r){var n=[],s=[];n[0]=t[0]-i[0];n[1]=t[1]-i[1];n[2]=t[2]-i[2];s[0]=n[0];s[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r);s[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r);e[0]=s[0]+i[0];e[1]=s[1]+i[1];e[2]=s[2]+i[2];return e}function Vi(e,t,i,r){var n=[],s=[];n[0]=t[0]-i[0];n[1]=t[1]-i[1];n[2]=t[2]-i[2];s[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r);s[1]=n[1];s[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r);e[0]=s[0]+i[0];e[1]=s[1]+i[1];e[2]=s[2]+i[2];return e}function ji(e,t,i,r){var n=[],s=[];n[0]=t[0]-i[0];n[1]=t[1]-i[1];n[2]=t[2]-i[2];s[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r);s[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r);s[2]=n[2];e[0]=s[0]+i[0];e[1]=s[1]+i[1];e[2]=s[2]+i[2];return e}function Gi(e,t){var i=o(e[0],e[1],e[2]);var r=o(t[0],t[1],t[2]);V(i,i);V(r,r);var n=j(i,r);if(n>1){return 0}else if(n<-1){return Math.PI}else{return Math.acos(n)}}function zi(e){e[0]=0;e[1]=0;e[2]=0;return e}function Hi(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Xi(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Yi(e,t){var i=e[0],r=e[1],n=e[2];var s=t[0],a=t[1],o=t[2];return Math.abs(i-s)<=w*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-a)<=w*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=w*Math.max(1,Math.abs(n),Math.abs(o))}var qi=B;var Wi=bi;var Zi=vi;var Ki=Mi;var Qi=Ci;var Ji=mi;var $i=Ri;var er=function(){var l=D();return function(e,t,i,r,n,s){var a,o;if(!t){t=3}if(!i){i=0}if(r){o=Math.min(r*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];l[2]=e[a+2];n(l,l,s);e[a]=l[0];e[a+1]=l[1];e[a+2]=l[2]}return e}}();function tr(){var e=new _(4);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0;e[3]=0}return e}function ir(e){var t=new _(4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}function rr(e,t,i,r){var n=new _(4);n[0]=e;n[1]=t;n[2]=i;n[3]=r;return n}function nr(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}function sr(e,t,i,r,n){e[0]=t;e[1]=i;e[2]=r;e[3]=n;return e}function ar(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];return e}function or(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];return e}function lr(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];e[2]=t[2]*i[2];e[3]=t[3]*i[3];return e}function ur(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];e[2]=t[2]/i[2];e[3]=t[3]/i[3];return e}function hr(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);e[2]=Math.ceil(t[2]);e[3]=Math.ceil(t[3]);return e}function cr(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);e[2]=Math.floor(t[2]);e[3]=Math.floor(t[3]);return e}function fr(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);e[2]=Math.min(t[2],i[2]);e[3]=Math.min(t[3],i[3]);return e}function gr(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);e[2]=Math.max(t[2],i[2]);e[3]=Math.max(t[3],i[3]);return e}function dr(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);e[2]=Math.round(t[2]);e[3]=Math.round(t[3]);return e}function mr(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;return e}function pr(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;e[3]=t[3]+i[3]*r;return e}function _r(e,t){var i=t[0]-e[0];var r=t[1]-e[1];var n=t[2]-e[2];var s=t[3]-e[3];return Math.hypot(i,r,n,s)}function br(e,t){var i=t[0]-e[0];var r=t[1]-e[1];var n=t[2]-e[2];var s=t[3]-e[3];return i*i+r*r+n*n+s*s}function vr(e){var t=e[0];var i=e[1];var r=e[2];var n=e[3];return Math.hypot(t,i,r,n)}function xr(e){var t=e[0];var i=e[1];var r=e[2];var n=e[3];return t*t+i*i+r*r+n*n}function Er(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=-t[3];return e}function Ar(e,t){e[0]=1/t[0];e[1]=1/t[1];e[2]=1/t[2];e[3]=1/t[3];return e}function Tr(e,t){var i=t[0];var r=t[1];var n=t[2];var s=t[3];var a=i*i+r*r+n*n+s*s;if(a>0){a=1/Math.sqrt(a)}e[0]=i*a;e[1]=r*a;e[2]=n*a;e[3]=s*a;return e}function Or(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Ir(e,t,i,r){var n=i[0]*r[1]-i[1]*r[0],s=i[0]*r[2]-i[2]*r[0],a=i[0]*r[3]-i[3]*r[0],o=i[1]*r[2]-i[2]*r[1],l=i[1]*r[3]-i[3]*r[1],u=i[2]*r[3]-i[3]*r[2];var h=t[0];var c=t[1];var f=t[2];var g=t[3];e[0]=c*u-f*l+g*o;e[1]=-(h*u)+f*a-g*s;e[2]=h*l-c*a+g*n;e[3]=-(h*o)+c*s-f*n;return e}function Sr(e,t,i,r){var n=t[0];var s=t[1];var a=t[2];var o=t[3];e[0]=n+r*(i[0]-n);e[1]=s+r*(i[1]-s);e[2]=a+r*(i[2]-a);e[3]=o+r*(i[3]-o);return e}function Mr(e,t){t=t||1;var i,r,n,s;var a,o;do{i=u()*2-1;r=u()*2-1;a=i*i+r*r}while(a>=1);do{n=u()*2-1;s=u()*2-1;o=n*n+s*s}while(o>=1);var l=Math.sqrt((1-a)/o);e[0]=t*i;e[1]=t*r;e[2]=t*n*l;e[3]=t*s*l;return e}function Cr(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3];e[0]=i[0]*r+i[4]*n+i[8]*s+i[12]*a;e[1]=i[1]*r+i[5]*n+i[9]*s+i[13]*a;e[2]=i[2]*r+i[6]*n+i[10]*s+i[14]*a;e[3]=i[3]*r+i[7]*n+i[11]*s+i[15]*a;return e}function Rr(e,t,i){var r=t[0],n=t[1],s=t[2];var a=i[0],o=i[1],l=i[2],u=i[3];var h=u*r+o*s-l*n;var c=u*n+l*r-a*s;var f=u*s+a*n-o*r;var g=-a*r-o*n-l*s;e[0]=h*u+g*-a+c*-l-f*-o;e[1]=c*u+g*-o+f*-a-h*-l;e[2]=f*u+g*-l+h*-o-c*-a;e[3]=t[3];return e}function Nr(e){e[0]=0;e[1]=0;e[2]=0;e[3]=0;return e}function yr(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Pr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Lr(e,t){var i=e[0],r=e[1],n=e[2],s=e[3];var a=t[0],o=t[1],l=t[2],u=t[3];return Math.abs(i-a)<=w*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-o)<=w*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-l)<=w*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-u)<=w*Math.max(1,Math.abs(s),Math.abs(u))}var wr=or;var Fr=lr;var kr=ur;var Dr=_r;var Ur=br;var Br=vr;var Vr=xr;var jr=function(){var l=tr();return function(e,t,i,r,n,s){var a,o;if(!t){t=4}if(!i){i=0}if(r){o=Math.min(r*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];l[2]=e[a+2];l[3]=e[a+3];n(l,l,s);e[a]=l[0];e[a+1]=l[1];e[a+2]=l[2];e[a+3]=l[3]}return e}}();function s(){var e=new _(4);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0}e[3]=1;return e}function Gr(e){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e}function zr(e,t,i){i=i*.5;var r=Math.sin(i);e[0]=r*t[0];e[1]=r*t[1];e[2]=r*t[2];e[3]=Math.cos(i);return e}function Hr(e,t){var i=Math.acos(t[3])*2;var r=Math.sin(i/2);if(r>w){e[0]=t[0]/r;e[1]=t[1]/r;e[2]=t[2]/r}else{e[0]=1;e[1]=0;e[2]=0}return i}function Xr(e,t){var i=dn(e,t);return Math.acos(2*i*i-1)}function Yr(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3];var o=i[0],l=i[1],u=i[2],h=i[3];e[0]=r*h+a*o+n*u-s*l;e[1]=n*h+a*l+s*o-r*u;e[2]=s*h+a*u+r*l-n*o;e[3]=a*h-r*o-n*l-s*u;return e}function qr(e,t,i){i*=.5;var r=t[0],n=t[1],s=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=r*l+a*o;e[1]=n*l+s*o;e[2]=s*l-n*o;e[3]=a*l-r*o;return e}function Wr(e,t,i){i*=.5;var r=t[0],n=t[1],s=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=r*l-s*o;e[1]=n*l+a*o;e[2]=s*l+r*o;e[3]=a*l-n*o;return e}function Zr(e,t,i){i*=.5;var r=t[0],n=t[1],s=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=r*l+n*o;e[1]=n*l-r*o;e[2]=s*l+a*o;e[3]=a*l-s*o;return e}function Kr(e,t){var i=t[0],r=t[1],n=t[2];e[0]=i;e[1]=r;e[2]=n;e[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n));return e}function Qr(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=Math.sqrt(i*i+r*r+n*n);var o=Math.exp(s);var l=a>0?o*Math.sin(a)/a:0;e[0]=i*l;e[1]=r*l;e[2]=n*l;e[3]=o*Math.cos(a);return e}function Jr(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=Math.sqrt(i*i+r*r+n*n);var o=a>0?Math.atan2(a,s)/a:0;e[0]=i*o;e[1]=r*o;e[2]=n*o;e[3]=.5*Math.log(i*i+r*r+n*n+s*s);return e}function $r(e,t,i){Jr(e,t);gn(e,e,i);Qr(e,e);return e}function l(e,t,i,r){var n=t[0],s=t[1],a=t[2],o=t[3];var l=i[0],u=i[1],h=i[2],c=i[3];var f,g,d,m,p;g=n*l+s*u+a*h+o*c;if(g<0){g=-g;l=-l;u=-u;h=-h;c=-c}if(1-g>w){f=Math.acos(g);d=Math.sin(f);m=Math.sin((1-r)*f)/d;p=Math.sin(r*f)/d}else{m=1-r;p=r}e[0]=m*n+p*l;e[1]=m*s+p*u;e[2]=m*a+p*h;e[3]=m*o+p*c;return e}function en(e){var t=u();var i=u();var r=u();var n=Math.sqrt(1-t);var s=Math.sqrt(t);e[0]=n*Math.sin(2*Math.PI*i);e[1]=n*Math.cos(2*Math.PI*i);e[2]=s*Math.sin(2*Math.PI*r);e[3]=s*Math.cos(2*Math.PI*r);return e}function tn(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=i*i+r*r+n*n+s*s;var o=a?1/a:0;e[0]=-i*o;e[1]=-r*o;e[2]=-n*o;e[3]=s*o;return e}function rn(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=t[3];return e}function nn(e,t){var i=t[0]+t[4]+t[8];var r;if(i>0){r=Math.sqrt(i+1);e[3]=.5*r;r=.5/r;e[0]=(t[5]-t[7])*r;e[1]=(t[6]-t[2])*r;e[2]=(t[1]-t[3])*r}else{var n=0;if(t[4]>t[0])n=1;if(t[8]>t[n*3+n])n=2;var s=(n+1)%3;var a=(n+2)%3;r=Math.sqrt(t[n*3+n]-t[s*3+s]-t[a*3+a]+1);e[n]=.5*r;r=.5/r;e[3]=(t[s*3+a]-t[a*3+s])*r;e[s]=(t[s*3+n]+t[n*3+s])*r;e[a]=(t[a*3+n]+t[n*3+a])*r}return e}function sn(e,t,i,r){var n=.5*Math.PI/180;t*=n;i*=n;r*=n;var s=Math.sin(t);var a=Math.cos(t);var o=Math.sin(i);var l=Math.cos(i);var u=Math.sin(r);var h=Math.cos(r);e[0]=s*l*h-a*o*u;e[1]=a*o*h+s*l*u;e[2]=a*l*u-s*o*h;e[3]=a*l*h+s*o*u;return e}function an(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var on=ir;var ln=rr;var un=nr;var hn=sr;var cn=ar;var fn=Yr;var gn=mr;var dn=Or;var mn=Sr;var pn=vr;var _n=pn;var bn=xr;var vn=bn;var xn=Tr;var En=Pr;var An=Lr;var Tn=function(){var n=D();var s=o(1,0,0);var a=o(0,1,0);return function(e,t,i){var r=j(t,i);if(r<-.999999){G(n,s,t);if(Ji(n)<1e-6)G(n,a,t);V(n,n);zr(e,n,Math.PI);return e}else if(r>.999999){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e}else{G(n,t,i);e[0]=n[0];e[1]=n[1];e[2]=n[2];e[3]=1+r;return xn(e,e)}}}();var On=function(){var a=s();var o=s();return function(e,t,i,r,n,s){l(a,t,n,s);l(o,i,r,s);l(e,a,o,2*s*(1-s));return e}}();var In=function(){var n=qe();return function(e,t,i,r){n[0]=i[0];n[3]=i[1];n[6]=i[2];n[1]=r[0];n[4]=r[1];n[7]=r[2];n[2]=-t[0];n[5]=-t[1];n[8]=-t[2];return xn(e,nn(e,n))}}();function Sn(){var e=new _(8);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0;e[4]=0;e[5]=0;e[6]=0;e[7]=0}e[3]=1;return e}function Mn(e){var t=new _(8);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];return t}function Cn(e,t,i,r,n,s,a,o){var l=new _(8);l[0]=e;l[1]=t;l[2]=i;l[3]=r;l[4]=n;l[5]=s;l[6]=a;l[7]=o;return l}function Rn(e,t,i,r,n,s,a){var o=new _(8);o[0]=e;o[1]=t;o[2]=i;o[3]=r;var l=n*.5,u=s*.5,h=a*.5;o[4]=l*r+u*i-h*t;o[5]=u*r+h*e-l*i;o[6]=h*r+l*t-u*e;o[7]=-l*e-u*t-h*i;return o}function Nn(e,t,i){var r=i[0]*.5,n=i[1]*.5,s=i[2]*.5,a=t[0],o=t[1],l=t[2],u=t[3];e[0]=a;e[1]=o;e[2]=l;e[3]=u;e[4]=r*u+n*l-s*o;e[5]=n*u+s*a-r*l;e[6]=s*u+r*o-n*a;e[7]=-r*a-n*o-s*l;return e}function yn(e,t){e[0]=0;e[1]=0;e[2]=0;e[3]=1;e[4]=t[0]*.5;e[5]=t[1]*.5;e[6]=t[2]*.5;e[7]=0;return e}function Pn(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=0;e[5]=0;e[6]=0;e[7]=0;return e}function Ln(e,t){var i=s();Wt(i,t);var r=new _(3);Yt(r,t);Nn(e,i,r);return e}function wn(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];return e}function Fn(e){e[0]=0;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;e[6]=0;e[7]=0;return e}function kn(e,t,i,r,n,s,a,o,l){e[0]=t;e[1]=i;e[2]=r;e[3]=n;e[4]=s;e[5]=a;e[6]=o;e[7]=l;return e}var Dn=un;function Un(e,t){e[0]=t[4];e[1]=t[5];e[2]=t[6];e[3]=t[7];return e}var Bn=un;function Vn(e,t){e[4]=t[0];e[5]=t[1];e[6]=t[2];e[7]=t[3];return e}function jn(e,t){var i=t[4],r=t[5],n=t[6],s=t[7],a=-t[0],o=-t[1],l=-t[2],u=t[3];e[0]=(i*u+s*a+r*l-n*o)*2;e[1]=(r*u+s*o+n*a-i*l)*2;e[2]=(n*u+s*l+i*o-r*a)*2;return e}function Gn(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=i[0]*.5,l=i[1]*.5,u=i[2]*.5,h=t[4],c=t[5],f=t[6],g=t[7];e[0]=r;e[1]=n;e[2]=s;e[3]=a;e[4]=a*o+n*u-s*l+h;e[5]=a*l+s*o-r*u+c;e[6]=a*u+r*l-n*o+f;e[7]=-r*o-n*l-s*u+g;return e}function zn(e,t,i){var r=-t[0],n=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=o*a+h*r+l*s-u*n,f=l*a+h*n+u*r-o*s,g=u*a+h*s+o*n-l*r,d=h*a-o*r-l*n-u*s;qr(e,t,i);r=e[0];n=e[1];s=e[2];a=e[3];e[4]=c*a+d*r+f*s-g*n;e[5]=f*a+d*n+g*r-c*s;e[6]=g*a+d*s+c*n-f*r;e[7]=d*a-c*r-f*n-g*s;return e}function Hn(e,t,i){var r=-t[0],n=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=o*a+h*r+l*s-u*n,f=l*a+h*n+u*r-o*s,g=u*a+h*s+o*n-l*r,d=h*a-o*r-l*n-u*s;Wr(e,t,i);r=e[0];n=e[1];s=e[2];a=e[3];e[4]=c*a+d*r+f*s-g*n;e[5]=f*a+d*n+g*r-c*s;e[6]=g*a+d*s+c*n-f*r;e[7]=d*a-c*r-f*n-g*s;return e}function Xn(e,t,i){var r=-t[0],n=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=o*a+h*r+l*s-u*n,f=l*a+h*n+u*r-o*s,g=u*a+h*s+o*n-l*r,d=h*a-o*r-l*n-u*s;Zr(e,t,i);r=e[0];n=e[1];s=e[2];a=e[3];e[4]=c*a+d*r+f*s-g*n;e[5]=f*a+d*n+g*r-c*s;e[6]=g*a+d*s+c*n-f*r;e[7]=d*a-c*r-f*n-g*s;return e}function Yn(e,t,i){var r=i[0],n=i[1],s=i[2],a=i[3],o=t[0],l=t[1],u=t[2],h=t[3];e[0]=o*a+h*r+l*s-u*n;e[1]=l*a+h*n+u*r-o*s;e[2]=u*a+h*s+o*n-l*r;e[3]=h*a-o*r-l*n-u*s;o=t[4];l=t[5];u=t[6];h=t[7];e[4]=o*a+h*r+l*s-u*n;e[5]=l*a+h*n+u*r-o*s;e[6]=u*a+h*s+o*n-l*r;e[7]=h*a-o*r-l*n-u*s;return e}function qn(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=i[0],l=i[1],u=i[2],h=i[3];e[0]=r*h+a*o+n*u-s*l;e[1]=n*h+a*l+s*o-r*u;e[2]=s*h+a*u+r*l-n*o;e[3]=a*h-r*o-n*l-s*u;o=i[4];l=i[5];u=i[6];h=i[7];e[4]=r*h+a*o+n*u-s*l;e[5]=n*h+a*l+s*o-r*u;e[6]=s*h+a*u+r*l-n*o;e[7]=a*h-r*o-n*l-s*u;return e}function Wn(e,t,i,r){if(Math.abs(r)<w){return wn(e,t)}var n=Math.hypot(i[0],i[1],i[2]);r=r*.5;var s=Math.sin(r);var a=s*i[0]/n;var o=s*i[1]/n;var l=s*i[2]/n;var u=Math.cos(r);var h=t[0],c=t[1],f=t[2],g=t[3];e[0]=h*u+g*a+c*l-f*o;e[1]=c*u+g*o+f*a-h*l;e[2]=f*u+g*l+h*o-c*a;e[3]=g*u-h*a-c*o-f*l;var d=t[4],m=t[5],p=t[6],_=t[7];e[4]=d*u+_*a+m*l-p*o;e[5]=m*u+_*o+p*a-d*l;e[6]=p*u+_*l+d*o-m*a;e[7]=_*u-d*a-m*o-p*l;return e}function Zn(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];return e}function Kn(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=i[4],l=i[5],u=i[6],h=i[7],c=t[4],f=t[5],g=t[6],d=t[7],m=i[0],p=i[1],_=i[2],b=i[3];e[0]=r*b+a*m+n*_-s*p;e[1]=n*b+a*p+s*m-r*_;e[2]=s*b+a*_+r*p-n*m;e[3]=a*b-r*m-n*p-s*_;e[4]=r*h+a*o+n*u-s*l+c*b+d*m+f*_-g*p;e[5]=n*h+a*l+s*o-r*u+f*b+d*p+g*m-c*_;e[6]=s*h+a*u+r*l-n*o+g*b+d*_+c*p-f*m;e[7]=a*h-r*o-n*l-s*u+d*b-c*m-f*p-g*_;return e}var Qn=Kn;function Jn(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;return e}var $n=dn;function es(e,t,i,r){var n=1-r;if($n(t,i)<0)r=-r;e[0]=t[0]*n+i[0]*r;e[1]=t[1]*n+i[1]*r;e[2]=t[2]*n+i[2]*r;e[3]=t[3]*n+i[3]*r;e[4]=t[4]*n+i[4]*r;e[5]=t[5]*n+i[5]*r;e[6]=t[6]*n+i[6]*r;e[7]=t[7]*n+i[7]*r;return e}function ts(e,t){var i=f(t);e[0]=-t[0]/i;e[1]=-t[1]/i;e[2]=-t[2]/i;e[3]=t[3]/i;e[4]=-t[4]/i;e[5]=-t[5]/i;e[6]=-t[6]/i;e[7]=t[7]/i;return e}function is(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=t[3];e[4]=-t[4];e[5]=-t[5];e[6]=-t[6];e[7]=t[7];return e}var rs=pn;var ns=rs;var f=bn;var ss=f;function as(e,t){var i=f(t);if(i>0){i=Math.sqrt(i);var r=t[0]/i;var n=t[1]/i;var s=t[2]/i;var a=t[3]/i;var o=t[4];var l=t[5];var u=t[6];var h=t[7];var c=r*o+n*l+s*u+a*h;e[0]=r;e[1]=n;e[2]=s;e[3]=a;e[4]=(o-r*c)/i;e[5]=(l-n*c)/i;e[6]=(u-s*c)/i;e[7]=(h-a*c)/i}return e}function os(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function ls(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function us(e,t){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7];var h=t[0],c=t[1],f=t[2],g=t[3],d=t[4],m=t[5],p=t[6],_=t[7];return Math.abs(i-h)<=w*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-c)<=w*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-f)<=w*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-g)<=w*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(a-d)<=w*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(o-m)<=w*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(l-p)<=w*Math.max(1,Math.abs(l),Math.abs(p))&&Math.abs(u-_)<=w*Math.max(1,Math.abs(u),Math.abs(_))}function e(){var e=new _(2);if(_!=Float32Array){e[0]=0;e[1]=0}return e}function hs(e){var t=new _(2);t[0]=e[0];t[1]=e[1];return t}function cs(e,t){var i=new _(2);i[0]=e;i[1]=t;return i}function fs(e,t){e[0]=t[0];e[1]=t[1];return e}function z(e,t,i){e[0]=t;e[1]=i;return e}function gs(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];return e}function ds(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];return e}function ms(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];return e}function ps(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];return e}function _s(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);return e}function bs(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);return e}function vs(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);return e}function xs(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);return e}function Es(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);return e}function As(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;return e}function Ts(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;return e}function Os(e,t){var i=t[0]-e[0],r=t[1]-e[1];return Math.hypot(i,r)}function Is(e,t){var i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function Ss(e){var t=e[0],i=e[1];return Math.hypot(t,i)}function Ms(e){var t=e[0],i=e[1];return t*t+i*i}function Cs(e,t){e[0]=-t[0];e[1]=-t[1];return e}function Rs(e,t){e[0]=1/t[0];e[1]=1/t[1];return e}function Ns(e,t){var i=t[0],r=t[1];var n=i*i+r*r;if(n>0){n=1/Math.sqrt(n)}e[0]=t[0]*n;e[1]=t[1]*n;return e}function ys(e,t){return e[0]*t[0]+e[1]*t[1]}function Ps(e,t,i){var r=t[0]*i[1]-t[1]*i[0];e[0]=e[1]=0;e[2]=r;return e}function Ls(e,t,i,r){var n=t[0],s=t[1];e[0]=n+r*(i[0]-n);e[1]=s+r*(i[1]-s);return e}function ws(e,t){t=t||1;var i=u()*2*Math.PI;e[0]=Math.cos(i)*t;e[1]=Math.sin(i)*t;return e}function Fs(e,t,i){var r=t[0],n=t[1];e[0]=i[0]*r+i[2]*n;e[1]=i[1]*r+i[3]*n;return e}function ks(e,t,i){var r=t[0],n=t[1];e[0]=i[0]*r+i[2]*n+i[4];e[1]=i[1]*r+i[3]*n+i[5];return e}function Ds(e,t,i){var r=t[0],n=t[1];e[0]=i[0]*r+i[3]*n+i[6];e[1]=i[1]*r+i[4]*n+i[7];return e}function Us(e,t,i){var r=t[0];var n=t[1];e[0]=i[0]*r+i[4]*n+i[12];e[1]=i[1]*r+i[5]*n+i[13];return e}function Bs(e,t,i,r){var n=t[0]-i[0],s=t[1]-i[1],a=Math.sin(r),o=Math.cos(r);e[0]=n*o-s*a+i[0];e[1]=n*a+s*o+i[1];return e}function Vs(e,t){var i=e[0],r=e[1],n=t[0],s=t[1];var a=i*i+r*r;if(a>0){a=1/Math.sqrt(a)}var o=n*n+s*s;if(o>0){o=1/Math.sqrt(o)}var l=(i*n+r*s)*a*o;if(l>1){return 0}else if(l<-1){return Math.PI}else{return Math.acos(l)}}function js(e){e[0]=0;e[1]=0;return e}function Gs(e){return"vec2("+e[0]+", "+e[1]+")"}function zs(e,t){return e[0]===t[0]&&e[1]===t[1]}function Hs(e,t){var i=e[0],r=e[1];var n=t[0],s=t[1];return Math.abs(i-n)<=w*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-s)<=w*Math.max(1,Math.abs(r),Math.abs(s))}var Xs=Ss;var Ys=ds;var qs=ms;var Ws=ps;var Zs=Os;var Ks=Is;var Qs=Ms;var Js=function(){var l=e();return function(e,t,i,r,n,s){var a,o;if(!t){t=2}if(!i){i=0}if(r){o=Math.min(r*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];n(l,l,s);e[a]=l[0];e[a+1]=l[1]}return e}}();class c{isGeometry=true;constructor(e){this.name=e||"unknown";this._log=new h.Logger("cgl_geometry");this.faceVertCount=3;this.glPrimitive=null;this._attributes={};this._vertices=[];this.verticesIndices=[];this.morphTargets=[]}get vertices(){return this._vertices}set vertices(e){this.setVertices(e)}get texCoords(){const e=this.getAttribute("texCoords");if(!e)return[];return e.data}set texCoords(e){this.setAttribute("texCoords",e,2)}get vertexNormals(){const e=this.getAttribute("vertexNormals");if(!e)return[];return e.data}set vertexNormals(e){this.setAttribute("vertexNormals",e,3)}get tangents(){const e=this.getAttribute("tangents");if(!e)return[];return e.data}set tangents(e){this.setAttribute("tangents",e,3)}get biTangents(){const e=this.getAttribute("biTangents");if(!e)return[];return e.data}set biTangents(e){this.setAttribute("biTangents",e,3)}get vertexColors(){const e=this.getAttribute("vertexColors");if(!e)return[];return e.data}set vertexColors(e){this.setAttribute("vertexColors",e,4)}clear(){this._vertices=new Float32Array([]);this.verticesIndices=[];this.texCoords=new Float32Array([]);this.vertexNormals=new Float32Array([]);this.tangents=[];this.biTangents=[];this._attributes={}}getAttributes(){return this._attributes}getAttribute(t){for(const e in this._attributes){if(this._attributes[e].name==t)return this._attributes[e]}return null}setAttribute(e,t,i){let r="";if(!i||i>4){this._log.warn("itemsize wrong?",i,e);this._log.stack("itemsize");i=3}if(i==1)r="float";else if(i==2)r="vec2";else if(i==3)r="vec3";else if(i==4)r="vec4";const n={name:e,data:t,itemSize:i,type:r};this._attributes[e]=n}copyAttribute(e,t){const i=this.getAttribute(e);t.setAttribute(e,new Float32Array(i.data),i.itemSize)}setVertices(e){if(e instanceof Float32Array)this._vertices=e;else this._vertices=new Float32Array(e)}setTexCoords(e){if(e instanceof Float32Array)this.texCoords=e;else this.texCoords=new Float32Array(e)}calcNormals(e){const t={smooth:e};this.calculateNormals(t)}flipNormals(t,i,r){let n=D();if(t==undefined)t=1;if(i==undefined)i=1;if(r==undefined)r=1;for(let e=0;e<this.vertexNormals.length;e+=3){U(n,this.vertexNormals[e+0],this.vertexNormals[e+1],this.vertexNormals[e+2]);n[0]*=-t;n[1]*=-i;n[2]*=-r;V(n,n);this.vertexNormals[e+0]=n[0];this.vertexNormals[e+1]=n[1];this.vertexNormals[e+2]=n[2]}}getNumTriangles(){if(this.verticesIndices&&this.verticesIndices.length)return this.verticesIndices.length/3;return this.vertices.length/3}flipVertDir(){const t=[];t.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e+=3){t[e]=this.verticesIndices[e+2];t[e+1]=this.verticesIndices[e+1];t[e+2]=this.verticesIndices[e]}this.verticesIndices=t}setPointVertices(t){if(t.length%3!==0){this._log.error("SetPointVertices: Array must be multiple of three.");return}if(!(t instanceof Float32Array))this.vertices=new Float32Array(t);else this.vertices=t;if(!(this.texCoords instanceof Float32Array))this.texCoords=new Float32Array(t.length/3*2);this.verticesIndices.length=t.length/3;for(let e=0;e<t.length/3;e++){this.verticesIndices[e]=e;this.texCoords[e*2]=0;this.texCoords[e*2+1]=0}}merge(t){if(!t)return;if(this.isIndexed()!=t.isIndexed()){if(this.isIndexed()){this.unIndex(false,true)}if(t.isIndexed()){const e=t.copy();e.unIndex(false,true);t=e}}const i=this.verticesIndices.length;const r=this._vertices.length/3;this.verticesIndices.length+=t.verticesIndices.length;for(let e=0;e<t.verticesIndices.length;e++)this.verticesIndices[i+e]=t.verticesIndices[e]+r;this.vertices=A.utils.float32Concat(this._vertices,t.vertices);this.texCoords=A.utils.float32Concat(this.texCoords,t.texCoords);this.vertexNormals=A.utils.float32Concat(this.vertexNormals,t.vertexNormals);this.tangents=A.utils.float32Concat(this.tangents,t.tangents);this.biTangents=A.utils.float32Concat(this.biTangents,t.biTangents)}copy(){const t=new c(this.name+" copy");t.faceVertCount=this.faceVertCount;t.glPrimitive=this.glPrimitive;t.setVertices(this._vertices.slice(0));if(this.verticesIndices){t.verticesIndices.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e++)t.verticesIndices[e]=this.verticesIndices[e]}for(let e in this._attributes)this.copyAttribute(e,t);t.morphTargets.length=this.morphTargets.length;for(let e=0;e<this.morphTargets.length;e++)t.morphTargets[e]=this.morphTargets[e];return t}calculateNormals(t=null){t=t||{};if(t.smooth===false)this.unIndex();const i=D();const r=D();const n=D();function s(e){B(i,e[0],e[1]);B(r,e[0],e[2]);G(n,i,r);V(n,n);if(t&&t.forceZUp){if(n[2]<0){n[0]*=-1;n[1]*=-1;n[2]*=-1}}return n}this.getVertexVec=function(e){const t=[0,0,0];t[0]=this.vertices[e*3+0];t[1]=this.vertices[e*3+1];t[2]=this.vertices[e*3+2];return t};if(!(this.vertexNormals instanceof Float32Array)||this.vertexNormals.length!=this.vertices.length)this.vertexNormals=new Float32Array(this.vertices.length);for(let e=0;e<this.vertices.length;e++){this.vertexNormals[e]=0}if(!this.isIndexed()){const a=[];for(let e=0;e<this.vertices.length;e+=9){const o=[[this.vertices[e+0],this.vertices[e+1],this.vertices[e+2]],[this.vertices[e+3],this.vertices[e+4],this.vertices[e+5]],[this.vertices[e+6],this.vertices[e+7],this.vertices[e+8]]];const l=s(o);a.push(l[0],l[1],l[2],l[0],l[1],l[2],l[0],l[1],l[2])}this.vertexNormals=a}else{const u=[];u.length=Math.floor(this.verticesIndices.length/3);for(let e=0;e<this.verticesIndices.length;e+=3){const o=[this.getVertexVec(this.verticesIndices[e+0]),this.getVertexVec(this.verticesIndices[e+1]),this.getVertexVec(this.verticesIndices[e+2])];u[e/3]=s(o);this.vertexNormals[this.verticesIndices[e+0]*3+0]+=u[e/3][0];this.vertexNormals[this.verticesIndices[e+0]*3+1]+=u[e/3][1];this.vertexNormals[this.verticesIndices[e+0]*3+2]+=u[e/3][2];this.vertexNormals[this.verticesIndices[e+1]*3+0]+=u[e/3][0];this.vertexNormals[this.verticesIndices[e+1]*3+1]+=u[e/3][1];this.vertexNormals[this.verticesIndices[e+1]*3+2]+=u[e/3][2];this.vertexNormals[this.verticesIndices[e+2]*3+0]+=u[e/3][0];this.vertexNormals[this.verticesIndices[e+2]*3+1]+=u[e/3][1];this.vertexNormals[this.verticesIndices[e+2]*3+2]+=u[e/3][2]}for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){const h=[this.vertexNormals[this.verticesIndices[t+e]*3+0],this.vertexNormals[this.verticesIndices[t+e]*3+1],this.vertexNormals[this.verticesIndices[t+e]*3+2]];V(h,h);this.vertexNormals[this.verticesIndices[t+e]*3+0]=h[0];this.vertexNormals[this.verticesIndices[t+e]*3+1]=h[1];this.vertexNormals[this.verticesIndices[t+e]*3+2]=h[2]}}}}calcTangentsBitangents(){if(!this.vertices.length){return}if(!this.vertexNormals.length){return}if(!this.texCoords.length){const x=this.vertices.length/3*2;this.texCoords=new Float32Array(x);for(let e=0;e<x;e+=1)this.texCoords[e]=0}if(!this.verticesIndices||!this.verticesIndices.length){return}if(this.verticesIndices.length%3!==0){this._log.error("Vertex indices mismatch!");return}const t=this.verticesIndices.length/3;const i=this.vertices.length/3;this.tangents=new Float32Array(this.vertexNormals.length);this.biTangents=new Float32Array(this.vertexNormals.length);const r=[];r.length=i*2;const n=D();const s=D();const a=D();const o=e();const l=e();const u=e();const h=D();const c=D();for(let e=0;e<t;e+=1){const E=this.verticesIndices[e*3];const A=this.verticesIndices[e*3+1];const T=this.verticesIndices[e*3+2];U(n,this.vertices[E*3],this.vertices[E*3+1],this.vertices[E*3+2]);U(s,this.vertices[A*3],this.vertices[A*3+1],this.vertices[A*3+2]);U(a,this.vertices[T*3],this.vertices[T*3+1],this.vertices[T*3+2]);z(o,this.texCoords[E*2],this.texCoords[E*2+1]);z(l,this.texCoords[A*2],this.texCoords[A*2+1]);z(u,this.texCoords[T*2],this.texCoords[T*2+1]);const O=s[0]-n[0];const I=a[0]-n[0];const S=s[1]-n[1];const M=a[1]-n[1];const C=s[2]-n[2];const R=a[2]-n[2];const N=l[0]-o[0];const y=u[0]-o[0];const P=l[1]-o[1];const L=u[1]-o[1];const w=1/(N*L-y*P);U(h,(L*O-P*I)*w,(L*S-P*M)*w,(L*C-P*R)*w);U(c,(N*I-y*O)*w,(N*M-y*S)*w,(N*R-y*C)*w);r[E]=h;r[A]=h;r[T]=h;r[E+i]=c;r[A+i]=c;r[T+i]=c}const f=D();const g=D();const d=D();const m=D();const p=D();const _=D();const b=D();const v=D();for(let e=0;e<i;e+=1){if(!r[e])continue;U(f,this.vertexNormals[e*3],this.vertexNormals[e*3+1],this.vertexNormals[e*3+2]);U(g,r[e][0],r[e][1],r[e][2]);const F=j(f,g);Ii(p,f,F);B(_,g,p);V(v,_);G(b,f,g);const k=1;Ii(d,v,1/k);G(m,f,d);this.tangents[e*3+0]=d[0];this.tangents[e*3+1]=d[1];this.tangents[e*3+2]=d[2];this.biTangents[e*3+0]=m[0];this.biTangents[e*3+1]=m[1];this.biTangents[e*3+2]=m[2]}}isIndexed(){if(this._vertices.length==0)return true;return this.verticesIndices.length!=0}unIndex(e=false,t=false){const i=[];const r=[];let n=0;for(let e in this._attributes){const s=this._attributes[e];let i=[];for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){if(s.itemSize==3)i.push(s.data[this.verticesIndices[t+e]*3+0],s.data[this.verticesIndices[t+e]*3+1],s.data[this.verticesIndices[t+e]*3+2]);else if(s.itemSize==4)i.push(s.data[this.verticesIndices[t+e]*4+0],s.data[this.verticesIndices[t+e]*4+1],s.data[this.verticesIndices[t+e]*4+2],s.data[this.verticesIndices[t+e]*4+3]);else if(s.itemSize==2)i.push(s.data[this.verticesIndices[t+e]*2+0],s.data[this.verticesIndices[t+e]*2+1]);else if(s.itemSize==1)i.push(s.data[this.verticesIndices[t+e]]);else this._log.warn("unknown attr",s)}}this.setAttribute(s.name,i,s.itemSize)}for(let e=0;e<this.verticesIndices.length;e+=3){i.push(this.vertices[this.verticesIndices[e+0]*3+0],this.vertices[this.verticesIndices[e+0]*3+1],this.vertices[this.verticesIndices[e+0]*3+2]);r.push(n);n++;i.push(this.vertices[this.verticesIndices[e+1]*3+0],this.vertices[this.verticesIndices[e+1]*3+1],this.vertices[this.verticesIndices[e+1]*3+2]);r.push(n);n++;i.push(this.vertices[this.verticesIndices[e+2]*3+0],this.vertices[this.verticesIndices[e+2]*3+1],this.vertices[this.verticesIndices[e+2]*3+2]);r.push(n);n++}this.vertices=i;this.verticesIndices=[];if(e)this.verticesIndices=r;if(!t)this.calculateNormals()}calcBarycentric(){let t=[];t.length=this.vertices.length;for(let e=0;e<this.vertices.length;e++)t[e]=0;let i=0;for(let e=0;e<this.vertices.length;e+=3){t[e+i]=1;i++;if(i==3)i=0}this.setAttribute("attrBarycentric",t,3)}getBounds(){return new i(this)}center(e,t,i){if(e===undefined){e=true;t=true;i=true}let r=0;const n=this.getBounds();const s=[n.minX+(n.maxX-n.minX)/2,n.minY+(n.maxY-n.minY)/2,n.minZ+(n.maxZ-n.minZ)/2];for(r=0;r<this.vertices.length;r+=3){if(this.vertices[r+0]==this.vertices[r+0]){if(e)this.vertices[r+0]-=s[0];if(t)this.vertices[r+1]-=s[1];if(i)this.vertices[r+2]-=s[2]}}return s}mapTexCoords2d(){const t=this.getBounds();const i=this.vertices.length/3;this.texCoords=new Float32Array(i*2);for(let e=0;e<i;e++){const r=this.vertices[e*3+0];const n=this.vertices[e*3+1];this.texCoords[e*2+0]=r/(t.maxX-t.minX)+.5;this.texCoords[e*2+1]=1-n/(t.maxY-t.minY)+.5}}getInfoOneLine(){let e="";if(this.faceVertCount==3&&this.verticesIndices)e+=this.verticesIndices.length/3;else e+=0;e+=" tris ";if(this.vertices)e+=this.vertices.length/3;else e+=0;e+=" verts";return e}getInfo(){const e={};e.name=this.name;e.class=this.constructor.name;if(this.faceVertCount==3&&this.verticesIndices)e.numFaces=this.verticesIndices.length/3;else e.numFaces=0;if(this.verticesIndices&&this.verticesIndices.length)e.indices=this.verticesIndices.length;if(this.vertices)e.numVerts=this.vertices.length/3;else e.numVerts=0;if(this.vertexNormals)e.numNormals=this.vertexNormals.length/3;else e.numNormals=0;if(this.texCoords)e.numTexCoords=this.texCoords.length/2;else e.numTexCoords=0;if(this.tangents)e.numTangents=this.tangents.length/3;else e.numTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.vertexColors)e.numVertexColors=this.vertexColors.length/4;else e.numVertexColors=0;if(this.getAttributes())e.numAttribs=Object.keys(this.getAttributes()).length;else e.numAttribs=0;e.isIndexed=this.isIndexed();return e}}c.buildFromFaces=function(t,e,i){const r=[];const n=[];for(let e=0;e<t.length;e+=3){const a=t[e+0];const o=t[e+1];const l=t[e+2];const u=[-1,-1,-1];if(i)for(let e=0;e<r.length;e+=3){if(r[e+0]==a[0]&&r[e+1]==a[1]&&r[e+2]==a[2])u[0]=e/3;if(r[e+0]==o[0]&&r[e+1]==o[1]&&r[e+2]==o[2])u[1]=e/3;if(r[e+0]==l[0]&&r[e+1]==l[1]&&r[e+2]==l[2])u[2]=e/3}if(u[0]==-1){r.push(a[0],a[1],a[2]);u[0]=(r.length-1)/3}if(u[1]==-1){r.push(o[0],o[1],o[2]);u[1]=(r.length-1)/3}if(u[2]==-1){r.push(l[0],l[1],l[2]);u[2]=(r.length-1)/3}n.push(u[0]);n.push(u[1]);n.push(u[2])}const s=new c(e);s.name=e;s.vertices=r;s.verticesIndices=n;return s};class i{constructor(e){this._init();this._first=true;this._wireMesh=null;if(e)this.applyGeom(e)}_init(){this._max=[-0,-0,-0];this._min=[0,0,0];this._center=[0,0,0];this._size=[0,0,0];this._maxAxis=0;this._first=true}get maxAxis(){return this._maxAxis||1}get size(){return this._size}get center(){return this._center}get x(){return this._center[0]}get y(){return this._center[1]}get z(){return this._center[2]}get minX(){return this._min[0]}get minY(){return this._min[1]}get minZ(){return this._min[2]}get maxX(){return this._max[0]}get maxY(){return this._max[1]}get maxZ(){return this._max[2]}apply(e){return this.applyGeom(e)}applyGeom(t){if(!t)return;if(t instanceof i){const e=t;this.applyPos(e.maxX,e.maxY,e.maxZ);this.applyPos(e.minX,e.minY,e.minZ)}else{if(t.isGeometry)for(let e=0;e<t.vertices.length;e+=3)this.applyPos(t.vertices[e],t.vertices[e+1],t.vertices[e+2])}this.calcCenterSize()}copy(){return new i(this)}get changed(){return!(this._max[0]==-Number.MAX_VALUE&&this._max[1]==-Number.MAX_VALUE&&this._max[2]==-Number.MAX_VALUE)}applyPos(e,t,i){if(e==Number.MAX_VALUE||e==-Number.MAX_VALUE||t==Number.MAX_VALUE||t==-Number.MAX_VALUE||i==Number.MAX_VALUE||i==-Number.MAX_VALUE)return;if(!A.utils.isNumeric(e)||!A.utils.isNumeric(t)||!A.utils.isNumeric(i))return;if(this._first){this._max[0]=e;this._max[1]=t;this._max[2]=i;this._min[0]=e;this._min[1]=t;this._min[2]=i;this._first=false;return}this._max[0]=Math.max(this._max[0],e);this._max[1]=Math.max(this._max[1],t);this._max[2]=Math.max(this._max[2],i);this._min[0]=Math.min(this._min[0],e);this._min[1]=Math.min(this._min[1],t);this._min[2]=Math.min(this._min[2],i)}calcCenterSize(){if(this._first)return;this._size[0]=this._max[0]-this._min[0];this._size[1]=this._max[1]-this._min[1];this._size[2]=this._max[2]-this._min[2];this._center[0]=(this._min[0]+this._max[0])/2;this._center[1]=(this._min[1]+this._max[1])/2;this._center[2]=(this._min[2]+this._max[2])/2;this._maxAxis=Math.max(this._size[2],Math.max(this._size[0],this._size[1]))}mulMat4(e){if(this._first){this._max[0]=0;this._max[1]=0;this._max[2]=0;this._min[0]=0;this._min[1]=0;this._min[2]=0;this._first=false}ki(this._max,this._max,e);ki(this._min,this._min,e);this.calcCenterSize()}render(e,t,i){if(!this._wireMesh)this._wireMesh=new CGL.WireCube(e);e.pushModelMatrix();n(e.mMatrix,e.mMatrix,this._center);if(CABLES.UI&&i){CABLES.UI.OverlayMeshes.drawCube(i,this._size[0]/2,this._size[1]/2,this._size[2]/2)}e.popModelMatrix()}}class $s{hasFocus=false;forceAspect=0;pixelDensity=1;_oldWidthRp=-1;_oldHeightRp=-1;constructor(e){this._log=new h.Logger("CgCanvas");if(!e){this._log.error("CgCanvas no options")}else{this._canvasEle=e.canvasEle}if(!e.cg)this._log.error("CgCanvas options has no cg");this._cg=e.cg;if(this.canvasEle){this.canvasWidth=this.canvasEle.clientWidth;this.canvasHeight=this.canvasEle.clientHeight;this.setSize(this.canvasWidth,this.canvasHeight);this.canvasEle.addEventListener("focus",()=>{this.hasFocus=true});this.canvasEle.addEventListener("blur",()=>{this.hasFocus=false})}}get canvasEle(){return this._canvasEle}setSize(e,t,i=false){if(this._oldWidthRp!=e*this.pixelDensity||this._oldHeightRp!=t*this.pixelDensity){this._oldWidthRp=this.canvasEle.width=e*this.pixelDensity;this._oldHeightRp=this.canvasEle.height=t*this.pixelDensity;if(!i){this.canvasEle.style.width=e+"px";this.canvasEle.style.height=t+"px"}this.updateSize();this._cg.emitEvent("resize")}}updateSize(){this.canvasEle.width=this.canvasWidth=Math.ceil(this.canvasEle.clientWidth*this.pixelDensity);this.canvasEle.height=this.canvasHeight=Math.ceil(this.canvasEle.clientHeight*this.pixelDensity)}dispose(){if(this._canvasEle)this._canvasEle.remove();this._canvasEle=null}}class ea extends h.Events{#timeStartFrame=0;#timeStartSecond=0;#fpsCounter=0;#msCounter=0;#frameCount=0;logFps=false;constructor(){super();this.stats={ms:0,fps:0}}get frameCount(){return this.#frameCount}startFrame(){this.#timeStartFrame=(0,A.now)()}endFrame(){this.#frameCount++;this.#fpsCounter++;const e=(0,A.now)()-this.#timeStartFrame;this.#msCounter+=e;if((0,A.now)()-this.#timeStartSecond>1e3)this.endSecond()}endSecond(){this.stats.fps=this.#fpsCounter;this.stats.ms=Math.round(this.#msCounter/this.#fpsCounter*100)/100;this.emitEvent("performance",this.stats);if(this.logFps)console.log(this.stats);this.#fpsCounter=0;this.#msCounter=0;this.#timeStartSecond=(0,A.now)()}}class a{constructor(){this._arr=[r()];this._index=0;this.stateCounter=0}push(e){this._index++;this.stateCounter++;if(this._index==this._arr.length){const e=r();this._arr.push(e)}St(this._arr[this._index],e||this._arr[this._index-1]);return this._arr[this._index]}pop(){this.stateCounter++;this._index--;if(this._index<0)this._index=0;return this._arr[this._index]}length(){return this._index}}class ta{constructor(e){this._cgl=e;this._lastTime=0;this.pause=false;this.profileUniformCount=0;this.profileShaderBinds=0;this.profileUniformCount=0;this.profileShaderCompiles=0;this.profileVideosPlaying=0;this.profileMVPMatrixCount=0;this.profileEffectBuffercreate=0;this.profileShaderGetUniform=0;this.profileFrameBuffercreate=0;this.profileMeshSetGeom=0;this.profileTextureNew=0;this.profileGenMipMap=0;this.profileOnAnimFrameOps=0;this.profileFencedPixelRead=0;this.profileMainloopMs=0;this.profileMeshDraw=0;this.profileTextureEffect=0;this.profileTexPreviews=0;this.shaderCompileTime=0;this.profileMeshNumElements=0;this.profileMeshAttributes=0;this.profileSingleMeshAttribute=[];this.heavyEvents=[];this.doProfileGlQuery=false;this.glQueryData={};this.counts={}}clear(){this.counts={};this.profileSingleMeshAttribute={};this.profileMeshAttributes=0;this.profileUniformCount=0;this.profileShaderGetUniform=0;this.profileShaderCompiles=0;this.profileShaderBinds=0;this.profileTextureResize=0;this.profileFrameBuffercreate=0;this.profileEffectBuffercreate=0;this.profileTextureDelete=0;this.profileMeshSetGeom=0;this.profileVideosPlaying=0;this.profileMVPMatrixCount=0;this.profileNonTypedAttrib=0;this.profileNonTypedAttribNames="";this.profileTextureNew=0;this.profileGenMipMap=0;this.profileFramebuffer=0;this.profileMeshDraw=0;this.profileTextureEffect=0;this.profileTexPreviews=0;this.profileMeshNumElements=0;this.profileFencedPixelRead=0}clearGlQuery(){for(let e in this.glQueryData){if(!this.glQueryData[e].lastClear||performance.now()-this.glQueryData[e].lastClear>1e3){this.glQueryData[e].time=this.glQueryData[e]._times/this.glQueryData[e]._numcount;this.glQueryData[e].num=this.glQueryData[e]._numcount;this.glQueryData[e]._times=0;this.glQueryData[e]._numcount=0;this.glQueryData[e].lastClear=performance.now()}}}count(e,t){this.counts[e]=this.counts[e]||[];this.counts[e].push(t)}addHeavyEvent(e,t,i){const r={event:e,name:t,info:i,date:performance.now()};this.heavyEvents.push(r);this._cgl.emitEvent("heavyEvent",r)}}class ia extends h.Events{static API_UNKNOWN=0;static API_WEBGL=1;static API_WEBGPU=2;static EVENT_RESIZE="resize";#patch=null;gApi=0;_textureslots=[];_pMatrixStack=new a;_mMatrixStack=new a;_vMatrixStack=new a;canvasScale=1;constructor(e){super();this._log=new h.Logger("cg_context",{onError:e.config.onError});this.tempData=this.frameStore=this.frameStore||{};this.fpsCounter=new ea;this._identView=D();this._ident=D();U(this._identView,0,0,-2);U(this._ident,0,0,0);this._onetimeCallbacks=[];this.maxTexSize=2048;this._viewPort=[0,0,1,1];this._viewPortStack=[];this.patch=e;this.autoReSize=true;this.DEPTH_COMPARE_FUNC_NEVER=0;this.DEPTH_COMPARE_FUNC_LESS=1;this.DEPTH_COMPARE_FUNC_EQUAL=2;this.DEPTH_COMPARE_FUNC_LESSEQUAL=3;this.DEPTH_COMPARE_FUNC_GREATER=4;this.DEPTH_COMPARE_FUNC_NOTEQUAL=5;this.DEPTH_COMPARE_FUNC_GREATEREQUAL=6;this.DEPTH_COMPARE_FUNC_ALWAYS=7;this.profileData=new ta(this);this.pMatrix=r();this.mMatrix=r();this.vMatrix=r();T(this.mMatrix);T(this.vMatrix);window.matchMedia("screen and (min-resolution: 2dppx)").addEventListener("change",()=>{this.emitEvent("resize")})}get canvasWidth(){return this.width}get canvasHeight(){return this.height}get width(){return this.cgCanvas.canvasWidth}get height(){return this.cgCanvas.canvasHeight}get widthCss(){return this.cgCanvas.canvasWidth/this.pixelDensity}get heightCss(){return this.cgCanvas.canvasHeight/this.pixelDensity}set pixelDensity(e){if(this.cgCanvas.pixelDensity!=e){this.cgCanvas.pixelDensity=e;this.cgCanvas.updateSize();this.emitEvent("resize")}}get pixelDensity(){return this.cgCanvas.pixelDensity}getGApiName(){return["unknown","WebGL","WebGPU"][this.gApi]}get canvas(){return this.cgCanvas.canvasEle}get viewPort(){return[0,0,this.canvasWidth,this.canvasHeight]}setCanvas(e){if(this.cgCanvas&&e==this.cgCanvas.canvasEle)return;if(typeof e==="string")e=document.getElementById(e);this.cgCanvas=new $s({canvasEle:e,cg:this});if(!e)return;e.parentElement.classList.add("cablesContainer");if(this._setCanvas)this._setCanvas(e);this.updateSize()}_setCanvas(e){}updateSize(){this.cgCanvas.updateSize()}setSize(e,t,i=false){this.cgCanvas.setSize(e,t,i)}_resizeToWindowSize(){if(this.autoReSize){this.setSize(window.innerWidth,window.innerHeight);this.updateSize()}}_resizeToParentSize(){if(this.autoReSize){const e=this.canvas.parentElement;if(!e){this._log.error("cables: can not resize to container element");return}this.setSize(e.clientWidth,e.clientHeight);this.updateSize()}}setAutoResize(e){window.removeEventListener("resize",this._resizeToWindowSize.bind(this));window.removeEventListener("resize",this._resizeToParentSize.bind(this));if(e=="window"){window.addEventListener("resize",this._resizeToWindowSize.bind(this));window.addEventListener("orientationchange",this._resizeToWindowSize.bind(this));this._resizeToWindowSize()}if(e=="parent"){window.addEventListener("resize",this._resizeToParentSize.bind(this));this._resizeToParentSize()}}pushPMatrix(){this.pMatrix=this._pMatrixStack.push(this.pMatrix)}popPMatrix(){this.pMatrix=this._pMatrixStack.pop();return this.pMatrix}getProjectionMatrixStateCount(){return this._pMatrixStack.stateCounter}pushModelMatrix(){this.mMatrix=this._mMatrixStack.push(this.mMatrix)}popModelMatrix(){this.mMatrix=this._mMatrixStack.pop();return this.mMatrix}modelMatrix(){return this.mMatrix}pushViewMatrix(){this.vMatrix=this._vMatrixStack.push(this.vMatrix)}popViewMatrix(){this.vMatrix=this._vMatrixStack.pop()}getViewMatrixStateCount(){return this._vMatrixStack.stateCounter}_startMatrixStacks(e,t){e=e||this._ident;t=t||this._identView;$t(this.pMatrix,45,this.canvasWidth/this.canvasHeight,.1,1e3);T(this.mMatrix);T(this.vMatrix);n(this.mMatrix,this.mMatrix,e);n(this.vMatrix,this.vMatrix,t);this.pushPMatrix();this.pushModelMatrix();this.pushViewMatrix()}_endMatrixStacks(){this.popViewMatrix();this.popModelMatrix();this.popPMatrix()}dispose(){this.aborted=true;if(this.cgCanvas)this.cgCanvas.dispose();if(this._dispose)this._dispose()}_dispose(){}shouldDrawHelpers(e){return false}addNextFrameOnceCallback(e){if(e&&this._onetimeCallbacks.indexOf(e)==-1)this._onetimeCallbacks.push(e)}_execOneTimeCallbacks(){if(this._onetimeCallbacks.length>0){for(let e=0;e<this._onetimeCallbacks.length;e++)this._onetimeCallbacks[e]();this._onetimeCallbacks.length=0}}checkTextureSize(e){e=e||1;e=Math.floor(e);e=Math.min(e,this.maxTexSize);e=Math.max(e,1);return e}screenShot(e,t,i,r){console.log("no screenshot function implemented")}saveScreenshot(i,r,e,t,n){this.patch.renderOneFrame();let s=this.canvas.clientWidth*this.pixelDensity;let a=this.canvas.clientHeight*this.pixelDensity;if(e){this.canvas.width=e;s=e}if(t){this.canvas.height=t;a=t}function o(e,t,i){return Array(t-String(e).length+1).join(i||"0")+e}const l=new Date;const u="".concat(String(l.getFullYear())+String(l.getMonth()+1)+String(l.getDate()),"_").concat(o(l.getHours(),2)).concat(o(l.getMinutes(),2)).concat(o(l.getSeconds(),2));if(!i)i="cables_"+u+".png";else i+=".png";this.screenShot(e=>{this.canvas.width=s;this.canvas.height=a;if(e){const t=document.createElement("a");t.download=i;t.href=URL.createObjectURL(e);console.log("scrrenshot");setTimeout(function(){t.click();if(r)r(e)},100)}else{this._log.log("screenshot: no blob")}})}hasFocus(){return this.cgCanvas.hasFocus}}class ra extends h.Events{id=A.utils.simpleId();_isValid=true;_defines=[];_moduleNames=[];_moduleNumId=0;_needsRecompile=true;_compileReason="initial";_modules=[];_compileCount=0;logError=true;num=-1;lastCompile=0;constructor(){super()}setWhyCompile(e){this._compileReason=e;this._needsRecompile=true}getWhyCompile(){return this._compileReason}needsRecompile(){return this._needsRecompile}removeUniform(t){for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName()==t){this._uniforms.splice(e,1)}}this.setWhyCompile("remove uniform "+t)}hasUniformInStage(t,e){let i=this.defaultUniBindingFrag;if(e==GPUShaderStage.VERTEX)i=this.defaultUniBindingVert;if(e==GPUShaderStage.COMPUTE)i=this.defaultUniBindingCompute;for(let e=0;e<this._uniforms.length;e++){console.log("hasuniiiiiiiiiiiiiii",this._uniforms[e].getName(),t);if(this._uniforms[e].getName()==t)return true}return false}hasUniform(e){}toggleDefine(t,e){if(e&&typeof e=="object"&&e.addEventListener){if(e.changeListener)e.off(e.changeListener);e.onToggleDefine=e=>{this.toggleDefine(t,e)};e.changeListener=e.on("change",e.onToggleDefine);e=e.get()}if(e)this.define(t);else this.removeDefine(t)}define(t,i=""){if(i===null||i===undefined)i="";if(typeof i=="object"){i.removeEventListener("change",i.onDefineChange);i.onDefineChange=e=>{this.define(t,e)};i.on("change",i.onDefineChange);i=i.get()}for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t&&this._defines[e][1]==i)return;if(this._defines[e][0]==t){this._defines[e][1]=i;this.setWhyCompile("define "+t+" "+i);return}}this.setWhyCompile("define "+t+" "+i);this._defines.push([t,i])}getDefines(){return this._defines}getDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return this._defines[e][1];return null}hasDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return true}removeDefine(t){for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t){this._defines.splice(e,1);this.setWhyCompile("define removed:"+t);return}}}hasModule(t){for(let e=0;e<this._modules.length;e++)if(this._modules[e].id==t)return true;return false}setModules(e){this._moduleNames=e}removeModule(i){for(let e=0;e<this._modules.length;e++){if(i&&i.id){if(this._modules[e].id==i.id||!this._modules[e]){let t=true;while(t){t=false;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName().startsWith(i.prefix)){this._uniforms.splice(e,1);t=true;continue}}}this.setWhyCompile("remove module "+i.title);this._modules.splice(e,1);break}}}}getNumModules(){return this._modules.length}getCurrentModules(){return this._modules}addModule(e,t){if(this.hasModule(e.id))return;if(!e.id)e.id=A.utils.simpleId();if(!e.numId)e.numId=this._moduleNumId;if(!e.num)e.num=this._modules.length;if(t&&!t.group)t.group=A.utils.simpleId();if(!e.group)if(t)e.group=t.group;else e.group=A.utils.simpleId();e.prefix="mod"+e.group+"_";this._modules.push(e);this.setWhyCompile("add module "+e.title);this._moduleNumId++;return e}isValid(){return this._isValid}}class na{constructor(e,t,i,r,n,s,a,o,l,u){this._log=new h.Logger("cg_uniform");this._type=t;this._name=i;this._shader=e;this._value=1e-5;this._oldValue=null;this._port=null;this._structName=l;this._structUniformName=o;this._propertyName=u;if(this._shader._addUniform)this._shader._addUniform(this);this.needsUpdate=true;this.shaderType=null;this.comment=null;if(t=="f"){this.set=this.setValue=this.setValueF.bind(this);this.updateValue=this.updateValueF.bind(this)}else if(t=="f[]"){this.set=this.setValue=this.setValueArrayF.bind(this);this.updateValue=this.updateValueArrayF.bind(this)}else if(t=="2f[]"){this.set=this.setValue=this.setValueArray2F.bind(this);this.updateValue=this.updateValueArray2F.bind(this)}else if(t=="3f[]"){this.set=this.setValue=this.setValueArray3F.bind(this);this.updateValue=this.updateValueArray3F.bind(this)}else if(t=="4f[]"){this.set=this.setValue=this.setValueArray4F.bind(this);this.updateValue=this.updateValueArray4F.bind(this)}else if(t=="i"){this.set=this.setValue=this.setValueI.bind(this);this.updateValue=this.updateValueI.bind(this)}else if(t=="2i"){this.set=this.setValue=this.setValue2I.bind(this);this.updateValue=this.updateValue2I.bind(this)}else if(t=="3i"){this.set=this.setValue=this.setValue3I.bind(this);this.updateValue=this.updateValue3I.bind(this)}else if(t=="4i"){this.set=this.setValue=this.setValue4I.bind(this);this.updateValue=this.updateValue4I.bind(this)}else if(t=="b"){this.set=this.setValue=this.setValueBool.bind(this);this.updateValue=this.updateValueBool.bind(this)}else if(t=="4f"){this.set=this.setValue=this.setValue4F.bind(this);this.updateValue=this.updateValue4F.bind(this)}else if(t=="3f"){this.set=this.setValue=this.setValue3F.bind(this);this.updateValue=this.updateValue3F.bind(this)}else if(t=="2f"){this.set=this.setValue=this.setValue2F.bind(this);this.updateValue=this.updateValue2F.bind(this)}else if(t=="t"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="sampler"){if(this.setValueAny){this.set=this.setValue=this.setValueAny.bind(this);this.updateValue=this.updateValueAny.bind(this)}}else if(t=="tc"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="t[]"){this.set=this.setValue=this.setValueArrayT.bind(this);this.updateValue=this.updateValueArrayT.bind(this)}else if(t=="m4"||t=="m4[]"){this.set=this.setValue=this.setValueM4.bind(this);this.updateValue=this.updateValueM4.bind(this)}else{this._log.error("Unknown uniform type "+t,i,typeof this._shader)}if(typeof r=="object"&&r instanceof A.Port){this._port=r;this._value=this._port.get();if(n&&s&&a){if(!(n instanceof A.Port)||!(s instanceof A.Port)||!(a instanceof A.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0,0];this._port2=n;this._port3=s;this._port4=a;this._port.on("change",this.updateFromPort4f.bind(this));this._port2.on("change",this.updateFromPort4f.bind(this));this._port3.on("change",this.updateFromPort4f.bind(this));this._port4.on("change",this.updateFromPort4f.bind(this));this.updateFromPort4f()}else if(n&&s){if(!(n instanceof A.Port)||!(s instanceof A.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0];this._port2=n;this._port3=s;this._port.on("change",this.updateFromPort3f.bind(this));this._port2.on("change",this.updateFromPort3f.bind(this));this._port3.on("change",this.updateFromPort3f.bind(this));this.updateFromPort3f()}else if(n){if(!(n instanceof A.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0];this._port2=n;this._port.on("change",this.updateFromPort2f.bind(this));this._port2.on("change",this.updateFromPort2f.bind(this));this.updateFromPort2f()}else{this._port.on("change",this.updateFromPort.bind(this))}}else this._value=r;if(this._value==undefined){this._value=0}this.setValue(this._value);this.needsUpdate=true}getType(){return this._type}get type(){return this._type}get name(){return this._name}getName(){return this._name}getValue(){return this._value}getShaderType(){return this.shaderType}isStructMember(){return!!this._structName}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}get port(){return this._port}}class sa{_name="unknown";constructor(){}}const aa=8;class g{constructor(e={}){this.id=A.utils.uuid();this.width=0;this.height=0;this.name="unknown";e=e||{};this.pixelFormat=e.pixelFormat||g.PFORMATSTR_RGBA8UB;this.name=e.name||"unknown";if(!e.width)e.width=aa;if(!e.height)e.height=aa}}g.getDefaultTextureData=(e,s,a={})=>{if(e=="empty"){return new Uint8Array(s*s*4).fill(0)}else if(e=="color"){const n=new Uint8Array(s*s*4);let t=a.r||1;let i=a.g||1;let r=a.b||1;for(let e=0;e<s*s;e++){n[e*4+0]=t;n[e*4+1]=i;n[e*4+2]=r;n[e*4+3]=255}return n}else if(e=="randomUInt"){const n=new Uint8Array(s*s*4);for(let e=0;e<s*s;e++){n[e*4+0]=Math.random()*255;n[e*4+1]=Math.random()*255;n[e*4+2]=Math.random()*255;n[e*4+3]=255}return n}else if(e=="random"||e=="randomFloat"){const n=new Float32Array(s*s*4);for(let e=0;e<s*s;e++){n[e*4+0]=(Math.random()-.5)*2;n[e*4+1]=(Math.random()-.5)*2;n[e*4+2]=(Math.random()-.5)*2;n[e*4+3]=1}return n}else if(e=="stripes"){const o=[];let i=a.r;let r=a.g;let n=a.b;if(i===undefined)i=1;if(r===undefined)r=1;if(n===undefined)n=1;for(let t=0;t<s;t++){for(let e=0;e<s;e++){if((e+t)%64<32){o.push((200+t/s*25+e/s*25)*i);o.push((200+t/s*25+e/s*25)*r);o.push((200+t/s*25+e/s*25)*n)}else{o.push((40+t/s*25+e/s*25)*i);o.push((40+t/s*25+e/s*25)*r);o.push((40+t/s*25+e/s*25)*n)}o.push(255)}}return new Uint8Array(o)}else{console.warn("unknown default texture",e);return g.getDefaultTextureData("stripes",s,{r:1,g:0,b:0})}};g.FILTER_NEAREST=0;g.FILTER_LINEAR=1;g.FILTER_MIPMAP=2;g.WRAP_REPEAT=0;g.WRAP_MIRRORED_REPEAT=1;g.WRAP_CLAMP_TO_EDGE=2;g.TYPE_DEFAULT=0;g.TYPE_DEPTH=1;g.TYPE_FLOAT=2;g.PFORMATSTR_RGB565="RGB 5/6/5bit ubyte";g.PFORMATSTR_R8UB="R 8bit ubyte";g.PFORMATSTR_RG8UB="RG 8bit ubyte";g.PFORMATSTR_RGB8UB="RGB 8bit ubyte";g.PFORMATSTR_RGBA8UB="RGBA 8bit ubyte";g.PFORMATSTR_SRGBA8="SRGBA 8bit ubyte";g.PFORMATSTR_R11FG11FB10F="RGB 11/11/10bit float";g.PFORMATSTR_R16F="R 16bit float";g.PFORMATSTR_RG16F="RG 16bit float";g.PFORMATSTR_RGB16F="RGB 16bit float";g.PFORMATSTR_RGBA16F="RGBA 16bit float";g.PFORMATSTR_R32F="R 32bit float";g.PFORMATSTR_RG32F="RG 32bit float";g.PFORMATSTR_RGB32F="RGB 32bit float";g.PFORMATSTR_RGBA32F="RGBA 32bit float";g.PFORMATSTR_DEPTH="DEPTH";g.PIXELFORMATS=[g.PFORMATSTR_RGB565,g.PFORMATSTR_R8UB,g.PFORMATSTR_RG8UB,g.PFORMATSTR_RGB8UB,g.PFORMATSTR_RGBA8UB,g.PFORMATSTR_SRGBA8,g.PFORMATSTR_R11FG11FB10F,g.PFORMATSTR_R16F,g.PFORMATSTR_RG16F,g.PFORMATSTR_RGBA16F,g.PFORMATSTR_R32F,g.PFORMATSTR_RGBA32F];const oa={SHADERVAR_VERTEX_POSITION:"vPosition",SHADERVAR_VERTEX_NUMBER:"attrVertIndex",SHADERVAR_VERTEX_NORMAL:"attrVertNormal",SHADERVAR_VERTEX_TEXCOORD:"attrTexCoord",SHADERVAR_INSTANCE_MMATRIX:"instMat",SHADERVAR_VERTEX_COLOR:"attrVertColor",SHADERVAR_INSTANCE_INDEX:"instanceIndex",SHADERVAR_UNI_PROJMAT:"projMatrix",SHADERVAR_UNI_VIEWMAT:"viewMatrix",SHADERVAR_UNI_MODELMAT:"modelMatrix",SHADERVAR_UNI_NORMALMAT:"normalMatrix",SHADERVAR_UNI_INVVIEWMAT:"inverseViewMatrix",SHADERVAR_UNI_INVPROJMAT:"invProjMatrix",SHADERVAR_UNI_MATERIALID:"materialId",SHADERVAR_UNI_OBJECTID:"objectId",SHADERVAR_UNI_VIEWPOS:"camPos"};const la={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};const ua=180/Math.PI;const ha=Math.PI/180;const d={MATH:{DEG2RAD:ha,RAD2DEG:ua},SHADER:oa,BLEND_MODES:la};const O="\n";const ca={DEPTH_COMPARE_NEVER:0,DEPTH_COMPARE_LESS:1,DEPTH_COMPARE_EQUAL:2,DEPTH_COMPARE_LESSEQUAL:3,DEPTH_COMPARE_GREATER:4,DEPTH_COMPARE_NOTEQUAL:5,DEPTH_COMPARE_GREATEREQUAL:6,DEPTH_COMPARE_ALWAYS:7,CULL_NONE:0,CULL_BACK:1,CULL_FRONT:2,CULL_BOTH:3,Geometry:c,BoundingBox:i,FpsCounter:ea,CgCanvas:$s};window.CABLES=window.CABLES||{};window.CABLES.CG={...window.CABLES.CG,...ca};window.CG={...window.CG,...ca};window.glMatrix=C;window.mat2=R;window.mat2d=N;window.mat3=y;window.mat4=P;window.quat=k;window.quat2=H;window.vec2=X;window.vec3=L;window.vec4=F;class m extends na{constructor(e,t,i,r,n,s,a,o,l,u){super(e,t,i,r,n,s,a,o,l,u);this._loc=-1;this._cgl=e._cgl}get name(){return this._name}copy(e){const t=new m(e,this._type,this._name,this._value,this._port2,this._port3,this._port4,this._structUniformName,this._structName,this._propertyName);t.shaderType=this.shaderType;return t}getGlslTypeString(){return m.glslTypeString(this._type)}_isValidLoc(){return this._loc!=-1}resetLoc(){this._loc=-1;this.needsUpdate=true}bindTextures(){}getLoc(){return this._loc}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}updateValueF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1f(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueF(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}updateValueI(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value);this._cgl.profileData.profileUniformCount++}updateValue2I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2i(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}updateValue3I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3i(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}updateValue4I(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform4i(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.profileUniformCount++}setValueI(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValue2I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}setValue3I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}setValue4I(e){this.needsUpdate=true;this._value=e||vec4.create()}updateValueBool(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value?1:0);this._cgl.profileData.profileUniformCount++}setValueBool(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValueArray4F(e){this.needsUpdate=true;this._value=e}updateValueArray4F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform4fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArray3F(e){this.needsUpdate=true;this._value=e}updateValueArray3F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform3fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArray2F(e){this.needsUpdate=true;this._value=e}updateValueArray2F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform2fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArrayF(e){this.needsUpdate=true;this._value=e}updateValueArrayF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArrayT(e){this.needsUpdate=true;this._value=e}updateValue3F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3f(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}setValue3F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValue2F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2f(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}setValue2F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}updateValue4F(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value){this._log.warn("no value for uniform",this._name,this);this._value=[0,0,0,0]}this.needsUpdate=false;this._shader.getCgl().gl.uniform4f(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.profileUniformCount++}setValue4F(e){if(typeof this.value=="number")this.value=vec4.create();if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2,3];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]||e[3]!=this._oldValue[3]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValueM4(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value||this._value.length%16!=0)return console.log("this.name",this._name,this._value);this._shader.getCgl().gl.uniformMatrix4fv(this._loc,false,this._value);this._cgl.profileData.profileUniformCount++}setValueM4(e){this.needsUpdate=true;this._value=e||mat4.create()}updateValueArrayT(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1iv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}updateValueT(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._cgl.profileData.profileUniformCount++;this._shader.getCgl().gl.uniform1i(this._loc,this._value);this.needsUpdate=false}setValueT(e){this.needsUpdate=true;this._value=e}}m.glslTypeString=e=>{if(e=="f")return"float";if(e=="b")return"bool";if(e=="i")return"int";if(e=="2i")return"ivec2";if(e=="2f")return"vec2";if(e=="3f")return"vec3";if(e=="4f")return"vec4";if(e=="m4")return"mat4";if(e=="t")return"sampler2D";if(e=="tc")return"samplerCube";if(e=="3f[]")return null;if(e=="m4[]")return null;if(e=="f[]")return null;console.warn("[CGL UNIFORM] unknown glsl type string ",e)};const I={};I.lastMesh=null;class p extends sa{#cgl=null;#geom=null;#bufVerticesIndizes=null;constructor(e,t,i={}){super();this.#cgl=e;let r=i||{};if(A.utils.isNumeric(r))r={glPrimitive:i};this._log=new h.Logger("cgl_mesh");this._bufVertexAttrib=null;this.#bufVerticesIndizes=this.#cgl.gl.createBuffer();this._indexType=this.#cgl.gl.UNSIGNED_SHORT;this._attributes=[];this._attribLocs={};this._lastShader=null;this._numInstances=0;this._glPrimitive=r.glPrimitive||null;this.opId=r.opId||"";this._preWireframeGeom=null;this.addVertexNumbers=false;this.feedBackAttributes=[];this.setGeom(t);this._feedBacks=[];this._feedBacksChanged=false;this._transformFeedBackLoc=-1;this._lastAttrUpdate=0;this.memFreed=false;this.#cgl.profileData.addHeavyEvent("mesh constructed",this._name);this._queryExt=null}get geom(){return this.#geom}get numInstances(){return this._numInstances}set numInstances(e){this.setNumInstances(e)}freeMem(){this.memFreed=true;for(let e=0;e<this._attributes.length;e++)this._attributes[e].floatArray=null}updateVertices(e){this.setAttribute(d.SHADER.SHADERVAR_VERTEX_POSITION,e.vertices,3);this._numVerts=e.vertices.length/3}setAttributePointer(t,i,r,n){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t){if(!this._attributes[e].pointer)this._attributes[e].pointer=[];this._attributes[e].pointer.push({loc:-1,name:i,stride:r,offset:n,instanced:t==d.SHADER.SHADERVAR_INSTANCE_MMATRIX})}}}getAttribute(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].name==t)return this._attributes[e]}setAttributeRange(e,t,i,r){if(!e)return;if(!i&&!r)return;if(!e.name)this._log.stack("no attrname?!");const n=this.#cgl.gl;n.bindBuffer(n.ARRAY_BUFFER,e.buffer);this.#cgl.profileData.profileMeshAttributes+=r-i||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]=this.#cgl.profileData.profileSingleMeshAttribute[this._name]||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]+=r-i||0;if(e.numItems<t.length/e.itemSize){this._resizeAttr(t,e)}if(r>t.length&&!this.warned){this.warned=true;this._log.warn(this.#cgl.canvas.id+"'"+e.name+"' buffersubdata out of bounds ?",t.length,r,i,e);return}n.bufferSubData(n.ARRAY_BUFFER,i*4,t,i,r-i)}_resizeAttr(e,t){const i=this.#cgl.gl;if(t.buffer)i.deleteBuffer(t.buffer);t.buffer=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,t.buffer);this._bufferArray(e,t);t.numItems=e.length/t.itemSize}_bufferArray(e,t){let i=t.floatArray||null;if(!e)return;if(this.#cgl.debugOneFrame){console.log("_bufferArray",e.length,t.name)}if(!(e instanceof Float32Array)){if(t&&i&&i.length==e.length){i.set(e)}else{i=new Float32Array(e);if(this.#cgl.debugOneFrame){console.log("_bufferArray create new float32array",e.length,t.name)}if(e.length>1e4){this.#cgl.profileData.profileNonTypedAttrib++;this.#cgl.profileData.profileNonTypedAttribNames="("+this._name+":"+t.name+")"}}}else i=e;t.arrayLength=i.length;t.floatArray=null;this.#cgl.gl.bufferData(this.#cgl.gl.ARRAY_BUFFER,i,this.#cgl.gl.DYNAMIC_DRAW)}addAttribute(e,t,i,r){this.setAttribute(e,t,i,r)}setAttribute(e,t,i,r={}){if(!t){this._log.error("mesh addAttribute - no array given! "+e);throw new Error}let n=null;let s=false;let a=0;const o=t.length/i;this.#cgl.profileData.profileMeshAttributes+=o||0;if(typeof r=="function"){n=r}if(typeof r=="object"){if(r.cb)n=r.cb;if(r.instanced)s=r.instanced}if(e==d.SHADER.SHADERVAR_INSTANCE_MMATRIX)s=true;for(a=0;a<this._attributes.length;a++){const h=this._attributes[a];if(h.name==e){if(h.numItems===o){}else{this._resizeAttr(t,h)}this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,h.buffer);this._bufferArray(t,h);return h}}const l=this.#cgl.gl.createBuffer();this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,l);let u=this.#cgl.gl.FLOAT;if(r&&r.type)u=r.type;const h={buffer:l,name:e,cb:n,itemSize:i,numItems:o,startItem:0,instanced:s,type:u};this._bufferArray(t,h);if(e==d.SHADER.SHADERVAR_VERTEX_POSITION)this._bufVertexAttrib=h;this._attributes.push(h);this._attribLocs={};return h}getAttributes(){return this._attributes}updateTexCoords(e){if(e.texCoords&&e.texCoords.length>0){this.setAttribute(d.SHADER.SHADERVAR_VERTEX_TEXCOORD,e.texCoords,2)}else{const t=new Float32Array(Math.round(e.vertices.length/3*2));this.setAttribute(d.SHADER.SHADERVAR_VERTEX_TEXCOORD,t,2)}}updateNormals(e){if(e.vertexNormals&&e.vertexNormals.length>0){this.setAttribute(d.SHADER.SHADERVAR_VERTEX_NORMAL,e.vertexNormals,3)}else{const t=new Float32Array(Math.round(e.vertices.length));this.setAttribute(d.SHADER.SHADERVAR_VERTEX_NORMAL,t,3)}}_setVertexNumbers(e=null){if(!this._verticesNumbers||this._verticesNumbers.length!=this._numVerts||e){if(e)this._verticesNumbers=e;else{this._verticesNumbers=new Float32Array(this._numVerts);for(let e=0;e<this._numVerts;e++)this._verticesNumbers[e]=e}this.setAttribute(d.SHADER.SHADERVAR_VERTEX_NUMBER,this._verticesNumbers,1,(e,t,i)=>{if(!i.uniformNumVertices)i.uniformNumVertices=new m(i,"f","numVertices",this._numVerts);i.uniformNumVertices.setValue(this._numVerts)})}}setVertexIndices(t){if(!this.#bufVerticesIndizes){this._log.warn("no bufVerticesIndizes: "+this._name);return}if(t.length>0){if(t instanceof Float32Array)this._log.warn("vertIndices float32Array: "+this._name);for(let e=0;e<t.length;e++){if(t[e]>=this._numVerts){this._log.warn("invalid index in "+this._name,e,t[e]);return}}this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes);if(t.length>65535){this.vertIndicesTyped=new Uint32Array(t);this._indexType=this.#cgl.gl.UNSIGNED_INT}else if(t instanceof Uint32Array){this.vertIndicesTyped=t;this._indexType=this.#cgl.gl.UNSIGNED_INT}else if(!(t instanceof Uint16Array)){this.vertIndicesTyped=new Uint16Array(t);this._indexType=this.#cgl.gl.UNSIGNED_SHORT}else this.vertIndicesTyped=t;this.#cgl.gl.bufferData(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.vertIndicesTyped,this.#cgl.gl.DYNAMIC_DRAW);this.#bufVerticesIndizes.itemSize=1;this.#bufVerticesIndizes.numItems=t.length}else this.#bufVerticesIndizes.numItems=0}setGeom(e,t=false){this.#geom=e;if(e.glPrimitive!=null)this._glPrimitive=e.glPrimitive;if(this.#geom&&this.#geom.name)this._name="mesh "+this.#geom.name;I.lastMesh=null;this.#cgl.profileData.profileMeshSetGeom++;this._disposeAttributes();this.updateVertices(this.#geom);this.setVertexIndices(this.#geom.verticesIndices);if(this.addVertexNumbers)this._setVertexNumbers();const i=this.#geom.getAttributes();const r={texCoords:d.SHADER.SHADERVAR_VERTEX_TEXCOORD,vertexNormals:d.SHADER.SHADERVAR_VERTEX_NORMAL,vertexColors:d.SHADER.SHADERVAR_VERTEX_COLOR,tangents:"attrTangent",biTangents:"attrBiTangent"};for(const n in i)if(i[n].data&&i[n].data.length)this.setAttribute(r[n]||n,i[n].data,i[n].itemSize);if(t){this.#geom=null}}_preBind(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].cb)this._attributes[e].cb(this._attributes[e],this.#geom,t)}_checkAttrLengths(){if(this.memFreed)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].arrayLength/this._attributes[e].itemSize<this._attributes[0].arrayLength/this._attributes[0].itemSize){let e="unknown";if(this.#geom)e=this.#geom.name}}}_bind(t){if(!t)return;if(!t.isValid())return;let i=[];if(this._attribLocs[t.id])i=this._attribLocs[t.id];else this._attribLocs[t.id]=i;this._lastShader=t;if(t.lastCompile>this._lastAttrUpdate||i.length!=this._attributes.length){this._lastAttrUpdate=t.lastCompile;for(let e=0;e<this._attributes.length;e++)i[e]=-1}for(let e=0;e<this._attributes.length;e++){const r=this._attributes[e];if(i[e]==-1){if(r._attrLocationLastShaderTime!=t.lastCompile){r._attrLocationLastShaderTime=t.lastCompile;i[e]=this.#cgl.glGetAttribLocation(t.getProgram(),r.name);this.#cgl.profileData.profileAttrLoc++}}if(i[e]!=-1){this.#cgl.gl.enableVertexAttribArray(i[e]);this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,r.buffer);if(r.instanced){if(r.itemSize<=4){if(!r.itemSize||r.itemSize==0)this._log.warn("instanced attrib itemsize error",this.#geom.name,r);this.#cgl.gl.vertexAttribPointer(i[e],r.itemSize,r.type,false,r.itemSize*4,0);this.#cgl.gl.vertexAttribDivisor(i[e],1)}else if(r.itemSize==16){const n=16*4;this.#cgl.gl.vertexAttribPointer(i[e],4,r.type,false,n,0);this.#cgl.gl.enableVertexAttribArray(i[e]+1);this.#cgl.gl.vertexAttribPointer(i[e]+1,4,r.type,false,n,4*4*1);this.#cgl.gl.enableVertexAttribArray(i[e]+2);this.#cgl.gl.vertexAttribPointer(i[e]+2,4,r.type,false,n,4*4*2);this.#cgl.gl.enableVertexAttribArray(i[e]+3);this.#cgl.gl.vertexAttribPointer(i[e]+3,4,r.type,false,n,4*4*3);this.#cgl.gl.vertexAttribDivisor(i[e],1);this.#cgl.gl.vertexAttribDivisor(i[e]+1,1);this.#cgl.gl.vertexAttribDivisor(i[e]+2,1);this.#cgl.gl.vertexAttribDivisor(i[e]+3,1)}else{this._log.warn("unknown instance attrib size",r.name)}}else{if(!r.itemSize||r.itemSize==0)this._log.warn("attrib itemsize error",this._name,r);this.#cgl.gl.vertexAttribPointer(i[e],r.itemSize,r.type,false,r.itemSize*4,0);if(r.pointer){for(let e=0;e<r.pointer.length;e++){const s=r.pointer[e];if(s.loc==-1)s.loc=this.#cgl.glGetAttribLocation(t.getProgram(),s.name);this.#cgl.profileData.profileAttrLoc++;this.#cgl.gl.enableVertexAttribArray(s.loc);this.#cgl.gl.vertexAttribPointer(s.loc,r.itemSize,r.type,false,s.stride,s.offset)}}if(this.bindFeedback)this.bindFeedback(r)}}}if(this.#bufVerticesIndizes&&this.#bufVerticesIndizes.numItems!==0)this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes)}unBind(){const e=this._lastShader;this._lastShader=null;if(!e)return;let t=[];if(this._attribLocs[e.id])t=this._attribLocs[e.id];else this._attribLocs[e.id]=t;I.lastMesh=null;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].instanced){if(this._attributes[e].itemSize<=4){if(t[e]!=-1)this.#cgl.gl.vertexAttribDivisor(t[e],0);if(t[e]>=0)this.#cgl.gl.disableVertexAttribArray(t[e])}else{this.#cgl.gl.vertexAttribDivisor(t[e],0);this.#cgl.gl.vertexAttribDivisor(t[e]+1,0);this.#cgl.gl.vertexAttribDivisor(t[e]+2,0);this.#cgl.gl.vertexAttribDivisor(t[e]+3,0);this.#cgl.gl.disableVertexAttribArray(t[e]+1);this.#cgl.gl.disableVertexAttribArray(t[e]+2);this.#cgl.gl.disableVertexAttribArray(t[e]+3)}}if(t[e]!=-1)this.#cgl.gl.disableVertexAttribArray(t[e])}}meshChanged(){return this.#cgl.lastMesh&&this.#cgl.lastMesh!=this}printDebug(){console.log("--attributes");for(let e=0;e<this._attributes.length;e++){console.log("attribute "+e+" "+this._attributes[e].name)}}setNumVertices(e){this._bufVertexAttrib.numItems=e}getNumVertices(){return this._bufVertexAttrib.numItems}setNumIndices(e){this.#bufVerticesIndizes.numItems=e}getNumIndices(){return this.#bufVerticesIndizes.numItems}render(i){if(this.#cgl.aborted)return;i=i||this.#cgl.getShader();if(!i){return console.log("shader not valid")}if(!i.isValid()){i=this.#cgl.getErrorShader()}this._checkAttrLengths();if(this.#geom){if(this._preWireframeGeom&&!i.wireframe&&!this.#geom.isIndexed()){this.setGeom(this._preWireframeGeom);this._preWireframeGeom=null}if(i.wireframe){let e=false;if(this.#geom.isIndexed()){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}this.#geom.unIndex();e=true}if(!this.#geom.getAttribute("attrBarycentric")){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}e=true;this.#geom.calcBarycentric()}if(e)this.setGeom(this.#geom)}}let e=false;if(I.lastMesh!=this){if(I.lastMesh)I.lastMesh.unBind();e=true}if(e)this._preBind(i);if(!i.bind())return;this._bind(i);if(this.addVertexNumbers)this._setVertexNumbers();I.lastMesh=this;let t=this.#cgl.gl.TRIANGLES;if(this._glPrimitive!==null)t=this._glPrimitive;if(i.glPrimitive!==null)t=i.glPrimitive;let r=1;let n=this.#cgl.profileData.doProfileGlQuery;let s=false;if(n){let e=this._name+" - "+i.getName()+" #"+i.id;if(this._numInstances)e+=" instanced "+this._numInstances+"x";let t=this.#cgl.profileData.glQueryData[e];if(!t)t={id:e,num:0};if(i.opId)t.shaderOp=i.opId;if(this.opId)t.meshOp=this.opId;this.#cgl.profileData.glQueryData[e]=t;if(!this._queryExt&&this._queryExt!==false)this._queryExt=this.#cgl.enableExtension("EXT_disjoint_timer_query_webgl2")||false;if(this._queryExt){if(t._drawQuery){const a=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT_AVAILABLE);if(a){const o=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT);const l=o/1e6;t._times=t._times||0;t._times+=l;t._numcount++;t.when=performance.now();t._drawQuery=null;t.queryStarted=false}}if(!t.queryStarted){t._drawQuery=this.#cgl.gl.createQuery();this.#cgl.gl.beginQuery(this._queryExt.TIME_ELAPSED_EXT,t._drawQuery);s=t.queryStarted=true}}}if(this.hasFeedbacks&&this.hasFeedbacks())this.drawFeedbacks(i,t);else if(!this.#bufVerticesIndizes||this.#bufVerticesIndizes.numItems===0){if(t==this.#cgl.gl.TRIANGLES)r=3;if(this._numInstances===0)this.#cgl.gl.drawArrays(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems-this._bufVertexAttrib.startItem);else this.#cgl.gl.drawArraysInstanced(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems,this._numInstances)}else{if(t==this.#cgl.gl.TRIANGLES)r=3;if(this._numInstances===0){this.#cgl.gl.drawElements(t,this.#bufVerticesIndizes.numItems,this._indexType,0)}else{this.#cgl.gl.drawElementsInstanced(t,this.#bufVerticesIndizes.numItems,this._indexType,0,this._numInstances)}}if(this.#cgl.debugOneFrame&&this.#cgl.gl.getError()!=this.#cgl.gl.NO_ERROR){this._log.error("mesh draw gl error");this._log.error("mesh",this);this._log.error("shader",i);const u=[];for(let e=0;e<this.#cgl.gl.getProgramParameter(i.getProgram(),this.#cgl.gl.ACTIVE_ATTRIBUTES);e++){const h=this.#cgl.gl.getActiveAttrib(i.getProgram(),e).name;this._log.error("attrib ",h)}}this.#cgl.profileData.profileMeshNumElements+=this._bufVertexAttrib.numItems/r*(this._numInstances||1);this.#cgl.profileData.profileMeshDraw++;if(n&&s){this.#cgl.gl.endQuery(this._queryExt.TIME_ELAPSED_EXT)}this.#cgl.printError("mesh render "+this._name);this.unBind()}setNumInstances(t){t=Math.max(0,t);if(this._numInstances!=t){this._numInstances=t;const i=new Float32Array(t);for(let e=0;e<t;e++)i[e]=e;this.setAttribute(d.SHADER.SHADERVAR_INSTANCE_INDEX,i,1,{instanced:true})}}_disposeAttributes(){if(!this._attributes)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].buffer){this.#cgl.gl.deleteBuffer(this._attributes[e].buffer);this._attributes[e].buffer=null}}this._attributes.length=0}dispose(){if(this.#cgl.aborted)return;if(this._bufVertexAttrib&&this._bufVertexAttrib.buffer)this.#cgl.gl.deleteBuffer(this._bufVertexAttrib.buffer);if(this.#bufVerticesIndizes)this.#cgl.gl.deleteBuffer(this.#bufVerticesIndizes);this.#bufVerticesIndizes=null;this._disposeAttributes();return null}}const b={};b.getSimpleRect=function(e,t,i=1){const r=new c(t);r.vertices=[1*i,1*i,0,-1*i,1*i,0,1*i,-1*i,0,-1*i,-1*i,0];r.texCoords=[1,1,0,1,1,0,0,0];r.verticesIndices=[0,1,2,2,1,3];r.vertexNormals=[0,0,0,0,0,0,0,0,0,0,0,0];return e.createMesh(r)};b.getSimpleCube=function(e,t){const i=new c(t);i.vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1];i.setTexCoords([0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,0,0,0,1,1,1,1,0,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0]);i.verticesIndices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];i.vertexNormals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]);i.tangents=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1]);i.biTangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1]);return new p(e,i)};class v{constructor(e,t){this._cgl=e;this._log=new h.Logger("cgl_TextureEffect");if(!e.TextureEffectMesh)this.createMesh();this._textureSource=null;this._options=t;this.name=t.name||"unknown";this.imgCompVer=0;this.aspectRatio=1;this._textureTarget=null;this._frameBuf=this._cgl.gl.createFramebuffer();this._frameBuf2=this._cgl.gl.createFramebuffer();this._renderbuffer=this._cgl.gl.createRenderbuffer();this._renderbuffer2=this._cgl.gl.createRenderbuffer();this.switched=false;this.depth=false}dispose(){if(this._renderbuffer)this._cgl.gl.deleteRenderbuffer(this._renderbuffer);if(this._frameBuf)this._cgl.gl.deleteFramebuffer(this._frameBuf);if(this._renderbuffer2)this._cgl.gl.deleteRenderbuffer(this._renderbuffer2);if(this._frameBuf2)this._cgl.gl.deleteFramebuffer(this._frameBuf2)}getWidth(){return this._textureSource.width}getHeight(){return this._textureSource.height}setSourceTexture(e){if(e===null){this._textureSource=new E(this._cgl);this._textureSource.setSize(16,16)}else{this._textureSource=e}if(!this._textureSource.compareSettings(this._textureTarget)){if(this._textureTarget)this._textureTarget.delete();this._textureTarget=this._textureSource.clone();this._cgl.profileData.profileEffectBuffercreate++;this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureTarget.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer2);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureSource.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer2);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}this.aspectRatio=this._textureSource.width/this._textureSource.height}continueEffect(){this._cgl.pushDepthTest(false);this._cgl.pushModelMatrix();this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this.getCurrentTargetTexture().width,this.getCurrentTargetTexture().height);mat4.perspective(this._cgl.pMatrix,45,this.getCurrentTargetTexture().width/this.getCurrentTargetTexture().height,.1,1100);this._cgl.pushPMatrix();mat4.identity(this._cgl.pMatrix);this._cgl.pushViewMatrix();mat4.identity(this._cgl.vMatrix);this._cgl.pushModelMatrix();mat4.identity(this._cgl.mMatrix)}startEffect(e){if(!this._textureTarget){this._log.warn("effect has no target");return}this.switched=false;this.continueEffect();if(e){this._bgTex=e}this._countEffects=0}endEffect(){this._cgl.popDepthTest();this._cgl.popModelMatrix();this._cgl.popPMatrix();this._cgl.popModelMatrix();this._cgl.popViewMatrix();this._cgl.popPMatrix();this._cgl.popViewPort()}bind(){if(this._textureSource===null){this._log.warn("no base texture set!");return}if(!this.switched){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.pushGlFrameBuffer(this._frameBuf)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.pushGlFrameBuffer(this._frameBuf2)}}finish(){if(this._textureSource===null){this._log.warn("no base texture set!");return}this._cgl.TextureEffectMesh.render(this._cgl.getShader());this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.profileData.profileTextureEffect++;if(this._textureTarget.filter==E.FILTER_MIPMAP){if(!this.switched){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureTarget.tex);this._textureTarget.updateMipMap()}else{this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureSource.tex);this._textureSource.updateMipMap()}this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}this.switched=!this.switched;this._countEffects++}getCurrentTargetTexture(){if(this.switched)return this._textureSource;return this._textureTarget}getCurrentSourceTexture(){if(this._countEffects==0&&this._bgTex)return this._bgTex;if(this.switched)return this._textureTarget;return this._textureSource}delete(){if(this._textureTarget)this._textureTarget.delete();if(this._textureSource)this._textureSource.delete();this._cgl.gl.deleteRenderbuffer(this._renderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuf)}createMesh(){this._cgl.TextureEffectMesh=b.getSimpleRect(this._cgl,"texEffectRect")}}v.checkOpNotInTextureEffect=function(e){if(!e.patch.cgl)return true;if(e.uiAttribs.error&&!e.patch.cgl.currentTextureEffect){e.setUiError("textureeffect",null);return true}if(!e.patch.cgl.currentTextureEffect)return true;if(e.patch.cgl.currentTextureEffect&&!e.uiAttribs.error){e.setUiError("textureeffect","This op can not be a child of a ImageCompose/texture effect! imagecompose should only have textureeffect childs.",0);return false}if(e.patch.cgl.currentTextureEffect)return false;return true};v.checkOpInEffect=function(e,t){t=t||0;if(e.patch.cgl.currentTextureEffect){if(e.uiAttribs.uierrors&&e.patch.cgl.currentTextureEffect.imgCompVer>=t){e.setUiError("texeffect",null);return true}if(t&&e.patch.cgl.currentTextureEffect.imgCompVer<t){e.setUiError("texeffect","This op must be a child of an ImageCompose op with version >="+t+' <span class="button-small" onclick="gui.patchView.downGradeOp(\''+e.id+"','"+e.name+"')\">Downgrade</span> to previous version",1)}}if(e.patch.cgl.currentTextureEffect)return true;if(!e.patch.cgl.currentTextureEffect&&(!e.uiAttribs.uierrors||e.uiAttribs.uierrors.length==0)){e.setUiError("texeffect",'This op must be a child of an ImageCompose op! More infos <a href="https://cables.gl/docs/image_composition/image_composition.html" target="_blank">here</a>. ',1);return false}if(!e.patch.cgl.currentTextureEffect)return false;return true};v.getBlendCode=function(e){let t="".endl()+"vec3 _blend(vec3 base,vec3 blend)".endl()+"{".endl()+"   vec3 colNew=blend;".endl()+"   #ifdef BM_MULTIPLY".endl()+"       colNew=base*blend;".endl()+"   #endif".endl()+"   #ifdef BM_MULTIPLY_INV".endl()+"       colNew=base* vec3(1.0)-blend;".endl()+"   #endif".endl()+"   #ifdef BM_AVERAGE".endl()+"       colNew=((base + blend) / 2.0);".endl()+"   #endif".endl()+"   #ifdef BM_ADD".endl()+"       colNew=min(base + blend, vec3(1.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT_ONE".endl()+"       colNew=max(base + blend - vec3(1.0), vec3(0.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT".endl()+"       colNew=base - blend;".endl()+"   #endif".endl()+"   #ifdef BM_DIFFERENCE".endl()+"       colNew=abs(base - blend);".endl()+"   #endif".endl()+"   #ifdef BM_NEGATION".endl()+"       colNew=(vec3(1.0) - abs(vec3(1.0) - base - blend));".endl()+"   #endif".endl()+"   #ifdef BM_EXCLUSION".endl()+"       colNew=(base + blend - 2.0 * base * blend);".endl()+"   #endif".endl()+"   #ifdef BM_LIGHTEN".endl()+"       colNew=max(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_DARKEN".endl()+"       colNew=min(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_OVERLAY".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SCREEN".endl()+"      #define BlendScreenf(base, blend)       (1.0 - ((1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendScreenf(base.r, blend.r),BlendScreenf(base.g, blend.g),BlendScreenf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SOFTLIGHT".endl()+"      #define BlendSoftLightf(base, blend)    ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))".endl()+"      colNew=vec3(BlendSoftLightf(base.r, blend.r),BlendSoftLightf(base.g, blend.g),BlendSoftLightf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_HARDLIGHT".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORDODGE".endl()+"      #define BlendColorDodgef(base, blend)   ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))".endl()+"      colNew=vec3(BlendColorDodgef(base.r, blend.r),BlendColorDodgef(base.g, blend.g),BlendColorDodgef(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORBURN".endl()+"      #define BlendColorBurnf(base, blend)    ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))".endl()+"      colNew=vec3(BlendColorBurnf(base.r, blend.r),BlendColorBurnf(base.g, blend.g),BlendColorBurnf(base.b, blend.b));".endl()+"   #endif".endl()+"   return colNew;".endl()+"}".endl();if(!e)t+="vec4 cgl_blend(vec4 oldColor,vec4 newColor,float amount)".endl()+"{".endl()+"vec4 col=vec4( _blend(oldColor.rgb,newColor.rgb) ,1.0);".endl()+"col=vec4( mix( col.rgb, oldColor.rgb ,1.0-oldColor.a*amount),1.0);".endl()+"return col;".endl()+"}".endl();if(e>=3)t+="vec4 cgl_blendPixel(vec4 base,vec4 col,float amount)".endl()+"{".endl()+"#ifdef BM_MATH_ADD".endl()+"   return vec4(base.rgb+col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_SUB".endl()+"   return vec4(base.rgb-col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_MUL".endl()+"   return vec4(base.rgb*col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_DIV".endl()+"   return vec4(base.rgb/col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifndef BM_MATH".endl()+"vec3 colNew=_blend(base.rgb,col.rgb);".endl()+"float newA=clamp(base.a+(col.a*amount),0.,1.);".endl()+"#ifdef BM_ALPHAMASKED".endl()+"newA=base.a;".endl()+"#endif".endl()+"return vec4(".endl()+"mix(colNew,base.rgb,1.0-(amount*col.a)),".endl()+"newA);".endl()+"#endif".endl()+"}".endl();return t};v.onChangeBlendSelect=function(e,t,i=false){t=String(t);e.toggleDefine("BM_NORMAL",t=="normal");e.toggleDefine("BM_MULTIPLY",t=="multiply");e.toggleDefine("BM_MULTIPLY_INV",t=="multiply invert");e.toggleDefine("BM_AVERAGE",t=="average");e.toggleDefine("BM_ADD",t=="add");e.toggleDefine("BM_SUBTRACT_ONE",t=="subtract one");e.toggleDefine("BM_SUBTRACT",t=="subtract");e.toggleDefine("BM_DIFFERENCE",t=="difference");e.toggleDefine("BM_NEGATION",t=="negation");e.toggleDefine("BM_EXCLUSION",t=="exclusion");e.toggleDefine("BM_LIGHTEN",t=="lighten");e.toggleDefine("BM_DARKEN",t=="darken");e.toggleDefine("BM_OVERLAY",t=="overlay");e.toggleDefine("BM_SCREEN",t=="screen");e.toggleDefine("BM_SOFTLIGHT",t=="softlight");e.toggleDefine("BM_HARDLIGHT",t=="hardlight");e.toggleDefine("BM_COLORDODGE",t=="color dodge");e.toggleDefine("BM_COLORBURN",t=="color burn");e.toggleDefine("BM_MATH_ADD",t=="Math Add");e.toggleDefine("BM_MATH_SUB",t=="Math Subtract");e.toggleDefine("BM_MATH_MUL",t=="Math Multiply");e.toggleDefine("BM_MATH_DIV",t=="Math Divide");e.toggleDefine("BM_MATH",t.indexOf("Math ")==0);e.toggleDefine("BM_ALPHAMASKED",i)};v.AddBlendSelect=function(e,t,i){const r=e.inValueSelect(t||"Blend Mode",["normal","lighten","darken","multiply","multiply invert","average","add","subtract","difference","negation","exclusion","overlay","screen","color dodge","color burn","softlight","hardlight","subtract one","Math Add","Math Subtract","Math Multiply","Math Divide"],i||"normal");return r};v.AddBlendAlphaMask=function(e,t,i){const r=e.inSwitch(t||"Alpha Mask",["Off","On"],i||"Off");return r};v.setupBlending=function(i,r,n,e,s){const t=()=>{let e=false;if(s)e=s.get()=="On";v.onChangeBlendSelect(r,n.get(),e);let t=n.get();if(t=="normal")t=null;else if(t=="multiply")t="mul";else if(t=="multiply invert")t="mulinv";else if(t=="lighten")t="light";else if(t=="darken")t="darken";else if(t=="average")t="avg";else if(t=="subtract one")t="sub one";else if(t=="subtract")t="sub";else if(t=="difference")t="diff";else if(t=="negation")t="neg";else if(t=="exclusion")t="exc";else if(t=="overlay")t="ovl";else if(t=="color dodge")t="dodge";else if(t=="color burn")t="burn";else if(t=="softlight")t="soft";else if(t=="hardlight")t="hard";else if(t=="Math Add")t="+";else if(t=="Math Subtract")t="-";else if(t=="Math Multiply")t="*";else if(t=="Math Divide")t="/";i.setUiAttrib({extendTitle:t})};i.setPortGroup("Blending",[n,e,s]);let a=false;n.onChange=t;if(s){s.onChange=t;a=s.get()=="On"}v.onChangeBlendSelect(r,n.get(),a)};const fa={"CGL.BLENDMODES":function(){this.name="blendmodes";this.srcHeadFrag=v.getBlendCode()},"CGL.BLENDMODES3":function(){this.name="blendmodes3";this.srcHeadFrag=v.getBlendCode(3)},"CGL.LUMINANCE":function(){this.name="luminance";this.srcHeadFrag="".endl()+"float cgl_luminance(vec3 c)".endl()+"{".endl()+"    return dot(vec3(0.2126,0.7152,0.0722),c);".endl()+"}".endl()},"CGL.RANDOM_OLD":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 432758.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_LOW":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 358.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_TEX":function(){this.name="randomNumbertex";this.srcHeadFrag="".endl()+"UNI sampler2D CGLRNDTEX;".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).r;".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).rgb;".endl()+"}";this.initUniforms=function(e){return[new m(e,"t","CGLRNDTEX",7)]};this.onBind=function(e,t){E.getRandomTexture(e);e.setTexture(7,E.getRandomTexture(e).tex)}}};const ga="{{MODULES_HEAD}}\nIN vec3 vPosition; //!@\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    gl_PointSize=10.0;\n\n    {{MODULE_VERTEX_POSITION}}\n\n    mat4 modelViewMatrix=viewMatrix*mMatrix;\n    {{MODULE_VERTEX_MODELVIEW}}\n\n    gl_Position = projMatrix * modelViewMatrix * pos;\n}\n";let da=0;function S(){return ga}function M(e,t,i){if(e==undefined){e=.5;t=.5;i=.5}return""+O+"IN vec2 texCoord;"+O+"{{MODULES_HEAD}}"+O+"void main()"+O+"{"+O+"    vec4 col=vec4("+e+","+t+","+i+",1.0);"+O+"    {{MODULE_COLOR}}"+O+"    outColor = col;"+O+"}"}class x extends ra{_uniforms=[];constructor(e,t,i){super();if(!e)throw new Error("shader constructed without cgl "+t);this._log=new h.Logger("cgl_shader");this._cgl=e;if(!t)this._log.stack("no shader name given");this._name=t||"unknown";if(i)this.opId=i.id;this.glslVersion=0;if(e.glVersion>1)this.glslVersion=300;this._materialId=++da;this._program=null;this._drawBuffers=[true];this.error=null;this.ignoreMissingUniforms=false;this._projMatrixUniform=null;this._mvMatrixUniform=null;this._mMatrixUniform=null;this._vMatrixUniform=null;this._camPosUniform=null;this._normalMatrixUniform=null;this._inverseViewMatrixUniform=null;this._fromUserInteraction=false;this._attrVertexPos=-1;this.precision=e.patch.config.glslPrecision||"highp";this._pMatrixState=-1;this._vMatrixState=-1;this._countMissingUniforms=0;this._modGroupCount=0;this._feedBackNames=[];this._attributes=[];this.glPrimitive=null;this.offScreenPass=false;this._extensions=[];this.srcVert=S();this.srcFrag=M();this.lastCompile=0;this._libs=[];this._structNames=[];this._structUniformNames=[];this._textureStackUni=[];this._textureStackTex=[];this._textureStackType=[];this._textureStackTexCgl=[];this._tempNormalMatrix=r();this._tempCamPosMatrix=r();this._tempInverseViewMatrix=r();this._tempInverseProjMatrix=r();this.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_NORMAL","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"])}isValid(){return this._isValid}getCgl(){return this._cgl}getName(){return this._name}enableExtension(e){this.setWhyCompile("enable extension "+e);this._extensions.push(e)}getAttrVertexPos(){return this._attrVertexPos}hasTextureUniforms(){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getType()=="t")return true;return false}copyUniformValues(t){for(let e=0;e<t._uniforms.length;e++){if(!this._uniforms[e]){this._log.log("unknown uniform?!");continue}this.getUniform(t._uniforms[e].getName()).set(t._uniforms[e].getValue())}this.popTextures();for(let e=0;e<t._textureStackUni.length;e++){this._textureStackUni[e]=t._textureStackUni[e];this._textureStackTex[e]=t._textureStackTex[e];this._textureStackType[e]=t._textureStackType[e];this._textureStackTexCgl[e]=t._textureStackTexCgl[e]}}copy(){const t=new x(this._cgl,this._name+" copy");t.setSource(this.srcVert,this.srcFrag);t._modules=JSON.parse(JSON.stringify(this._modules));t._defines=JSON.parse(JSON.stringify(this._defines));t._modGroupCount=this._modGroupCount;t._moduleNames=this._moduleNames;t.glPrimitive=this.glPrimitive;t.offScreenPass=this.offScreenPass;t._extensions=this._extensions;t.wireframe=this.wireframe;t._attributes=this._attributes;for(let e=0;e<this._uniforms.length;e++){const i=this._uniforms[e].copy(t);i.resetLoc()}t.setWhyCompile("copy");return t}setSource(e,t,i=false){this._fromUserInteraction=i;this.srcVert=e;this.srcFrag=t;this.setWhyCompile("Source changed");this._isValid=true}_addLibs(e){for(const t in fa){if(e.includes(t)){const i=new fa[t];e=e.replace("{{"+t+"}}",i.srcHeadFrag);this._libs.push(i);if(i.initUniforms)i.initUniforms(this)}}return e}createStructUniforms(){let r="";let n="";this._structNames=[];this._injectedStringsFrag={};this._injectedStringsVert={};this._structUniformNamesIndicesFrag=[];this._structUniformNamesIndicesVert=[];for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].isStructMember()){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";if(!this._structNames.includes(this._uniforms[i]._structName)){const a="struct "+this._uniforms[i]._structName+" {"+O+s+"};"+O+O;if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="frag")r=r.concat(a);if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="vert")n=n.concat(a);this._structNames.push(this._uniforms[i]._structName);this._injectedStringsFrag[this._uniforms[i]._structName]=[];this._injectedStringsVert[this._uniforms[i]._structName]=[]}let e="";if(this._uniforms[i].comment)e=" // "+this._uniforms[i].comment;let t="";if(this._uniforms[i].getGlslTypeString()==undefined)t+="//";t+="  "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i]._propertyName+";"+e;if(this._uniforms[i].getShaderType()==="both"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)&&!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const o=r.lastIndexOf(s);const l=n.lastIndexOf(s);r=r.slice(0,o)+t+r.slice(o-1);n=n.slice(0,l)+t+n.slice(l-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i);if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}else if(this._uniforms[i].getShaderType()==="frag"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)){const o=r.lastIndexOf(s);r=r.slice(0,o)+t+r.slice(o-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i)}else if(this._uniforms[i].getShaderType()==="vert"){if(!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const l=n.lastIndexOf(s);n=n.slice(0,l)+t+n.slice(l-1);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}}}this._uniDeclarationsFrag=[];this._uniDeclarationsVert=[];for(let e=0;e<this._structUniformNamesIndicesFrag.length;e+=1){const t=this._structUniformNamesIndicesFrag[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+O;if(!this._uniDeclarationsFrag.includes(i)){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";r=r.replace(s,"");r+=i;this._uniDeclarationsFrag.push(i)}}for(let e=0;e<this._structUniformNamesIndicesVert.length;e+=1){const t=this._structUniformNamesIndicesVert[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+O;if(!this._uniDeclarationsVert.includes(i)){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";n=n.replace(s,"");n+=i;this._uniDeclarationsVert.push(i)}}return[n,r]}_getAttrSrc(e,t){const i={};if(e.name&&e.type){i.srcHeadVert="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.name+O;i.srcHeadVert+="#define ATTRIB_"+e.name+O;i.srcHeadVert+="IN "+e.type+" "+e.name+";"+O;if(!t)i.srcHeadVert+="#endif"+O;if(e.nameFrag){i.srcHeadVert+="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.nameFrag+O;i.srcHeadVert+="#define ATTRIB_"+e.nameFrag+O;i.srcHeadVert+="OUT "+e.type+" "+e.nameFrag+";"+O;if(!t)i.srcHeadVert+="#endif"+O;i.srcVert=""+O+e.nameFrag+"="+e.name+";";i.srcHeadFrag="";if(!t)i.srcHeadFrag+="#ifndef ATTRIB_"+e.nameFrag+O;i.srcHeadFrag+="#define ATTRIB_"+e.nameFrag+O;i.srcHeadFrag+="IN "+e.type+" "+e.nameFrag+";"+O;if(!t)i.srcHeadFrag+="#endif"+O}}return i}compile(){if(this._cgl.aborted)return;const e=performance.now();this._cgl.profileData.profileShaderCompiles++;this._cgl.profileData.profileShaderCompileName=this._name+" ["+this._compileReason+"]";let t="";if(this._extensions)for(let e=0;e<this._extensions.length;e++)t+="#extension "+this._extensions[e]+" : enable"+O;let i="";if(this._defines.length)i="\n// cgl generated"+O;for(let e=0;e<this._defines.length;e++)i+="#define "+this._defines[e][0]+" "+this._defines[e][1]+""+O;const r=this.createStructUniforms();this._cgl.profileData.addHeavyEvent("shader compile",this._name+" ["+this._compileReason+"]");this._compileReason="";if(this._uniforms){const p=this._uniforms.map(e=>{return e._name});const _=[];for(let e=0;e<this._uniforms.length;e++){const b=this._uniforms[e];const v=p.indexOf(b._name,e+1);if(v>-1)_.push(e)}for(let e=this._uniforms.length-1;e>=0;e-=1){if(_.includes(e))this._uniforms.splice(e,1);else this._uniforms[e].resetLoc()}}this._cgl.printError("uniform resets");this._compileCount++;if(this.hasTextureUniforms())i+="#define HAS_TEXTURES"+O;let n="";let s="";if(!this.srcFrag){this._log.warn("[cgl shader] has no fragment source!",this._name,this);this.srcVert=S();this.srcFrag=M()}n="#version 300 es"+O+"// "+O+"// vertex shader "+this._name+O+"// "+O+"precision "+this.precision+" float;"+O+"precision "+this.precision+" sampler2D;"+O+""+O+"#define WEBGL2"+O+"#define texture2D texture"+O+"#define UNI uniform"+O+"#define IN in"+O+"#define OUT out"+O;s="#version 300 es"+O+"// "+O+"// fragment shader "+this._name+O+"// "+O+"precision "+this.precision+" float;"+O+"precision "+this.precision+" sampler2D;"+O+""+O+"#define WEBGL2"+O+"#define texture2D texture"+O+"#define IN in"+O+"#define OUT out"+O+"#define UNI uniform"+O+"{{DRAWBUFFER}}"+O;let a="\n// cgl generated"+O;let o="\n// cgl generated"+O;s+="\n// active mods: --------------- ";n+="\n// active mods: --------------- ";let l=false;let u=false;for(let t=0;t<this._moduleNames.length;t++){for(let e=0;e<this._modules.length;e++){if(this._modules[e].name==this._moduleNames[t]){if(this._modules[e].srcBodyFrag||this._modules[e].srcHeadFrag){l=true;s+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")"}if(this._modules[e].srcBodyVert||this._modules[e].srcHeadVert){n+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")";u=true}}}}if(!u)s+="\n// no mods used...";if(!l)s+="\n// no mods used...";s+="\n";n+="\n";for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].shaderType&&!this._uniforms[i].isStructMember()){let e="";if(!this._uniforms[i].getGlslTypeString())e+="// ";e+="UNI "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName();let t="";if(this._uniforms[i].comment)t=" // "+this._uniforms[i].comment;if(this._uniforms[i].shaderType=="vert"||this._uniforms[i].shaderType=="both")if(!this.srcVert.includes(e)&&!this.srcVert.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))a+=e+";"+t+O;if(this._uniforms[i].shaderType=="frag"||this._uniforms[i].shaderType=="both")if(!this.srcFrag.includes(e)&&!this.srcFrag.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))o+=e+";"+t+O}}let h=0;let c=0;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].shaderType&&!this._uniforms[e].isStructMember()){if(this._uniforms[e].shaderType=="vert"||this._uniforms[e].shaderType=="both")c++;if(this._uniforms[e].shaderType=="frag"||this._uniforms[e].shaderType=="both")h++}}if(h>=this._cgl.maxUniformsFrag)this._log.warn("[cgl_shader] num uniforms frag: "+h+" / "+this._cgl.maxUniformsFrag);if(c>=this._cgl.maxUniformsVert)this._log.warn("[cgl_shader] num uniforms vert: "+c+" / "+this._cgl.maxUniformsVert);if(!s.includes("precision"))s="precision "+this.precision+" float;"+O+s;if(!n.includes("precision"))n="precision "+this.precision+" float;"+O+n;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){s+="#define MOBILE"+O;n+="#define MOBILE"+O}n=t+n+i+r[0]+a+"\n// -- \n"+this.srcVert;s=t+s+i+r[1]+o+"\n// -- \n"+this.srcFrag;let f="";let g="";this._modules.sort(function(e,t){return e.priority||0-t.priority||0});let d=false;for(let r=0;r<this._moduleNames.length;r++){let t="";let i="";if(!d){d=true;for(let e=0;e<this._attributes.length;e++){const x=this._getAttrSrc(this._attributes[e],true);if(x.srcHeadVert)f+=x.srcHeadVert;if(x.srcVert)t+=x.srcVert;if(x.srcHeadFrag)g+=x.srcHeadFrag}}for(let e=0;e<this._modules.length;e++){const E=this._modules[e];if(E.name==this._moduleNames[r]){f+="\n//---- MOD: group:"+E.group+": idx:"+e+" - prfx:"+E.prefix+" - "+E.title+" ------\n";g+="\n//---- MOD: group:"+E.group+": idx:"+e+" - prfx:"+E.prefix+" - "+E.title+" ------\n";t+="\n\n//---- MOD: "+E.title+" / "+E.priority+" ------\n";i+="\n\n//---- MOD: "+E.title+" / "+E.priority+" ------\n";if(E.attributes)for(let e=0;e<E.attributes.length;e++){const x=this._getAttrSrc(E.attributes[e],false);if(x.srcHeadVert)f+=x.srcHeadVert;if(x.srcVert)t+=x.srcVert;if(x.srcHeadFrag)g+=x.srcHeadFrag}f+=E.srcHeadVert||"";g+=E.srcHeadFrag||"";t+=E.srcBodyVert||"";i+=E.srcBodyFrag||"";f+="\n//---- end mod ------\n";g+="\n//---- end mod ------\n";t+="\n//---- end mod ------\n";i+="\n//---- end mod ------\n";t=t.replace(/{{mod}}/g,E.prefix);i=i.replace(/{{mod}}/g,E.prefix);f=f.replace(/{{mod}}/g,E.prefix);g=g.replace(/{{mod}}/g,E.prefix);t=t.replace(/MOD_/g,E.prefix);i=i.replace(/MOD_/g,E.prefix);f=f.replace(/MOD_/g,E.prefix);g=g.replace(/MOD_/g,E.prefix)}}n=n.replace("{{"+this._moduleNames[r]+"}}",t);s=s.replace("{{"+this._moduleNames[r]+"}}",i)}n=n.replace("{{MODULES_HEAD}}",f);s=s.replace("{{MODULES_HEAD}}",g);n=this._addLibs(n);s=this._addLibs(s);let m="";for(let e=0;e<16;e++)if(s.includes("outColor"+e))this._drawBuffers[e]=true;if(this._drawBuffers.length==1){m="out vec4 outColor;"+O;m+="#define gl_FragColor outColor"+O}else{m+="#define MULTI_COLORTARGETS"+O;m+="vec4 outColor;"+O;let t=0;for(let e=0;e<this._drawBuffers.length;e++){if(t==0)m+="#define gl_FragColor outColor"+e+""+O;m+="layout(location = "+e+") out vec4 outColor"+e+";"+O;t++}}s=s.replace("{{DRAWBUFFER}}",m);if(!this._program){this._program=this._createProgram(n,s)}else{this._program=this._createProgram(n,s);this._projMatrixUniform=null;for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].resetLoc()}this.finalShaderFrag=s;this.finalShaderVert=n;I.lastMesh=null;I.lastShader=null;this._countMissingUniforms=0;this._needsRecompile=false;this.lastCompile=(0,A.now)();this._cgl.profileData.shaderCompileTime+=performance.now()-e}bind(){if(!this._isValid||this._cgl.aborted)return;I.lastShader=this;if(!this._program||this.needsRecompile())this.compile();if(!this._isValid)return;if(!this._projMatrixUniform&&!this.ignoreMissingUniforms){this._countMissingUniforms++;if(this._countMissingUniforms<10){this._projMatrixUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_PROJMAT);this._attrVertexPos=this._cgl.glGetAttribLocation(this._program,d.SHADER.SHADERVAR_VERTEX_POSITION);this._mvMatrixUniform=this._cgl.gl.getUniformLocation(this._program,"mvMatrix");this._vMatrixUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_VIEWMAT);this._mMatrixUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_MODELMAT);this._camPosUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_VIEWPOS);this._normalMatrixUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_NORMALMAT);this._inverseViewMatrixUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_INVVIEWMAT);this._inverseProjMatrixUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_INVPROJMAT);this._materialIdUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_MATERIALID);this._objectIdUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_OBJECTID);for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].needsUpdate=true}}if(this._cgl.currentProgram!=this._program){this._cgl.profileData.profileShaderBinds++;this._cgl.gl.useProgram(this._program);this._cgl.currentProgram=this._program}for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].needsUpdate)this._uniforms[e].updateValue();if(this._pMatrixState!=this._cgl.getProjectionMatrixStateCount()){this._pMatrixState=this._cgl.getProjectionMatrixStateCount();this._cgl.gl.uniformMatrix4fv(this._projMatrixUniform,false,this._cgl.pMatrix);this._cgl.profileData.profileMVPMatrixCount++}if(this._objectIdUniform)this._cgl.gl.uniform1f(this._objectIdUniform,++this._cgl.tempData.objectIdCounter);if(this._materialIdUniform)this._cgl.gl.uniform1f(this._materialIdUniform,this._materialId);if(this._vMatrixUniform){if(this._vMatrixState!=this._cgl.getViewMatrixStateCount()){this._cgl.gl.uniformMatrix4fv(this._vMatrixUniform,false,this._cgl.vMatrix);this._cgl.profileData.profileMVPMatrixCount++;this._vMatrixState=this._cgl.getViewMatrixStateCount();if(this._inverseViewMatrixUniform){t(this._tempInverseViewMatrix,this._cgl.vMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseViewMatrixUniform,false,this._tempInverseViewMatrix);this._cgl.profileData.profileMVPMatrixCount++}if(this._inverseProjMatrixUniform){t(this._tempInverseProjMatrix,this._cgl.pMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseProjMatrixUniform,false,this._tempInverseProjMatrix);this._cgl.profileData.profileMVPMatrixCount++}}this._cgl.gl.uniformMatrix4fv(this._mMatrixUniform,false,this._cgl.mMatrix);this._cgl.profileData.profileMVPMatrixCount++;if(this._camPosUniform){t(this._tempCamPosMatrix,this._cgl.vMatrix);this._cgl.gl.uniform3f(this._camPosUniform,this._tempCamPosMatrix[12],this._tempCamPosMatrix[13],this._tempCamPosMatrix[14]);this._cgl.profileData.profileMVPMatrixCount++}}else{const e=r();fi(e,this._cgl.vMatrix,this._cgl.mMatrix);this._cgl.gl.uniformMatrix4fv(this._mvMatrixUniform,false,e);this._cgl.profileData.profileMVPMatrixCount++}if(this._normalMatrixUniform){t(this._tempNormalMatrix,this._cgl.mMatrix);Rt(this._tempNormalMatrix,this._tempNormalMatrix);this._cgl.gl.uniformMatrix4fv(this._normalMatrixUniform,false,this._tempNormalMatrix);this._cgl.profileData.profileMVPMatrixCount++}for(let e=0;e<this._libs.length;e++){if(this._libs[e].onBind)this._libs[e].onBind.bind(this._libs[e])(this._cgl,this)}this._bindTextures();return this._isValid}unBind(){}dispose(){if(this._program&&this._cgl&&this._cgl.gl)this._cgl.gl.deleteProgram(this._program);this._program=null}setDrawBuffers(e){this._log.warn("useless drawbuffers...?!")}getUniforms(){return this._uniforms}getUniform(t){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getName()==t)return this._uniforms[e];return null}removeAllUniforms(){this._uniforms=[]}_addUniform(e){this._uniforms.push(e);this.setWhyCompile("add uniform "+name)}addUniformFrag(e,t,i,r,n,s){const a=new m(this,e,t,i,r,n,s);a.shaderType="frag";return a}addUniformVert(e,t,i,r,n,s){const a=new m(this,e,t,i,r,n,s);a.shaderType="vert";return a}addUniformBoth(e,t,i,r,n,s){const a=new m(this,e,t,i,r,n,s);a.shaderType="both";return a}addUniformStructFrag(t,i,r){const n={};if(!r)return n;for(let e=0;e<r.length;e+=1){const s=r[e];if(!this.hasUniform(i+"."+s.name)){const a=new m(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="frag";n[i+"."+s.name]=a}}return n}addUniformStructVert(t,i,r){const n={};if(!r)return n;for(let e=0;e<r.length;e+=1){const s=r[e];if(!this.hasUniform(i+"."+s.name)){const a=new m(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="vert";n[i+"."+s.name]=a}}return n}addUniformStructBoth(t,i,r){const n={};if(!r)return n;for(let e=0;e<r.length;e+=1){const s=r[e];if(s.type==="2i"||s.type==="i"||s.type==="3i")this._log.error("Adding an integer struct member to both shaders can potentially error. Please use different structs for each shader. Error occured in struct:",t," with member:",s.name," of type:",s.type,".");if(!this.hasUniform(i+"."+s.name)){const a=new m(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="both";n[i+"."+s.name]=a}}return n}_createProgram(e,t){this._cgl.printError("before _createprogram");const i=this._cgl.gl.createProgram();this.vshader=x.createShader(this._cgl,e,this._cgl.gl.VERTEX_SHADER,this);this.fshader=x.createShader(this._cgl,t,this._cgl.gl.FRAGMENT_SHADER,this);if(this.vshader&&this.fshader){this._cgl.gl.attachShader(i,this.vshader);this._cgl.gl.attachShader(i,this.fshader);this._linkProgram(i,e,t)}else{this._isValid=false;this._cgl.printError("shader _createProgram");this._log.error("could not link shaderprogram");return null}this._cgl.printError("shader _createProgram");return i}hasErrors(){return this._hasErrors}_linkProgram(e,t,i){this._cgl.printError("before _linkprogram");if(this._feedBackNames.length>0){this._cgl.gl.transformFeedbackVaryings(e,this._feedBackNames,this._cgl.gl.SEPARATE_ATTRIBS)}this._cgl.gl.linkProgram(e);this._cgl.printError("gl.linkprogram");this._isValid=true;this._hasErrors=false;if(this._cgl.patch.config.glValidateShader!==false){this._cgl.gl.validateProgram(e);if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.VALIDATE_STATUS)){this._log.log("shaderprogram validation failed...");this._cgl.gl.getProgramInfoLog(e)}if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.LINK_STATUS)){this._hasErrors=true;const r=this._cgl.gl.getShaderInfoLog(this.fshader);const n=this._cgl.gl.getShaderInfoLog(this.vshader);if(this.logError)this._log.error(this._name+" shader linking fail...");else this._log.warn(this._name+" shader linking fail...");if(r)this._log.warn(this._cgl.gl.getShaderInfoLog(this.fshader));if(n)this._log.warn(this._cgl.gl.getShaderInfoLog(this.vshader));this._cgl.gl.getProgramInfoLog(e);if(!CABLES.UI)this._log.log(this);this._isValid=false;this._cgl.printError("shader link err")}}}getProgram(){return this._program}setFeedbackNames(e){this.setWhyCompile("setFeedbackNames");this._feedBackNames=e}addAttribute(t){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t.name&&this._attributes[e].nameFrag==t.nameFrag)return}this._attributes.push(t);this.setWhyCompile("addAttribute")}bindTextures(){this._bindTextures()}_bindTextures(){if(this._textureStackTex.length>this._cgl.maxTextureUnits){this._log.warn("[shader._bindTextures] too many textures bound",this._textureStackTex.length+"/"+this._cgl.maxTextureUnits)}for(let i=0;i<this._textureStackTex.length;i++){if(!this._textureStackTex[i]&&!this._textureStackTexCgl[i]){this._log.warn("no texture for pushtexture",this._name)}else{let e=this._textureStackTex[i];if(this._textureStackTexCgl[i]){e=this._textureStackTexCgl[i].tex||CGL.Texture.getEmptyTexture(this._cgl).tex}let t=true;if(!this._textureStackUni[i]){this._log.warn("no uniform for pushtexture",this._name);t=this._cgl.setTexture(i,e,this._textureStackType[i])}else{this._textureStackUni[i].setValue(i);t=this._cgl.setTexture(i,e,this._textureStackType[i])}if(!t)this._log.warn("tex bind failed",this.getName(),this._textureStackUni[i])}}}setUniformTexture(t,i){i=i||E.getTempTexture(this._cgl);for(let e=0;e<this._textureStackUni.length;e++)if(this._textureStackUni[e]==t){const r=this._textureStackTex[e]||this._textureStackTexCgl[e];if(i.hasOwnProperty("tex")){this._textureStackTexCgl[e]=i;this._textureStackTex[e]=null}else{this._textureStackTexCgl[e]=null;this._textureStackTex[e]=i}return r}return null}pushTexture(e,t,i){if(!e){return}if(!t){return}if(!t.hasOwnProperty("tex")&&!(t instanceof WebGLTexture)){this._log.warn(new Error("invalid texture").stack);this._log.warn("[cgl_shader] invalid texture...",t);return}this._textureStackUni.push(e);if(t.hasOwnProperty("tex")){this._textureStackTexCgl.push(t);this._textureStackTex.push(null)}else{this._textureStackTexCgl.push(null);this._textureStackTex.push(t)}this._textureStackType.push(i)}popTexture(){this._textureStackUni.pop();this._textureStackTex.pop();this._textureStackTexCgl.pop();this._textureStackType.pop()}popTextures(){this._textureStackTex.length=this._textureStackTexCgl.length=this._textureStackType.length=this._textureStackUni.length=0}getMaterialId(){return this._materialId}getInfo(){const e={};e.name=this._name;e.defines=this.getDefines();e.hasErrors=this.hasErrors();return e}getDefaultFragmentShader(e,t,i,r){return M(e,t,i,r)}getDefaultVertexShader(){return S()}}x.getDefaultVertexShader=S;x.getDefaultFragmentShader=M;x.getErrorFragmentShader=function(){return""+O+"void main()"+O+"{"+O+"   float g=mod((gl_FragCoord.y+gl_FragCoord.x),50.0)/50.0;"+O+"   g= step(0.1,g);"+O+"   outColor = vec4( g+0.5, 0.0, 0.0, 1.0);"+O+"}"};x.createShader=function(e,t,i,r){if(e.aborted)return;const n=e.gl.createShader(i);e.gl.shaderSource(n,t);e.gl.compileShader(n);if(!e.gl.getShaderParameter(n,e.gl.COMPILE_STATUS)){r.error={str:t,infoLog:e.gl.getShaderInfoLog(n)};if(CABLES.UI)gui.emitEvent("ShaderError",r);if(!r.error.infoLog){r._log.warn("empty shader info log",this._name);return}r.setSource(x.getDefaultVertexShader(),x.getErrorFragmentShader())}return n};class ma extends A.RenderLoop{#patch;#cgl;#renderOneFrame;#animReq;frameNum=0;onOneFrameRendered=null;_frameNext=0;_frameInterval=0;_lastFrameTime=0;reqAnimTimeStamp=0;_frameWasdelayed=true;aborted=false;constructor(e,t){super();this.#cgl=e;this.#patch=t;this.#patch.renderloop=this;this.exec(0)}exec(e){cancelAnimationFrame(this.#animReq);this.#patch.config.fpsLimit=this.#patch.config.fpsLimit||0;if(this.#patch.config.fpsLimit){this._frameInterval=1e3/this.#patch.config.fpsLimit}const t=CABLES.now();const i=t-this._frameNext;if(this.#patch.isEditorMode()){if(!this.#renderOneFrame){if(t-this._lastFrameTime>=500&&this._lastFrameTime!==0&&!this._frameWasdelayed){this._lastFrameTime=0;setTimeout(this.exec.bind(this),500);this.emitEvent("renderDelayStart");this._frameWasdelayed=true;return}}}if(this.#renderOneFrame||this.#patch.config.fpsLimit===0||i>this._frameInterval||this._frameWasdelayed){this.renderFrame(e);if(this._frameInterval)this._frameNext=t-i%this._frameInterval}if(this._frameWasdelayed){this.emitEvent("renderDelayEnd");this._frameWasdelayed=false}if(this.#renderOneFrame){if(this.onOneFrameRendered)this.onOneFrameRendered();this.emitEvent(A.Patch.EVENT_RENDERED_ONE_FRAME);this._renderOneFrame=false}if(this.#patch.config.doRequestAnimation){this.#animReq=this.#patch.getDocument().defaultView.requestAnimationFrame(this.exec.bind(this))}}renderFrame(e){const t=this.#patch.timer.getTime();const i=performance.now();this.#cgl.frameStartTime=this.#patch.timer.getTime();const r=e-this.reqAnimTimeStamp||e;this.#patch.updateAnims(null,r,e);this.#cgl.profileData.profileFrameDelta=r;this.reqAnimTimeStamp=e;this.#cgl.profileData.profileOnAnimFrameOps=performance.now()-i;this.#patch.emitEvent(A.Patch.EVENT_RENDER_FRAME,t);this.frameNum++;if(this.frameNum==1){if(this.#patch.config.onFirstFrameRendered)this.#patch.config.onFirstFrameRendered()}}pause(){cancelAnimationFrame(this.#animReq);this.#animReq=null;this.paused=true}resume(){cancelAnimationFrame(this.#animReq);this.paused=false;this.exec(0)}}const pa={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};class _a extends ia{#cursor="auto";frameStartTime=0;constructor(e){super(e);this.gApi=ia.API_WEBGL;this.aborted=false;e.cgl=this;this.pushMvMatrix=this.pushModelMatrix;this.popMvMatrix=this.popmMatrix=this.popModelMatrix;this._log=new h.Logger("cgl_context",{onError:e.config.onError});this.glVersion=0;this.glUseHalfFloatTex=false;this.clearCanvasTransparent=true;this.clearCanvasDepth=true;this.debugOneFrame=false;this.checkGlErrors=false;this.maxTextureUnits=0;this.maxVaryingVectors=0;this.currentProgram=null;this._hadStackError=false;this.glSlowRendere=false;this._isSafariCrap=false;this.temporaryTexture=null;this.gl=null;this.#cursor="auto";this._currentCursor="";this._viewPortStack=[];this._glFrameBufferStack=[];this._frameBufferStack=[];this._shaderStack=[];this._stackDepthTest=[];this.mainloopOp=null;this._stackBlendMode=[];this._stackBlendModePremul=[];this._stackBlend=[];this._stackDepthFunc=[];this._stackCullFaceFacing=[];this._stackCullFace=[];this._stackDepthWrite=[];this._stackDepthTest=[];this._stackStencil=[];this._simpleShader=new x(this,"simpleshader");this._simpleShader.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"]);this._simpleShader.setSource(x.getDefaultVertexShader(),x.getDefaultFragmentShader());this._currentShader=this._simpleShader;this._oldCanvasWidth=-1;this._oldCanvasHeight=-1;this._enabledExtensions={};this.errorShader=null;this.setCanvas(e.config.glCanvasId||e.config.glCanvas||"glcanvas");if(e.config.glCanvasResizeToWindow===true)this.setAutoResize("window");if(e.config.glCanvasResizeToParent===true)this.setAutoResize("parent");if(this.aborted)e.aborted=true;e.on(A.Patch.EVENT_DISPOSE,()=>{this.dispose()});e.on("patchClearStart",()=>{this.TextureEffectMesh=null});this.renderLoop=new ma(this,e)}get viewPort(){if(this._viewPortStack.length>3){const e=this._viewPortStack.length;return[this._viewPortStack[e-4],this._viewPortStack[e-3],this._viewPortStack[e-2],this._viewPortStack[e-1]]}else{return this._viewPort}}get mvMatrix(){return this.mMatrix}set mvMatrix(e){this.mMatrix=e}_setCanvas(e){if(!e)this._log.stack("_setCanvas undef");if(!this.patch.config.canvas)this.patch.config.canvas={};if(!this.patch.config.canvas.hasOwnProperty("preserveDrawingBuffer"))this.patch.config.canvas.preserveDrawingBuffer=true;if(!this.patch.config.canvas.hasOwnProperty("premultipliedAlpha"))this.patch.config.canvas.premultipliedAlpha=false;if(!this.patch.config.canvas.hasOwnProperty("alpha"))this.patch.config.canvas.alpha=false;this.patch.config.canvas.stencil=true;if(this.patch.config.hasOwnProperty("clearCanvasColor"))this.clearCanvasTransparent=this.patch.config.clearCanvasColor;if(this.patch.config.hasOwnProperty("clearCanvasDepth"))this.clearCanvasDepth=this.patch.config.clearCanvasDepth;if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){this._isSafariCrap=true;this.glUseHalfFloatTex=true}if(!this.patch.config.canvas.forceWebGl1)this.gl=e.getContext("webgl2",this.patch.config.canvas);if(!this.gl||this.gl.isContextLost()){this.aborted=true;this._log.error("NO_WEBGL","sorry, could not initialize WebGL. Please check if your Browser supports WebGL or try to restart your browser.");return}if(this.gl.getParameter(this.gl.VERSION)!="WebGL 1.0"){this.glVersion=2}else{this.gl=e.getContext("webgl",this.patch.config.canvas)||e.getContext("experimental-webgl",this.patch.config.canvas);this.glVersion=1;if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){if(!this.patch.config.canvas.hasOwnProperty("powerPreference"))this.patch.config.canvas.powerPreference="high-performance"}this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}const t=this.enableExtension("WEBGL_debug_renderer_info");if(t){this.glRenderer=this.gl.getParameter(t.UNMASKED_RENDERER_WEBGL);if(this.glRenderer==="Google SwiftShader")this.glSlowRenderer=true}this.canvas.addEventListener("webglcontextlost",e=>{if(this.aborted)return this._log.warn("[cgl_state] aborted context lost... can be ignored...");this._log.error("canvas lost...",e);this.emitEvent("webglcontextlost");this.aborted=true});this.maxAnisotropic=0;if(this.enableExtension("EXT_texture_filter_anisotropic"))this.maxAnisotropic=this.gl.getParameter(this.enableExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.maxVaryingVectors=this.gl.getParameter(this.gl.MAX_VARYING_VECTORS);this.maxTextureUnits=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS);this.maxTexSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE);this.maxUniformsFrag=this.gl.getParameter(this.gl.MAX_FRAGMENT_UNIFORM_VECTORS);this.maxUniformsVert=this.gl.getParameter(this.gl.MAX_VERTEX_UNIFORM_VECTORS);this.maxSamples=0;if(this.gl.MAX_SAMPLES)this.maxSamples=this.gl.getParameter(this.gl.MAX_SAMPLES);if(this.glVersion==1){this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}this.DEPTH_FUNCS=[this.gl.NEVER,this.gl.ALWAYS,this.gl.LESS,this.gl.LEQUAL,this.gl.GREATER,this.gl.GEQUAL,this.gl.EQUAL,this.gl.NOTEQUAL];this.CULL_MODES=[null,this.gl.BACK,this.gl.FRONT,this.gl.FRONT_AND_BACK]}getInfo(){return{glVersion:this.glVersion,glRenderer:this.glRenderer,glUseHalfFloatTex:this.glUseHalfFloatTex,maxVaryingVectors:this.maxVaryingVectors,maxTextureUnits:this.maxTextureUnits,maxTexSize:this.maxTexSize,maxUniformsFrag:this.maxUniformsFrag,maxUniformsVert:this.maxUniformsVert,maxSamples:this.maxSamples}}popViewPort(){this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();if(this._viewPortStack.length==0)this.setViewPort(0,0,this.canvasWidth,this.canvasHeight);else this.setViewPort(this._viewPortStack[this._viewPort.length-4],this._viewPortStack[this._viewPort.length-3],this._viewPortStack[this._viewPort.length-2],this._viewPortStack[this._viewPort.length-1])}pushViewPort(e,t,i,r){this._viewPortStack.push(e,t,i,r);this.setViewPort(e,t,i,r)}getViewPort(){return this._viewPort}resetViewPort(){this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}setViewPort(e,t,i,r){this._viewPort[0]=Math.round(e);this._viewPort[1]=Math.round(t);this._viewPort[2]=Math.round(i);this._viewPort[3]=Math.round(r);this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}screenShot(t,e,i,r){if(e){this.gl.clearColor(1,1,1,1);this.gl.colorMask(false,false,false,true);this.gl.clear(this.gl.COLOR_BUFFER_BIT);this.gl.colorMask(true,true,true,true)}if(this.canvas&&this.canvas.toBlob){this.canvas.toBlob(e=>{if(t)t(e);else this._log.log("no screenshot callback...")},i,r)}}endFrame(){if(this.patch.isEditorMode())CABLES.GL_MARKER.drawMarkerLayer(this);this.setPreviousShader();if(this._vMatrixStack.length()>0)this.logStackError("view matrix stack length !=0 at end of rendering...");if(this._mMatrixStack.length()>0)this.logStackError("mvmatrix stack length !=0 at end of rendering...");if(this._pMatrixStack.length()>0)this.logStackError("pmatrix stack length !=0 at end of rendering...");if(this._glFrameBufferStack.length>0)this.logStackError("glFrameBuffer stack length !=0 at end of rendering...");if(this._stackDepthTest.length>0)this.logStackError("depthtest stack length !=0 at end of rendering...");if(this._stackDepthWrite.length>0)this.logStackError("depthwrite stack length !=0 at end of rendering...");if(this._stackDepthFunc.length>0)this.logStackError("depthfunc stack length !=0 at end of rendering...");if(this._stackBlend.length>0)this.logStackError("blend stack length !=0 at end of rendering...");if(this._stackBlendMode.length>0)this.logStackError("blendMode stack length !=0 at end of rendering...");if(this._shaderStack.length>0)this.logStackError("this._shaderStack length !=0 at end of rendering...");if(this._stackCullFace.length>0)this.logStackError("this._stackCullFace length !=0 at end of rendering...");if(this._stackCullFaceFacing.length>0)this.logStackError("this._stackCullFaceFacing length !=0 at end of rendering...");if(this._viewPortStack.length>0)this.logStackError("viewport stack length !=0 at end of rendering...");this._frameStarted=false;if(this._oldCanvasWidth!=this.canvasWidth||this._oldCanvasHeight!=this.canvasHeight){this._oldCanvasWidth=this.canvasWidth;this._oldCanvasHeight=this.canvasHeight;this.emitEvent(ia.EVENT_RESIZE)}if(this.#cursor!=this._currentCursor){this._currentCursor=this.canvas.style.cursor=this.#cursor}this.emitEvent("endframe");this.fpsCounter.endFrame()}logStackError(e){if(!this._hadStackError){this._hadStackError=true;this._log.warn("["+this.canvas.id+"]: ",e)}}getShader(){if(this._currentShader)if(!this.tempData||this.tempData.renderOffscreen===true==this._currentShader.offScreenPass===true)return this._currentShader;for(let e=this._shaderStack.length-1;e>=0;e--)if(this._shaderStack[e])if(this.tempData.renderOffscreen==this._shaderStack[e].offScreenPass)return this._shaderStack[e]}getDefaultShader(){return this._simpleShader}setShader(e){this.pushShader(e)}pushShader(t){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){t=this.tempData.forceShaderMods[e].bind(t,false)}}this._shaderStack.push(t);this._currentShader=t}popShader(){this.setPreviousShader()}setPreviousShader(){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){this.tempData.forceShaderMods[e].unbind(false)}}if(this._shaderStack.length===0)throw new Error("Invalid shader stack pop!");this._shaderStack.pop();this._currentShader=this._shaderStack[this._shaderStack.length-1]}pushGlFrameBuffer(e){this._glFrameBufferStack.push(e)}popGlFrameBuffer(){if(this._glFrameBufferStack.length==0)return null;this._glFrameBufferStack.pop();return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}getCurrentGlFrameBuffer(){if(this._glFrameBufferStack.length===0)return null;return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}pushFrameBuffer(e){this._frameBufferStack.push(e)}popFrameBuffer(){if(this._frameBufferStack.length==0)return null;this._frameBufferStack.pop();return this._frameBufferStack[this._frameBufferStack.length-1]}getCurrentFrameBuffer(){if(this._frameBufferStack.length===0)return null;return this._frameBufferStack[this._frameBufferStack.length-1]}renderStart(e,t,i){this.fpsCounter.startFrame();this.pushDepthTest(true);this.pushDepthWrite(true);this.pushDepthFunc(e.gl.LEQUAL);this.pushCullFaceFacing(e.gl.BACK);this.pushCullFace(false);e.setViewPort(0,0,e.canvasWidth,e.canvasHeight);this._startMatrixStacks(t,i);e.pushBlendMode(d.BLEND_MODES.BLEND_NORMAL,false);for(let e=0;e<this._textureslots.length;e++)this._textureslots[e]=null;this.pushShader(this._simpleShader);this._frameStarted=true;this._execOneTimeCallbacks();for(let e=0;e<this._textureslots.length;e++){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(this.gl.TEXTURE_2D,null);this._textureslots[e]=null}this.emitEvent("beginFrame")}renderEnd(e,t=true){this._endMatrixStacks();this.popDepthTest();this.popDepthWrite();this.popDepthFunc();this.popCullFaceFacing();this.popCullFace();this.popBlend();this.popBlendMode();if(t)e.endFrame();this.emitEvent("endFrame")}getTexture(e){return this._textureslots[e]}hasFrameStarted(){return this._frameStarted}checkFrameStarted(e){if(!this._frameStarted){this._log.warn("frame not started "+e);Error.stackTraceLimit=25;A.utils.logStack();this.patch.printTriggerStack()}}setTexture(e,t,i){this.checkFrameStarted("cgl setTexture");if(t===null)t=E.getEmptyTexture(this).tex;if(this._textureslots[e]!=t){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(i||this.gl.TEXTURE_2D,t);this._textureslots[e]=t}return true}fullScreen(){if(this.canvas.requestFullscreen)this.canvas.requestFullscreen();else if(this.canvas.mozRequestFullScreen)this.canvas.mozRequestFullScreen();else if(this.canvas.webkitRequestFullscreen)this.canvas.webkitRequestFullscreen();else if(this.canvas.msRequestFullscreen)this.canvas.msRequestFullscreen()}printError(t){if(!this.checkGlErrors)return;let i=false;let r=this.gl.getError();if(r!=this.gl.NO_ERROR){let e="";if(r==this.gl.OUT_OF_MEMORY)e="OUT_OF_MEMORY";if(r==this.gl.INVALID_ENUM)e="INVALID_ENUM";if(r==this.gl.INVALID_OPERATION)e="INVALID_OPERATION";if(r==this.gl.INVALID_FRAMEBUFFER_OPERATION)e="INVALID_FRAMEBUFFER_OPERATION";if(r==this.gl.INVALID_VALUE)e="INVALID_VALUE";if(r==this.gl.CONTEXT_LOST_WEBGL){this.aborted=true;e="CONTEXT_LOST_WEBGL"}if(r==this.gl.NO_ERROR)e="NO_ERROR";i=true;this._log.warn("gl error ["+this.canvas.id+"]: ",t,r,e);if(this.canvas.id.includes("glGuiCanvas"))if(!this._loggedGlError){this.patch.printTriggerStack();this._log.stack("glerror");this._loggedGlError=true}}r=this.gl.getError();return i}_dispose(){this._simpleShader.dispose();this.gl=null}pushDepthTest(e){this._stackDepthTest.push(e);if(!e)this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}stateDepthTest(){return this._stackDepthTest[this._stackDepthTest.length-1]}popDepthTest(){this._stackDepthTest.pop();if(!this._stackDepthTest[this._stackDepthTest.length-1])this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}pushDepthWrite(e){e=e||false;this._stackDepthWrite.push(e);this.gl.depthMask(e)}stateDepthWrite(){return this._stackDepthWrite[this._stackDepthWrite.length-1]}popDepthWrite(){this._stackDepthWrite.pop();this.gl.depthMask(this._stackDepthWrite[this._stackDepthWrite.length-1]||false)}pushCullFace(e){this._stackCullFace.push(e);if(e)this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}stateCullFace(){return this._stackCullFace[this._stackCullFace.length-1]}popCullFace(){this._stackCullFace.pop();if(this._stackCullFace[this._stackCullFace.length-1])this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}pushCullFaceFacing(e){this._stackCullFaceFacing.push(e);this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}stateCullFaceFacing(){return this._stackCullFaceFacing[this._stackCullFaceFacing.length-1]}popCullFaceFacing(){this._stackCullFaceFacing.pop();if(this._stackCullFaceFacing.length>0)this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}pushDepthFunc(e){this._stackDepthFunc.push(e);this.gl.depthFunc(e)}stateDepthFunc(){if(this._stackDepthFunc.length>0)return this._stackDepthFunc[this._stackDepthFunc.length-1];return false}popDepthFunc(){this._stackDepthFunc.pop();if(this._stackDepthFunc.length>0)this.gl.depthFunc(this._stackDepthFunc[this._stackDepthFunc.length-1])}pushBlend(e){this._stackBlend.push(e);if(!e)this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}popBlend(){this._stackBlend.pop();if(!this._stackBlend[this._stackBlend.length-1])this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}stateBlend(){return this._stackBlend[this._stackBlend.length-1]}pushBlendMode(e,t){this._stackBlendMode.push(e);this._stackBlendModePremul.push(t);const i=this._stackBlendMode.length-1;this.pushBlend(this._stackBlendMode[i]!==d.BLEND_MODES.BLEND_NONE);this._setBlendMode(this._stackBlendMode[i],this._stackBlendModePremul[i])}popBlendMode(){this._stackBlendMode.pop();this._stackBlendModePremul.pop();const e=this._stackBlendMode.length-1;this.popBlend();if(e>=0)this._setBlendMode(this._stackBlendMode[e],this._stackBlendModePremul[e])}pushStencil(e){this._stackStencil.push(e);if(!e)this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}popStencil(){this._stackStencil.pop();if(!this._stackStencil[this._stackStencil.length-1])this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}glGetAttribLocation(e,t){const i=this.gl.getAttribLocation(e,t);return i}shouldDrawHelpers(e){if(this.tempData.shadowPass)return false;if(!e.patch.isEditorMode())return false;return gui.shouldDrawOverlay}_setBlendMode(e,t){const i=this.gl;if(e==d.BLEND_MODES.BLEND_NONE){}else if(e==d.BLEND_MODES.BLEND_ADD){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE,i.ONE,i.ONE)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.SRC_ALPHA,i.ONE)}}else if(e==d.BLEND_MODES.BLEND_SUB){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.ONE_MINUS_SRC_COLOR)}}else if(e==d.BLEND_MODES.BLEND_MUL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.SRC_COLOR)}}else if(e==d.BLEND_MODES.BLEND_NORMAL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}}else{this._log.log("setblendmode: unknown blendmode")}}createMesh(e,t){if(A.utils.isNumeric(t))t={glPrimitive:t};return new p(this,e,t)}setCursor(e){this.#cursor=e}enableExtension(e){if(!this.gl)return null;if(this._enabledExtensions.hasOwnProperty(e))return this._enabledExtensions[e];const t=this.gl.getExtension(e);this._enabledExtensions[e]=t;if(!t)this._log.warn("[cgl_state] extension not available "+e);return t}getErrorShader(){if(this.errorShader)return this.errorShader;this.errorShader=new x(this,"errormaterial");this.errorShader.setSource(x.getDefaultVertexShader(),x.getErrorFragmentShader());return this.errorShader}}const ba=8;const va=new h.Logger("cgl_texture");class E extends g{constructor(e,t={}){super(t);if(!e)throw new Error("no cgl");this._cgl=e;this._log=new h.Logger("tex");this.tex=this._cgl.gl.createTexture();this.loading=false;this.flip=true;this.flipped=false;this.shadowMap=false;this.deleted=false;this.image=null;this.anisotropic=0;this.filter=E.FILTER_NEAREST;this.wrap=E.WRAP_CLAMP_TO_EDGE;this.texTarget=this._cgl.gl.TEXTURE_2D;if(t&&t.type)this.texTarget=t.type;this.textureType=E.TYPE_DEFAULT;this.unpackAlpha=true;this._fromData=true;this._glDataType=-1;this._glInternalFormat=-1;this._glDataFormat=-1;if(t){if(t.isDepthTexture)this.textureType=E.TYPE_DEPTH;if(t.isFloatingPointTexture===true)this.textureType=E.TYPE_FLOAT;if("textureType"in t)this.textureType=t.textureType;if("filter"in t)this.filter=t.filter;if("wrap"in t)this.wrap=t.wrap;if("unpackAlpha"in t)this.unpackAlpha=t.unpackAlpha;if("flip"in t)this.flip=t.flip;if("shadowMap"in t)this.shadowMap=t.shadowMap;if("anisotropic"in t)this.anisotropic=t.anisotropic}else{t={}}if(!t.pixelFormat&&t.isFloatingPointTexture)this.pixelFormat=E.PFORMATSTR_RGBA32F;if(this.textureType==E.TYPE_DEPTH)this.pixelFormat=E.PFORMATSTR_DEPTH;this._cgl.profileData.profileTextureNew++;this.setFormat(E.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.profileData.addHeavyEvent("texture created",this.name,t.width+"x"+t.height);this.setSize(t.width,t.height);this.getInfoOneLine()}isFloatingPoint(){return E.isPixelFormatFloat(this.pixelFormat)}compareSettings(e){if(!e)return false;return e.width==this.width&&e.height==this.height&&e.filter==this.filter&&e.wrap==this.wrap&&e.textureType==this.textureType&&e.unpackAlpha==this.unpackAlpha&&e.anisotropic==this.anisotropic&&e.shadowMap==this.shadowMap&&e.texTarget==this.texTarget&&e.flip==this.flip}clone(){const e=new E(this._cgl,{name:this.name,filter:this.filter,anisotropic:this.anisotropic,wrap:this.wrap,textureType:this.textureType,pixelFormat:this.pixelFormat,unpackAlpha:this.unpackAlpha,flip:this.flip,width:this.width,height:this.height});this._cgl.profileData.addHeavyEvent("texture created",this.name,this.width+"x"+this.height);if(!this.compareSettings(e)){this._log.error("Cloned texture settings do not compare!");this._log.error(this);this._log.error(e)}return e}setFormat(e){this.pixelFormat=e.pixelFormat;this._glDataFormat=e.glDataFormat;this._glInternalFormat=e.glInternalFormat;this._glDataType=e.glDataType}setSize(e,t){if(this._cgl.aborted)return;if(e!=e||e<=0||!e)e=ba;if(t!=t||t<=0||!t)t=ba;if(e>this._cgl.maxTexSize||t>this._cgl.maxTexSize)this._log.error("texture size too big! "+e+"x"+t+" / max: "+this._cgl.maxTexSize);e=Math.min(e,this._cgl.maxTexSize);t=Math.min(t,this._cgl.maxTexSize);e=Math.floor(e);t=Math.floor(t);if(this.width==e&&this.height==t)return;e=this._cgl.checkTextureSize(e);t=this._cgl.checkTextureSize(t);this.width=e;this.height=t;this.deleted=false;this.setFormat(E.setUpGlPixelFormat(this._cgl,this.pixelFormat));this.shortInfoString=this.getInfoOneLine();this._cgl.gl.bindTexture(this.texTarget,this.tex);this._cgl.profileData.profileTextureResize++;const i=null;this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,e,t,0,this._glDataFormat,this._glDataType,i);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null)}initFromData(e,t,i,r,n){this.filter=r;this.wrap=n;if(r==undefined)this.filter=E.FILTER_LINEAR;if(n==undefined)this.wrap=E.WRAP_CLAMP_TO_EDGE;this.width=t;this.height=i;this._fromData=true;this.deleted=false;if(this.height>this._cgl.maxTexSize||this.width>this._cgl.maxTexSize){const s=CGL.Texture.getTempTexture(this._cgl);this.width=s.width;this.height=s.height;this.tex=s.tex;this._log.warn("[cgl_texture] texture size too big!",this.width,this.height,this._cgl.maxTexSize);return}if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flip);this._cgl.gl.bindTexture(this.texTarget,this.tex);this.setFormat(E.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,t,i,0,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this._cgl.gl.bindTexture(this.texTarget,null)}updateMipMap(){if((this._cgl.glVersion==2||this.isPowerOfTwo())&&this.filter==E.FILTER_MIPMAP){this._cgl.gl.generateMipmap(this.texTarget);this._cgl.profileData.profileGenMipMap++}}initTexture(e,t=null){this._cgl.printError("before initTexture");this._cgl.checkFrameStarted("texture inittexture");this._fromData=false;this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha);if(e.width||e.videoWidth)this.width=e.videoWidth||e.width;if(e.height||e.videoHeight)this.height=e.videoHeight||e.height;if(t!==null)this.filter=t;if(e.height>this._cgl.maxTexSize||e.width>this._cgl.maxTexSize){const i=CGL.Texture.getTempTexture(this._cgl);this.width=i.width;this.height=i.height;this.tex=i.tex;this._log.warn("[cgl_texture] texture size too big!",e.width,e.height,this._cgl.maxTexSize);return}this._cgl.gl.bindTexture(this.texTarget,this.tex);this.deleted=false;this.flipped=!this.flip;if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flipped);this.setFormat(E.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null);this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this.getInfoOneLine();this._cgl.printError("initTexture")}dispose(){this.delete()}delete(){if(this.loading){return}this.deleted=true;this.width=0;this.height=0;this._cgl.profileData.profileTextureDelete++;this._cgl.gl.deleteTexture(this.tex);this.image=null;this.tex=null}isPowerOfTwo(){return E.isPowerOfTwo(this.width)&&E.isPowerOfTwo(this.height)}printInfo(){va.log(this.getInfo())}getInfoReadable(){const t=this.getInfo();let i="";t.name=t.name.substr(0,t.name.indexOf("?rnd="));for(const e in t){i+="* "+e+":  **"+t[e]+"**\n"}return i}getInfoOneLine(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;if(this.filter===E.FILTER_NEAREST)e+=" nearest";if(this.filter===E.FILTER_LINEAR)e+=" linear";if(this.filter===E.FILTER_MIPMAP)e+=" mipmap";if(this.wrap===E.WRAP_CLAMP_TO_EDGE)e+=" clamp";if(this.wrap===E.WRAP_REPEAT)e+=" repeat";if(this.wrap===E.WRAP_MIRRORED_REPEAT)e+=" repeatmir";this.shortInfoString=e;return e}getInfoOneLineShort(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;this.shortInfoString=e;return e}getInfo(){return E.getTexInfo(this)}_setFilter(){this._cgl.printError("before _setFilter");if(!this._fromData){this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha)}if(this.shadowMap){this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_MODE,this._cgl.gl.COMPARE_REF_TO_TEXTURE);this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_FUNC,this._cgl.gl.LEQUAL)}if(this.textureType==E.TYPE_FLOAT&&this.filter==E.FILTER_MIPMAP){this.filter=E.FILTER_LINEAR;this._log.stack("texture: HDR and mipmap filtering at the same time is not possible")}if(this._cgl.glVersion==1&&!this.isPowerOfTwo()){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE);this.filter=E.FILTER_NEAREST;this.wrap=E.WRAP_CLAMP_TO_EDGE}else{if(this.wrap==E.WRAP_CLAMP_TO_EDGE){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE)}else if(this.wrap==E.WRAP_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.REPEAT)}else if(this.wrap==E.WRAP_MIRRORED_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.MIRRORED_REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.MIRRORED_REPEAT)}if(this.filter==E.FILTER_NEAREST){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST)}else if(this.filter==E.FILTER_LINEAR){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR)}else if(this.filter==E.FILTER_MIPMAP){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR_MIPMAP_LINEAR)}else{this._log.log("unknown texture filter!",this.filter);throw new Error("unknown texture filter!"+this.filter)}if(this.anisotropic){const e=this._cgl.enableExtension("EXT_texture_filter_anisotropic");if(this._cgl.maxAnisotropic){const t=Math.min(this._cgl.maxAnisotropic,this.anisotropic);this._cgl.gl.texParameterf(this._cgl.gl.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}}}this.getInfoOneLine();this._cgl.printError("_setFilter")}}E.load=function(i,r,n,e){if(!r)return n({error:true});let s=null;if(!i.patch.loading.existByName(r))s=i.patch.loading.start("cgl.texture",r);const a=new E(i);a.name=r;a.image=new Image;a.image.crossOrigin="anonymous";a.loading=true;if(e&&e.hasOwnProperty("filter"))a.filter=e.filter;if(e&&e.hasOwnProperty("flip"))a.flip=e.flip;if(e&&e.hasOwnProperty("wrap"))a.wrap=e.wrap;if(e&&e.hasOwnProperty("anisotropic"))a.anisotropic=e.anisotropic;if(e&&e.hasOwnProperty("unpackAlpha"))a.unpackAlpha=e.unpackAlpha;if(e&&e.hasOwnProperty("pixelFormat"))a.pixelFormat=e.pixelFormat;a.image.onabort=a.image.onerror=e=>{console.warn("[cgl.texture.load] error loading texture",r,e);a.loading=false;if(s)i.patch.loading.finished(s);const t={error:true};if(n)n(t,a)};a.image.onload=function(e){i.addNextFrameOnceCallback(()=>{a.initTexture(a.image);if(s)i.patch.loading.finished(s);a.loading=false;if(n)n(null,a)})};a.image.src=r;return a};E.getTempTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.tempTexture)e.tempTexture=E.getTemporaryTexture(e,256,E.FILTER_LINEAR,E.REPEAT);return e.tempTexture};E.getErrorTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.errorTexture)e.errorTexture=E.getTemporaryTexture(e,256,E.FILTER_LINEAR,E.REPEAT,1,.2,.2);return e.errorTexture};E.getEmptyTexture=function(e,t){if(t)return E.getEmptyTextureFloat(e);if(!e)console.error("[getEmptyTexture] no cgl!");if(e.tempTextureEmpty)return e.tempTextureEmpty;let i=8;e.tempTextureEmpty=new E(e,{name:"emptyTexture"});const r=E.getDefaultTextureData("empty",i);e.tempTextureEmpty.initFromData(r,i,i,E.FILTER_NEAREST,E.WRAP_REPEAT);return e.tempTextureEmpty};E.getEmptyTextureFloat=function(e){if(!e)console.error("[getEmptyTextureFloat] no cgl!");if(e.tempTextureEmptyFloat)return e.tempTextureEmptyFloat;e.tempTextureEmptyFloat=new E(e,{name:"emptyTexture",isFloatingPointTexture:true});const t=new Float32Array(8*8*4).fill(1);for(let e=0;e<8*8*4;e+=4)t[e+3]=0;e.tempTextureEmptyFloat.initFromData(t,8,8,E.FILTER_NEAREST,E.WRAP_REPEAT);return e.tempTextureEmptyFloat};E.getRandomTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.randomTexture)return e.randomTexture;const t=256;const i=E.getDefaultTextureData("randomUInt",t);e.randomTexture=new E(e);e.randomTexture.initFromData(i,t,t,E.FILTER_NEAREST,E.WRAP_REPEAT);return e.randomTexture};E.getRandomFloatTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.getRandomFloatTexture)return e.getRandomFloatTexture;const t=256;const i=E.getDefaultTextureData("randomFloat",t);e.getRandomFloatTexture=new E(e,{isFloatingPointTexture:true});e.getRandomFloatTexture.initFromData(i,t,t,E.FILTER_NEAREST,E.WRAP_REPEAT);return e.getRandomFloatTexture};E.getBlackTexture=function(e){if(e.blackTexture)return e.blackTexture;const t=8;const i=E.getDefaultTextureData("color",t,{r:0,g:0,b:0});e.blackTexture=new E(e);e.blackTexture.initFromData(i,t,t,E.FILTER_NEAREST,E.WRAP_REPEAT);return e.blackTexture};E.getEmptyCubemapTexture=function(t){const i=[t.gl.TEXTURE_CUBE_MAP_POSITIVE_X,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z];const e=t.gl.createTexture();const r=t.gl.TEXTURE_CUBE_MAP;const n=E.FILTER_NEAREST;const s=E.WRAP_CLAMP_TO_EDGE;const a=8;const o=8;t.profileData.profileTextureNew++;t.gl.bindTexture(r,e);t.profileData.profileTextureResize++;for(let e=0;e<6;e+=1){const l=new Uint8Array(8*8*4);t.gl.texImage2D(i[e],0,t.gl.RGBA,8,8,0,t.gl.RGBA,t.gl.UNSIGNED_BYTE,l);t.gl.texParameteri(r,t.gl.TEXTURE_MAG_FILTER,t.gl.NEAREST);t.gl.texParameteri(r,t.gl.TEXTURE_MIN_FILTER,t.gl.NEAREST);t.gl.texParameteri(r,t.gl.TEXTURE_WRAP_S,t.gl.CLAMP_TO_EDGE);t.gl.texParameteri(r,t.gl.TEXTURE_WRAP_T,t.gl.CLAMP_TO_EDGE)}t.gl.bindTexture(r,null);return{id:A.utils.uuid(),tex:e,cubemap:e,width:a,height:o,filter:n,wrap:s,unpackAlpha:true,flip:true,_fromData:true,name:"emptyCubemapTexture",anisotropic:0}};E.getTempGradientTexture=function(e){if(!e)console.error("[getTempGradientTexture] no cgl!");return E.getTempTexture(e)};E.getTemporaryTexture=function(e,t,i,r,n,s,a){const o=E.getDefaultTextureData("stripes",256,{r:n,g:s,b:a});const l=new E(e);l.initFromData(o,t,t,i,r);return l};E.createFromImage=function(e,t,i){i=i||{};const r=new E(e,i);r.flip=false;r.image=t;r.width=t.videoWidth||t.width||8;r.height=t.videoHeight||t.height||8;if(i.hasOwnProperty("wrap"))r.wrap=i.wrap;r.initTexture(t,i.filter);return r};E.fromImage=function(e,t,i,r){console.error("deprecated texture from image...");const n=new E(e);n.flip=false;if(i)n.filter=i;if(r)n.wrap=r;n.image=t;n.initTexture(t);return n};E.isPowerOfTwo=function(e){return e==1||e==2||e==4||e==8||e==16||e==32||e==64||e==128||e==256||e==512||e==1024||e==2048||e==4096||e==8192||e==16384};E.getTexInfo=function(e){const t={};t.name=e.name;t["power of two"]=e.isPowerOfTwo();t.size=e.width+" x "+e.height;let i=e.texTarget;if(e.texTarget==e._cgl.gl.TEXTURE_2D)i="TEXTURE_2D";t.target=i;t.unpackAlpha=e.unpackAlpha;if(e.cubemap)t.cubemap=true;if(e.textureType==E.TYPE_FLOAT)t.textureType="TYPE_FLOAT";if(e.textureType==E.TYPE_HALF_FLOAT)t.textureType="TYPE_HALF_FLOAT";else if(e.textureType==E.TYPE_DEPTH)t.textureType="TYPE_DEPTH";else if(e.textureType==E.TYPE_DEFAULT)t.textureType="TYPE_DEFAULT";else t.textureType="UNKNOWN "+this.textureType;if(e.wrap==E.WRAP_CLAMP_TO_EDGE)t.wrap="CLAMP_TO_EDGE";else if(e.wrap==E.WRAP_REPEAT)t.wrap="WRAP_REPEAT";else if(e.wrap==E.WRAP_MIRRORED_REPEAT)t.wrap="WRAP_MIRRORED_REPEAT";else t.wrap="UNKNOWN";if(e.filter==E.FILTER_NEAREST)t.filter="FILTER_NEAREST";else if(e.filter==E.FILTER_LINEAR)t.filter="FILTER_LINEAR";else if(e.filter==E.FILTER_MIPMAP)t.filter="FILTER_MIPMAP";else t.filter="UNKNOWN";t.pixelFormat=e.pixelFormat||"unknown";return t};E.setUpGlPixelFormat=function(e,t){const i={};if(!t){e._log.error("no pixelformatstr!");e._log.log(new Error);t=E.PFORMATSTR_RGBA8UB}i.pixelFormatBase=t;i.pixelFormat=t;i.glDataType=e.gl.UNSIGNED_BYTE;i.glInternalFormat=e.gl.RGBA8;i.glDataFormat=e.gl.RGBA;let r=e.gl.FLOAT;if(e.glUseHalfFloatTex){if(t==E.PFORMATSTR_RGBA32F)t=E.PFORMATSTR_RGBA16F;if(t==E.PFORMATSTR_RG32F)t=E.PFORMATSTR_RG16F;if(t==E.PFORMATSTR_R32F)t=E.PFORMATSTR_R16F}if(t.includes("16bit")){if(e.glVersion==2){const n=e.enableExtension("EXT_color_buffer_half_float");if(!n){console.warn("no 16bit extension, fallback to 32bit",t);if(t==E.PFORMATSTR_RGBA16F)t=E.PFORMATSTR_RGBA32F;if(t==E.PFORMATSTR_RGB16F)t=E.PFORMATSTR_RGB32F;if(t==E.PFORMATSTR_RG16F)t=E.PFORMATSTR_RG32F;if(t==E.PFORMATSTR_R16F)t=E.PFORMATSTR_R32F}else{r=e.gl.HALF_FLOAT}}}if(e.glVersion==1){i.glInternalFormat=e.gl.RGBA;if(t==E.PFORMATSTR_RGBA16F||t==E.PFORMATSTR_RG16F||t==E.PFORMATSTR_R16F){const s=e.enableExtension("OES_texture_half_float");if(!s)throw new Error("no half float texture extension");r=s.HALF_FLOAT_OES}}if(t==E.PFORMATSTR_RGBA8UB){}else if(t==E.PFORMATSTR_RGB565){i.glInternalFormat=e.gl.RGB565;i.glDataFormat=e.gl.RGB}else if(t==E.PFORMATSTR_R8UB){i.glInternalFormat=e.gl.R8;i.glDataFormat=e.gl.RED}else if(t==E.PFORMATSTR_RG8UB){i.glInternalFormat=e.gl.RG8;i.glDataFormat=e.gl.RG}else if(t==E.PFORMATSTR_RGB8UB){i.glInternalFormat=e.gl.RGB8;i.glDataFormat=e.gl.RGB}else if(t==E.PFORMATSTR_SRGBA8){i.glInternalFormat=e.gl.SRGB8_ALPHA8}else if(t==E.PFORMATSTR_R32F){i.glInternalFormat=e.gl.R32F;i.glDataFormat=e.gl.RED;i.glDataType=r}else if(t==E.PFORMATSTR_R16F){i.glInternalFormat=e.gl.R16F;i.glDataType=r;i.glDataFormat=e.gl.RED}else if(t==E.PFORMATSTR_RG16F){i.glInternalFormat=e.gl.RG16F;i.glDataType=r;i.glDataFormat=e.gl.RG}else if(t==E.PFORMATSTR_RGBA16F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA16F;i.glDataType=r}else if(t==E.PFORMATSTR_R11FG11FB10F){i.glInternalFormat=e.gl.R11F_G11F_B10F;i.glDataType=r;i.glDataFormat=e.gl.RGB}else if(t==E.PFORMATSTR_RGBA32F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA32F;i.glDataType=r}else if(t==E.PFORMATSTR_DEPTH){if(e.glVersion==1){i.glInternalFormat=e.gl.DEPTH_COMPONENT;i.glDataType=e.gl.UNSIGNED_SHORT;i.glDataFormat=e.gl.DEPTH_COMPONENT}else{i.glInternalFormat=e.gl.DEPTH_COMPONENT32F;i.glDataType=e.gl.FLOAT;i.glDataFormat=e.gl.DEPTH_COMPONENT}}else{va.log("unknown pixelformat ",t)}if(t.includes("32bit")||t==E.PFORMATSTR_R11FG11FB10F){if(e.glVersion==2)e.enableExtension("EXT_color_buffer_float");if(e.glVersion==2)e.enableExtension("EXT_float_blend");e.enableExtension("OES_texture_float_linear")}i.numColorChannels=E.getPixelFormatNumChannels(t);if(!i.glDataType||!i.glInternalFormat||!i.glDataFormat)va.log("pixelformat wrong ?!",t,i.glDataType,i.glInternalFormat,i.glDataFormat,this);return i};E.getPixelFormatNumChannels=e=>{if(e.startsWith("RGBA"))return 4;if(e.startsWith("RGB"))return 3;if(e.startsWith("RG"))return 2;return 1};E.isPixelFormatFloat=e=>{return(e||"").includes("float")};E.isPixelFormatHalfFloat=e=>{return(e||"").includes("float")&&(e||"").includes("16bit")};A.Op.prototype.outTexture=function(e,t){const i=this.addOutPort(new A.Port(this,e,A.Port.TYPE_OBJECT,{preview:true,objType:"texture",display:"texture"}));if(t!==undefined)i.setRef(t||E.getEmptyTexture(this.patch.cgl));i.ignoreValueSerialize=true;return i};class xa{constructor(t,e,i,r){this._log=new h.Logger("cgl_framebuffer2");if(t.glVersion==1)this._log.error("framebuffer2 used on webgl1");this.Framebuffer2DrawTargetsDefault=null;this.Framebuffer2BlittingFramebuffer=null;this.Framebuffer2FinalFramebuffer=null;this._cgl=t;this._cgl.printError("before framebuffer2 constructor");this._width=0;this._height=0;this.valid=true;this._depthRenderbuffer=null;this._frameBuffer=null;this._textureFrameBuffer=null;this._colorRenderbuffers=[];this._drawTargetArray=[];this._disposed=false;if(!this.Framebuffer2BlittingFramebuffer)this.Framebuffer2BlittingFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2FinalFramebuffer)this.Framebuffer2FinalFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2DrawTargetsDefault)this.Framebuffer2DrawTargetsDefault=[t.gl.COLOR_ATTACHMENT0];this._options=r||{isFloatingPointTexture:false};this.name=this._options.name||"unknown";this._cgl.profileData.addHeavyEvent("framebuffer create",this.name);if(!this._options.hasOwnProperty("numRenderBuffers"))this._options.numRenderBuffers=1;if(!this._options.hasOwnProperty("depth"))this._options.depth=true;if(!this._options.hasOwnProperty("clear"))this._options.clear=true;if(!this._options.hasOwnProperty("multisampling")){this._options.multisampling=false;this._options.multisamplingSamples=0}if(this._options.multisamplingSamples){if(this._cgl.glSlowRenderer)this._options.multisamplingSamples=0;if(!this._cgl.gl.MAX_SAMPLES)this._options.multisamplingSamples=0;else this._options.multisamplingSamples=Math.min(this._cgl.maxSamples,this._options.multisamplingSamples)}if(!this._options.hasOwnProperty("filter"))this._options.filter=E.FILTER_LINEAR;if(!this._options.hasOwnProperty("wrap"))this._options.wrap=E.WRAP_REPEAT;this._numRenderBuffers=this._options.numRenderBuffers;this._colorTextures=[];this.clearColors=[];for(let e=0;e<this._numRenderBuffers;e++)this.clearColors.push([0,0,0,1]);if(!r.pixelFormat){if(r.isFloatingPointTexture)this._options.pixelFormat=E.PFORMATSTR_RGBA32F;else this._options.pixelFormat=E.PFORMATSTR_RGBA8UB}for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e]=new E(t,{name:"fb2 "+this.name+" "+e,isFloatingPointTexture:this._options.isFloatingPointTexture,anisotropic:this._options.anisotropic||0,pixelFormat:this._options.pixelFormat,filter:this._options.filter,wrap:this._options.wrap})}let n=E.FILTER_NEAREST;if(this._options.shadowMap)n=E.FILTER_LINEAR;const s=512;if(this._options.depth){this._textureDepth=new E(t,{name:"fb2 depth "+this.name,isDepthTexture:true,filter:n,shadowMap:this._options.shadowMap||false,width:e||s,height:i||s})}if(t.aborted)return;this.setSize(e||s,i||s);this._cgl.printError("framebuffer2 constructor")}getWidth(){return this._width}getHeight(){return this._height}getGlFrameBuffer(){return this._frameBuffer}getDepthRenderBuffer(){return this._depthRenderbuffer}getTextureColor(){return this._colorTextures[0]}getTextureColorNum(e){return this._colorTextures[e]}getTextureDepth(){return this._textureDepth}setFilter(t){for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e].filter=t;this._colorTextures[e].setSize(this._width,this._height)}}delete(){this.dispose()}dispose(){this._disposed=true;let e=0;for(e=0;e<this._numRenderBuffers;e++)this._colorTextures[e].delete();if(this._textureDepth)this._textureDepth.delete();for(e=0;e<this._numRenderBuffers;e++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[e]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}setSize(e,t){if(this._disposed)return this._log.warn("disposed framebuffer setsize...");this._cgl.profileData.addHeavyEvent("framebuffer resize",this.name);let i=0;this._width=this._cgl.checkTextureSize(e);this._height=this._cgl.checkTextureSize(t);this._cgl.profileData.profileFrameBuffercreate++;if(this._frameBuffer){for(i=0;i<this._numRenderBuffers;i++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[i]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}this._frameBuffer=this._cgl.gl.createFramebuffer();this._textureFrameBuffer=this._cgl.gl.createFramebuffer();const r=this._options.depth;for(i=0;i<this._numRenderBuffers;i++){this._colorTextures[i].setSize(this._width,this._height)}for(i=0;i<this._numRenderBuffers;i++){const a=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,a);const o=E.setUpGlPixelFormat(this._cgl,this._options.pixelFormat);let e=o.glInternalFormat;if(CGL.Texture.isPixelFormatHalfFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._options.filter=E.FILTER_NEAREST;this.setFilter(this._options.filter)}}else if(CGL.Texture.isPixelFormatFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._log.warn("no linear pixelformat,using nearest");this._options.filter=E.FILTER_NEAREST;this.setFilter(this._options.filter)}}if(this._options.multisampling&&this._options.multisamplingSamples){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,e,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,e,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.RENDERBUFFER,a);this._colorRenderbuffers[i]=a}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._textureFrameBuffer);for(i=0;i<this._numRenderBuffers;i++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.TEXTURE_2D,this._colorTextures[i].tex,0)}if(this._options.depth){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0)}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);let n=this._cgl.gl.DEPTH_COMPONENT32F;if(this._cgl.glSlowRenderer)n=this._cgl.gl.DEPTH_COMPONENT16;if(r){this._textureDepth.setSize(this._width,this._height);this._depthRenderbuffer=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);if(this._options.isFloatingPointTexture){if(this._options.multisampling)this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,n,this._width,this._height);else this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,n,this._width,this._height)}else if(this._options.multisampling){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,n,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,n,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer)}this._drawTargetArray.length=0;for(i=0;i<this._numRenderBuffers;i++)this._drawTargetArray.push(this._cgl.gl.COLOR_ATTACHMENT0+i);if(!this._cgl.gl.isFramebuffer(this._textureFrameBuffer))this._log.warn("invalid framebuffer");const s=this._cgl.gl.checkFramebufferStatus(this._cgl.gl.FRAMEBUFFER);if(s!=this._cgl.gl.FRAMEBUFFER_COMPLETE){this._log.error("framebuffer incomplete: "+this.name,this);this._log.log("options",this._options);this._log.log("options pixelformat",this._options.pixelFormat);switch(s){case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...",this);throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:this._log.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case this._cgl.gl.FRAMEBUFFER_UNSUPPORTED:this._log.warn("FRAMEBUFFER_UNSUPPORTED");throw new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:this.valid=false;this._log.error("incomplete framebuffer",s,this._frameBuffer);this._cgl.printError();this._frameBuffer=null;throw new Error("Incomplete framebuffer: "+s)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null)}renderStart(){if(this._disposed)return this._log.warn("disposed framebuffer renderStart...");this._cgl.checkFrameStarted("fb2 renderstart");this._cgl.pushModelMatrix();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.pushGlFrameBuffer(this._frameBuffer);this._cgl.pushFrameBuffer(this);this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this._width,this._height);this._cgl.gl.drawBuffers(this._drawTargetArray);if(this._options.clear){this._cgl.gl.clearColor(0,0,0,0);this._cgl.gl.clear(this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT)}}clear(){if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer)}else this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.drawBuffers(this._drawTargetArray);for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+e,this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex,0);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,e,this.clearColors[e])}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}renderEnd(){if(this._disposed)return this._log.warn("disposed framebuffer renderEnd...");this._cgl.popPMatrix();this._cgl.profileData.profileFramebuffer++;if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,0,[0,0,0,1]);this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT,this._cgl.gl.NEAREST)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0);for(let t=0;t<this._numRenderBuffers;t++){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.RENDERBUFFER,this._colorRenderbuffers[t]);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._colorTextures[t].tex,0);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);let e=this._cgl.gl.COLOR_BUFFER_BIT;if(t==0)e|=this._cgl.gl.DEPTH_BUFFER_BIT;this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,e,this._cgl.gl.NEAREST)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.popFrameBuffer();this._cgl.popModelMatrix();this._cgl.popViewPort();if(this._colorTextures[0].filter==E.FILTER_MIPMAP){for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex);this._colorTextures[e].updateMipMap();this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}}}}const Ea=function(e){this.draw=function(e,t,i){}};const Aa=function(e){this.render=function(e,t){}};const Ta=function(e){this.render=function(e,t,i,r){}};class Oa{constructor(e){this.shader=new CGL.Shader(e,"markermaterial");const t="".endl()+"void main()".endl()+"{".endl()+"    outColor = vec4(color.rgb,1.0);".endl()+"}";const i="".endl()+"IN vec3 vPosition;".endl()+"UNI mat4 projMatrix;".endl()+"UNI mat4 mvMatrix;".endl()+"void main()".endl()+"{".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(vPosition,1.0);".endl()+"}";this.shader.setSource(i,t);this.coloruni=this.shader.addUniformFrag("4f","color",[1,.777,1,1])}setColor(e,t,i,r){this.coloruni.set(e,t,i,r)}}const Ia=Math.PI/180;const Sa=180/Math.PI;const Ma=null;const Ca=window.navigator.userAgent.includes("Windows");const Ra=function(t){let i;if(t.wheelDelta){i=t.wheelDelta%120-0==-0?t.wheelDelta/120:t.wheelDelta/30;i*=-1.5;if(Ca)i*=2}else{let e=t.deltaY;if(t.shiftKey)e=t.deltaX;const r=e||t.detail;i=-(r%3?r*10:r/3);i*=-3}if(i>20)i=20;if(i<-20)i=-20;return i};const Na=Ra;const ya=Ra;const Pa={Framebuffer2:xa,Geometry:c,BoundingBox:i,Marker:Ea,WirePoint:Aa,WireCube:Ta,MatrixStack:a,Mesh:p,MESH:I,ShaderLibMods:fa,Shader:x,Uniform:m,MESHES:b,getWheelSpeed:Na,getWheelDelta:ya,Context:_a,Texture:E,TextureEffect:v,onLoadingAssetsFinished:Ma,ProfileData:ta,UniColorShader:Oa,...d.BLEND_MODES,...d.SHADER,...d.MATH,...d.BLEND_MODES};window.CABLES=window.CABLES||{};window.CABLES.CGL={...window.CABLES.CGL,...Pa};window.CGL={...window.CGL,...Pa};window.cgInitialized=false;window.addEventListener("INIT_CG",e=>{if(window.cgInitialized&&!CABLES.UI)return;window.cgInitialized=true;const t=new _a(e.detail)});A.Anim.slerpQuaternion=function(e,t,i,r,n,s){if(!A.Anim.slerpQuaternion.q1){A.Anim.slerpQuaternion.q1=quat.create();A.Anim.slerpQuaternion.q2=quat.create()}const a=i.getKeyIndex(e);let o=a+1;if(o>=i.keys.length)o=i.keys.length-1;if(a==o){quat.set(t,i.keys[a].value,r.keys[a].value,n.keys[a].value,s.keys[a].value)}else{const l=i.keys[a].time;const u=i.keys[o].time;const h=(e-l)/(u-l);quat.set(A.Anim.slerpQuaternion.q1,i.keys[a].value,r.keys[a].value,n.keys[a].value,s.keys[a].value);quat.set(A.Anim.slerpQuaternion.q2,i.keys[o].value,r.keys[o].value,n.keys[o].value,s.keys[o].value);quat.slerp(t,A.Anim.slerpQuaternion.q1,A.Anim.slerpQuaternion.q2,h)}return t}})();var e=CABLES=typeof CABLES==="undefined"?{}:CABLES;for(var t in wa)e[t]=wa[t];if(wa.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();(()=>{var r={};(()=>{r.d=(e,t)=>{for(var i in t){if(r.o(t,i)&&!r.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{r.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var i={};(()=>{"use strict";r.r(i);r.d(i,{VarGetOpWrapper:()=>t,VarSetOpWrapper:()=>e});const a=CABLES;class e{constructor(t,e,i,r,n,s){this._valuePort=i;this._varNamePort=r;this._op=t;this._type=e;this._typeId=-1;this._triggerPort=n;this._nextPort=s;this._var=null;this._btnCreate=t.inTriggerButton("Create new variable");this._btnCreate.setUiAttribs({hidePort:true});this._btnCreate.onTriggered=this._createVar.bind(this);this._helper=t.inUiTriggerButtons("",["Rename"]);this._helper.setUiAttribs({hidePort:true});this._helper.onTriggered=e=>{CABLES.CMD.PATCH.renameVariable(t.varName.get())};this._op.setPortGroup("Variable",[this._helper,this._varNamePort,this._btnCreate]);r.setUiAttribs({_variableSelect:true});this._op.on("uiParamPanel",this._updateVarNamesDropdown.bind(this));this._op.patch.addEventListener("variablesChanged",this._updateName.bind(this));this._op.patch.addEventListener("variableRename",this._renameVar.bind(this));this._varNamePort.onChange=this._updateName.bind(this);this._isTexture=this._valuePort.uiAttribs.objType==="texture";this._valuePort.changeAlways=true;if(this._triggerPort){this._triggerPort.onTriggered=()=>{this._setVarValue(true)}}else{this._valuePort.onChange=this._setVarValue.bind(this)}this._op.init=()=>{this._updateName();if(!this._triggerPort)this._setVarValue();this._updateErrorUi()};if(e=="array")this._typeId=a.Port.TYPE_ARRAY;else if(e=="object")this._typeId=a.Port.TYPE_OBJECT;else if(e=="string")this._typeId=a.Port.TYPE_STRING;else if(e=="texture")this._typeId=a.Port.TYPE_TEXTURE;else this._typeId=a.Port.TYPE_VALUE}_updateErrorUi(){if(CABLES.UI){if(!this._varNamePort.get())this._op.setUiError("novarname","no variable selected");else{if(this._op.hasUiErrors)this._op.setUiError("novarname",null)}}}_updateName(){this._var=null;const e=this._varNamePort.get();this._op.setTitle("var set");this._op.setUiAttrib({extendTitle:"#"+e});this._updateErrorUi();const t=this._op.patch.getVar(e);if(t&&!t.type)t.type=this._type;if(!this._op.patch.hasVar(e)&&e!=0&&!this._triggerPort){this._setVarValue()}if(!this._op.patch.hasVar(e)&&e!=0&&this._triggerPort){if(this._type=="string")this._op.patch.setVarValue(e,"");else if(this._type=="number")this._op.patch.setVarValue(e,"");else this._op.patch.setVarValue(e,null)}if(this._op.isCurrentUiOp()){this._updateVarNamesDropdown();this._op.refreshParams()}this._updateDisplay();this._op.patch.emitEvent("opVariableNameChanged",this._op,this._varNamePort.get())}_createVar(){CABLES.CMD.PATCH.createVariable(this._op,this._type,()=>{this._updateName()})}_updateDisplay(){this._valuePort.setUiAttribs({greyout:!this._varNamePort.get()})}_updateVarNamesDropdown(){if(CABLES.UI&&CABLES.UI.loaded&&CABLES.UI.loaded){const e=gui.uiProfiler.start("[vars] _updateVarNamesDropdown");const t=[];const i=this._op.patch.getVars();for(const e in i)if(i[e].type==this._type&&e!="0")t.push(e);this._varNamePort.uiAttribs.values=t;e.finish()}}_renameVar(e,t){if(e!=this._varNamePort.get())return;this._varNamePort.set(t);this._updateName()}_setVarValue(e){let t=this._valuePort.get();if(!this._var){const i=this._varNamePort.get();if(!i)return;if(this._typeId==a.Port.TYPE_VALUE&&typeof t=="string")t=parseFloat(t);this._op.patch.setVarValue(i,t,this._type);this._var=this._op.patch.getVar(i)}if(this._typeId==a.Port.TYPE_VALUE||this._typeId==a.Port.TYPE_STRING){this._var.setValue(t)}else if(this._typeId==a.Port.TYPE_ARRAY){this._arr=[];a.utils.copyArray(t,this._arr);this._var.setValue(this._arr)}else{if(this._typeId==a.Port.TYPE_OBJECT){if(this._isTexture)this._var.setValue(CGL.Texture.getEmptyTexture(this._op.patch.cgl));else this._var.setValue(null);if(t&&t.tex&&t._cgl&&!this._isTexture)this._op.setUiError("texobj","Dont use object variables for textures, use varSetTexture");else this._op.setUiError("texobj",null)}this._var.setValue(t)}if(e&&this._nextPort)this._nextPort.trigger()}}class t{constructor(e,t,i,r){this._op=e;this._type=t;this._varnamePort=i;this._variable=null;this._valueOutPort=r;this._listenerId=null;this._typeId=0;if(t=="array")this._typeId=a.Port.TYPE_ARRAY;else if(t=="object")this._typeId=a.Port.TYPE_OBJECT;else if(t=="texture")this._typeId=a.Port.TYPE_TEXTURE;else if(t=="string")this._typeId=a.Port.TYPE_STRING;else this._typeId=a.Port.TYPE_VALUE;if(r)this._isTexture=r.uiAttribs.objType==="texture";this._op.on("uiParamPanel",this._updateVarNamesDropdown.bind(this));this._op.on("uiErrorChange",this._updateTitle.bind(this));this._op.patch.on("variableRename",this._renameVar.bind(this));this._op.patch.on("variableDeleted",e=>{if(this._op.isCurrentUiOp())this._op.refreshParams()});i.setUiAttribs({_variableSelect:true});i.setUiAttribs({_variableSelectGet:true});this._varnamePort.onChange=this._changeVar.bind(this);this._op.patch.addEventListener("variablesChanged",this._init.bind(this));this._op.onDelete=()=>{if(this._variable&&this._listenerId)this._variable.off(this._listenerId)};this._op.init=()=>{this._init()}}get variable(){return this._variable}_changeVar(){if(this._variable&&this._listenerId){this._variable.off(this._listenerId)}this._init()}_renameVar(e,t){if(e!=this._varnamePort.get())return;this._varnamePort.set(t);this._updateVarNamesDropdown();this._updateTitle();this._listenerId=this._variable.on("change",this._setValueOut.bind(this))}_updateVarNamesDropdown(){if(CABLES.UI&&CABLES.UI.loaded){const t=[];const i=this._op.patch.getVars();for(const e in i)if(i[e].type==this._type&&e!="0")t.push(e);this._op.varName.uiAttribs.values=t}}_setValueOut(e){if(this._valueOutPort)if(this._typeId==a.Port.TYPE_NUMBER||this._typeId==a.Port.TYPE_STRING)this._valueOutPort.set(e);else if(this._typeId==a.Port.TYPE_ARRAY||this._typeId==a.Port.TYPE_OBJECT||this._isTexture)this._valueOutPort.setRef(e);else console.log("unkown type?")}_updateTitle(){if(this._variable){this._op.setUiError("unknownvar",null);this._op.setTitle("var get");this._op.setUiAttrib({extendTitle:"#"+this._varnamePort.get()});if(this._valueOutPort)this._setValueOut(this._variable.getValue())}else{this._op.setUiError("unknownvar","unknown variable! - there is no setVariable with this name ("+this._varnamePort.get()+")");this._op.setUiAttrib({extendTitle:"#invalid"});if(this._valueOutPort)this._setValueOut(0)}}_init(){this._updateVarNamesDropdown();if(this._variable&&this._listenerId)this._variable.off(this._listenerId);this._variable=this._op.patch.getVar(this._op.varName.get());if(this._variable)this._listenerId=this._variable.on("change",this._setValueOut.bind(this));this._updateTitle();this._op.patch.emitEvent("opVariableNameChanged",this._op,this._varnamePort.get())}}})();var e=CABLES=typeof CABLES==="undefined"?{}:CABLES;for(var t in i)e[t]=i[t];if(i.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();(()=>{var wa={};(()=>{wa.d=(e,t)=>{for(var i in t){if(wa.o(t,i)&&!wa.o(e,i)){Object.defineProperty(e,i,{enumerable:true,get:t[i]})}}}})();(()=>{wa.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{wa.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();var Fa={};(()=>{"use strict";wa.r(Fa);wa.d(Fa,{CopyTexture:()=>La});var C={};wa.r(C);wa.d(C,{ARRAY_TYPE:()=>_,EPSILON:()=>w,RANDOM:()=>u,equals:()=>Z,setMatrixArrayType:()=>Y,toRadian:()=>W});var R={};wa.r(R);wa.d(R,{LDU:()=>ge,add:()=>de,adjoint:()=>ne,clone:()=>Q,copy:()=>J,create:()=>K,determinant:()=>se,equals:()=>_e,exactEquals:()=>pe,frob:()=>fe,fromRotation:()=>ue,fromScaling:()=>he,fromValues:()=>ee,identity:()=>$,invert:()=>re,mul:()=>xe,multiply:()=>ae,multiplyScalar:()=>be,multiplyScalarAndAdd:()=>ve,rotate:()=>oe,scale:()=>le,set:()=>te,str:()=>ce,sub:()=>Ee,subtract:()=>me,transpose:()=>ie});var N={};wa.r(N);wa.d(N,{add:()=>Be,clone:()=>Te,copy:()=>Oe,create:()=>Ae,determinant:()=>Re,equals:()=>He,exactEquals:()=>ze,frob:()=>Ue,fromRotation:()=>we,fromScaling:()=>Fe,fromTranslation:()=>ke,fromValues:()=>Se,identity:()=>Ie,invert:()=>Ce,mul:()=>Xe,multiply:()=>Ne,multiplyScalar:()=>je,multiplyScalarAndAdd:()=>Ge,rotate:()=>ye,scale:()=>Pe,set:()=>Me,str:()=>De,sub:()=>Ye,subtract:()=>Ve,translate:()=>Le});var y={};wa.r(y);wa.d(y,{add:()=>_t,adjoint:()=>it,clone:()=>Ze,copy:()=>Ke,create:()=>qe,determinant:()=>rt,equals:()=>At,exactEquals:()=>Et,frob:()=>pt,fromMat2d:()=>ct,fromMat4:()=>We,fromQuat:()=>ft,fromRotation:()=>ut,fromScaling:()=>ht,fromTranslation:()=>lt,fromValues:()=>Qe,identity:()=>$e,invert:()=>tt,mul:()=>Tt,multiply:()=>nt,multiplyScalar:()=>vt,multiplyScalarAndAdd:()=>xt,normalFromMat4:()=>gt,projection:()=>dt,rotate:()=>at,scale:()=>ot,set:()=>Je,str:()=>mt,sub:()=>Ot,subtract:()=>bt,translate:()=>st,transpose:()=>et});var P={};wa.r(P);wa.d(P,{add:()=>ai,adjoint:()=>Nt,clone:()=>It,copy:()=>St,create:()=>r,determinant:()=>yt,equals:()=>ci,exactEquals:()=>hi,frob:()=>si,fromQuat:()=>Qt,fromQuat2:()=>Xt,fromRotation:()=>Vt,fromRotationTranslation:()=>Ht,fromRotationTranslationScale:()=>Zt,fromRotationTranslationScaleOrigin:()=>Kt,fromScaling:()=>Bt,fromTranslation:()=>Ut,fromValues:()=>Mt,fromXRotation:()=>jt,fromYRotation:()=>Gt,fromZRotation:()=>zt,frustum:()=>Jt,getRotation:()=>Wt,getScaling:()=>qt,getTranslation:()=>Yt,identity:()=>T,invert:()=>t,lookAt:()=>ii,mul:()=>fi,multiply:()=>Pt,multiplyScalar:()=>li,multiplyScalarAndAdd:()=>ui,ortho:()=>ti,perspective:()=>$t,perspectiveFromFieldOfView:()=>ei,rotate:()=>wt,rotateX:()=>Ft,rotateY:()=>kt,rotateZ:()=>Dt,scale:()=>Lt,set:()=>Ct,str:()=>ni,sub:()=>gi,subtract:()=>oi,targetTo:()=>ri,translate:()=>n,transpose:()=>Rt});var L={};wa.r(L);wa.d(L,{add:()=>_i,angle:()=>Gi,bezier:()=>wi,ceil:()=>xi,clone:()=>di,copy:()=>pi,create:()=>D,cross:()=>G,dist:()=>Ki,distance:()=>Mi,div:()=>Zi,divide:()=>vi,dot:()=>j,equals:()=>Yi,exactEquals:()=>Xi,floor:()=>Ei,forEach:()=>er,fromValues:()=>o,hermite:()=>Li,inverse:()=>yi,len:()=>Ji,length:()=>mi,lerp:()=>Pi,max:()=>Ti,min:()=>Ai,mul:()=>Wi,multiply:()=>bi,negate:()=>Ni,normalize:()=>V,random:()=>Fi,rotateX:()=>Bi,rotateY:()=>Vi,rotateZ:()=>ji,round:()=>Oi,scale:()=>Ii,scaleAndAdd:()=>Si,set:()=>U,sqrDist:()=>Qi,sqrLen:()=>$i,squaredDistance:()=>Ci,squaredLength:()=>Ri,str:()=>Hi,sub:()=>qi,subtract:()=>B,transformMat3:()=>Di,transformMat4:()=>ki,transformQuat:()=>Ui,zero:()=>zi});var F={};wa.r(F);wa.d(F,{add:()=>ar,ceil:()=>hr,clone:()=>ir,copy:()=>nr,create:()=>tr,cross:()=>Ir,dist:()=>Dr,distance:()=>_r,div:()=>kr,divide:()=>ur,dot:()=>Or,equals:()=>Lr,exactEquals:()=>Pr,floor:()=>cr,forEach:()=>jr,fromValues:()=>rr,inverse:()=>Ar,len:()=>Br,length:()=>vr,lerp:()=>Sr,max:()=>gr,min:()=>fr,mul:()=>Fr,multiply:()=>lr,negate:()=>Er,normalize:()=>Tr,random:()=>Mr,round:()=>dr,scale:()=>mr,scaleAndAdd:()=>pr,set:()=>sr,sqrDist:()=>Ur,sqrLen:()=>Vr,squaredDistance:()=>br,squaredLength:()=>xr,str:()=>yr,sub:()=>wr,subtract:()=>or,transformMat4:()=>Cr,transformQuat:()=>Rr,zero:()=>Nr});var k={};wa.r(k);wa.d(k,{add:()=>cn,calculateW:()=>Kr,clone:()=>on,conjugate:()=>rn,copy:()=>un,create:()=>s,dot:()=>dn,equals:()=>An,exactEquals:()=>En,exp:()=>Qr,fromEuler:()=>sn,fromMat3:()=>nn,fromValues:()=>ln,getAngle:()=>Xr,getAxisAngle:()=>Hr,identity:()=>Gr,invert:()=>tn,len:()=>_n,length:()=>pn,lerp:()=>mn,ln:()=>Jr,mul:()=>fn,multiply:()=>Yr,normalize:()=>xn,pow:()=>$r,random:()=>en,rotateX:()=>qr,rotateY:()=>Wr,rotateZ:()=>Zr,rotationTo:()=>Tn,scale:()=>gn,set:()=>hn,setAxes:()=>In,setAxisAngle:()=>zr,slerp:()=>l,sqlerp:()=>On,sqrLen:()=>vn,squaredLength:()=>bn,str:()=>an});var H={};wa.r(H);wa.d(H,{add:()=>Zn,clone:()=>Mn,conjugate:()=>is,copy:()=>wn,create:()=>Sn,dot:()=>$n,equals:()=>us,exactEquals:()=>ls,fromMat4:()=>Ln,fromRotation:()=>Pn,fromRotationTranslation:()=>Nn,fromRotationTranslationValues:()=>Rn,fromTranslation:()=>yn,fromValues:()=>Cn,getDual:()=>Un,getReal:()=>Dn,getTranslation:()=>jn,identity:()=>Fn,invert:()=>ts,len:()=>ns,length:()=>rs,lerp:()=>es,mul:()=>Qn,multiply:()=>Kn,normalize:()=>as,rotateAroundAxis:()=>Wn,rotateByQuatAppend:()=>Yn,rotateByQuatPrepend:()=>qn,rotateX:()=>zn,rotateY:()=>Hn,rotateZ:()=>Xn,scale:()=>Jn,set:()=>kn,setDual:()=>Vn,setReal:()=>Bn,sqrLen:()=>ss,squaredLength:()=>f,str:()=>os,translate:()=>Gn});var X={};wa.r(X);wa.d(X,{add:()=>gs,angle:()=>Vs,ceil:()=>_s,clone:()=>hs,copy:()=>fs,create:()=>e,cross:()=>Ps,dist:()=>Zs,distance:()=>Os,div:()=>Ws,divide:()=>ps,dot:()=>ys,equals:()=>Hs,exactEquals:()=>zs,floor:()=>bs,forEach:()=>Js,fromValues:()=>cs,inverse:()=>Rs,len:()=>Xs,length:()=>Ss,lerp:()=>Ls,max:()=>xs,min:()=>vs,mul:()=>qs,multiply:()=>ms,negate:()=>Cs,normalize:()=>Ns,random:()=>ws,rotate:()=>Bs,round:()=>Es,scale:()=>As,scaleAndAdd:()=>Ts,set:()=>z,sqrDist:()=>Ks,sqrLen:()=>Qs,squaredDistance:()=>Is,squaredLength:()=>Ms,str:()=>Gs,sub:()=>Ys,subtract:()=>ds,transformMat2:()=>Fs,transformMat2d:()=>ks,transformMat3:()=>Ds,transformMat4:()=>Us,zero:()=>js});const A=CABLES;const h=CABLES.SHARED;var w=1e-6;var _=typeof Float32Array!=="undefined"?Float32Array:Array;var u=Math.random;function Y(e){_=e}var q=Math.PI/180;function W(e){return e*q}function Z(e,t){return Math.abs(e-t)<=w*Math.max(1,Math.abs(e),Math.abs(t))}if(!Math.hypot)Math.hypot=function(){var e=0,t=arguments.length;while(t--){e+=arguments[t]*arguments[t]}return Math.sqrt(e)};function K(){var e=new _(4);if(_!=Float32Array){e[1]=0;e[2]=0}e[0]=1;e[3]=1;return e}function Q(e){var t=new _(4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}function J(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}function $(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;return e}function ee(e,t,i,r){var n=new _(4);n[0]=e;n[1]=t;n[2]=i;n[3]=r;return n}function te(e,t,i,r,n){e[0]=t;e[1]=i;e[2]=r;e[3]=n;return e}function ie(e,t){if(e===t){var i=t[1];e[1]=t[2];e[2]=i}else{e[0]=t[0];e[1]=t[2];e[2]=t[1];e[3]=t[3]}return e}function re(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=i*s-n*r;if(!a){return null}a=1/a;e[0]=s*a;e[1]=-r*a;e[2]=-n*a;e[3]=i*a;return e}function ne(e,t){var i=t[0];e[0]=t[3];e[1]=-t[1];e[2]=-t[2];e[3]=i;return e}function se(e){return e[0]*e[3]-e[2]*e[1]}function ae(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3];var o=i[0],l=i[1],u=i[2],h=i[3];e[0]=r*o+s*l;e[1]=n*o+a*l;e[2]=r*u+s*h;e[3]=n*u+a*h;return e}function oe(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3];var o=Math.sin(i);var l=Math.cos(i);e[0]=r*l+s*o;e[1]=n*l+a*o;e[2]=r*-o+s*l;e[3]=n*-o+a*l;return e}function le(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3];var o=i[0],l=i[1];e[0]=r*o;e[1]=n*o;e[2]=s*l;e[3]=a*l;return e}function ue(e,t){var i=Math.sin(t);var r=Math.cos(t);e[0]=r;e[1]=i;e[2]=-i;e[3]=r;return e}function he(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=t[1];return e}function ce(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function fe(e){return Math.hypot(e[0],e[1],e[2],e[3])}function ge(e,t,i,r){e[2]=r[2]/r[0];i[0]=r[0];i[1]=r[1];i[3]=r[3]-e[2]*i[1];return[e,t,i]}function de(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];return e}function me(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];return e}function pe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function _e(e,t){var i=e[0],r=e[1],n=e[2],s=e[3];var a=t[0],o=t[1],l=t[2],u=t[3];return Math.abs(i-a)<=w*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-o)<=w*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-l)<=w*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-u)<=w*Math.max(1,Math.abs(s),Math.abs(u))}function be(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;return e}function ve(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;e[3]=t[3]+i[3]*r;return e}var xe=ae;var Ee=me;function Ae(){var e=new _(6);if(_!=Float32Array){e[1]=0;e[2]=0;e[4]=0;e[5]=0}e[0]=1;e[3]=1;return e}function Te(e){var t=new _(6);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];return t}function Oe(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];return e}function Ie(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;return e}function Se(e,t,i,r,n,s){var a=new _(6);a[0]=e;a[1]=t;a[2]=i;a[3]=r;a[4]=n;a[5]=s;return a}function Me(e,t,i,r,n,s,a){e[0]=t;e[1]=i;e[2]=r;e[3]=n;e[4]=s;e[5]=a;return e}function Ce(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=t[4],o=t[5];var l=i*s-r*n;if(!l){return null}l=1/l;e[0]=s*l;e[1]=-r*l;e[2]=-n*l;e[3]=i*l;e[4]=(n*o-s*a)*l;e[5]=(r*a-i*o)*l;return e}function Re(e){return e[0]*e[3]-e[1]*e[2]}function Ne(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var u=i[0],h=i[1],c=i[2],f=i[3],g=i[4],d=i[5];e[0]=r*u+s*h;e[1]=n*u+a*h;e[2]=r*c+s*f;e[3]=n*c+a*f;e[4]=r*g+s*d+o;e[5]=n*g+a*d+l;return e}function ye(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var u=Math.sin(i);var h=Math.cos(i);e[0]=r*h+s*u;e[1]=n*h+a*u;e[2]=r*-u+s*h;e[3]=n*-u+a*h;e[4]=o;e[5]=l;return e}function Pe(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var u=i[0],h=i[1];e[0]=r*u;e[1]=n*u;e[2]=s*h;e[3]=a*h;e[4]=o;e[5]=l;return e}function Le(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5];var u=i[0],h=i[1];e[0]=r;e[1]=n;e[2]=s;e[3]=a;e[4]=r*u+s*h+o;e[5]=n*u+a*h+l;return e}function we(e,t){var i=Math.sin(t),r=Math.cos(t);e[0]=r;e[1]=i;e[2]=-i;e[3]=r;e[4]=0;e[5]=0;return e}function Fe(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=t[1];e[4]=0;e[5]=0;return e}function ke(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=t[0];e[5]=t[1];return e}function De(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function Ue(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function Be(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];return e}function Ve(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];return e}function je(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;return e}function Ge(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;e[3]=t[3]+i[3]*r;e[4]=t[4]+i[4]*r;e[5]=t[5]+i[5]*r;return e}function ze(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function He(e,t){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5];var l=t[0],u=t[1],h=t[2],c=t[3],f=t[4],g=t[5];return Math.abs(i-l)<=w*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-u)<=w*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-h)<=w*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(s-c)<=w*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(a-f)<=w*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-g)<=w*Math.max(1,Math.abs(o),Math.abs(g))}var Xe=Ne;var Ye=Ve;function qe(){var e=new _(9);if(_!=Float32Array){e[1]=0;e[2]=0;e[3]=0;e[5]=0;e[6]=0;e[7]=0}e[0]=1;e[4]=1;e[8]=1;return e}function We(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[4];e[4]=t[5];e[5]=t[6];e[6]=t[8];e[7]=t[9];e[8]=t[10];return e}function Ze(e){var t=new _(9);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t}function Ke(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e}function Qe(e,t,i,r,n,s,a,o,l){var u=new _(9);u[0]=e;u[1]=t;u[2]=i;u[3]=r;u[4]=n;u[5]=s;u[6]=a;u[7]=o;u[8]=l;return u}function Je(e,t,i,r,n,s,a,o,l,u){e[0]=t;e[1]=i;e[2]=r;e[3]=n;e[4]=s;e[5]=a;e[6]=o;e[7]=l;e[8]=u;return e}function $e(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function et(e,t){if(e===t){var i=t[1],r=t[2],n=t[5];e[1]=t[3];e[2]=t[6];e[3]=i;e[5]=t[7];e[6]=r;e[7]=n}else{e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8]}return e}function tt(e,t){var i=t[0],r=t[1],n=t[2];var s=t[3],a=t[4],o=t[5];var l=t[6],u=t[7],h=t[8];var c=h*a-o*u;var f=-h*s+o*l;var g=u*s-a*l;var d=i*c+r*f+n*g;if(!d){return null}d=1/d;e[0]=c*d;e[1]=(-h*r+n*u)*d;e[2]=(o*r-n*a)*d;e[3]=f*d;e[4]=(h*i-n*l)*d;e[5]=(-o*i+n*s)*d;e[6]=g*d;e[7]=(-u*i+r*l)*d;e[8]=(a*i-r*s)*d;return e}function it(e,t){var i=t[0],r=t[1],n=t[2];var s=t[3],a=t[4],o=t[5];var l=t[6],u=t[7],h=t[8];e[0]=a*h-o*u;e[1]=n*u-r*h;e[2]=r*o-n*a;e[3]=o*l-s*h;e[4]=i*h-n*l;e[5]=n*s-i*o;e[6]=s*u-a*l;e[7]=r*l-i*u;e[8]=i*a-r*s;return e}function rt(e){var t=e[0],i=e[1],r=e[2];var n=e[3],s=e[4],a=e[5];var o=e[6],l=e[7],u=e[8];return t*(u*s-a*l)+i*(-u*n+a*o)+r*(l*n-s*o)}function nt(e,t,i){var r=t[0],n=t[1],s=t[2];var a=t[3],o=t[4],l=t[5];var u=t[6],h=t[7],c=t[8];var f=i[0],g=i[1],d=i[2];var m=i[3],p=i[4],_=i[5];var b=i[6],v=i[7],x=i[8];e[0]=f*r+g*a+d*u;e[1]=f*n+g*o+d*h;e[2]=f*s+g*l+d*c;e[3]=m*r+p*a+_*u;e[4]=m*n+p*o+_*h;e[5]=m*s+p*l+_*c;e[6]=b*r+v*a+x*u;e[7]=b*n+v*o+x*h;e[8]=b*s+v*l+x*c;return e}function st(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=t[8],f=i[0],g=i[1];e[0]=r;e[1]=n;e[2]=s;e[3]=a;e[4]=o;e[5]=l;e[6]=f*r+g*a+u;e[7]=f*n+g*o+h;e[8]=f*s+g*l+c;return e}function at(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=t[8],f=Math.sin(i),g=Math.cos(i);e[0]=g*r+f*a;e[1]=g*n+f*o;e[2]=g*s+f*l;e[3]=g*a-f*r;e[4]=g*o-f*n;e[5]=g*l-f*s;e[6]=u;e[7]=h;e[8]=c;return e}function ot(e,t,i){var r=i[0],n=i[1];e[0]=r*t[0];e[1]=r*t[1];e[2]=r*t[2];e[3]=n*t[3];e[4]=n*t[4];e[5]=n*t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e}function lt(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=t[0];e[7]=t[1];e[8]=1;return e}function ut(e,t){var i=Math.sin(t),r=Math.cos(t);e[0]=r;e[1]=i;e[2]=0;e[3]=-i;e[4]=r;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function ht(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=0;e[4]=t[1];e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e}function ct(e,t){e[0]=t[0];e[1]=t[1];e[2]=0;e[3]=t[2];e[4]=t[3];e[5]=0;e[6]=t[4];e[7]=t[5];e[8]=1;return e}function ft(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=i+i;var o=r+r;var l=n+n;var u=i*a;var h=r*a;var c=r*o;var f=n*a;var g=n*o;var d=n*l;var m=s*a;var p=s*o;var _=s*l;e[0]=1-c-d;e[3]=h-_;e[6]=f+p;e[1]=h+_;e[4]=1-u-d;e[7]=g-m;e[2]=f-p;e[5]=g+m;e[8]=1-u-c;return e}function gt(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=t[4],o=t[5],l=t[6],u=t[7];var h=t[8],c=t[9],f=t[10],g=t[11];var d=t[12],m=t[13],p=t[14],_=t[15];var b=i*o-r*a;var v=i*l-n*a;var x=i*u-s*a;var E=r*l-n*o;var A=r*u-s*o;var T=n*u-s*l;var O=h*m-c*d;var I=h*p-f*d;var S=h*_-g*d;var M=c*p-f*m;var C=c*_-g*m;var R=f*_-g*p;var N=b*R-v*C+x*M+E*S-A*I+T*O;if(!N){return null}N=1/N;e[0]=(o*R-l*C+u*M)*N;e[1]=(l*S-a*R-u*I)*N;e[2]=(a*C-o*S+u*O)*N;e[3]=(n*C-r*R-s*M)*N;e[4]=(i*R-n*S+s*I)*N;e[5]=(r*S-i*C-s*O)*N;e[6]=(m*T-p*A+_*E)*N;e[7]=(p*x-d*T-_*v)*N;e[8]=(d*A-m*x+_*b)*N;return e}function dt(e,t,i){e[0]=2/t;e[1]=0;e[2]=0;e[3]=0;e[4]=-2/i;e[5]=0;e[6]=-1;e[7]=1;e[8]=1;return e}function mt(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function pt(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function _t(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];e[8]=t[8]+i[8];return e}function bt(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];e[6]=t[6]-i[6];e[7]=t[7]-i[7];e[8]=t[8]-i[8];return e}function vt(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;e[8]=t[8]*i;return e}function xt(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;e[3]=t[3]+i[3]*r;e[4]=t[4]+i[4]*r;e[5]=t[5]+i[5]*r;e[6]=t[6]+i[6]*r;e[7]=t[7]+i[7]*r;e[8]=t[8]+i[8]*r;return e}function Et(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function At(e,t){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7],h=e[8];var c=t[0],f=t[1],g=t[2],d=t[3],m=t[4],p=t[5],_=t[6],b=t[7],v=t[8];return Math.abs(i-c)<=w*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(r-f)<=w*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-g)<=w*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(s-d)<=w*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-m)<=w*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(o-p)<=w*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(l-_)<=w*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(u-b)<=w*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(h-v)<=w*Math.max(1,Math.abs(h),Math.abs(v))}var Tt=nt;var Ot=bt;function r(){var e=new _(16);if(_!=Float32Array){e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[11]=0;e[12]=0;e[13]=0;e[14]=0}e[0]=1;e[5]=1;e[10]=1;e[15]=1;return e}function It(e){var t=new _(16);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];t[9]=e[9];t[10]=e[10];t[11]=e[11];t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15];return t}function St(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e}function Mt(e,t,i,r,n,s,a,o,l,u,h,c,f,g,d,m){var p=new _(16);p[0]=e;p[1]=t;p[2]=i;p[3]=r;p[4]=n;p[5]=s;p[6]=a;p[7]=o;p[8]=l;p[9]=u;p[10]=h;p[11]=c;p[12]=f;p[13]=g;p[14]=d;p[15]=m;return p}function Ct(e,t,i,r,n,s,a,o,l,u,h,c,f,g,d,m,p){e[0]=t;e[1]=i;e[2]=r;e[3]=n;e[4]=s;e[5]=a;e[6]=o;e[7]=l;e[8]=u;e[9]=h;e[10]=c;e[11]=f;e[12]=g;e[13]=d;e[14]=m;e[15]=p;return e}function T(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Rt(e,t){if(e===t){var i=t[1],r=t[2],n=t[3];var s=t[6],a=t[7];var o=t[11];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=i;e[6]=t[9];e[7]=t[13];e[8]=r;e[9]=s;e[11]=t[14];e[12]=n;e[13]=a;e[14]=o}else{e[0]=t[0];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=t[1];e[5]=t[5];e[6]=t[9];e[7]=t[13];e[8]=t[2];e[9]=t[6];e[10]=t[10];e[11]=t[14];e[12]=t[3];e[13]=t[7];e[14]=t[11];e[15]=t[15]}return e}function t(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=t[4],o=t[5],l=t[6],u=t[7];var h=t[8],c=t[9],f=t[10],g=t[11];var d=t[12],m=t[13],p=t[14],_=t[15];var b=i*o-r*a;var v=i*l-n*a;var x=i*u-s*a;var E=r*l-n*o;var A=r*u-s*o;var T=n*u-s*l;var O=h*m-c*d;var I=h*p-f*d;var S=h*_-g*d;var M=c*p-f*m;var C=c*_-g*m;var R=f*_-g*p;var N=b*R-v*C+x*M+E*S-A*I+T*O;if(!N){return null}N=1/N;e[0]=(o*R-l*C+u*M)*N;e[1]=(n*C-r*R-s*M)*N;e[2]=(m*T-p*A+_*E)*N;e[3]=(f*A-c*T-g*E)*N;e[4]=(l*S-a*R-u*I)*N;e[5]=(i*R-n*S+s*I)*N;e[6]=(p*x-d*T-_*v)*N;e[7]=(h*T-f*x+g*v)*N;e[8]=(a*C-o*S+u*O)*N;e[9]=(r*S-i*C-s*O)*N;e[10]=(d*A-m*x+_*b)*N;e[11]=(c*x-h*A-g*b)*N;e[12]=(o*I-a*M-l*O)*N;e[13]=(i*M-r*I+n*O)*N;e[14]=(m*v-d*E-p*b)*N;e[15]=(h*E-c*v+f*b)*N;return e}function Nt(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=t[4],o=t[5],l=t[6],u=t[7];var h=t[8],c=t[9],f=t[10],g=t[11];var d=t[12],m=t[13],p=t[14],_=t[15];e[0]=o*(f*_-g*p)-c*(l*_-u*p)+m*(l*g-u*f);e[1]=-(r*(f*_-g*p)-c*(n*_-s*p)+m*(n*g-s*f));e[2]=r*(l*_-u*p)-o*(n*_-s*p)+m*(n*u-s*l);e[3]=-(r*(l*g-u*f)-o*(n*g-s*f)+c*(n*u-s*l));e[4]=-(a*(f*_-g*p)-h*(l*_-u*p)+d*(l*g-u*f));e[5]=i*(f*_-g*p)-h*(n*_-s*p)+d*(n*g-s*f);e[6]=-(i*(l*_-u*p)-a*(n*_-s*p)+d*(n*u-s*l));e[7]=i*(l*g-u*f)-a*(n*g-s*f)+h*(n*u-s*l);e[8]=a*(c*_-g*m)-h*(o*_-u*m)+d*(o*g-u*c);e[9]=-(i*(c*_-g*m)-h*(r*_-s*m)+d*(r*g-s*c));e[10]=i*(o*_-u*m)-a*(r*_-s*m)+d*(r*u-s*o);e[11]=-(i*(o*g-u*c)-a*(r*g-s*c)+h*(r*u-s*o));e[12]=-(a*(c*p-f*m)-h*(o*p-l*m)+d*(o*f-l*c));e[13]=i*(c*p-f*m)-h*(r*p-n*m)+d*(r*f-n*c);e[14]=-(i*(o*p-l*m)-a*(r*p-n*m)+d*(r*l-n*o));e[15]=i*(o*f-l*c)-a*(r*f-n*c)+h*(r*l-n*o);return e}function yt(e){var t=e[0],i=e[1],r=e[2],n=e[3];var s=e[4],a=e[5],o=e[6],l=e[7];var u=e[8],h=e[9],c=e[10],f=e[11];var g=e[12],d=e[13],m=e[14],p=e[15];var _=t*a-i*s;var b=t*o-r*s;var v=t*l-n*s;var x=i*o-r*a;var E=i*l-n*a;var A=r*l-n*o;var T=u*d-h*g;var O=u*m-c*g;var I=u*p-f*g;var S=h*m-c*d;var M=h*p-f*d;var C=c*p-f*m;return _*C-b*M+v*S+x*I-E*O+A*T}function Pt(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3];var o=t[4],l=t[5],u=t[6],h=t[7];var c=t[8],f=t[9],g=t[10],d=t[11];var m=t[12],p=t[13],_=t[14],b=t[15];var v=i[0],x=i[1],E=i[2],A=i[3];e[0]=v*r+x*o+E*c+A*m;e[1]=v*n+x*l+E*f+A*p;e[2]=v*s+x*u+E*g+A*_;e[3]=v*a+x*h+E*d+A*b;v=i[4];x=i[5];E=i[6];A=i[7];e[4]=v*r+x*o+E*c+A*m;e[5]=v*n+x*l+E*f+A*p;e[6]=v*s+x*u+E*g+A*_;e[7]=v*a+x*h+E*d+A*b;v=i[8];x=i[9];E=i[10];A=i[11];e[8]=v*r+x*o+E*c+A*m;e[9]=v*n+x*l+E*f+A*p;e[10]=v*s+x*u+E*g+A*_;e[11]=v*a+x*h+E*d+A*b;v=i[12];x=i[13];E=i[14];A=i[15];e[12]=v*r+x*o+E*c+A*m;e[13]=v*n+x*l+E*f+A*p;e[14]=v*s+x*u+E*g+A*_;e[15]=v*a+x*h+E*d+A*b;return e}function n(e,t,i){var r=i[0],n=i[1],s=i[2];var a,o,l,u;var h,c,f,g;var d,m,p,_;if(t===e){e[12]=t[0]*r+t[4]*n+t[8]*s+t[12];e[13]=t[1]*r+t[5]*n+t[9]*s+t[13];e[14]=t[2]*r+t[6]*n+t[10]*s+t[14];e[15]=t[3]*r+t[7]*n+t[11]*s+t[15]}else{a=t[0];o=t[1];l=t[2];u=t[3];h=t[4];c=t[5];f=t[6];g=t[7];d=t[8];m=t[9];p=t[10];_=t[11];e[0]=a;e[1]=o;e[2]=l;e[3]=u;e[4]=h;e[5]=c;e[6]=f;e[7]=g;e[8]=d;e[9]=m;e[10]=p;e[11]=_;e[12]=a*r+h*n+d*s+t[12];e[13]=o*r+c*n+m*s+t[13];e[14]=l*r+f*n+p*s+t[14];e[15]=u*r+g*n+_*s+t[15]}return e}function Lt(e,t,i){var r=i[0],n=i[1],s=i[2];e[0]=t[0]*r;e[1]=t[1]*r;e[2]=t[2]*r;e[3]=t[3]*r;e[4]=t[4]*n;e[5]=t[5]*n;e[6]=t[6]*n;e[7]=t[7]*n;e[8]=t[8]*s;e[9]=t[9]*s;e[10]=t[10]*s;e[11]=t[11]*s;e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e}function wt(e,t,i,r){var n=r[0],s=r[1],a=r[2];var o=Math.hypot(n,s,a);var l,u,h;var c,f,g,d;var m,p,_,b;var v,x,E,A;var T,O,I;var S,M,C;var R,N,y;if(o<w){return null}o=1/o;n*=o;s*=o;a*=o;l=Math.sin(i);u=Math.cos(i);h=1-u;c=t[0];f=t[1];g=t[2];d=t[3];m=t[4];p=t[5];_=t[6];b=t[7];v=t[8];x=t[9];E=t[10];A=t[11];T=n*n*h+u;O=s*n*h+a*l;I=a*n*h-s*l;S=n*s*h-a*l;M=s*s*h+u;C=a*s*h+n*l;R=n*a*h+s*l;N=s*a*h-n*l;y=a*a*h+u;e[0]=c*T+m*O+v*I;e[1]=f*T+p*O+x*I;e[2]=g*T+_*O+E*I;e[3]=d*T+b*O+A*I;e[4]=c*S+m*M+v*C;e[5]=f*S+p*M+x*C;e[6]=g*S+_*M+E*C;e[7]=d*S+b*M+A*C;e[8]=c*R+m*N+v*y;e[9]=f*R+p*N+x*y;e[10]=g*R+_*N+E*y;e[11]=d*R+b*N+A*y;if(t!==e){e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}return e}function Ft(e,t,i){var r=Math.sin(i);var n=Math.cos(i);var s=t[4];var a=t[5];var o=t[6];var l=t[7];var u=t[8];var h=t[9];var c=t[10];var f=t[11];if(t!==e){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[4]=s*n+u*r;e[5]=a*n+h*r;e[6]=o*n+c*r;e[7]=l*n+f*r;e[8]=u*n-s*r;e[9]=h*n-a*r;e[10]=c*n-o*r;e[11]=f*n-l*r;return e}function kt(e,t,i){var r=Math.sin(i);var n=Math.cos(i);var s=t[0];var a=t[1];var o=t[2];var l=t[3];var u=t[8];var h=t[9];var c=t[10];var f=t[11];if(t!==e){e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=s*n-u*r;e[1]=a*n-h*r;e[2]=o*n-c*r;e[3]=l*n-f*r;e[8]=s*r+u*n;e[9]=a*r+h*n;e[10]=o*r+c*n;e[11]=l*r+f*n;return e}function Dt(e,t,i){var r=Math.sin(i);var n=Math.cos(i);var s=t[0];var a=t[1];var o=t[2];var l=t[3];var u=t[4];var h=t[5];var c=t[6];var f=t[7];if(t!==e){e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=s*n+u*r;e[1]=a*n+h*r;e[2]=o*n+c*r;e[3]=l*n+f*r;e[4]=u*n-s*r;e[5]=h*n-a*r;e[6]=c*n-o*r;e[7]=f*n-l*r;return e}function Ut(e,t){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=t[0];e[13]=t[1];e[14]=t[2];e[15]=1;return e}function Bt(e,t){e[0]=t[0];e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=t[1];e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=t[2];e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Vt(e,t,i){var r=i[0],n=i[1],s=i[2];var a=Math.hypot(r,n,s);var o,l,u;if(a<w){return null}a=1/a;r*=a;n*=a;s*=a;o=Math.sin(t);l=Math.cos(t);u=1-l;e[0]=r*r*u+l;e[1]=n*r*u+s*o;e[2]=s*r*u-n*o;e[3]=0;e[4]=r*n*u-s*o;e[5]=n*n*u+l;e[6]=s*n*u+r*o;e[7]=0;e[8]=r*s*u+n*o;e[9]=n*s*u-r*o;e[10]=s*s*u+l;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function jt(e,t){var i=Math.sin(t);var r=Math.cos(t);e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=r;e[6]=i;e[7]=0;e[8]=0;e[9]=-i;e[10]=r;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Gt(e,t){var i=Math.sin(t);var r=Math.cos(t);e[0]=r;e[1]=0;e[2]=-i;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=i;e[9]=0;e[10]=r;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function zt(e,t){var i=Math.sin(t);var r=Math.cos(t);e[0]=r;e[1]=i;e[2]=0;e[3]=0;e[4]=-i;e[5]=r;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Ht(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3];var o=r+r;var l=n+n;var u=s+s;var h=r*o;var c=r*l;var f=r*u;var g=n*l;var d=n*u;var m=s*u;var p=a*o;var _=a*l;var b=a*u;e[0]=1-(g+m);e[1]=c+b;e[2]=f-_;e[3]=0;e[4]=c-b;e[5]=1-(h+m);e[6]=d+p;e[7]=0;e[8]=f+_;e[9]=d-p;e[10]=1-(h+g);e[11]=0;e[12]=i[0];e[13]=i[1];e[14]=i[2];e[15]=1;return e}function Xt(e,t){var i=new _(3);var r=-t[0],n=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7];var c=r*r+n*n+s*s+a*a;if(c>0){i[0]=(o*a+h*r+l*s-u*n)*2/c;i[1]=(l*a+h*n+u*r-o*s)*2/c;i[2]=(u*a+h*s+o*n-l*r)*2/c}else{i[0]=(o*a+h*r+l*s-u*n)*2;i[1]=(l*a+h*n+u*r-o*s)*2;i[2]=(u*a+h*s+o*n-l*r)*2}Ht(e,t,i);return e}function Yt(e,t){e[0]=t[12];e[1]=t[13];e[2]=t[14];return e}function qt(e,t){var i=t[0];var r=t[1];var n=t[2];var s=t[4];var a=t[5];var o=t[6];var l=t[8];var u=t[9];var h=t[10];e[0]=Math.hypot(i,r,n);e[1]=Math.hypot(s,a,o);e[2]=Math.hypot(l,u,h);return e}function Wt(e,t){var i=new _(3);qt(i,t);var r=1/i[0];var n=1/i[1];var s=1/i[2];var a=t[0]*r;var o=t[1]*n;var l=t[2]*s;var u=t[4]*r;var h=t[5]*n;var c=t[6]*s;var f=t[8]*r;var g=t[9]*n;var d=t[10]*s;var m=a+h+d;var p=0;if(m>0){p=Math.sqrt(m+1)*2;e[3]=.25*p;e[0]=(c-g)/p;e[1]=(f-l)/p;e[2]=(o-u)/p}else if(a>h&&a>d){p=Math.sqrt(1+a-h-d)*2;e[3]=(c-g)/p;e[0]=.25*p;e[1]=(o+u)/p;e[2]=(f+l)/p}else if(h>d){p=Math.sqrt(1+h-a-d)*2;e[3]=(f-l)/p;e[0]=(o+u)/p;e[1]=.25*p;e[2]=(c+g)/p}else{p=Math.sqrt(1+d-a-h)*2;e[3]=(o-u)/p;e[0]=(f+l)/p;e[1]=(c+g)/p;e[2]=.25*p}return e}function Zt(e,t,i,r){var n=t[0],s=t[1],a=t[2],o=t[3];var l=n+n;var u=s+s;var h=a+a;var c=n*l;var f=n*u;var g=n*h;var d=s*u;var m=s*h;var p=a*h;var _=o*l;var b=o*u;var v=o*h;var x=r[0];var E=r[1];var A=r[2];e[0]=(1-(d+p))*x;e[1]=(f+v)*x;e[2]=(g-b)*x;e[3]=0;e[4]=(f-v)*E;e[5]=(1-(c+p))*E;e[6]=(m+_)*E;e[7]=0;e[8]=(g+b)*A;e[9]=(m-_)*A;e[10]=(1-(c+d))*A;e[11]=0;e[12]=i[0];e[13]=i[1];e[14]=i[2];e[15]=1;return e}function Kt(e,t,i,r,n){var s=t[0],a=t[1],o=t[2],l=t[3];var u=s+s;var h=a+a;var c=o+o;var f=s*u;var g=s*h;var d=s*c;var m=a*h;var p=a*c;var _=o*c;var b=l*u;var v=l*h;var x=l*c;var E=r[0];var A=r[1];var T=r[2];var O=n[0];var I=n[1];var S=n[2];var M=(1-(m+_))*E;var C=(g+x)*E;var R=(d-v)*E;var N=(g-x)*A;var y=(1-(f+_))*A;var P=(p+b)*A;var L=(d+v)*T;var w=(p-b)*T;var F=(1-(f+m))*T;e[0]=M;e[1]=C;e[2]=R;e[3]=0;e[4]=N;e[5]=y;e[6]=P;e[7]=0;e[8]=L;e[9]=w;e[10]=F;e[11]=0;e[12]=i[0]+O-(M*O+N*I+L*S);e[13]=i[1]+I-(C*O+y*I+w*S);e[14]=i[2]+S-(R*O+P*I+F*S);e[15]=1;return e}function Qt(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=i+i;var o=r+r;var l=n+n;var u=i*a;var h=r*a;var c=r*o;var f=n*a;var g=n*o;var d=n*l;var m=s*a;var p=s*o;var _=s*l;e[0]=1-c-d;e[1]=h+_;e[2]=f-p;e[3]=0;e[4]=h-_;e[5]=1-u-d;e[6]=g+m;e[7]=0;e[8]=f+p;e[9]=g-m;e[10]=1-u-c;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}function Jt(e,t,i,r,n,s,a){var o=1/(i-t);var l=1/(n-r);var u=1/(s-a);e[0]=s*2*o;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=s*2*l;e[6]=0;e[7]=0;e[8]=(i+t)*o;e[9]=(n+r)*l;e[10]=(a+s)*u;e[11]=-1;e[12]=0;e[13]=0;e[14]=a*s*2*u;e[15]=0;return e}function $t(e,t,i,r,n){var s=1/Math.tan(t/2),a;e[0]=s/i;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=s;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[11]=-1;e[12]=0;e[13]=0;e[15]=0;if(n!=null&&n!==Infinity){a=1/(r-n);e[10]=(n+r)*a;e[14]=2*n*r*a}else{e[10]=-1;e[14]=-2*r}return e}function ei(e,t,i,r){var n=Math.tan(t.upDegrees*Math.PI/180);var s=Math.tan(t.downDegrees*Math.PI/180);var a=Math.tan(t.leftDegrees*Math.PI/180);var o=Math.tan(t.rightDegrees*Math.PI/180);var l=2/(a+o);var u=2/(n+s);e[0]=l;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=u;e[6]=0;e[7]=0;e[8]=-((a-o)*l*.5);e[9]=(n-s)*u*.5;e[10]=r/(i-r);e[11]=-1;e[12]=0;e[13]=0;e[14]=r*i/(i-r);e[15]=0;return e}function ti(e,t,i,r,n,s,a){var o=1/(t-i);var l=1/(r-n);var u=1/(s-a);e[0]=-2*o;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=-2*l;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=2*u;e[11]=0;e[12]=(t+i)*o;e[13]=(n+r)*l;e[14]=(a+s)*u;e[15]=1;return e}function ii(e,t,i,r){var n,s,a,o,l,u,h,c,f,g;var d=t[0];var m=t[1];var p=t[2];var _=r[0];var b=r[1];var v=r[2];var x=i[0];var E=i[1];var A=i[2];if(Math.abs(d-x)<w&&Math.abs(m-E)<w&&Math.abs(p-A)<w){return T(e)}h=d-x;c=m-E;f=p-A;g=1/Math.hypot(h,c,f);h*=g;c*=g;f*=g;n=b*f-v*c;s=v*h-_*f;a=_*c-b*h;g=Math.hypot(n,s,a);if(!g){n=0;s=0;a=0}else{g=1/g;n*=g;s*=g;a*=g}o=c*a-f*s;l=f*n-h*a;u=h*s-c*n;g=Math.hypot(o,l,u);if(!g){o=0;l=0;u=0}else{g=1/g;o*=g;l*=g;u*=g}e[0]=n;e[1]=o;e[2]=h;e[3]=0;e[4]=s;e[5]=l;e[6]=c;e[7]=0;e[8]=a;e[9]=u;e[10]=f;e[11]=0;e[12]=-(n*d+s*m+a*p);e[13]=-(o*d+l*m+u*p);e[14]=-(h*d+c*m+f*p);e[15]=1;return e}function ri(e,t,i,r){var n=t[0],s=t[1],a=t[2],o=r[0],l=r[1],u=r[2];var h=n-i[0],c=s-i[1],f=a-i[2];var g=h*h+c*c+f*f;if(g>0){g=1/Math.sqrt(g);h*=g;c*=g;f*=g}var d=l*f-u*c,m=u*h-o*f,p=o*c-l*h;g=d*d+m*m+p*p;if(g>0){g=1/Math.sqrt(g);d*=g;m*=g;p*=g}e[0]=d;e[1]=m;e[2]=p;e[3]=0;e[4]=c*p-f*m;e[5]=f*d-h*p;e[6]=h*m-c*d;e[7]=0;e[8]=h;e[9]=c;e[10]=f;e[11]=0;e[12]=n;e[13]=s;e[14]=a;e[15]=1;return e}function ni(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function si(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function ai(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];e[8]=t[8]+i[8];e[9]=t[9]+i[9];e[10]=t[10]+i[10];e[11]=t[11]+i[11];e[12]=t[12]+i[12];e[13]=t[13]+i[13];e[14]=t[14]+i[14];e[15]=t[15]+i[15];return e}function oi(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];e[4]=t[4]-i[4];e[5]=t[5]-i[5];e[6]=t[6]-i[6];e[7]=t[7]-i[7];e[8]=t[8]-i[8];e[9]=t[9]-i[9];e[10]=t[10]-i[10];e[11]=t[11]-i[11];e[12]=t[12]-i[12];e[13]=t[13]-i[13];e[14]=t[14]-i[14];e[15]=t[15]-i[15];return e}function li(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;e[8]=t[8]*i;e[9]=t[9]*i;e[10]=t[10]*i;e[11]=t[11]*i;e[12]=t[12]*i;e[13]=t[13]*i;e[14]=t[14]*i;e[15]=t[15]*i;return e}function ui(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;e[3]=t[3]+i[3]*r;e[4]=t[4]+i[4]*r;e[5]=t[5]+i[5]*r;e[6]=t[6]+i[6]*r;e[7]=t[7]+i[7]*r;e[8]=t[8]+i[8]*r;e[9]=t[9]+i[9]*r;e[10]=t[10]+i[10]*r;e[11]=t[11]+i[11]*r;e[12]=t[12]+i[12]*r;e[13]=t[13]+i[13]*r;e[14]=t[14]+i[14]*r;e[15]=t[15]+i[15]*r;return e}function hi(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function ci(e,t){var i=e[0],r=e[1],n=e[2],s=e[3];var a=e[4],o=e[5],l=e[6],u=e[7];var h=e[8],c=e[9],f=e[10],g=e[11];var d=e[12],m=e[13],p=e[14],_=e[15];var b=t[0],v=t[1],x=t[2],E=t[3];var A=t[4],T=t[5],O=t[6],I=t[7];var S=t[8],M=t[9],C=t[10],R=t[11];var N=t[12],y=t[13],P=t[14],L=t[15];return Math.abs(i-b)<=w*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(r-v)<=w*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(n-x)<=w*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(s-E)<=w*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(a-A)<=w*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(o-T)<=w*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(l-O)<=w*Math.max(1,Math.abs(l),Math.abs(O))&&Math.abs(u-I)<=w*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(h-S)<=w*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(c-M)<=w*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(f-C)<=w*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(g-R)<=w*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(d-N)<=w*Math.max(1,Math.abs(d),Math.abs(N))&&Math.abs(m-y)<=w*Math.max(1,Math.abs(m),Math.abs(y))&&Math.abs(p-P)<=w*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(_-L)<=w*Math.max(1,Math.abs(_),Math.abs(L))}var fi=Pt;var gi=oi;function D(){var e=new _(3);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0}return e}function di(e){var t=new _(3);t[0]=e[0];t[1]=e[1];t[2]=e[2];return t}function mi(e){var t=e[0];var i=e[1];var r=e[2];return Math.hypot(t,i,r)}function o(e,t,i){var r=new _(3);r[0]=e;r[1]=t;r[2]=i;return r}function pi(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];return e}function U(e,t,i,r){e[0]=t;e[1]=i;e[2]=r;return e}function _i(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];return e}function B(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];return e}function bi(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];e[2]=t[2]*i[2];return e}function vi(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];e[2]=t[2]/i[2];return e}function xi(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);e[2]=Math.ceil(t[2]);return e}function Ei(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);e[2]=Math.floor(t[2]);return e}function Ai(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);e[2]=Math.min(t[2],i[2]);return e}function Ti(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);e[2]=Math.max(t[2],i[2]);return e}function Oi(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);e[2]=Math.round(t[2]);return e}function Ii(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;return e}function Si(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;return e}function Mi(e,t){var i=t[0]-e[0];var r=t[1]-e[1];var n=t[2]-e[2];return Math.hypot(i,r,n)}function Ci(e,t){var i=t[0]-e[0];var r=t[1]-e[1];var n=t[2]-e[2];return i*i+r*r+n*n}function Ri(e){var t=e[0];var i=e[1];var r=e[2];return t*t+i*i+r*r}function Ni(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];return e}function yi(e,t){e[0]=1/t[0];e[1]=1/t[1];e[2]=1/t[2];return e}function V(e,t){var i=t[0];var r=t[1];var n=t[2];var s=i*i+r*r+n*n;if(s>0){s=1/Math.sqrt(s)}e[0]=t[0]*s;e[1]=t[1]*s;e[2]=t[2]*s;return e}function j(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function G(e,t,i){var r=t[0],n=t[1],s=t[2];var a=i[0],o=i[1],l=i[2];e[0]=n*l-s*o;e[1]=s*a-r*l;e[2]=r*o-n*a;return e}function Pi(e,t,i,r){var n=t[0];var s=t[1];var a=t[2];e[0]=n+r*(i[0]-n);e[1]=s+r*(i[1]-s);e[2]=a+r*(i[2]-a);return e}function Li(e,t,i,r,n,s){var a=s*s;var o=a*(2*s-3)+1;var l=a*(s-2)+s;var u=a*(s-1);var h=a*(3-2*s);e[0]=t[0]*o+i[0]*l+r[0]*u+n[0]*h;e[1]=t[1]*o+i[1]*l+r[1]*u+n[1]*h;e[2]=t[2]*o+i[2]*l+r[2]*u+n[2]*h;return e}function wi(e,t,i,r,n,s){var a=1-s;var o=a*a;var l=s*s;var u=o*a;var h=3*s*o;var c=3*l*a;var f=l*s;e[0]=t[0]*u+i[0]*h+r[0]*c+n[0]*f;e[1]=t[1]*u+i[1]*h+r[1]*c+n[1]*f;e[2]=t[2]*u+i[2]*h+r[2]*c+n[2]*f;return e}function Fi(e,t){t=t||1;var i=u()*2*Math.PI;var r=u()*2-1;var n=Math.sqrt(1-r*r)*t;e[0]=Math.cos(i)*n;e[1]=Math.sin(i)*n;e[2]=r*t;return e}function ki(e,t,i){var r=t[0],n=t[1],s=t[2];var a=i[3]*r+i[7]*n+i[11]*s+i[15];a=a||1;e[0]=(i[0]*r+i[4]*n+i[8]*s+i[12])/a;e[1]=(i[1]*r+i[5]*n+i[9]*s+i[13])/a;e[2]=(i[2]*r+i[6]*n+i[10]*s+i[14])/a;return e}function Di(e,t,i){var r=t[0],n=t[1],s=t[2];e[0]=r*i[0]+n*i[3]+s*i[6];e[1]=r*i[1]+n*i[4]+s*i[7];e[2]=r*i[2]+n*i[5]+s*i[8];return e}function Ui(e,t,i){var r=i[0],n=i[1],s=i[2],a=i[3];var o=t[0],l=t[1],u=t[2];var h=n*u-s*l,c=s*o-r*u,f=r*l-n*o;var g=n*f-s*c,d=s*h-r*f,m=r*c-n*h;var p=a*2;h*=p;c*=p;f*=p;g*=2;d*=2;m*=2;e[0]=o+h+g;e[1]=l+c+d;e[2]=u+f+m;return e}function Bi(e,t,i,r){var n=[],s=[];n[0]=t[0]-i[0];n[1]=t[1]-i[1];n[2]=t[2]-i[2];s[0]=n[0];s[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r);s[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r);e[0]=s[0]+i[0];e[1]=s[1]+i[1];e[2]=s[2]+i[2];return e}function Vi(e,t,i,r){var n=[],s=[];n[0]=t[0]-i[0];n[1]=t[1]-i[1];n[2]=t[2]-i[2];s[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r);s[1]=n[1];s[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r);e[0]=s[0]+i[0];e[1]=s[1]+i[1];e[2]=s[2]+i[2];return e}function ji(e,t,i,r){var n=[],s=[];n[0]=t[0]-i[0];n[1]=t[1]-i[1];n[2]=t[2]-i[2];s[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r);s[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r);s[2]=n[2];e[0]=s[0]+i[0];e[1]=s[1]+i[1];e[2]=s[2]+i[2];return e}function Gi(e,t){var i=o(e[0],e[1],e[2]);var r=o(t[0],t[1],t[2]);V(i,i);V(r,r);var n=j(i,r);if(n>1){return 0}else if(n<-1){return Math.PI}else{return Math.acos(n)}}function zi(e){e[0]=0;e[1]=0;e[2]=0;return e}function Hi(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Xi(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Yi(e,t){var i=e[0],r=e[1],n=e[2];var s=t[0],a=t[1],o=t[2];return Math.abs(i-s)<=w*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-a)<=w*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=w*Math.max(1,Math.abs(n),Math.abs(o))}var qi=B;var Wi=bi;var Zi=vi;var Ki=Mi;var Qi=Ci;var Ji=mi;var $i=Ri;var er=function(){var l=D();return function(e,t,i,r,n,s){var a,o;if(!t){t=3}if(!i){i=0}if(r){o=Math.min(r*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];l[2]=e[a+2];n(l,l,s);e[a]=l[0];e[a+1]=l[1];e[a+2]=l[2]}return e}}();function tr(){var e=new _(4);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0;e[3]=0}return e}function ir(e){var t=new _(4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}function rr(e,t,i,r){var n=new _(4);n[0]=e;n[1]=t;n[2]=i;n[3]=r;return n}function nr(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}function sr(e,t,i,r,n){e[0]=t;e[1]=i;e[2]=r;e[3]=n;return e}function ar(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];return e}function or(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];e[2]=t[2]-i[2];e[3]=t[3]-i[3];return e}function lr(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];e[2]=t[2]*i[2];e[3]=t[3]*i[3];return e}function ur(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];e[2]=t[2]/i[2];e[3]=t[3]/i[3];return e}function hr(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);e[2]=Math.ceil(t[2]);e[3]=Math.ceil(t[3]);return e}function cr(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);e[2]=Math.floor(t[2]);e[3]=Math.floor(t[3]);return e}function fr(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);e[2]=Math.min(t[2],i[2]);e[3]=Math.min(t[3],i[3]);return e}function gr(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);e[2]=Math.max(t[2],i[2]);e[3]=Math.max(t[3],i[3]);return e}function dr(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);e[2]=Math.round(t[2]);e[3]=Math.round(t[3]);return e}function mr(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;return e}function pr(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;e[2]=t[2]+i[2]*r;e[3]=t[3]+i[3]*r;return e}function _r(e,t){var i=t[0]-e[0];var r=t[1]-e[1];var n=t[2]-e[2];var s=t[3]-e[3];return Math.hypot(i,r,n,s)}function br(e,t){var i=t[0]-e[0];var r=t[1]-e[1];var n=t[2]-e[2];var s=t[3]-e[3];return i*i+r*r+n*n+s*s}function vr(e){var t=e[0];var i=e[1];var r=e[2];var n=e[3];return Math.hypot(t,i,r,n)}function xr(e){var t=e[0];var i=e[1];var r=e[2];var n=e[3];return t*t+i*i+r*r+n*n}function Er(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=-t[3];return e}function Ar(e,t){e[0]=1/t[0];e[1]=1/t[1];e[2]=1/t[2];e[3]=1/t[3];return e}function Tr(e,t){var i=t[0];var r=t[1];var n=t[2];var s=t[3];var a=i*i+r*r+n*n+s*s;if(a>0){a=1/Math.sqrt(a)}e[0]=i*a;e[1]=r*a;e[2]=n*a;e[3]=s*a;return e}function Or(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Ir(e,t,i,r){var n=i[0]*r[1]-i[1]*r[0],s=i[0]*r[2]-i[2]*r[0],a=i[0]*r[3]-i[3]*r[0],o=i[1]*r[2]-i[2]*r[1],l=i[1]*r[3]-i[3]*r[1],u=i[2]*r[3]-i[3]*r[2];var h=t[0];var c=t[1];var f=t[2];var g=t[3];e[0]=c*u-f*l+g*o;e[1]=-(h*u)+f*a-g*s;e[2]=h*l-c*a+g*n;e[3]=-(h*o)+c*s-f*n;return e}function Sr(e,t,i,r){var n=t[0];var s=t[1];var a=t[2];var o=t[3];e[0]=n+r*(i[0]-n);e[1]=s+r*(i[1]-s);e[2]=a+r*(i[2]-a);e[3]=o+r*(i[3]-o);return e}function Mr(e,t){t=t||1;var i,r,n,s;var a,o;do{i=u()*2-1;r=u()*2-1;a=i*i+r*r}while(a>=1);do{n=u()*2-1;s=u()*2-1;o=n*n+s*s}while(o>=1);var l=Math.sqrt((1-a)/o);e[0]=t*i;e[1]=t*r;e[2]=t*n*l;e[3]=t*s*l;return e}function Cr(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3];e[0]=i[0]*r+i[4]*n+i[8]*s+i[12]*a;e[1]=i[1]*r+i[5]*n+i[9]*s+i[13]*a;e[2]=i[2]*r+i[6]*n+i[10]*s+i[14]*a;e[3]=i[3]*r+i[7]*n+i[11]*s+i[15]*a;return e}function Rr(e,t,i){var r=t[0],n=t[1],s=t[2];var a=i[0],o=i[1],l=i[2],u=i[3];var h=u*r+o*s-l*n;var c=u*n+l*r-a*s;var f=u*s+a*n-o*r;var g=-a*r-o*n-l*s;e[0]=h*u+g*-a+c*-l-f*-o;e[1]=c*u+g*-o+f*-a-h*-l;e[2]=f*u+g*-l+h*-o-c*-a;e[3]=t[3];return e}function Nr(e){e[0]=0;e[1]=0;e[2]=0;e[3]=0;return e}function yr(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Pr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Lr(e,t){var i=e[0],r=e[1],n=e[2],s=e[3];var a=t[0],o=t[1],l=t[2],u=t[3];return Math.abs(i-a)<=w*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-o)<=w*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-l)<=w*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-u)<=w*Math.max(1,Math.abs(s),Math.abs(u))}var wr=or;var Fr=lr;var kr=ur;var Dr=_r;var Ur=br;var Br=vr;var Vr=xr;var jr=function(){var l=tr();return function(e,t,i,r,n,s){var a,o;if(!t){t=4}if(!i){i=0}if(r){o=Math.min(r*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];l[2]=e[a+2];l[3]=e[a+3];n(l,l,s);e[a]=l[0];e[a+1]=l[1];e[a+2]=l[2];e[a+3]=l[3]}return e}}();function s(){var e=new _(4);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0}e[3]=1;return e}function Gr(e){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e}function zr(e,t,i){i=i*.5;var r=Math.sin(i);e[0]=r*t[0];e[1]=r*t[1];e[2]=r*t[2];e[3]=Math.cos(i);return e}function Hr(e,t){var i=Math.acos(t[3])*2;var r=Math.sin(i/2);if(r>w){e[0]=t[0]/r;e[1]=t[1]/r;e[2]=t[2]/r}else{e[0]=1;e[1]=0;e[2]=0}return i}function Xr(e,t){var i=dn(e,t);return Math.acos(2*i*i-1)}function Yr(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3];var o=i[0],l=i[1],u=i[2],h=i[3];e[0]=r*h+a*o+n*u-s*l;e[1]=n*h+a*l+s*o-r*u;e[2]=s*h+a*u+r*l-n*o;e[3]=a*h-r*o-n*l-s*u;return e}function qr(e,t,i){i*=.5;var r=t[0],n=t[1],s=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=r*l+a*o;e[1]=n*l+s*o;e[2]=s*l-n*o;e[3]=a*l-r*o;return e}function Wr(e,t,i){i*=.5;var r=t[0],n=t[1],s=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=r*l-s*o;e[1]=n*l+a*o;e[2]=s*l+r*o;e[3]=a*l-n*o;return e}function Zr(e,t,i){i*=.5;var r=t[0],n=t[1],s=t[2],a=t[3];var o=Math.sin(i),l=Math.cos(i);e[0]=r*l+n*o;e[1]=n*l-r*o;e[2]=s*l+a*o;e[3]=a*l-s*o;return e}function Kr(e,t){var i=t[0],r=t[1],n=t[2];e[0]=i;e[1]=r;e[2]=n;e[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n));return e}function Qr(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=Math.sqrt(i*i+r*r+n*n);var o=Math.exp(s);var l=a>0?o*Math.sin(a)/a:0;e[0]=i*l;e[1]=r*l;e[2]=n*l;e[3]=o*Math.cos(a);return e}function Jr(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=Math.sqrt(i*i+r*r+n*n);var o=a>0?Math.atan2(a,s)/a:0;e[0]=i*o;e[1]=r*o;e[2]=n*o;e[3]=.5*Math.log(i*i+r*r+n*n+s*s);return e}function $r(e,t,i){Jr(e,t);gn(e,e,i);Qr(e,e);return e}function l(e,t,i,r){var n=t[0],s=t[1],a=t[2],o=t[3];var l=i[0],u=i[1],h=i[2],c=i[3];var f,g,d,m,p;g=n*l+s*u+a*h+o*c;if(g<0){g=-g;l=-l;u=-u;h=-h;c=-c}if(1-g>w){f=Math.acos(g);d=Math.sin(f);m=Math.sin((1-r)*f)/d;p=Math.sin(r*f)/d}else{m=1-r;p=r}e[0]=m*n+p*l;e[1]=m*s+p*u;e[2]=m*a+p*h;e[3]=m*o+p*c;return e}function en(e){var t=u();var i=u();var r=u();var n=Math.sqrt(1-t);var s=Math.sqrt(t);e[0]=n*Math.sin(2*Math.PI*i);e[1]=n*Math.cos(2*Math.PI*i);e[2]=s*Math.sin(2*Math.PI*r);e[3]=s*Math.cos(2*Math.PI*r);return e}function tn(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];var a=i*i+r*r+n*n+s*s;var o=a?1/a:0;e[0]=-i*o;e[1]=-r*o;e[2]=-n*o;e[3]=s*o;return e}function rn(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=t[3];return e}function nn(e,t){var i=t[0]+t[4]+t[8];var r;if(i>0){r=Math.sqrt(i+1);e[3]=.5*r;r=.5/r;e[0]=(t[5]-t[7])*r;e[1]=(t[6]-t[2])*r;e[2]=(t[1]-t[3])*r}else{var n=0;if(t[4]>t[0])n=1;if(t[8]>t[n*3+n])n=2;var s=(n+1)%3;var a=(n+2)%3;r=Math.sqrt(t[n*3+n]-t[s*3+s]-t[a*3+a]+1);e[n]=.5*r;r=.5/r;e[3]=(t[s*3+a]-t[a*3+s])*r;e[s]=(t[s*3+n]+t[n*3+s])*r;e[a]=(t[a*3+n]+t[n*3+a])*r}return e}function sn(e,t,i,r){var n=.5*Math.PI/180;t*=n;i*=n;r*=n;var s=Math.sin(t);var a=Math.cos(t);var o=Math.sin(i);var l=Math.cos(i);var u=Math.sin(r);var h=Math.cos(r);e[0]=s*l*h-a*o*u;e[1]=a*o*h+s*l*u;e[2]=a*l*u-s*o*h;e[3]=a*l*h+s*o*u;return e}function an(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var on=ir;var ln=rr;var un=nr;var hn=sr;var cn=ar;var fn=Yr;var gn=mr;var dn=Or;var mn=Sr;var pn=vr;var _n=pn;var bn=xr;var vn=bn;var xn=Tr;var En=Pr;var An=Lr;var Tn=function(){var n=D();var s=o(1,0,0);var a=o(0,1,0);return function(e,t,i){var r=j(t,i);if(r<-.999999){G(n,s,t);if(Ji(n)<1e-6)G(n,a,t);V(n,n);zr(e,n,Math.PI);return e}else if(r>.999999){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e}else{G(n,t,i);e[0]=n[0];e[1]=n[1];e[2]=n[2];e[3]=1+r;return xn(e,e)}}}();var On=function(){var a=s();var o=s();return function(e,t,i,r,n,s){l(a,t,n,s);l(o,i,r,s);l(e,a,o,2*s*(1-s));return e}}();var In=function(){var n=qe();return function(e,t,i,r){n[0]=i[0];n[3]=i[1];n[6]=i[2];n[1]=r[0];n[4]=r[1];n[7]=r[2];n[2]=-t[0];n[5]=-t[1];n[8]=-t[2];return xn(e,nn(e,n))}}();function Sn(){var e=new _(8);if(_!=Float32Array){e[0]=0;e[1]=0;e[2]=0;e[4]=0;e[5]=0;e[6]=0;e[7]=0}e[3]=1;return e}function Mn(e){var t=new _(8);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];return t}function Cn(e,t,i,r,n,s,a,o){var l=new _(8);l[0]=e;l[1]=t;l[2]=i;l[3]=r;l[4]=n;l[5]=s;l[6]=a;l[7]=o;return l}function Rn(e,t,i,r,n,s,a){var o=new _(8);o[0]=e;o[1]=t;o[2]=i;o[3]=r;var l=n*.5,u=s*.5,h=a*.5;o[4]=l*r+u*i-h*t;o[5]=u*r+h*e-l*i;o[6]=h*r+l*t-u*e;o[7]=-l*e-u*t-h*i;return o}function Nn(e,t,i){var r=i[0]*.5,n=i[1]*.5,s=i[2]*.5,a=t[0],o=t[1],l=t[2],u=t[3];e[0]=a;e[1]=o;e[2]=l;e[3]=u;e[4]=r*u+n*l-s*o;e[5]=n*u+s*a-r*l;e[6]=s*u+r*o-n*a;e[7]=-r*a-n*o-s*l;return e}function yn(e,t){e[0]=0;e[1]=0;e[2]=0;e[3]=1;e[4]=t[0]*.5;e[5]=t[1]*.5;e[6]=t[2]*.5;e[7]=0;return e}function Pn(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=0;e[5]=0;e[6]=0;e[7]=0;return e}function Ln(e,t){var i=s();Wt(i,t);var r=new _(3);Yt(r,t);Nn(e,i,r);return e}function wn(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];return e}function Fn(e){e[0]=0;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;e[6]=0;e[7]=0;return e}function kn(e,t,i,r,n,s,a,o,l){e[0]=t;e[1]=i;e[2]=r;e[3]=n;e[4]=s;e[5]=a;e[6]=o;e[7]=l;return e}var Dn=un;function Un(e,t){e[0]=t[4];e[1]=t[5];e[2]=t[6];e[3]=t[7];return e}var Bn=un;function Vn(e,t){e[4]=t[0];e[5]=t[1];e[6]=t[2];e[7]=t[3];return e}function jn(e,t){var i=t[4],r=t[5],n=t[6],s=t[7],a=-t[0],o=-t[1],l=-t[2],u=t[3];e[0]=(i*u+s*a+r*l-n*o)*2;e[1]=(r*u+s*o+n*a-i*l)*2;e[2]=(n*u+s*l+i*o-r*a)*2;return e}function Gn(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=i[0]*.5,l=i[1]*.5,u=i[2]*.5,h=t[4],c=t[5],f=t[6],g=t[7];e[0]=r;e[1]=n;e[2]=s;e[3]=a;e[4]=a*o+n*u-s*l+h;e[5]=a*l+s*o-r*u+c;e[6]=a*u+r*l-n*o+f;e[7]=-r*o-n*l-s*u+g;return e}function zn(e,t,i){var r=-t[0],n=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=o*a+h*r+l*s-u*n,f=l*a+h*n+u*r-o*s,g=u*a+h*s+o*n-l*r,d=h*a-o*r-l*n-u*s;qr(e,t,i);r=e[0];n=e[1];s=e[2];a=e[3];e[4]=c*a+d*r+f*s-g*n;e[5]=f*a+d*n+g*r-c*s;e[6]=g*a+d*s+c*n-f*r;e[7]=d*a-c*r-f*n-g*s;return e}function Hn(e,t,i){var r=-t[0],n=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=o*a+h*r+l*s-u*n,f=l*a+h*n+u*r-o*s,g=u*a+h*s+o*n-l*r,d=h*a-o*r-l*n-u*s;Wr(e,t,i);r=e[0];n=e[1];s=e[2];a=e[3];e[4]=c*a+d*r+f*s-g*n;e[5]=f*a+d*n+g*r-c*s;e[6]=g*a+d*s+c*n-f*r;e[7]=d*a-c*r-f*n-g*s;return e}function Xn(e,t,i){var r=-t[0],n=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],u=t[6],h=t[7],c=o*a+h*r+l*s-u*n,f=l*a+h*n+u*r-o*s,g=u*a+h*s+o*n-l*r,d=h*a-o*r-l*n-u*s;Zr(e,t,i);r=e[0];n=e[1];s=e[2];a=e[3];e[4]=c*a+d*r+f*s-g*n;e[5]=f*a+d*n+g*r-c*s;e[6]=g*a+d*s+c*n-f*r;e[7]=d*a-c*r-f*n-g*s;return e}function Yn(e,t,i){var r=i[0],n=i[1],s=i[2],a=i[3],o=t[0],l=t[1],u=t[2],h=t[3];e[0]=o*a+h*r+l*s-u*n;e[1]=l*a+h*n+u*r-o*s;e[2]=u*a+h*s+o*n-l*r;e[3]=h*a-o*r-l*n-u*s;o=t[4];l=t[5];u=t[6];h=t[7];e[4]=o*a+h*r+l*s-u*n;e[5]=l*a+h*n+u*r-o*s;e[6]=u*a+h*s+o*n-l*r;e[7]=h*a-o*r-l*n-u*s;return e}function qn(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=i[0],l=i[1],u=i[2],h=i[3];e[0]=r*h+a*o+n*u-s*l;e[1]=n*h+a*l+s*o-r*u;e[2]=s*h+a*u+r*l-n*o;e[3]=a*h-r*o-n*l-s*u;o=i[4];l=i[5];u=i[6];h=i[7];e[4]=r*h+a*o+n*u-s*l;e[5]=n*h+a*l+s*o-r*u;e[6]=s*h+a*u+r*l-n*o;e[7]=a*h-r*o-n*l-s*u;return e}function Wn(e,t,i,r){if(Math.abs(r)<w){return wn(e,t)}var n=Math.hypot(i[0],i[1],i[2]);r=r*.5;var s=Math.sin(r);var a=s*i[0]/n;var o=s*i[1]/n;var l=s*i[2]/n;var u=Math.cos(r);var h=t[0],c=t[1],f=t[2],g=t[3];e[0]=h*u+g*a+c*l-f*o;e[1]=c*u+g*o+f*a-h*l;e[2]=f*u+g*l+h*o-c*a;e[3]=g*u-h*a-c*o-f*l;var d=t[4],m=t[5],p=t[6],_=t[7];e[4]=d*u+_*a+m*l-p*o;e[5]=m*u+_*o+p*a-d*l;e[6]=p*u+_*l+d*o-m*a;e[7]=_*u-d*a-m*o-p*l;return e}function Zn(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];e[2]=t[2]+i[2];e[3]=t[3]+i[3];e[4]=t[4]+i[4];e[5]=t[5]+i[5];e[6]=t[6]+i[6];e[7]=t[7]+i[7];return e}function Kn(e,t,i){var r=t[0],n=t[1],s=t[2],a=t[3],o=i[4],l=i[5],u=i[6],h=i[7],c=t[4],f=t[5],g=t[6],d=t[7],m=i[0],p=i[1],_=i[2],b=i[3];e[0]=r*b+a*m+n*_-s*p;e[1]=n*b+a*p+s*m-r*_;e[2]=s*b+a*_+r*p-n*m;e[3]=a*b-r*m-n*p-s*_;e[4]=r*h+a*o+n*u-s*l+c*b+d*m+f*_-g*p;e[5]=n*h+a*l+s*o-r*u+f*b+d*p+g*m-c*_;e[6]=s*h+a*u+r*l-n*o+g*b+d*_+c*p-f*m;e[7]=a*h-r*o-n*l-s*u+d*b-c*m-f*p-g*_;return e}var Qn=Kn;function Jn(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;e[2]=t[2]*i;e[3]=t[3]*i;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;return e}var $n=dn;function es(e,t,i,r){var n=1-r;if($n(t,i)<0)r=-r;e[0]=t[0]*n+i[0]*r;e[1]=t[1]*n+i[1]*r;e[2]=t[2]*n+i[2]*r;e[3]=t[3]*n+i[3]*r;e[4]=t[4]*n+i[4]*r;e[5]=t[5]*n+i[5]*r;e[6]=t[6]*n+i[6]*r;e[7]=t[7]*n+i[7]*r;return e}function ts(e,t){var i=f(t);e[0]=-t[0]/i;e[1]=-t[1]/i;e[2]=-t[2]/i;e[3]=t[3]/i;e[4]=-t[4]/i;e[5]=-t[5]/i;e[6]=-t[6]/i;e[7]=t[7]/i;return e}function is(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=t[3];e[4]=-t[4];e[5]=-t[5];e[6]=-t[6];e[7]=t[7];return e}var rs=pn;var ns=rs;var f=bn;var ss=f;function as(e,t){var i=f(t);if(i>0){i=Math.sqrt(i);var r=t[0]/i;var n=t[1]/i;var s=t[2]/i;var a=t[3]/i;var o=t[4];var l=t[5];var u=t[6];var h=t[7];var c=r*o+n*l+s*u+a*h;e[0]=r;e[1]=n;e[2]=s;e[3]=a;e[4]=(o-r*c)/i;e[5]=(l-n*c)/i;e[6]=(u-s*c)/i;e[7]=(h-a*c)/i}return e}function os(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function ls(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function us(e,t){var i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7];var h=t[0],c=t[1],f=t[2],g=t[3],d=t[4],m=t[5],p=t[6],_=t[7];return Math.abs(i-h)<=w*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-c)<=w*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-f)<=w*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-g)<=w*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(a-d)<=w*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(o-m)<=w*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(l-p)<=w*Math.max(1,Math.abs(l),Math.abs(p))&&Math.abs(u-_)<=w*Math.max(1,Math.abs(u),Math.abs(_))}function e(){var e=new _(2);if(_!=Float32Array){e[0]=0;e[1]=0}return e}function hs(e){var t=new _(2);t[0]=e[0];t[1]=e[1];return t}function cs(e,t){var i=new _(2);i[0]=e;i[1]=t;return i}function fs(e,t){e[0]=t[0];e[1]=t[1];return e}function z(e,t,i){e[0]=t;e[1]=i;return e}function gs(e,t,i){e[0]=t[0]+i[0];e[1]=t[1]+i[1];return e}function ds(e,t,i){e[0]=t[0]-i[0];e[1]=t[1]-i[1];return e}function ms(e,t,i){e[0]=t[0]*i[0];e[1]=t[1]*i[1];return e}function ps(e,t,i){e[0]=t[0]/i[0];e[1]=t[1]/i[1];return e}function _s(e,t){e[0]=Math.ceil(t[0]);e[1]=Math.ceil(t[1]);return e}function bs(e,t){e[0]=Math.floor(t[0]);e[1]=Math.floor(t[1]);return e}function vs(e,t,i){e[0]=Math.min(t[0],i[0]);e[1]=Math.min(t[1],i[1]);return e}function xs(e,t,i){e[0]=Math.max(t[0],i[0]);e[1]=Math.max(t[1],i[1]);return e}function Es(e,t){e[0]=Math.round(t[0]);e[1]=Math.round(t[1]);return e}function As(e,t,i){e[0]=t[0]*i;e[1]=t[1]*i;return e}function Ts(e,t,i,r){e[0]=t[0]+i[0]*r;e[1]=t[1]+i[1]*r;return e}function Os(e,t){var i=t[0]-e[0],r=t[1]-e[1];return Math.hypot(i,r)}function Is(e,t){var i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function Ss(e){var t=e[0],i=e[1];return Math.hypot(t,i)}function Ms(e){var t=e[0],i=e[1];return t*t+i*i}function Cs(e,t){e[0]=-t[0];e[1]=-t[1];return e}function Rs(e,t){e[0]=1/t[0];e[1]=1/t[1];return e}function Ns(e,t){var i=t[0],r=t[1];var n=i*i+r*r;if(n>0){n=1/Math.sqrt(n)}e[0]=t[0]*n;e[1]=t[1]*n;return e}function ys(e,t){return e[0]*t[0]+e[1]*t[1]}function Ps(e,t,i){var r=t[0]*i[1]-t[1]*i[0];e[0]=e[1]=0;e[2]=r;return e}function Ls(e,t,i,r){var n=t[0],s=t[1];e[0]=n+r*(i[0]-n);e[1]=s+r*(i[1]-s);return e}function ws(e,t){t=t||1;var i=u()*2*Math.PI;e[0]=Math.cos(i)*t;e[1]=Math.sin(i)*t;return e}function Fs(e,t,i){var r=t[0],n=t[1];e[0]=i[0]*r+i[2]*n;e[1]=i[1]*r+i[3]*n;return e}function ks(e,t,i){var r=t[0],n=t[1];e[0]=i[0]*r+i[2]*n+i[4];e[1]=i[1]*r+i[3]*n+i[5];return e}function Ds(e,t,i){var r=t[0],n=t[1];e[0]=i[0]*r+i[3]*n+i[6];e[1]=i[1]*r+i[4]*n+i[7];return e}function Us(e,t,i){var r=t[0];var n=t[1];e[0]=i[0]*r+i[4]*n+i[12];e[1]=i[1]*r+i[5]*n+i[13];return e}function Bs(e,t,i,r){var n=t[0]-i[0],s=t[1]-i[1],a=Math.sin(r),o=Math.cos(r);e[0]=n*o-s*a+i[0];e[1]=n*a+s*o+i[1];return e}function Vs(e,t){var i=e[0],r=e[1],n=t[0],s=t[1];var a=i*i+r*r;if(a>0){a=1/Math.sqrt(a)}var o=n*n+s*s;if(o>0){o=1/Math.sqrt(o)}var l=(i*n+r*s)*a*o;if(l>1){return 0}else if(l<-1){return Math.PI}else{return Math.acos(l)}}function js(e){e[0]=0;e[1]=0;return e}function Gs(e){return"vec2("+e[0]+", "+e[1]+")"}function zs(e,t){return e[0]===t[0]&&e[1]===t[1]}function Hs(e,t){var i=e[0],r=e[1];var n=t[0],s=t[1];return Math.abs(i-n)<=w*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-s)<=w*Math.max(1,Math.abs(r),Math.abs(s))}var Xs=Ss;var Ys=ds;var qs=ms;var Ws=ps;var Zs=Os;var Ks=Is;var Qs=Ms;var Js=function(){var l=e();return function(e,t,i,r,n,s){var a,o;if(!t){t=2}if(!i){i=0}if(r){o=Math.min(r*t+i,e.length)}else{o=e.length}for(a=i;a<o;a+=t){l[0]=e[a];l[1]=e[a+1];n(l,l,s);e[a]=l[0];e[a+1]=l[1]}return e}}();class c{isGeometry=true;constructor(e){this.name=e||"unknown";this._log=new h.Logger("cgl_geometry");this.faceVertCount=3;this.glPrimitive=null;this._attributes={};this._vertices=[];this.verticesIndices=[];this.morphTargets=[]}get vertices(){return this._vertices}set vertices(e){this.setVertices(e)}get texCoords(){const e=this.getAttribute("texCoords");if(!e)return[];return e.data}set texCoords(e){this.setAttribute("texCoords",e,2)}get vertexNormals(){const e=this.getAttribute("vertexNormals");if(!e)return[];return e.data}set vertexNormals(e){this.setAttribute("vertexNormals",e,3)}get tangents(){const e=this.getAttribute("tangents");if(!e)return[];return e.data}set tangents(e){this.setAttribute("tangents",e,3)}get biTangents(){const e=this.getAttribute("biTangents");if(!e)return[];return e.data}set biTangents(e){this.setAttribute("biTangents",e,3)}get vertexColors(){const e=this.getAttribute("vertexColors");if(!e)return[];return e.data}set vertexColors(e){this.setAttribute("vertexColors",e,4)}clear(){this._vertices=new Float32Array([]);this.verticesIndices=[];this.texCoords=new Float32Array([]);this.vertexNormals=new Float32Array([]);this.tangents=[];this.biTangents=[];this._attributes={}}getAttributes(){return this._attributes}getAttribute(t){for(const e in this._attributes){if(this._attributes[e].name==t)return this._attributes[e]}return null}setAttribute(e,t,i){let r="";if(!i||i>4){this._log.warn("itemsize wrong?",i,e);this._log.stack("itemsize");i=3}if(i==1)r="float";else if(i==2)r="vec2";else if(i==3)r="vec3";else if(i==4)r="vec4";const n={name:e,data:t,itemSize:i,type:r};this._attributes[e]=n}copyAttribute(e,t){const i=this.getAttribute(e);t.setAttribute(e,new Float32Array(i.data),i.itemSize)}setVertices(e){if(e instanceof Float32Array)this._vertices=e;else this._vertices=new Float32Array(e)}setTexCoords(e){if(e instanceof Float32Array)this.texCoords=e;else this.texCoords=new Float32Array(e)}calcNormals(e){const t={smooth:e};this.calculateNormals(t)}flipNormals(t,i,r){let n=D();if(t==undefined)t=1;if(i==undefined)i=1;if(r==undefined)r=1;for(let e=0;e<this.vertexNormals.length;e+=3){U(n,this.vertexNormals[e+0],this.vertexNormals[e+1],this.vertexNormals[e+2]);n[0]*=-t;n[1]*=-i;n[2]*=-r;V(n,n);this.vertexNormals[e+0]=n[0];this.vertexNormals[e+1]=n[1];this.vertexNormals[e+2]=n[2]}}getNumTriangles(){if(this.verticesIndices&&this.verticesIndices.length)return this.verticesIndices.length/3;return this.vertices.length/3}flipVertDir(){const t=[];t.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e+=3){t[e]=this.verticesIndices[e+2];t[e+1]=this.verticesIndices[e+1];t[e+2]=this.verticesIndices[e]}this.verticesIndices=t}setPointVertices(t){if(t.length%3!==0){this._log.error("SetPointVertices: Array must be multiple of three.");return}if(!(t instanceof Float32Array))this.vertices=new Float32Array(t);else this.vertices=t;if(!(this.texCoords instanceof Float32Array))this.texCoords=new Float32Array(t.length/3*2);this.verticesIndices.length=t.length/3;for(let e=0;e<t.length/3;e++){this.verticesIndices[e]=e;this.texCoords[e*2]=0;this.texCoords[e*2+1]=0}}merge(t){if(!t)return;if(this.isIndexed()!=t.isIndexed()){if(this.isIndexed()){this.unIndex(false,true)}if(t.isIndexed()){const e=t.copy();e.unIndex(false,true);t=e}}const i=this.verticesIndices.length;const r=this._vertices.length/3;this.verticesIndices.length+=t.verticesIndices.length;for(let e=0;e<t.verticesIndices.length;e++)this.verticesIndices[i+e]=t.verticesIndices[e]+r;this.vertices=A.utils.float32Concat(this._vertices,t.vertices);this.texCoords=A.utils.float32Concat(this.texCoords,t.texCoords);this.vertexNormals=A.utils.float32Concat(this.vertexNormals,t.vertexNormals);this.tangents=A.utils.float32Concat(this.tangents,t.tangents);this.biTangents=A.utils.float32Concat(this.biTangents,t.biTangents)}copy(){const t=new c(this.name+" copy");t.faceVertCount=this.faceVertCount;t.glPrimitive=this.glPrimitive;t.setVertices(this._vertices.slice(0));if(this.verticesIndices){t.verticesIndices.length=this.verticesIndices.length;for(let e=0;e<this.verticesIndices.length;e++)t.verticesIndices[e]=this.verticesIndices[e]}for(let e in this._attributes)this.copyAttribute(e,t);t.morphTargets.length=this.morphTargets.length;for(let e=0;e<this.morphTargets.length;e++)t.morphTargets[e]=this.morphTargets[e];return t}calculateNormals(t=null){t=t||{};if(t.smooth===false)this.unIndex();const i=D();const r=D();const n=D();function s(e){B(i,e[0],e[1]);B(r,e[0],e[2]);G(n,i,r);V(n,n);if(t&&t.forceZUp){if(n[2]<0){n[0]*=-1;n[1]*=-1;n[2]*=-1}}return n}this.getVertexVec=function(e){const t=[0,0,0];t[0]=this.vertices[e*3+0];t[1]=this.vertices[e*3+1];t[2]=this.vertices[e*3+2];return t};if(!(this.vertexNormals instanceof Float32Array)||this.vertexNormals.length!=this.vertices.length)this.vertexNormals=new Float32Array(this.vertices.length);for(let e=0;e<this.vertices.length;e++){this.vertexNormals[e]=0}if(!this.isIndexed()){const a=[];for(let e=0;e<this.vertices.length;e+=9){const o=[[this.vertices[e+0],this.vertices[e+1],this.vertices[e+2]],[this.vertices[e+3],this.vertices[e+4],this.vertices[e+5]],[this.vertices[e+6],this.vertices[e+7],this.vertices[e+8]]];const l=s(o);a.push(l[0],l[1],l[2],l[0],l[1],l[2],l[0],l[1],l[2])}this.vertexNormals=a}else{const u=[];u.length=Math.floor(this.verticesIndices.length/3);for(let e=0;e<this.verticesIndices.length;e+=3){const o=[this.getVertexVec(this.verticesIndices[e+0]),this.getVertexVec(this.verticesIndices[e+1]),this.getVertexVec(this.verticesIndices[e+2])];u[e/3]=s(o);this.vertexNormals[this.verticesIndices[e+0]*3+0]+=u[e/3][0];this.vertexNormals[this.verticesIndices[e+0]*3+1]+=u[e/3][1];this.vertexNormals[this.verticesIndices[e+0]*3+2]+=u[e/3][2];this.vertexNormals[this.verticesIndices[e+1]*3+0]+=u[e/3][0];this.vertexNormals[this.verticesIndices[e+1]*3+1]+=u[e/3][1];this.vertexNormals[this.verticesIndices[e+1]*3+2]+=u[e/3][2];this.vertexNormals[this.verticesIndices[e+2]*3+0]+=u[e/3][0];this.vertexNormals[this.verticesIndices[e+2]*3+1]+=u[e/3][1];this.vertexNormals[this.verticesIndices[e+2]*3+2]+=u[e/3][2]}for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){const h=[this.vertexNormals[this.verticesIndices[t+e]*3+0],this.vertexNormals[this.verticesIndices[t+e]*3+1],this.vertexNormals[this.verticesIndices[t+e]*3+2]];V(h,h);this.vertexNormals[this.verticesIndices[t+e]*3+0]=h[0];this.vertexNormals[this.verticesIndices[t+e]*3+1]=h[1];this.vertexNormals[this.verticesIndices[t+e]*3+2]=h[2]}}}}calcTangentsBitangents(){if(!this.vertices.length){return}if(!this.vertexNormals.length){return}if(!this.texCoords.length){const x=this.vertices.length/3*2;this.texCoords=new Float32Array(x);for(let e=0;e<x;e+=1)this.texCoords[e]=0}if(!this.verticesIndices||!this.verticesIndices.length){return}if(this.verticesIndices.length%3!==0){this._log.error("Vertex indices mismatch!");return}const t=this.verticesIndices.length/3;const i=this.vertices.length/3;this.tangents=new Float32Array(this.vertexNormals.length);this.biTangents=new Float32Array(this.vertexNormals.length);const r=[];r.length=i*2;const n=D();const s=D();const a=D();const o=e();const l=e();const u=e();const h=D();const c=D();for(let e=0;e<t;e+=1){const E=this.verticesIndices[e*3];const A=this.verticesIndices[e*3+1];const T=this.verticesIndices[e*3+2];U(n,this.vertices[E*3],this.vertices[E*3+1],this.vertices[E*3+2]);U(s,this.vertices[A*3],this.vertices[A*3+1],this.vertices[A*3+2]);U(a,this.vertices[T*3],this.vertices[T*3+1],this.vertices[T*3+2]);z(o,this.texCoords[E*2],this.texCoords[E*2+1]);z(l,this.texCoords[A*2],this.texCoords[A*2+1]);z(u,this.texCoords[T*2],this.texCoords[T*2+1]);const O=s[0]-n[0];const I=a[0]-n[0];const S=s[1]-n[1];const M=a[1]-n[1];const C=s[2]-n[2];const R=a[2]-n[2];const N=l[0]-o[0];const y=u[0]-o[0];const P=l[1]-o[1];const L=u[1]-o[1];const w=1/(N*L-y*P);U(h,(L*O-P*I)*w,(L*S-P*M)*w,(L*C-P*R)*w);U(c,(N*I-y*O)*w,(N*M-y*S)*w,(N*R-y*C)*w);r[E]=h;r[A]=h;r[T]=h;r[E+i]=c;r[A+i]=c;r[T+i]=c}const f=D();const g=D();const d=D();const m=D();const p=D();const _=D();const b=D();const v=D();for(let e=0;e<i;e+=1){if(!r[e])continue;U(f,this.vertexNormals[e*3],this.vertexNormals[e*3+1],this.vertexNormals[e*3+2]);U(g,r[e][0],r[e][1],r[e][2]);const F=j(f,g);Ii(p,f,F);B(_,g,p);V(v,_);G(b,f,g);const k=1;Ii(d,v,1/k);G(m,f,d);this.tangents[e*3+0]=d[0];this.tangents[e*3+1]=d[1];this.tangents[e*3+2]=d[2];this.biTangents[e*3+0]=m[0];this.biTangents[e*3+1]=m[1];this.biTangents[e*3+2]=m[2]}}isIndexed(){if(this._vertices.length==0)return true;return this.verticesIndices.length!=0}unIndex(e=false,t=false){const i=[];const r=[];let n=0;for(let e in this._attributes){const s=this._attributes[e];let i=[];for(let t=0;t<this.verticesIndices.length;t+=3){for(let e=0;e<3;e++){if(s.itemSize==3)i.push(s.data[this.verticesIndices[t+e]*3+0],s.data[this.verticesIndices[t+e]*3+1],s.data[this.verticesIndices[t+e]*3+2]);else if(s.itemSize==4)i.push(s.data[this.verticesIndices[t+e]*4+0],s.data[this.verticesIndices[t+e]*4+1],s.data[this.verticesIndices[t+e]*4+2],s.data[this.verticesIndices[t+e]*4+3]);else if(s.itemSize==2)i.push(s.data[this.verticesIndices[t+e]*2+0],s.data[this.verticesIndices[t+e]*2+1]);else if(s.itemSize==1)i.push(s.data[this.verticesIndices[t+e]]);else this._log.warn("unknown attr",s)}}this.setAttribute(s.name,i,s.itemSize)}for(let e=0;e<this.verticesIndices.length;e+=3){i.push(this.vertices[this.verticesIndices[e+0]*3+0],this.vertices[this.verticesIndices[e+0]*3+1],this.vertices[this.verticesIndices[e+0]*3+2]);r.push(n);n++;i.push(this.vertices[this.verticesIndices[e+1]*3+0],this.vertices[this.verticesIndices[e+1]*3+1],this.vertices[this.verticesIndices[e+1]*3+2]);r.push(n);n++;i.push(this.vertices[this.verticesIndices[e+2]*3+0],this.vertices[this.verticesIndices[e+2]*3+1],this.vertices[this.verticesIndices[e+2]*3+2]);r.push(n);n++}this.vertices=i;this.verticesIndices=[];if(e)this.verticesIndices=r;if(!t)this.calculateNormals()}calcBarycentric(){let t=[];t.length=this.vertices.length;for(let e=0;e<this.vertices.length;e++)t[e]=0;let i=0;for(let e=0;e<this.vertices.length;e+=3){t[e+i]=1;i++;if(i==3)i=0}this.setAttribute("attrBarycentric",t,3)}getBounds(){return new i(this)}center(e,t,i){if(e===undefined){e=true;t=true;i=true}let r=0;const n=this.getBounds();const s=[n.minX+(n.maxX-n.minX)/2,n.minY+(n.maxY-n.minY)/2,n.minZ+(n.maxZ-n.minZ)/2];for(r=0;r<this.vertices.length;r+=3){if(this.vertices[r+0]==this.vertices[r+0]){if(e)this.vertices[r+0]-=s[0];if(t)this.vertices[r+1]-=s[1];if(i)this.vertices[r+2]-=s[2]}}return s}mapTexCoords2d(){const t=this.getBounds();const i=this.vertices.length/3;this.texCoords=new Float32Array(i*2);for(let e=0;e<i;e++){const r=this.vertices[e*3+0];const n=this.vertices[e*3+1];this.texCoords[e*2+0]=r/(t.maxX-t.minX)+.5;this.texCoords[e*2+1]=1-n/(t.maxY-t.minY)+.5}}getInfoOneLine(){let e="";if(this.faceVertCount==3&&this.verticesIndices)e+=this.verticesIndices.length/3;else e+=0;e+=" tris ";if(this.vertices)e+=this.vertices.length/3;else e+=0;e+=" verts";return e}getInfo(){const e={};e.name=this.name;e.class=this.constructor.name;if(this.faceVertCount==3&&this.verticesIndices)e.numFaces=this.verticesIndices.length/3;else e.numFaces=0;if(this.verticesIndices&&this.verticesIndices.length)e.indices=this.verticesIndices.length;if(this.vertices)e.numVerts=this.vertices.length/3;else e.numVerts=0;if(this.vertexNormals)e.numNormals=this.vertexNormals.length/3;else e.numNormals=0;if(this.texCoords)e.numTexCoords=this.texCoords.length/2;else e.numTexCoords=0;if(this.tangents)e.numTangents=this.tangents.length/3;else e.numTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.biTangents)e.numBiTangents=this.biTangents.length/3;else e.numBiTangents=0;if(this.vertexColors)e.numVertexColors=this.vertexColors.length/4;else e.numVertexColors=0;if(this.getAttributes())e.numAttribs=Object.keys(this.getAttributes()).length;else e.numAttribs=0;e.isIndexed=this.isIndexed();return e}}c.buildFromFaces=function(t,e,i){const r=[];const n=[];for(let e=0;e<t.length;e+=3){const a=t[e+0];const o=t[e+1];const l=t[e+2];const u=[-1,-1,-1];if(i)for(let e=0;e<r.length;e+=3){if(r[e+0]==a[0]&&r[e+1]==a[1]&&r[e+2]==a[2])u[0]=e/3;if(r[e+0]==o[0]&&r[e+1]==o[1]&&r[e+2]==o[2])u[1]=e/3;if(r[e+0]==l[0]&&r[e+1]==l[1]&&r[e+2]==l[2])u[2]=e/3}if(u[0]==-1){r.push(a[0],a[1],a[2]);u[0]=(r.length-1)/3}if(u[1]==-1){r.push(o[0],o[1],o[2]);u[1]=(r.length-1)/3}if(u[2]==-1){r.push(l[0],l[1],l[2]);u[2]=(r.length-1)/3}n.push(u[0]);n.push(u[1]);n.push(u[2])}const s=new c(e);s.name=e;s.vertices=r;s.verticesIndices=n;return s};class i{constructor(e){this._init();this._first=true;this._wireMesh=null;if(e)this.applyGeom(e)}_init(){this._max=[-0,-0,-0];this._min=[0,0,0];this._center=[0,0,0];this._size=[0,0,0];this._maxAxis=0;this._first=true}get maxAxis(){return this._maxAxis||1}get size(){return this._size}get center(){return this._center}get x(){return this._center[0]}get y(){return this._center[1]}get z(){return this._center[2]}get minX(){return this._min[0]}get minY(){return this._min[1]}get minZ(){return this._min[2]}get maxX(){return this._max[0]}get maxY(){return this._max[1]}get maxZ(){return this._max[2]}apply(e){return this.applyGeom(e)}applyGeom(t){if(!t)return;if(t instanceof i){const e=t;this.applyPos(e.maxX,e.maxY,e.maxZ);this.applyPos(e.minX,e.minY,e.minZ)}else{if(t.isGeometry)for(let e=0;e<t.vertices.length;e+=3)this.applyPos(t.vertices[e],t.vertices[e+1],t.vertices[e+2])}this.calcCenterSize()}copy(){return new i(this)}get changed(){return!(this._max[0]==-Number.MAX_VALUE&&this._max[1]==-Number.MAX_VALUE&&this._max[2]==-Number.MAX_VALUE)}applyPos(e,t,i){if(e==Number.MAX_VALUE||e==-Number.MAX_VALUE||t==Number.MAX_VALUE||t==-Number.MAX_VALUE||i==Number.MAX_VALUE||i==-Number.MAX_VALUE)return;if(!A.utils.isNumeric(e)||!A.utils.isNumeric(t)||!A.utils.isNumeric(i))return;if(this._first){this._max[0]=e;this._max[1]=t;this._max[2]=i;this._min[0]=e;this._min[1]=t;this._min[2]=i;this._first=false;return}this._max[0]=Math.max(this._max[0],e);this._max[1]=Math.max(this._max[1],t);this._max[2]=Math.max(this._max[2],i);this._min[0]=Math.min(this._min[0],e);this._min[1]=Math.min(this._min[1],t);this._min[2]=Math.min(this._min[2],i)}calcCenterSize(){if(this._first)return;this._size[0]=this._max[0]-this._min[0];this._size[1]=this._max[1]-this._min[1];this._size[2]=this._max[2]-this._min[2];this._center[0]=(this._min[0]+this._max[0])/2;this._center[1]=(this._min[1]+this._max[1])/2;this._center[2]=(this._min[2]+this._max[2])/2;this._maxAxis=Math.max(this._size[2],Math.max(this._size[0],this._size[1]))}mulMat4(e){if(this._first){this._max[0]=0;this._max[1]=0;this._max[2]=0;this._min[0]=0;this._min[1]=0;this._min[2]=0;this._first=false}ki(this._max,this._max,e);ki(this._min,this._min,e);this.calcCenterSize()}render(e,t,i){if(!this._wireMesh)this._wireMesh=new CGL.WireCube(e);e.pushModelMatrix();n(e.mMatrix,e.mMatrix,this._center);if(CABLES.UI&&i){CABLES.UI.OverlayMeshes.drawCube(i,this._size[0]/2,this._size[1]/2,this._size[2]/2)}e.popModelMatrix()}}class $s{hasFocus=false;forceAspect=0;pixelDensity=1;_oldWidthRp=-1;_oldHeightRp=-1;constructor(e){this._log=new h.Logger("CgCanvas");if(!e){this._log.error("CgCanvas no options")}else{this._canvasEle=e.canvasEle}if(!e.cg)this._log.error("CgCanvas options has no cg");this._cg=e.cg;if(this.canvasEle){this.canvasWidth=this.canvasEle.clientWidth;this.canvasHeight=this.canvasEle.clientHeight;this.setSize(this.canvasWidth,this.canvasHeight);this.canvasEle.addEventListener("focus",()=>{this.hasFocus=true});this.canvasEle.addEventListener("blur",()=>{this.hasFocus=false})}}get canvasEle(){return this._canvasEle}setSize(e,t,i=false){if(this._oldWidthRp!=e*this.pixelDensity||this._oldHeightRp!=t*this.pixelDensity){this._oldWidthRp=this.canvasEle.width=e*this.pixelDensity;this._oldHeightRp=this.canvasEle.height=t*this.pixelDensity;if(!i){this.canvasEle.style.width=e+"px";this.canvasEle.style.height=t+"px"}this.updateSize();this._cg.emitEvent("resize")}}updateSize(){this.canvasEle.width=this.canvasWidth=Math.ceil(this.canvasEle.clientWidth*this.pixelDensity);this.canvasEle.height=this.canvasHeight=Math.ceil(this.canvasEle.clientHeight*this.pixelDensity)}dispose(){if(this._canvasEle)this._canvasEle.remove();this._canvasEle=null}}class ea extends h.Events{#timeStartFrame=0;#timeStartSecond=0;#fpsCounter=0;#msCounter=0;#frameCount=0;logFps=false;constructor(){super();this.stats={ms:0,fps:0}}get frameCount(){return this.#frameCount}startFrame(){this.#timeStartFrame=(0,A.now)()}endFrame(){this.#frameCount++;this.#fpsCounter++;const e=(0,A.now)()-this.#timeStartFrame;this.#msCounter+=e;if((0,A.now)()-this.#timeStartSecond>1e3)this.endSecond()}endSecond(){this.stats.fps=this.#fpsCounter;this.stats.ms=Math.round(this.#msCounter/this.#fpsCounter*100)/100;this.emitEvent("performance",this.stats);if(this.logFps)console.log(this.stats);this.#fpsCounter=0;this.#msCounter=0;this.#timeStartSecond=(0,A.now)()}}class a{constructor(){this._arr=[r()];this._index=0;this.stateCounter=0}push(e){this._index++;this.stateCounter++;if(this._index==this._arr.length){const e=r();this._arr.push(e)}St(this._arr[this._index],e||this._arr[this._index-1]);return this._arr[this._index]}pop(){this.stateCounter++;this._index--;if(this._index<0)this._index=0;return this._arr[this._index]}length(){return this._index}}class ta{constructor(e){this._cgl=e;this._lastTime=0;this.pause=false;this.profileUniformCount=0;this.profileShaderBinds=0;this.profileUniformCount=0;this.profileShaderCompiles=0;this.profileVideosPlaying=0;this.profileMVPMatrixCount=0;this.profileEffectBuffercreate=0;this.profileShaderGetUniform=0;this.profileFrameBuffercreate=0;this.profileMeshSetGeom=0;this.profileTextureNew=0;this.profileGenMipMap=0;this.profileOnAnimFrameOps=0;this.profileFencedPixelRead=0;this.profileMainloopMs=0;this.profileMeshDraw=0;this.profileTextureEffect=0;this.profileTexPreviews=0;this.shaderCompileTime=0;this.profileMeshNumElements=0;this.profileMeshAttributes=0;this.profileSingleMeshAttribute=[];this.heavyEvents=[];this.doProfileGlQuery=false;this.glQueryData={};this.counts={}}clear(){this.counts={};this.profileSingleMeshAttribute={};this.profileMeshAttributes=0;this.profileUniformCount=0;this.profileShaderGetUniform=0;this.profileShaderCompiles=0;this.profileShaderBinds=0;this.profileTextureResize=0;this.profileFrameBuffercreate=0;this.profileEffectBuffercreate=0;this.profileTextureDelete=0;this.profileMeshSetGeom=0;this.profileVideosPlaying=0;this.profileMVPMatrixCount=0;this.profileNonTypedAttrib=0;this.profileNonTypedAttribNames="";this.profileTextureNew=0;this.profileGenMipMap=0;this.profileFramebuffer=0;this.profileMeshDraw=0;this.profileTextureEffect=0;this.profileTexPreviews=0;this.profileMeshNumElements=0;this.profileFencedPixelRead=0}clearGlQuery(){for(let e in this.glQueryData){if(!this.glQueryData[e].lastClear||performance.now()-this.glQueryData[e].lastClear>1e3){this.glQueryData[e].time=this.glQueryData[e]._times/this.glQueryData[e]._numcount;this.glQueryData[e].num=this.glQueryData[e]._numcount;this.glQueryData[e]._times=0;this.glQueryData[e]._numcount=0;this.glQueryData[e].lastClear=performance.now()}}}count(e,t){this.counts[e]=this.counts[e]||[];this.counts[e].push(t)}addHeavyEvent(e,t,i){const r={event:e,name:t,info:i,date:performance.now()};this.heavyEvents.push(r);this._cgl.emitEvent("heavyEvent",r)}}class ia extends h.Events{static API_UNKNOWN=0;static API_WEBGL=1;static API_WEBGPU=2;static EVENT_RESIZE="resize";#patch=null;gApi=0;_textureslots=[];_pMatrixStack=new a;_mMatrixStack=new a;_vMatrixStack=new a;canvasScale=1;constructor(e){super();this._log=new h.Logger("cg_context",{onError:e.config.onError});this.tempData=this.frameStore=this.frameStore||{};this.fpsCounter=new ea;this._identView=D();this._ident=D();U(this._identView,0,0,-2);U(this._ident,0,0,0);this._onetimeCallbacks=[];this.maxTexSize=2048;this._viewPort=[0,0,1,1];this._viewPortStack=[];this.patch=e;this.autoReSize=true;this.DEPTH_COMPARE_FUNC_NEVER=0;this.DEPTH_COMPARE_FUNC_LESS=1;this.DEPTH_COMPARE_FUNC_EQUAL=2;this.DEPTH_COMPARE_FUNC_LESSEQUAL=3;this.DEPTH_COMPARE_FUNC_GREATER=4;this.DEPTH_COMPARE_FUNC_NOTEQUAL=5;this.DEPTH_COMPARE_FUNC_GREATEREQUAL=6;this.DEPTH_COMPARE_FUNC_ALWAYS=7;this.profileData=new ta(this);this.pMatrix=r();this.mMatrix=r();this.vMatrix=r();T(this.mMatrix);T(this.vMatrix);window.matchMedia("screen and (min-resolution: 2dppx)").addEventListener("change",()=>{this.emitEvent("resize")})}get canvasWidth(){return this.width}get canvasHeight(){return this.height}get width(){return this.cgCanvas.canvasWidth}get height(){return this.cgCanvas.canvasHeight}get widthCss(){return this.cgCanvas.canvasWidth/this.pixelDensity}get heightCss(){return this.cgCanvas.canvasHeight/this.pixelDensity}set pixelDensity(e){if(this.cgCanvas.pixelDensity!=e){this.cgCanvas.pixelDensity=e;this.cgCanvas.updateSize();this.emitEvent("resize")}}get pixelDensity(){return this.cgCanvas.pixelDensity}getGApiName(){return["unknown","WebGL","WebGPU"][this.gApi]}get canvas(){return this.cgCanvas.canvasEle}get viewPort(){return[0,0,this.canvasWidth,this.canvasHeight]}setCanvas(e){if(this.cgCanvas&&e==this.cgCanvas.canvasEle)return;if(typeof e==="string")e=document.getElementById(e);this.cgCanvas=new $s({canvasEle:e,cg:this});if(!e)return;e.parentElement.classList.add("cablesContainer");if(this._setCanvas)this._setCanvas(e);this.updateSize()}_setCanvas(e){}updateSize(){this.cgCanvas.updateSize()}setSize(e,t,i=false){this.cgCanvas.setSize(e,t,i)}_resizeToWindowSize(){if(this.autoReSize){this.setSize(window.innerWidth,window.innerHeight);this.updateSize()}}_resizeToParentSize(){if(this.autoReSize){const e=this.canvas.parentElement;if(!e){this._log.error("cables: can not resize to container element");return}this.setSize(e.clientWidth,e.clientHeight);this.updateSize()}}setAutoResize(e){window.removeEventListener("resize",this._resizeToWindowSize.bind(this));window.removeEventListener("resize",this._resizeToParentSize.bind(this));if(e=="window"){window.addEventListener("resize",this._resizeToWindowSize.bind(this));window.addEventListener("orientationchange",this._resizeToWindowSize.bind(this));this._resizeToWindowSize()}if(e=="parent"){window.addEventListener("resize",this._resizeToParentSize.bind(this));this._resizeToParentSize()}}pushPMatrix(){this.pMatrix=this._pMatrixStack.push(this.pMatrix)}popPMatrix(){this.pMatrix=this._pMatrixStack.pop();return this.pMatrix}getProjectionMatrixStateCount(){return this._pMatrixStack.stateCounter}pushModelMatrix(){this.mMatrix=this._mMatrixStack.push(this.mMatrix)}popModelMatrix(){this.mMatrix=this._mMatrixStack.pop();return this.mMatrix}modelMatrix(){return this.mMatrix}pushViewMatrix(){this.vMatrix=this._vMatrixStack.push(this.vMatrix)}popViewMatrix(){this.vMatrix=this._vMatrixStack.pop()}getViewMatrixStateCount(){return this._vMatrixStack.stateCounter}_startMatrixStacks(e,t){e=e||this._ident;t=t||this._identView;$t(this.pMatrix,45,this.canvasWidth/this.canvasHeight,.1,1e3);T(this.mMatrix);T(this.vMatrix);n(this.mMatrix,this.mMatrix,e);n(this.vMatrix,this.vMatrix,t);this.pushPMatrix();this.pushModelMatrix();this.pushViewMatrix()}_endMatrixStacks(){this.popViewMatrix();this.popModelMatrix();this.popPMatrix()}dispose(){this.aborted=true;if(this.cgCanvas)this.cgCanvas.dispose();if(this._dispose)this._dispose()}_dispose(){}shouldDrawHelpers(e){return false}addNextFrameOnceCallback(e){if(e&&this._onetimeCallbacks.indexOf(e)==-1)this._onetimeCallbacks.push(e)}_execOneTimeCallbacks(){if(this._onetimeCallbacks.length>0){for(let e=0;e<this._onetimeCallbacks.length;e++)this._onetimeCallbacks[e]();this._onetimeCallbacks.length=0}}checkTextureSize(e){e=e||1;e=Math.floor(e);e=Math.min(e,this.maxTexSize);e=Math.max(e,1);return e}screenShot(e,t,i,r){console.log("no screenshot function implemented")}saveScreenshot(i,r,e,t,n){this.patch.renderOneFrame();let s=this.canvas.clientWidth*this.pixelDensity;let a=this.canvas.clientHeight*this.pixelDensity;if(e){this.canvas.width=e;s=e}if(t){this.canvas.height=t;a=t}function o(e,t,i){return Array(t-String(e).length+1).join(i||"0")+e}const l=new Date;const u="".concat(String(l.getFullYear())+String(l.getMonth()+1)+String(l.getDate()),"_").concat(o(l.getHours(),2)).concat(o(l.getMinutes(),2)).concat(o(l.getSeconds(),2));if(!i)i="cables_"+u+".png";else i+=".png";this.screenShot(e=>{this.canvas.width=s;this.canvas.height=a;if(e){const t=document.createElement("a");t.download=i;t.href=URL.createObjectURL(e);console.log("scrrenshot");setTimeout(function(){t.click();if(r)r(e)},100)}else{this._log.log("screenshot: no blob")}})}hasFocus(){return this.cgCanvas.hasFocus}}class ra extends h.Events{id=A.utils.simpleId();_isValid=true;_defines=[];_moduleNames=[];_moduleNumId=0;_needsRecompile=true;_compileReason="initial";_modules=[];_compileCount=0;logError=true;num=-1;lastCompile=0;constructor(){super()}setWhyCompile(e){this._compileReason=e;this._needsRecompile=true}getWhyCompile(){return this._compileReason}needsRecompile(){return this._needsRecompile}removeUniform(t){for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName()==t){this._uniforms.splice(e,1)}}this.setWhyCompile("remove uniform "+t)}hasUniformInStage(t,e){let i=this.defaultUniBindingFrag;if(e==GPUShaderStage.VERTEX)i=this.defaultUniBindingVert;if(e==GPUShaderStage.COMPUTE)i=this.defaultUniBindingCompute;for(let e=0;e<this._uniforms.length;e++){console.log("hasuniiiiiiiiiiiiiii",this._uniforms[e].getName(),t);if(this._uniforms[e].getName()==t)return true}return false}hasUniform(e){}toggleDefine(t,e){if(e&&typeof e=="object"&&e.addEventListener){if(e.changeListener)e.off(e.changeListener);e.onToggleDefine=e=>{this.toggleDefine(t,e)};e.changeListener=e.on("change",e.onToggleDefine);e=e.get()}if(e)this.define(t);else this.removeDefine(t)}define(t,i=""){if(i===null||i===undefined)i="";if(typeof i=="object"){i.removeEventListener("change",i.onDefineChange);i.onDefineChange=e=>{this.define(t,e)};i.on("change",i.onDefineChange);i=i.get()}for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t&&this._defines[e][1]==i)return;if(this._defines[e][0]==t){this._defines[e][1]=i;this.setWhyCompile("define "+t+" "+i);return}}this.setWhyCompile("define "+t+" "+i);this._defines.push([t,i])}getDefines(){return this._defines}getDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return this._defines[e][1];return null}hasDefine(t){for(let e=0;e<this._defines.length;e++)if(this._defines[e][0]==t)return true}removeDefine(t){for(let e=0;e<this._defines.length;e++){if(this._defines[e][0]==t){this._defines.splice(e,1);this.setWhyCompile("define removed:"+t);return}}}hasModule(t){for(let e=0;e<this._modules.length;e++)if(this._modules[e].id==t)return true;return false}setModules(e){this._moduleNames=e}removeModule(i){for(let e=0;e<this._modules.length;e++){if(i&&i.id){if(this._modules[e].id==i.id||!this._modules[e]){let t=true;while(t){t=false;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].getName().startsWith(i.prefix)){this._uniforms.splice(e,1);t=true;continue}}}this.setWhyCompile("remove module "+i.title);this._modules.splice(e,1);break}}}}getNumModules(){return this._modules.length}getCurrentModules(){return this._modules}addModule(e,t){if(this.hasModule(e.id))return;if(!e.id)e.id=A.utils.simpleId();if(!e.numId)e.numId=this._moduleNumId;if(!e.num)e.num=this._modules.length;if(t&&!t.group)t.group=A.utils.simpleId();if(!e.group)if(t)e.group=t.group;else e.group=A.utils.simpleId();e.prefix="mod"+e.group+"_";this._modules.push(e);this.setWhyCompile("add module "+e.title);this._moduleNumId++;return e}isValid(){return this._isValid}}class na{constructor(e,t,i,r,n,s,a,o,l,u){this._log=new h.Logger("cg_uniform");this._type=t;this._name=i;this._shader=e;this._value=1e-5;this._oldValue=null;this._port=null;this._structName=l;this._structUniformName=o;this._propertyName=u;if(this._shader._addUniform)this._shader._addUniform(this);this.needsUpdate=true;this.shaderType=null;this.comment=null;if(t=="f"){this.set=this.setValue=this.setValueF.bind(this);this.updateValue=this.updateValueF.bind(this)}else if(t=="f[]"){this.set=this.setValue=this.setValueArrayF.bind(this);this.updateValue=this.updateValueArrayF.bind(this)}else if(t=="2f[]"){this.set=this.setValue=this.setValueArray2F.bind(this);this.updateValue=this.updateValueArray2F.bind(this)}else if(t=="3f[]"){this.set=this.setValue=this.setValueArray3F.bind(this);this.updateValue=this.updateValueArray3F.bind(this)}else if(t=="4f[]"){this.set=this.setValue=this.setValueArray4F.bind(this);this.updateValue=this.updateValueArray4F.bind(this)}else if(t=="i"){this.set=this.setValue=this.setValueI.bind(this);this.updateValue=this.updateValueI.bind(this)}else if(t=="2i"){this.set=this.setValue=this.setValue2I.bind(this);this.updateValue=this.updateValue2I.bind(this)}else if(t=="3i"){this.set=this.setValue=this.setValue3I.bind(this);this.updateValue=this.updateValue3I.bind(this)}else if(t=="4i"){this.set=this.setValue=this.setValue4I.bind(this);this.updateValue=this.updateValue4I.bind(this)}else if(t=="b"){this.set=this.setValue=this.setValueBool.bind(this);this.updateValue=this.updateValueBool.bind(this)}else if(t=="4f"){this.set=this.setValue=this.setValue4F.bind(this);this.updateValue=this.updateValue4F.bind(this)}else if(t=="3f"){this.set=this.setValue=this.setValue3F.bind(this);this.updateValue=this.updateValue3F.bind(this)}else if(t=="2f"){this.set=this.setValue=this.setValue2F.bind(this);this.updateValue=this.updateValue2F.bind(this)}else if(t=="t"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="sampler"){if(this.setValueAny){this.set=this.setValue=this.setValueAny.bind(this);this.updateValue=this.updateValueAny.bind(this)}}else if(t=="tc"){this.set=this.setValue=this.setValueT.bind(this);this.updateValue=this.updateValueT.bind(this)}else if(t=="t[]"){this.set=this.setValue=this.setValueArrayT.bind(this);this.updateValue=this.updateValueArrayT.bind(this)}else if(t=="m4"||t=="m4[]"){this.set=this.setValue=this.setValueM4.bind(this);this.updateValue=this.updateValueM4.bind(this)}else{this._log.error("Unknown uniform type "+t,i,typeof this._shader)}if(typeof r=="object"&&r instanceof A.Port){this._port=r;this._value=this._port.get();if(n&&s&&a){if(!(n instanceof A.Port)||!(s instanceof A.Port)||!(a instanceof A.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0,0];this._port2=n;this._port3=s;this._port4=a;this._port.on("change",this.updateFromPort4f.bind(this));this._port2.on("change",this.updateFromPort4f.bind(this));this._port3.on("change",this.updateFromPort4f.bind(this));this._port4.on("change",this.updateFromPort4f.bind(this));this.updateFromPort4f()}else if(n&&s){if(!(n instanceof A.Port)||!(s instanceof A.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0,0];this._port2=n;this._port3=s;this._port.on("change",this.updateFromPort3f.bind(this));this._port2.on("change",this.updateFromPort3f.bind(this));this._port3.on("change",this.updateFromPort3f.bind(this));this.updateFromPort3f()}else if(n){if(!(n instanceof A.Port)){this._log.error("[cgl_uniform] mixed port/value parameter for vec4 ",this._name)}this._value=[0,0];this._port2=n;this._port.on("change",this.updateFromPort2f.bind(this));this._port2.on("change",this.updateFromPort2f.bind(this));this.updateFromPort2f()}else{this._port.on("change",this.updateFromPort.bind(this))}}else this._value=r;if(this._value==undefined){this._value=0}this.setValue(this._value);this.needsUpdate=true}getType(){return this._type}get type(){return this._type}get name(){return this._name}getName(){return this._name}getValue(){return this._value}getShaderType(){return this.shaderType}isStructMember(){return!!this._structName}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}get port(){return this._port}}class sa{_name="unknown";constructor(){}}const aa=8;class g{constructor(e={}){this.id=A.utils.uuid();this.width=0;this.height=0;this.name="unknown";e=e||{};this.pixelFormat=e.pixelFormat||g.PFORMATSTR_RGBA8UB;this.name=e.name||"unknown";if(!e.width)e.width=aa;if(!e.height)e.height=aa}}g.getDefaultTextureData=(e,s,a={})=>{if(e=="empty"){return new Uint8Array(s*s*4).fill(0)}else if(e=="color"){const n=new Uint8Array(s*s*4);let t=a.r||1;let i=a.g||1;let r=a.b||1;for(let e=0;e<s*s;e++){n[e*4+0]=t;n[e*4+1]=i;n[e*4+2]=r;n[e*4+3]=255}return n}else if(e=="randomUInt"){const n=new Uint8Array(s*s*4);for(let e=0;e<s*s;e++){n[e*4+0]=Math.random()*255;n[e*4+1]=Math.random()*255;n[e*4+2]=Math.random()*255;n[e*4+3]=255}return n}else if(e=="random"||e=="randomFloat"){const n=new Float32Array(s*s*4);for(let e=0;e<s*s;e++){n[e*4+0]=(Math.random()-.5)*2;n[e*4+1]=(Math.random()-.5)*2;n[e*4+2]=(Math.random()-.5)*2;n[e*4+3]=1}return n}else if(e=="stripes"){const o=[];let i=a.r;let r=a.g;let n=a.b;if(i===undefined)i=1;if(r===undefined)r=1;if(n===undefined)n=1;for(let t=0;t<s;t++){for(let e=0;e<s;e++){if((e+t)%64<32){o.push((200+t/s*25+e/s*25)*i);o.push((200+t/s*25+e/s*25)*r);o.push((200+t/s*25+e/s*25)*n)}else{o.push((40+t/s*25+e/s*25)*i);o.push((40+t/s*25+e/s*25)*r);o.push((40+t/s*25+e/s*25)*n)}o.push(255)}}return new Uint8Array(o)}else{console.warn("unknown default texture",e);return g.getDefaultTextureData("stripes",s,{r:1,g:0,b:0})}};g.FILTER_NEAREST=0;g.FILTER_LINEAR=1;g.FILTER_MIPMAP=2;g.WRAP_REPEAT=0;g.WRAP_MIRRORED_REPEAT=1;g.WRAP_CLAMP_TO_EDGE=2;g.TYPE_DEFAULT=0;g.TYPE_DEPTH=1;g.TYPE_FLOAT=2;g.PFORMATSTR_RGB565="RGB 5/6/5bit ubyte";g.PFORMATSTR_R8UB="R 8bit ubyte";g.PFORMATSTR_RG8UB="RG 8bit ubyte";g.PFORMATSTR_RGB8UB="RGB 8bit ubyte";g.PFORMATSTR_RGBA8UB="RGBA 8bit ubyte";g.PFORMATSTR_SRGBA8="SRGBA 8bit ubyte";g.PFORMATSTR_R11FG11FB10F="RGB 11/11/10bit float";g.PFORMATSTR_R16F="R 16bit float";g.PFORMATSTR_RG16F="RG 16bit float";g.PFORMATSTR_RGB16F="RGB 16bit float";g.PFORMATSTR_RGBA16F="RGBA 16bit float";g.PFORMATSTR_R32F="R 32bit float";g.PFORMATSTR_RG32F="RG 32bit float";g.PFORMATSTR_RGB32F="RGB 32bit float";g.PFORMATSTR_RGBA32F="RGBA 32bit float";g.PFORMATSTR_DEPTH="DEPTH";g.PIXELFORMATS=[g.PFORMATSTR_RGB565,g.PFORMATSTR_R8UB,g.PFORMATSTR_RG8UB,g.PFORMATSTR_RGB8UB,g.PFORMATSTR_RGBA8UB,g.PFORMATSTR_SRGBA8,g.PFORMATSTR_R11FG11FB10F,g.PFORMATSTR_R16F,g.PFORMATSTR_RG16F,g.PFORMATSTR_RGBA16F,g.PFORMATSTR_R32F,g.PFORMATSTR_RGBA32F];const oa={SHADERVAR_VERTEX_POSITION:"vPosition",SHADERVAR_VERTEX_NUMBER:"attrVertIndex",SHADERVAR_VERTEX_NORMAL:"attrVertNormal",SHADERVAR_VERTEX_TEXCOORD:"attrTexCoord",SHADERVAR_INSTANCE_MMATRIX:"instMat",SHADERVAR_VERTEX_COLOR:"attrVertColor",SHADERVAR_INSTANCE_INDEX:"instanceIndex",SHADERVAR_UNI_PROJMAT:"projMatrix",SHADERVAR_UNI_VIEWMAT:"viewMatrix",SHADERVAR_UNI_MODELMAT:"modelMatrix",SHADERVAR_UNI_NORMALMAT:"normalMatrix",SHADERVAR_UNI_INVVIEWMAT:"inverseViewMatrix",SHADERVAR_UNI_INVPROJMAT:"invProjMatrix",SHADERVAR_UNI_MATERIALID:"materialId",SHADERVAR_UNI_OBJECTID:"objectId",SHADERVAR_UNI_VIEWPOS:"camPos"};const la={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};const ua=180/Math.PI;const ha=Math.PI/180;const d={MATH:{DEG2RAD:ha,RAD2DEG:ua},SHADER:oa,BLEND_MODES:la};const O="\n";const ca={DEPTH_COMPARE_NEVER:0,DEPTH_COMPARE_LESS:1,DEPTH_COMPARE_EQUAL:2,DEPTH_COMPARE_LESSEQUAL:3,DEPTH_COMPARE_GREATER:4,DEPTH_COMPARE_NOTEQUAL:5,DEPTH_COMPARE_GREATEREQUAL:6,DEPTH_COMPARE_ALWAYS:7,CULL_NONE:0,CULL_BACK:1,CULL_FRONT:2,CULL_BOTH:3,Geometry:c,BoundingBox:i,FpsCounter:ea,CgCanvas:$s};window.CABLES=window.CABLES||{};window.CABLES.CG={...window.CABLES.CG,...ca};window.CG={...window.CG,...ca};window.glMatrix=C;window.mat2=R;window.mat2d=N;window.mat3=y;window.mat4=P;window.quat=k;window.quat2=H;window.vec2=X;window.vec3=L;window.vec4=F;class m extends na{constructor(e,t,i,r,n,s,a,o,l,u){super(e,t,i,r,n,s,a,o,l,u);this._loc=-1;this._cgl=e._cgl}get name(){return this._name}copy(e){const t=new m(e,this._type,this._name,this._value,this._port2,this._port3,this._port4,this._structUniformName,this._structName,this._propertyName);t.shaderType=this.shaderType;return t}getGlslTypeString(){return m.glslTypeString(this._type)}_isValidLoc(){return this._loc!=-1}resetLoc(){this._loc=-1;this.needsUpdate=true}bindTextures(){}getLoc(){return this._loc}updateFromPort4f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this._value[3]=this._port4.get();this.setValue(this._value)}updateFromPort3f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this._value[2]=this._port3.get();this.setValue(this._value)}updateFromPort2f(){this._value[0]=this._port.get();this._value[1]=this._port2.get();this.setValue(this._value)}updateFromPort(){this.setValue(this._port.get())}updateValueF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1f(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueF(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}updateValueI(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value);this._cgl.profileData.profileUniformCount++}updateValue2I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2i(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}updateValue3I(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3i(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}updateValue4I(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform4i(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.profileUniformCount++}setValueI(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValue2I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}setValue3I(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}setValue4I(e){this.needsUpdate=true;this._value=e||vec4.create()}updateValueBool(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;this._shader.getCgl().gl.uniform1i(this._loc,this._value?1:0);this._cgl.profileData.profileUniformCount++}setValueBool(e){if(e!=this._value){this.needsUpdate=true;this._value=e}}setValueArray4F(e){this.needsUpdate=true;this._value=e}updateValueArray4F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform4fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArray3F(e){this.needsUpdate=true;this._value=e}updateValueArray3F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform3fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArray2F(e){this.needsUpdate=true;this._value=e}updateValueArray2F(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform2fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArrayF(e){this.needsUpdate=true;this._value=e}updateValueArrayF(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1fv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}setValueArrayT(e){this.needsUpdate=true;this._value=e}updateValue3F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform3f(this._loc,this._value[0],this._value[1],this._value[2]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}setValue3F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValue2F(){if(!this._value)return;if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._shader.getCgl().gl.uniform2f(this._loc,this._value[0],this._value[1]);this.needsUpdate=false;this._cgl.profileData.profileUniformCount++}setValue2F(e){if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this.needsUpdate=true}this._value=e}updateValue4F(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value){this._log.warn("no value for uniform",this._name,this);this._value=[0,0,0,0]}this.needsUpdate=false;this._shader.getCgl().gl.uniform4f(this._loc,this._value[0],this._value[1],this._value[2],this._value[3]);this._cgl.profileData.profileUniformCount++}setValue4F(e){if(typeof this.value=="number")this.value=vec4.create();if(!e)return;if(!this._oldValue){this._oldValue=[e[0]-1,1,2,3];this.needsUpdate=true}else if(e[0]!=this._oldValue[0]||e[1]!=this._oldValue[1]||e[2]!=this._oldValue[2]||e[3]!=this._oldValue[3]){this._oldValue[0]=e[0];this._oldValue[1]=e[1];this._oldValue[2]=e[2];this.needsUpdate=true}this._value=e}updateValueM4(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}if(!this._value||this._value.length%16!=0)return console.log("this.name",this._name,this._value);this._shader.getCgl().gl.uniformMatrix4fv(this._loc,false,this._value);this._cgl.profileData.profileUniformCount++}setValueM4(e){this.needsUpdate=true;this._value=e||mat4.create()}updateValueArrayT(){if(!this._isValidLoc())this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);else this.needsUpdate=false;if(!this._value)return;this._shader.getCgl().gl.uniform1iv(this._loc,this._value);this._cgl.profileData.profileUniformCount++}updateValueT(){if(!this._isValidLoc()){this._loc=this._shader.getCgl().gl.getUniformLocation(this._shader.getProgram(),this._name);this._cgl.profileData.profileShaderGetUniform++;this._cgl.profileData.profileShaderGetUniformName=this._name}this._cgl.profileData.profileUniformCount++;this._shader.getCgl().gl.uniform1i(this._loc,this._value);this.needsUpdate=false}setValueT(e){this.needsUpdate=true;this._value=e}}m.glslTypeString=e=>{if(e=="f")return"float";if(e=="b")return"bool";if(e=="i")return"int";if(e=="2i")return"ivec2";if(e=="2f")return"vec2";if(e=="3f")return"vec3";if(e=="4f")return"vec4";if(e=="m4")return"mat4";if(e=="t")return"sampler2D";if(e=="tc")return"samplerCube";if(e=="3f[]")return null;if(e=="m4[]")return null;if(e=="f[]")return null;console.warn("[CGL UNIFORM] unknown glsl type string ",e)};const I={};I.lastMesh=null;class fa extends sa{#cgl=null;#geom=null;#bufVerticesIndizes=null;constructor(e,t,i={}){super();this.#cgl=e;let r=i||{};if(A.utils.isNumeric(r))r={glPrimitive:i};this._log=new h.Logger("cgl_mesh");this._bufVertexAttrib=null;this.#bufVerticesIndizes=this.#cgl.gl.createBuffer();this._indexType=this.#cgl.gl.UNSIGNED_SHORT;this._attributes=[];this._attribLocs={};this._lastShader=null;this._numInstances=0;this._glPrimitive=r.glPrimitive||null;this.opId=r.opId||"";this._preWireframeGeom=null;this.addVertexNumbers=false;this.feedBackAttributes=[];this.setGeom(t);this._feedBacks=[];this._feedBacksChanged=false;this._transformFeedBackLoc=-1;this._lastAttrUpdate=0;this.memFreed=false;this.#cgl.profileData.addHeavyEvent("mesh constructed",this._name);this._queryExt=null}get geom(){return this.#geom}get numInstances(){return this._numInstances}set numInstances(e){this.setNumInstances(e)}freeMem(){this.memFreed=true;for(let e=0;e<this._attributes.length;e++)this._attributes[e].floatArray=null}updateVertices(e){this.setAttribute(d.SHADER.SHADERVAR_VERTEX_POSITION,e.vertices,3);this._numVerts=e.vertices.length/3}setAttributePointer(t,i,r,n){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t){if(!this._attributes[e].pointer)this._attributes[e].pointer=[];this._attributes[e].pointer.push({loc:-1,name:i,stride:r,offset:n,instanced:t==d.SHADER.SHADERVAR_INSTANCE_MMATRIX})}}}getAttribute(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].name==t)return this._attributes[e]}setAttributeRange(e,t,i,r){if(!e)return;if(!i&&!r)return;if(!e.name)this._log.stack("no attrname?!");const n=this.#cgl.gl;n.bindBuffer(n.ARRAY_BUFFER,e.buffer);this.#cgl.profileData.profileMeshAttributes+=r-i||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]=this.#cgl.profileData.profileSingleMeshAttribute[this._name]||0;this.#cgl.profileData.profileSingleMeshAttribute[this._name]+=r-i||0;if(e.numItems<t.length/e.itemSize){this._resizeAttr(t,e)}if(r>t.length&&!this.warned){this.warned=true;this._log.warn(this.#cgl.canvas.id+"'"+e.name+"' buffersubdata out of bounds ?",t.length,r,i,e);return}n.bufferSubData(n.ARRAY_BUFFER,i*4,t,i,r-i)}_resizeAttr(e,t){const i=this.#cgl.gl;if(t.buffer)i.deleteBuffer(t.buffer);t.buffer=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,t.buffer);this._bufferArray(e,t);t.numItems=e.length/t.itemSize}_bufferArray(e,t){let i=t.floatArray||null;if(!e)return;if(this.#cgl.debugOneFrame){console.log("_bufferArray",e.length,t.name)}if(!(e instanceof Float32Array)){if(t&&i&&i.length==e.length){i.set(e)}else{i=new Float32Array(e);if(this.#cgl.debugOneFrame){console.log("_bufferArray create new float32array",e.length,t.name)}if(e.length>1e4){this.#cgl.profileData.profileNonTypedAttrib++;this.#cgl.profileData.profileNonTypedAttribNames="("+this._name+":"+t.name+")"}}}else i=e;t.arrayLength=i.length;t.floatArray=null;this.#cgl.gl.bufferData(this.#cgl.gl.ARRAY_BUFFER,i,this.#cgl.gl.DYNAMIC_DRAW)}addAttribute(e,t,i,r){this.setAttribute(e,t,i,r)}setAttribute(e,t,i,r={}){if(!t){this._log.error("mesh addAttribute - no array given! "+e);throw new Error}let n=null;let s=false;let a=0;const o=t.length/i;this.#cgl.profileData.profileMeshAttributes+=o||0;if(typeof r=="function"){n=r}if(typeof r=="object"){if(r.cb)n=r.cb;if(r.instanced)s=r.instanced}if(e==d.SHADER.SHADERVAR_INSTANCE_MMATRIX)s=true;for(a=0;a<this._attributes.length;a++){const h=this._attributes[a];if(h.name==e){if(h.numItems===o){}else{this._resizeAttr(t,h)}this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,h.buffer);this._bufferArray(t,h);return h}}const l=this.#cgl.gl.createBuffer();this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,l);let u=this.#cgl.gl.FLOAT;if(r&&r.type)u=r.type;const h={buffer:l,name:e,cb:n,itemSize:i,numItems:o,startItem:0,instanced:s,type:u};this._bufferArray(t,h);if(e==d.SHADER.SHADERVAR_VERTEX_POSITION)this._bufVertexAttrib=h;this._attributes.push(h);this._attribLocs={};return h}getAttributes(){return this._attributes}updateTexCoords(e){if(e.texCoords&&e.texCoords.length>0){this.setAttribute(d.SHADER.SHADERVAR_VERTEX_TEXCOORD,e.texCoords,2)}else{const t=new Float32Array(Math.round(e.vertices.length/3*2));this.setAttribute(d.SHADER.SHADERVAR_VERTEX_TEXCOORD,t,2)}}updateNormals(e){if(e.vertexNormals&&e.vertexNormals.length>0){this.setAttribute(d.SHADER.SHADERVAR_VERTEX_NORMAL,e.vertexNormals,3)}else{const t=new Float32Array(Math.round(e.vertices.length));this.setAttribute(d.SHADER.SHADERVAR_VERTEX_NORMAL,t,3)}}_setVertexNumbers(e=null){if(!this._verticesNumbers||this._verticesNumbers.length!=this._numVerts||e){if(e)this._verticesNumbers=e;else{this._verticesNumbers=new Float32Array(this._numVerts);for(let e=0;e<this._numVerts;e++)this._verticesNumbers[e]=e}this.setAttribute(d.SHADER.SHADERVAR_VERTEX_NUMBER,this._verticesNumbers,1,(e,t,i)=>{if(!i.uniformNumVertices)i.uniformNumVertices=new m(i,"f","numVertices",this._numVerts);i.uniformNumVertices.setValue(this._numVerts)})}}setVertexIndices(t){if(!this.#bufVerticesIndizes){this._log.warn("no bufVerticesIndizes: "+this._name);return}if(t.length>0){if(t instanceof Float32Array)this._log.warn("vertIndices float32Array: "+this._name);for(let e=0;e<t.length;e++){if(t[e]>=this._numVerts){this._log.warn("invalid index in "+this._name,e,t[e]);return}}this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes);if(t.length>65535){this.vertIndicesTyped=new Uint32Array(t);this._indexType=this.#cgl.gl.UNSIGNED_INT}else if(t instanceof Uint32Array){this.vertIndicesTyped=t;this._indexType=this.#cgl.gl.UNSIGNED_INT}else if(!(t instanceof Uint16Array)){this.vertIndicesTyped=new Uint16Array(t);this._indexType=this.#cgl.gl.UNSIGNED_SHORT}else this.vertIndicesTyped=t;this.#cgl.gl.bufferData(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.vertIndicesTyped,this.#cgl.gl.DYNAMIC_DRAW);this.#bufVerticesIndizes.itemSize=1;this.#bufVerticesIndizes.numItems=t.length}else this.#bufVerticesIndizes.numItems=0}setGeom(e,t=false){this.#geom=e;if(e.glPrimitive!=null)this._glPrimitive=e.glPrimitive;if(this.#geom&&this.#geom.name)this._name="mesh "+this.#geom.name;I.lastMesh=null;this.#cgl.profileData.profileMeshSetGeom++;this._disposeAttributes();this.updateVertices(this.#geom);this.setVertexIndices(this.#geom.verticesIndices);if(this.addVertexNumbers)this._setVertexNumbers();const i=this.#geom.getAttributes();const r={texCoords:d.SHADER.SHADERVAR_VERTEX_TEXCOORD,vertexNormals:d.SHADER.SHADERVAR_VERTEX_NORMAL,vertexColors:d.SHADER.SHADERVAR_VERTEX_COLOR,tangents:"attrTangent",biTangents:"attrBiTangent"};for(const n in i)if(i[n].data&&i[n].data.length)this.setAttribute(r[n]||n,i[n].data,i[n].itemSize);if(t){this.#geom=null}}_preBind(t){for(let e=0;e<this._attributes.length;e++)if(this._attributes[e].cb)this._attributes[e].cb(this._attributes[e],this.#geom,t)}_checkAttrLengths(){if(this.memFreed)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].arrayLength/this._attributes[e].itemSize<this._attributes[0].arrayLength/this._attributes[0].itemSize){let e="unknown";if(this.#geom)e=this.#geom.name}}}_bind(t){if(!t)return;if(!t.isValid())return;let i=[];if(this._attribLocs[t.id])i=this._attribLocs[t.id];else this._attribLocs[t.id]=i;this._lastShader=t;if(t.lastCompile>this._lastAttrUpdate||i.length!=this._attributes.length){this._lastAttrUpdate=t.lastCompile;for(let e=0;e<this._attributes.length;e++)i[e]=-1}for(let e=0;e<this._attributes.length;e++){const r=this._attributes[e];if(i[e]==-1){if(r._attrLocationLastShaderTime!=t.lastCompile){r._attrLocationLastShaderTime=t.lastCompile;i[e]=this.#cgl.glGetAttribLocation(t.getProgram(),r.name);this.#cgl.profileData.profileAttrLoc++}}if(i[e]!=-1){this.#cgl.gl.enableVertexAttribArray(i[e]);this.#cgl.gl.bindBuffer(this.#cgl.gl.ARRAY_BUFFER,r.buffer);if(r.instanced){if(r.itemSize<=4){if(!r.itemSize||r.itemSize==0)this._log.warn("instanced attrib itemsize error",this.#geom.name,r);this.#cgl.gl.vertexAttribPointer(i[e],r.itemSize,r.type,false,r.itemSize*4,0);this.#cgl.gl.vertexAttribDivisor(i[e],1)}else if(r.itemSize==16){const n=16*4;this.#cgl.gl.vertexAttribPointer(i[e],4,r.type,false,n,0);this.#cgl.gl.enableVertexAttribArray(i[e]+1);this.#cgl.gl.vertexAttribPointer(i[e]+1,4,r.type,false,n,4*4*1);this.#cgl.gl.enableVertexAttribArray(i[e]+2);this.#cgl.gl.vertexAttribPointer(i[e]+2,4,r.type,false,n,4*4*2);this.#cgl.gl.enableVertexAttribArray(i[e]+3);this.#cgl.gl.vertexAttribPointer(i[e]+3,4,r.type,false,n,4*4*3);this.#cgl.gl.vertexAttribDivisor(i[e],1);this.#cgl.gl.vertexAttribDivisor(i[e]+1,1);this.#cgl.gl.vertexAttribDivisor(i[e]+2,1);this.#cgl.gl.vertexAttribDivisor(i[e]+3,1)}else{this._log.warn("unknown instance attrib size",r.name)}}else{if(!r.itemSize||r.itemSize==0)this._log.warn("attrib itemsize error",this._name,r);this.#cgl.gl.vertexAttribPointer(i[e],r.itemSize,r.type,false,r.itemSize*4,0);if(r.pointer){for(let e=0;e<r.pointer.length;e++){const s=r.pointer[e];if(s.loc==-1)s.loc=this.#cgl.glGetAttribLocation(t.getProgram(),s.name);this.#cgl.profileData.profileAttrLoc++;this.#cgl.gl.enableVertexAttribArray(s.loc);this.#cgl.gl.vertexAttribPointer(s.loc,r.itemSize,r.type,false,s.stride,s.offset)}}if(this.bindFeedback)this.bindFeedback(r)}}}if(this.#bufVerticesIndizes&&this.#bufVerticesIndizes.numItems!==0)this.#cgl.gl.bindBuffer(this.#cgl.gl.ELEMENT_ARRAY_BUFFER,this.#bufVerticesIndizes)}unBind(){const e=this._lastShader;this._lastShader=null;if(!e)return;let t=[];if(this._attribLocs[e.id])t=this._attribLocs[e.id];else this._attribLocs[e.id]=t;I.lastMesh=null;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].instanced){if(this._attributes[e].itemSize<=4){if(t[e]!=-1)this.#cgl.gl.vertexAttribDivisor(t[e],0);if(t[e]>=0)this.#cgl.gl.disableVertexAttribArray(t[e])}else{this.#cgl.gl.vertexAttribDivisor(t[e],0);this.#cgl.gl.vertexAttribDivisor(t[e]+1,0);this.#cgl.gl.vertexAttribDivisor(t[e]+2,0);this.#cgl.gl.vertexAttribDivisor(t[e]+3,0);this.#cgl.gl.disableVertexAttribArray(t[e]+1);this.#cgl.gl.disableVertexAttribArray(t[e]+2);this.#cgl.gl.disableVertexAttribArray(t[e]+3)}}if(t[e]!=-1)this.#cgl.gl.disableVertexAttribArray(t[e])}}meshChanged(){return this.#cgl.lastMesh&&this.#cgl.lastMesh!=this}printDebug(){console.log("--attributes");for(let e=0;e<this._attributes.length;e++){console.log("attribute "+e+" "+this._attributes[e].name)}}setNumVertices(e){this._bufVertexAttrib.numItems=e}getNumVertices(){return this._bufVertexAttrib.numItems}setNumIndices(e){this.#bufVerticesIndizes.numItems=e}getNumIndices(){return this.#bufVerticesIndizes.numItems}render(i){if(this.#cgl.aborted)return;i=i||this.#cgl.getShader();if(!i){return console.log("shader not valid")}if(!i.isValid()){i=this.#cgl.getErrorShader()}this._checkAttrLengths();if(this.#geom){if(this._preWireframeGeom&&!i.wireframe&&!this.#geom.isIndexed()){this.setGeom(this._preWireframeGeom);this._preWireframeGeom=null}if(i.wireframe){let e=false;if(this.#geom.isIndexed()){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}this.#geom.unIndex();e=true}if(!this.#geom.getAttribute("attrBarycentric")){if(!this._preWireframeGeom){this._preWireframeGeom=this.#geom;this.#geom=this.#geom.copy()}e=true;this.#geom.calcBarycentric()}if(e)this.setGeom(this.#geom)}}let e=false;if(I.lastMesh!=this){if(I.lastMesh)I.lastMesh.unBind();e=true}if(e)this._preBind(i);if(!i.bind())return;this._bind(i);if(this.addVertexNumbers)this._setVertexNumbers();I.lastMesh=this;let t=this.#cgl.gl.TRIANGLES;if(this._glPrimitive!==null)t=this._glPrimitive;if(i.glPrimitive!==null)t=i.glPrimitive;let r=1;let n=this.#cgl.profileData.doProfileGlQuery;let s=false;if(n){let e=this._name+" - "+i.getName()+" #"+i.id;if(this._numInstances)e+=" instanced "+this._numInstances+"x";let t=this.#cgl.profileData.glQueryData[e];if(!t)t={id:e,num:0};if(i.opId)t.shaderOp=i.opId;if(this.opId)t.meshOp=this.opId;this.#cgl.profileData.glQueryData[e]=t;if(!this._queryExt&&this._queryExt!==false)this._queryExt=this.#cgl.enableExtension("EXT_disjoint_timer_query_webgl2")||false;if(this._queryExt){if(t._drawQuery){const a=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT_AVAILABLE);if(a){const o=this.#cgl.gl.getQueryParameter(t._drawQuery,this.#cgl.gl.QUERY_RESULT);const l=o/1e6;t._times=t._times||0;t._times+=l;t._numcount++;t.when=performance.now();t._drawQuery=null;t.queryStarted=false}}if(!t.queryStarted){t._drawQuery=this.#cgl.gl.createQuery();this.#cgl.gl.beginQuery(this._queryExt.TIME_ELAPSED_EXT,t._drawQuery);s=t.queryStarted=true}}}if(this.hasFeedbacks&&this.hasFeedbacks())this.drawFeedbacks(i,t);else if(!this.#bufVerticesIndizes||this.#bufVerticesIndizes.numItems===0){if(t==this.#cgl.gl.TRIANGLES)r=3;if(this._numInstances===0)this.#cgl.gl.drawArrays(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems-this._bufVertexAttrib.startItem);else this.#cgl.gl.drawArraysInstanced(t,this._bufVertexAttrib.startItem,this._bufVertexAttrib.numItems,this._numInstances)}else{if(t==this.#cgl.gl.TRIANGLES)r=3;if(this._numInstances===0){this.#cgl.gl.drawElements(t,this.#bufVerticesIndizes.numItems,this._indexType,0)}else{this.#cgl.gl.drawElementsInstanced(t,this.#bufVerticesIndizes.numItems,this._indexType,0,this._numInstances)}}if(this.#cgl.debugOneFrame&&this.#cgl.gl.getError()!=this.#cgl.gl.NO_ERROR){this._log.error("mesh draw gl error");this._log.error("mesh",this);this._log.error("shader",i);const u=[];for(let e=0;e<this.#cgl.gl.getProgramParameter(i.getProgram(),this.#cgl.gl.ACTIVE_ATTRIBUTES);e++){const h=this.#cgl.gl.getActiveAttrib(i.getProgram(),e).name;this._log.error("attrib ",h)}}this.#cgl.profileData.profileMeshNumElements+=this._bufVertexAttrib.numItems/r*(this._numInstances||1);this.#cgl.profileData.profileMeshDraw++;if(n&&s){this.#cgl.gl.endQuery(this._queryExt.TIME_ELAPSED_EXT)}this.#cgl.printError("mesh render "+this._name);this.unBind()}setNumInstances(t){t=Math.max(0,t);if(this._numInstances!=t){this._numInstances=t;const i=new Float32Array(t);for(let e=0;e<t;e++)i[e]=e;this.setAttribute(d.SHADER.SHADERVAR_INSTANCE_INDEX,i,1,{instanced:true})}}_disposeAttributes(){if(!this._attributes)return;for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].buffer){this.#cgl.gl.deleteBuffer(this._attributes[e].buffer);this._attributes[e].buffer=null}}this._attributes.length=0}dispose(){if(this.#cgl.aborted)return;if(this._bufVertexAttrib&&this._bufVertexAttrib.buffer)this.#cgl.gl.deleteBuffer(this._bufVertexAttrib.buffer);if(this.#bufVerticesIndizes)this.#cgl.gl.deleteBuffer(this.#bufVerticesIndizes);this.#bufVerticesIndizes=null;this._disposeAttributes();return null}}const p={};p.getSimpleRect=function(e,t,i=1){const r=new c(t);r.vertices=[1*i,1*i,0,-1*i,1*i,0,1*i,-1*i,0,-1*i,-1*i,0];r.texCoords=[1,1,0,1,1,0,0,0];r.verticesIndices=[0,1,2,2,1,3];r.vertexNormals=[0,0,0,0,0,0,0,0,0,0,0,0];return e.createMesh(r)};p.getSimpleCube=function(e,t){const i=new c(t);i.vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1];i.setTexCoords([0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,0,0,0,1,1,1,1,0,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0]);i.verticesIndices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];i.vertexNormals=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]);i.tangents=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1]);i.biTangents=new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1]);return new fa(e,i)};class b{constructor(e,t){this._cgl=e;this._log=new h.Logger("cgl_TextureEffect");if(!e.TextureEffectMesh)this.createMesh();this._textureSource=null;this._options=t;this.name=t.name||"unknown";this.imgCompVer=0;this.aspectRatio=1;this._textureTarget=null;this._frameBuf=this._cgl.gl.createFramebuffer();this._frameBuf2=this._cgl.gl.createFramebuffer();this._renderbuffer=this._cgl.gl.createRenderbuffer();this._renderbuffer2=this._cgl.gl.createRenderbuffer();this.switched=false;this.depth=false}dispose(){if(this._renderbuffer)this._cgl.gl.deleteRenderbuffer(this._renderbuffer);if(this._frameBuf)this._cgl.gl.deleteFramebuffer(this._frameBuf);if(this._renderbuffer2)this._cgl.gl.deleteRenderbuffer(this._renderbuffer2);if(this._frameBuf2)this._cgl.gl.deleteFramebuffer(this._frameBuf2)}getWidth(){return this._textureSource.width}getHeight(){return this._textureSource.height}setSourceTexture(e){if(e===null){this._textureSource=new x(this._cgl);this._textureSource.setSize(16,16)}else{this._textureSource=e}if(!this._textureSource.compareSettings(this._textureTarget)){if(this._textureTarget)this._textureTarget.delete();this._textureTarget=this._textureSource.clone();this._cgl.profileData.profileEffectBuffercreate++;this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureTarget.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._renderbuffer2);if(this.depth)this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,this._cgl.gl.DEPTH_COMPONENT16,this._textureSource.width,this._textureSource.height);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._textureSource.tex,0);if(this.depth)this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._renderbuffer2);this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}this.aspectRatio=this._textureSource.width/this._textureSource.height}continueEffect(){this._cgl.pushDepthTest(false);this._cgl.pushModelMatrix();this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this.getCurrentTargetTexture().width,this.getCurrentTargetTexture().height);mat4.perspective(this._cgl.pMatrix,45,this.getCurrentTargetTexture().width/this.getCurrentTargetTexture().height,.1,1100);this._cgl.pushPMatrix();mat4.identity(this._cgl.pMatrix);this._cgl.pushViewMatrix();mat4.identity(this._cgl.vMatrix);this._cgl.pushModelMatrix();mat4.identity(this._cgl.mMatrix)}startEffect(e){if(!this._textureTarget){this._log.warn("effect has no target");return}this.switched=false;this.continueEffect();if(e){this._bgTex=e}this._countEffects=0}endEffect(){this._cgl.popDepthTest();this._cgl.popModelMatrix();this._cgl.popPMatrix();this._cgl.popModelMatrix();this._cgl.popViewMatrix();this._cgl.popPMatrix();this._cgl.popViewPort()}bind(){if(this._textureSource===null){this._log.warn("no base texture set!");return}if(!this.switched){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf);this._cgl.pushGlFrameBuffer(this._frameBuf)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuf2);this._cgl.pushGlFrameBuffer(this._frameBuf2)}}finish(){if(this._textureSource===null){this._log.warn("no base texture set!");return}this._cgl.TextureEffectMesh.render(this._cgl.getShader());this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.profileData.profileTextureEffect++;if(this._textureTarget.filter==x.FILTER_MIPMAP){if(!this.switched){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureTarget.tex);this._textureTarget.updateMipMap()}else{this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._textureSource.tex);this._textureSource.updateMipMap()}this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}this.switched=!this.switched;this._countEffects++}getCurrentTargetTexture(){if(this.switched)return this._textureSource;return this._textureTarget}getCurrentSourceTexture(){if(this._countEffects==0&&this._bgTex)return this._bgTex;if(this.switched)return this._textureTarget;return this._textureSource}delete(){if(this._textureTarget)this._textureTarget.delete();if(this._textureSource)this._textureSource.delete();this._cgl.gl.deleteRenderbuffer(this._renderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuf)}createMesh(){this._cgl.TextureEffectMesh=p.getSimpleRect(this._cgl,"texEffectRect")}}b.checkOpNotInTextureEffect=function(e){if(!e.patch.cgl)return true;if(e.uiAttribs.error&&!e.patch.cgl.currentTextureEffect){e.setUiError("textureeffect",null);return true}if(!e.patch.cgl.currentTextureEffect)return true;if(e.patch.cgl.currentTextureEffect&&!e.uiAttribs.error){e.setUiError("textureeffect","This op can not be a child of a ImageCompose/texture effect! imagecompose should only have textureeffect childs.",0);return false}if(e.patch.cgl.currentTextureEffect)return false;return true};b.checkOpInEffect=function(e,t){t=t||0;if(e.patch.cgl.currentTextureEffect){if(e.uiAttribs.uierrors&&e.patch.cgl.currentTextureEffect.imgCompVer>=t){e.setUiError("texeffect",null);return true}if(t&&e.patch.cgl.currentTextureEffect.imgCompVer<t){e.setUiError("texeffect","This op must be a child of an ImageCompose op with version >="+t+' <span class="button-small" onclick="gui.patchView.downGradeOp(\''+e.id+"','"+e.name+"')\">Downgrade</span> to previous version",1)}}if(e.patch.cgl.currentTextureEffect)return true;if(!e.patch.cgl.currentTextureEffect&&(!e.uiAttribs.uierrors||e.uiAttribs.uierrors.length==0)){e.setUiError("texeffect",'This op must be a child of an ImageCompose op! More infos <a href="https://cables.gl/docs/image_composition/image_composition.html" target="_blank">here</a>. ',1);return false}if(!e.patch.cgl.currentTextureEffect)return false;return true};b.getBlendCode=function(e){let t="".endl()+"vec3 _blend(vec3 base,vec3 blend)".endl()+"{".endl()+"   vec3 colNew=blend;".endl()+"   #ifdef BM_MULTIPLY".endl()+"       colNew=base*blend;".endl()+"   #endif".endl()+"   #ifdef BM_MULTIPLY_INV".endl()+"       colNew=base* vec3(1.0)-blend;".endl()+"   #endif".endl()+"   #ifdef BM_AVERAGE".endl()+"       colNew=((base + blend) / 2.0);".endl()+"   #endif".endl()+"   #ifdef BM_ADD".endl()+"       colNew=min(base + blend, vec3(1.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT_ONE".endl()+"       colNew=max(base + blend - vec3(1.0), vec3(0.0));".endl()+"   #endif".endl()+"   #ifdef BM_SUBTRACT".endl()+"       colNew=base - blend;".endl()+"   #endif".endl()+"   #ifdef BM_DIFFERENCE".endl()+"       colNew=abs(base - blend);".endl()+"   #endif".endl()+"   #ifdef BM_NEGATION".endl()+"       colNew=(vec3(1.0) - abs(vec3(1.0) - base - blend));".endl()+"   #endif".endl()+"   #ifdef BM_EXCLUSION".endl()+"       colNew=(base + blend - 2.0 * base * blend);".endl()+"   #endif".endl()+"   #ifdef BM_LIGHTEN".endl()+"       colNew=max(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_DARKEN".endl()+"       colNew=min(blend, base);".endl()+"   #endif".endl()+"   #ifdef BM_OVERLAY".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SCREEN".endl()+"      #define BlendScreenf(base, blend)       (1.0 - ((1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendScreenf(base.r, blend.r),BlendScreenf(base.g, blend.g),BlendScreenf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_SOFTLIGHT".endl()+"      #define BlendSoftLightf(base, blend)    ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))".endl()+"      colNew=vec3(BlendSoftLightf(base.r, blend.r),BlendSoftLightf(base.g, blend.g),BlendSoftLightf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_HARDLIGHT".endl()+"      #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"      colNew=vec3(BlendOverlayf(base.r, blend.r),BlendOverlayf(base.g, blend.g),BlendOverlayf(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORDODGE".endl()+"      #define BlendColorDodgef(base, blend)   ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))".endl()+"      colNew=vec3(BlendColorDodgef(base.r, blend.r),BlendColorDodgef(base.g, blend.g),BlendColorDodgef(base.b, blend.b));".endl()+"   #endif".endl()+"   #ifdef BM_COLORBURN".endl()+"      #define BlendColorBurnf(base, blend)    ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))".endl()+"      colNew=vec3(BlendColorBurnf(base.r, blend.r),BlendColorBurnf(base.g, blend.g),BlendColorBurnf(base.b, blend.b));".endl()+"   #endif".endl()+"   return colNew;".endl()+"}".endl();if(!e)t+="vec4 cgl_blend(vec4 oldColor,vec4 newColor,float amount)".endl()+"{".endl()+"vec4 col=vec4( _blend(oldColor.rgb,newColor.rgb) ,1.0);".endl()+"col=vec4( mix( col.rgb, oldColor.rgb ,1.0-oldColor.a*amount),1.0);".endl()+"return col;".endl()+"}".endl();if(e>=3)t+="vec4 cgl_blendPixel(vec4 base,vec4 col,float amount)".endl()+"{".endl()+"#ifdef BM_MATH_ADD".endl()+"   return vec4(base.rgb+col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_SUB".endl()+"   return vec4(base.rgb-col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_MUL".endl()+"   return vec4(base.rgb*col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifdef BM_MATH_DIV".endl()+"   return vec4(base.rgb/col.rgb*amount,1.0);".endl()+"#endif".endl()+"#ifndef BM_MATH".endl()+"vec3 colNew=_blend(base.rgb,col.rgb);".endl()+"float newA=clamp(base.a+(col.a*amount),0.,1.);".endl()+"#ifdef BM_ALPHAMASKED".endl()+"newA=base.a;".endl()+"#endif".endl()+"return vec4(".endl()+"mix(colNew,base.rgb,1.0-(amount*col.a)),".endl()+"newA);".endl()+"#endif".endl()+"}".endl();return t};b.onChangeBlendSelect=function(e,t,i=false){t=String(t);e.toggleDefine("BM_NORMAL",t=="normal");e.toggleDefine("BM_MULTIPLY",t=="multiply");e.toggleDefine("BM_MULTIPLY_INV",t=="multiply invert");e.toggleDefine("BM_AVERAGE",t=="average");e.toggleDefine("BM_ADD",t=="add");e.toggleDefine("BM_SUBTRACT_ONE",t=="subtract one");e.toggleDefine("BM_SUBTRACT",t=="subtract");e.toggleDefine("BM_DIFFERENCE",t=="difference");e.toggleDefine("BM_NEGATION",t=="negation");e.toggleDefine("BM_EXCLUSION",t=="exclusion");e.toggleDefine("BM_LIGHTEN",t=="lighten");e.toggleDefine("BM_DARKEN",t=="darken");e.toggleDefine("BM_OVERLAY",t=="overlay");e.toggleDefine("BM_SCREEN",t=="screen");e.toggleDefine("BM_SOFTLIGHT",t=="softlight");e.toggleDefine("BM_HARDLIGHT",t=="hardlight");e.toggleDefine("BM_COLORDODGE",t=="color dodge");e.toggleDefine("BM_COLORBURN",t=="color burn");e.toggleDefine("BM_MATH_ADD",t=="Math Add");e.toggleDefine("BM_MATH_SUB",t=="Math Subtract");e.toggleDefine("BM_MATH_MUL",t=="Math Multiply");e.toggleDefine("BM_MATH_DIV",t=="Math Divide");e.toggleDefine("BM_MATH",t.indexOf("Math ")==0);e.toggleDefine("BM_ALPHAMASKED",i)};b.AddBlendSelect=function(e,t,i){const r=e.inValueSelect(t||"Blend Mode",["normal","lighten","darken","multiply","multiply invert","average","add","subtract","difference","negation","exclusion","overlay","screen","color dodge","color burn","softlight","hardlight","subtract one","Math Add","Math Subtract","Math Multiply","Math Divide"],i||"normal");return r};b.AddBlendAlphaMask=function(e,t,i){const r=e.inSwitch(t||"Alpha Mask",["Off","On"],i||"Off");return r};b.setupBlending=function(i,r,n,e,s){const t=()=>{let e=false;if(s)e=s.get()=="On";b.onChangeBlendSelect(r,n.get(),e);let t=n.get();if(t=="normal")t=null;else if(t=="multiply")t="mul";else if(t=="multiply invert")t="mulinv";else if(t=="lighten")t="light";else if(t=="darken")t="darken";else if(t=="average")t="avg";else if(t=="subtract one")t="sub one";else if(t=="subtract")t="sub";else if(t=="difference")t="diff";else if(t=="negation")t="neg";else if(t=="exclusion")t="exc";else if(t=="overlay")t="ovl";else if(t=="color dodge")t="dodge";else if(t=="color burn")t="burn";else if(t=="softlight")t="soft";else if(t=="hardlight")t="hard";else if(t=="Math Add")t="+";else if(t=="Math Subtract")t="-";else if(t=="Math Multiply")t="*";else if(t=="Math Divide")t="/";i.setUiAttrib({extendTitle:t})};i.setPortGroup("Blending",[n,e,s]);let a=false;n.onChange=t;if(s){s.onChange=t;a=s.get()=="On"}b.onChangeBlendSelect(r,n.get(),a)};const ga={"CGL.BLENDMODES":function(){this.name="blendmodes";this.srcHeadFrag=b.getBlendCode()},"CGL.BLENDMODES3":function(){this.name="blendmodes3";this.srcHeadFrag=b.getBlendCode(3)},"CGL.LUMINANCE":function(){this.name="luminance";this.srcHeadFrag="".endl()+"float cgl_luminance(vec3 c)".endl()+"{".endl()+"    return dot(vec3(0.2126,0.7152,0.0722),c);".endl()+"}".endl()},"CGL.RANDOM_OLD":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 432758.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_LOW":function(){this.name="randomNumber";this.srcHeadFrag="".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return fract(sin(dot(co.xy ,vec2(12.9898,4.1414))) * 358.5453);".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return vec3( cgl_random(co),cgl_random(co+0.5711),cgl_random(co+1.5711));".endl()+"}"},"CGL.RANDOM_TEX":function(){this.name="randomNumbertex";this.srcHeadFrag="".endl()+"UNI sampler2D CGLRNDTEX;".endl()+"float cgl_random(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).r;".endl()+"}".endl()+"vec3 cgl_random3(vec2 co)".endl()+"{".endl()+"    return texture(CGLRNDTEX,co*5711.0).rgb;".endl()+"}";this.initUniforms=function(e){return[new m(e,"t","CGLRNDTEX",7)]};this.onBind=function(e,t){x.getRandomTexture(e);e.setTexture(7,x.getRandomTexture(e).tex)}}};const da="{{MODULES_HEAD}}\nIN vec3 vPosition; //!@\nIN vec2 attrTexCoord;\nIN vec3 attrVertNormal;\nIN vec3 attrTangent,attrBiTangent;\n\nIN float attrVertIndex;\n\nOUT vec2 texCoord;\nOUT vec3 norm;\nUNI mat4 projMatrix;\nUNI mat4 viewMatrix;\nUNI mat4 modelMatrix;\n\nvoid main()\n{\n    texCoord=attrTexCoord;\n    norm=attrVertNormal;\n    vec4 pos=vec4(vPosition,  1.0);\n    vec3 tangent=attrTangent;\n    vec3 bitangent=attrBiTangent;\n    mat4 mMatrix=modelMatrix;\n    gl_PointSize=10.0;\n\n    {{MODULE_VERTEX_POSITION}}\n\n    mat4 modelViewMatrix=viewMatrix*mMatrix;\n    {{MODULE_VERTEX_MODELVIEW}}\n\n    gl_Position = projMatrix * modelViewMatrix * pos;\n}\n";let ma=0;function S(){return da}function M(e,t,i){if(e==undefined){e=.5;t=.5;i=.5}return""+O+"IN vec2 texCoord;"+O+"{{MODULES_HEAD}}"+O+"void main()"+O+"{"+O+"    vec4 col=vec4("+e+","+t+","+i+",1.0);"+O+"    {{MODULE_COLOR}}"+O+"    outColor = col;"+O+"}"}class v extends ra{_uniforms=[];constructor(e,t,i){super();if(!e)throw new Error("shader constructed without cgl "+t);this._log=new h.Logger("cgl_shader");this._cgl=e;if(!t)this._log.stack("no shader name given");this._name=t||"unknown";if(i)this.opId=i.id;this.glslVersion=0;if(e.glVersion>1)this.glslVersion=300;this._materialId=++ma;this._program=null;this._drawBuffers=[true];this.error=null;this.ignoreMissingUniforms=false;this._projMatrixUniform=null;this._mvMatrixUniform=null;this._mMatrixUniform=null;this._vMatrixUniform=null;this._camPosUniform=null;this._normalMatrixUniform=null;this._inverseViewMatrixUniform=null;this._fromUserInteraction=false;this._attrVertexPos=-1;this.precision=e.patch.config.glslPrecision||"highp";this._pMatrixState=-1;this._vMatrixState=-1;this._countMissingUniforms=0;this._modGroupCount=0;this._feedBackNames=[];this._attributes=[];this.glPrimitive=null;this.offScreenPass=false;this._extensions=[];this.srcVert=S();this.srcFrag=M();this.lastCompile=0;this._libs=[];this._structNames=[];this._structUniformNames=[];this._textureStackUni=[];this._textureStackTex=[];this._textureStackType=[];this._textureStackTexCgl=[];this._tempNormalMatrix=r();this._tempCamPosMatrix=r();this._tempInverseViewMatrix=r();this._tempInverseProjMatrix=r();this.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_NORMAL","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"])}isValid(){return this._isValid}getCgl(){return this._cgl}getName(){return this._name}enableExtension(e){this.setWhyCompile("enable extension "+e);this._extensions.push(e)}getAttrVertexPos(){return this._attrVertexPos}hasTextureUniforms(){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getType()=="t")return true;return false}copyUniformValues(t){for(let e=0;e<t._uniforms.length;e++){if(!this._uniforms[e]){this._log.log("unknown uniform?!");continue}this.getUniform(t._uniforms[e].getName()).set(t._uniforms[e].getValue())}this.popTextures();for(let e=0;e<t._textureStackUni.length;e++){this._textureStackUni[e]=t._textureStackUni[e];this._textureStackTex[e]=t._textureStackTex[e];this._textureStackType[e]=t._textureStackType[e];this._textureStackTexCgl[e]=t._textureStackTexCgl[e]}}copy(){const t=new v(this._cgl,this._name+" copy");t.setSource(this.srcVert,this.srcFrag);t._modules=JSON.parse(JSON.stringify(this._modules));t._defines=JSON.parse(JSON.stringify(this._defines));t._modGroupCount=this._modGroupCount;t._moduleNames=this._moduleNames;t.glPrimitive=this.glPrimitive;t.offScreenPass=this.offScreenPass;t._extensions=this._extensions;t.wireframe=this.wireframe;t._attributes=this._attributes;for(let e=0;e<this._uniforms.length;e++){const i=this._uniforms[e].copy(t);i.resetLoc()}t.setWhyCompile("copy");return t}setSource(e,t,i=false){this._fromUserInteraction=i;this.srcVert=e;this.srcFrag=t;this.setWhyCompile("Source changed");this._isValid=true}_addLibs(e){for(const t in ga){if(e.includes(t)){const i=new ga[t];e=e.replace("{{"+t+"}}",i.srcHeadFrag);this._libs.push(i);if(i.initUniforms)i.initUniforms(this)}}return e}createStructUniforms(){let r="";let n="";this._structNames=[];this._injectedStringsFrag={};this._injectedStringsVert={};this._structUniformNamesIndicesFrag=[];this._structUniformNamesIndicesVert=[];for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].isStructMember()){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[i]._structName+"}}";if(!this._structNames.includes(this._uniforms[i]._structName)){const a="struct "+this._uniforms[i]._structName+" {"+O+s+"};"+O+O;if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="frag")r=r.concat(a);if(this._uniforms[i].getShaderType()==="both"||this._uniforms[i].getShaderType()==="vert")n=n.concat(a);this._structNames.push(this._uniforms[i]._structName);this._injectedStringsFrag[this._uniforms[i]._structName]=[];this._injectedStringsVert[this._uniforms[i]._structName]=[]}let e="";if(this._uniforms[i].comment)e=" // "+this._uniforms[i].comment;let t="";if(this._uniforms[i].getGlslTypeString()==undefined)t+="//";t+="  "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i]._propertyName+";"+e;if(this._uniforms[i].getShaderType()==="both"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)&&!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const o=r.lastIndexOf(s);const l=n.lastIndexOf(s);r=r.slice(0,o)+t+r.slice(o-1);n=n.slice(0,l)+t+n.slice(l-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i);if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}else if(this._uniforms[i].getShaderType()==="frag"){if(!this._injectedStringsFrag[this._uniforms[i]._structName].includes(t)){const o=r.lastIndexOf(s);r=r.slice(0,o)+t+r.slice(o-1);this._injectedStringsFrag[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesFrag.includes(i))this._structUniformNamesIndicesFrag.push(i)}else if(this._uniforms[i].getShaderType()==="vert"){if(!this._injectedStringsVert[this._uniforms[i]._structName].includes(t)){const l=n.lastIndexOf(s);n=n.slice(0,l)+t+n.slice(l-1);this._injectedStringsVert[this._uniforms[i]._structName].push(t)}if(!this._structUniformNamesIndicesVert.includes(i))this._structUniformNamesIndicesVert.push(i)}}}this._uniDeclarationsFrag=[];this._uniDeclarationsVert=[];for(let e=0;e<this._structUniformNamesIndicesFrag.length;e+=1){const t=this._structUniformNamesIndicesFrag[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+O;if(!this._uniDeclarationsFrag.includes(i)){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";r=r.replace(s,"");r+=i;this._uniDeclarationsFrag.push(i)}}for(let e=0;e<this._structUniformNamesIndicesVert.length;e+=1){const t=this._structUniformNamesIndicesVert[e];const i="UNI "+this._uniforms[t]._structName+" "+this._uniforms[t]._structUniformName+";"+O;if(!this._uniDeclarationsVert.includes(i)){const s="{{INJECTION_POINT_STRUCT_"+this._uniforms[t]._structName+"}}";n=n.replace(s,"");n+=i;this._uniDeclarationsVert.push(i)}}return[n,r]}_getAttrSrc(e,t){const i={};if(e.name&&e.type){i.srcHeadVert="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.name+O;i.srcHeadVert+="#define ATTRIB_"+e.name+O;i.srcHeadVert+="IN "+e.type+" "+e.name+";"+O;if(!t)i.srcHeadVert+="#endif"+O;if(e.nameFrag){i.srcHeadVert+="";if(!t)i.srcHeadVert+="#ifndef ATTRIB_"+e.nameFrag+O;i.srcHeadVert+="#define ATTRIB_"+e.nameFrag+O;i.srcHeadVert+="OUT "+e.type+" "+e.nameFrag+";"+O;if(!t)i.srcHeadVert+="#endif"+O;i.srcVert=""+O+e.nameFrag+"="+e.name+";";i.srcHeadFrag="";if(!t)i.srcHeadFrag+="#ifndef ATTRIB_"+e.nameFrag+O;i.srcHeadFrag+="#define ATTRIB_"+e.nameFrag+O;i.srcHeadFrag+="IN "+e.type+" "+e.nameFrag+";"+O;if(!t)i.srcHeadFrag+="#endif"+O}}return i}compile(){if(this._cgl.aborted)return;const e=performance.now();this._cgl.profileData.profileShaderCompiles++;this._cgl.profileData.profileShaderCompileName=this._name+" ["+this._compileReason+"]";let t="";if(this._extensions)for(let e=0;e<this._extensions.length;e++)t+="#extension "+this._extensions[e]+" : enable"+O;let i="";if(this._defines.length)i="\n// cgl generated"+O;for(let e=0;e<this._defines.length;e++)i+="#define "+this._defines[e][0]+" "+this._defines[e][1]+""+O;const r=this.createStructUniforms();this._cgl.profileData.addHeavyEvent("shader compile",this._name+" ["+this._compileReason+"]");this._compileReason="";if(this._uniforms){const p=this._uniforms.map(e=>{return e._name});const _=[];for(let e=0;e<this._uniforms.length;e++){const b=this._uniforms[e];const v=p.indexOf(b._name,e+1);if(v>-1)_.push(e)}for(let e=this._uniforms.length-1;e>=0;e-=1){if(_.includes(e))this._uniforms.splice(e,1);else this._uniforms[e].resetLoc()}}this._cgl.printError("uniform resets");this._compileCount++;if(this.hasTextureUniforms())i+="#define HAS_TEXTURES"+O;let n="";let s="";if(!this.srcFrag){this._log.warn("[cgl shader] has no fragment source!",this._name,this);this.srcVert=S();this.srcFrag=M()}n="#version 300 es"+O+"// "+O+"// vertex shader "+this._name+O+"// "+O+"precision "+this.precision+" float;"+O+"precision "+this.precision+" sampler2D;"+O+""+O+"#define WEBGL2"+O+"#define texture2D texture"+O+"#define UNI uniform"+O+"#define IN in"+O+"#define OUT out"+O;s="#version 300 es"+O+"// "+O+"// fragment shader "+this._name+O+"// "+O+"precision "+this.precision+" float;"+O+"precision "+this.precision+" sampler2D;"+O+""+O+"#define WEBGL2"+O+"#define texture2D texture"+O+"#define IN in"+O+"#define OUT out"+O+"#define UNI uniform"+O+"{{DRAWBUFFER}}"+O;let a="\n// cgl generated"+O;let o="\n// cgl generated"+O;s+="\n// active mods: --------------- ";n+="\n// active mods: --------------- ";let l=false;let u=false;for(let t=0;t<this._moduleNames.length;t++){for(let e=0;e<this._modules.length;e++){if(this._modules[e].name==this._moduleNames[t]){if(this._modules[e].srcBodyFrag||this._modules[e].srcHeadFrag){l=true;s+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")"}if(this._modules[e].srcBodyVert||this._modules[e].srcHeadVert){n+="\n// "+t+"."+e+". "+this._modules[e].title+" ("+this._modules[e].name+")";u=true}}}}if(!u)s+="\n// no mods used...";if(!l)s+="\n// no mods used...";s+="\n";n+="\n";for(let i=0;i<this._uniforms.length;i++){if(this._uniforms[i].shaderType&&!this._uniforms[i].isStructMember()){let e="";if(!this._uniforms[i].getGlslTypeString())e+="// ";e+="UNI "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName();let t="";if(this._uniforms[i].comment)t=" // "+this._uniforms[i].comment;if(this._uniforms[i].shaderType=="vert"||this._uniforms[i].shaderType=="both")if(!this.srcVert.includes(e)&&!this.srcVert.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))a+=e+";"+t+O;if(this._uniforms[i].shaderType=="frag"||this._uniforms[i].shaderType=="both")if(!this.srcFrag.includes(e)&&!this.srcFrag.includes("uniform "+this._uniforms[i].getGlslTypeString()+" "+this._uniforms[i].getName()))o+=e+";"+t+O}}let h=0;let c=0;for(let e=0;e<this._uniforms.length;e++){if(this._uniforms[e].shaderType&&!this._uniforms[e].isStructMember()){if(this._uniforms[e].shaderType=="vert"||this._uniforms[e].shaderType=="both")c++;if(this._uniforms[e].shaderType=="frag"||this._uniforms[e].shaderType=="both")h++}}if(h>=this._cgl.maxUniformsFrag)this._log.warn("[cgl_shader] num uniforms frag: "+h+" / "+this._cgl.maxUniformsFrag);if(c>=this._cgl.maxUniformsVert)this._log.warn("[cgl_shader] num uniforms vert: "+c+" / "+this._cgl.maxUniformsVert);if(!s.includes("precision"))s="precision "+this.precision+" float;"+O+s;if(!n.includes("precision"))n="precision "+this.precision+" float;"+O+n;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){s+="#define MOBILE"+O;n+="#define MOBILE"+O}n=t+n+i+r[0]+a+"\n// -- \n"+this.srcVert;s=t+s+i+r[1]+o+"\n// -- \n"+this.srcFrag;let f="";let g="";this._modules.sort(function(e,t){return e.priority||0-t.priority||0});let d=false;for(let r=0;r<this._moduleNames.length;r++){let t="";let i="";if(!d){d=true;for(let e=0;e<this._attributes.length;e++){const x=this._getAttrSrc(this._attributes[e],true);if(x.srcHeadVert)f+=x.srcHeadVert;if(x.srcVert)t+=x.srcVert;if(x.srcHeadFrag)g+=x.srcHeadFrag}}for(let e=0;e<this._modules.length;e++){const E=this._modules[e];if(E.name==this._moduleNames[r]){f+="\n//---- MOD: group:"+E.group+": idx:"+e+" - prfx:"+E.prefix+" - "+E.title+" ------\n";g+="\n//---- MOD: group:"+E.group+": idx:"+e+" - prfx:"+E.prefix+" - "+E.title+" ------\n";t+="\n\n//---- MOD: "+E.title+" / "+E.priority+" ------\n";i+="\n\n//---- MOD: "+E.title+" / "+E.priority+" ------\n";if(E.attributes)for(let e=0;e<E.attributes.length;e++){const x=this._getAttrSrc(E.attributes[e],false);if(x.srcHeadVert)f+=x.srcHeadVert;if(x.srcVert)t+=x.srcVert;if(x.srcHeadFrag)g+=x.srcHeadFrag}f+=E.srcHeadVert||"";g+=E.srcHeadFrag||"";t+=E.srcBodyVert||"";i+=E.srcBodyFrag||"";f+="\n//---- end mod ------\n";g+="\n//---- end mod ------\n";t+="\n//---- end mod ------\n";i+="\n//---- end mod ------\n";t=t.replace(/{{mod}}/g,E.prefix);i=i.replace(/{{mod}}/g,E.prefix);f=f.replace(/{{mod}}/g,E.prefix);g=g.replace(/{{mod}}/g,E.prefix);t=t.replace(/MOD_/g,E.prefix);i=i.replace(/MOD_/g,E.prefix);f=f.replace(/MOD_/g,E.prefix);g=g.replace(/MOD_/g,E.prefix)}}n=n.replace("{{"+this._moduleNames[r]+"}}",t);s=s.replace("{{"+this._moduleNames[r]+"}}",i)}n=n.replace("{{MODULES_HEAD}}",f);s=s.replace("{{MODULES_HEAD}}",g);n=this._addLibs(n);s=this._addLibs(s);let m="";for(let e=0;e<16;e++)if(s.includes("outColor"+e))this._drawBuffers[e]=true;if(this._drawBuffers.length==1){m="out vec4 outColor;"+O;m+="#define gl_FragColor outColor"+O}else{m+="#define MULTI_COLORTARGETS"+O;m+="vec4 outColor;"+O;let t=0;for(let e=0;e<this._drawBuffers.length;e++){if(t==0)m+="#define gl_FragColor outColor"+e+""+O;m+="layout(location = "+e+") out vec4 outColor"+e+";"+O;t++}}s=s.replace("{{DRAWBUFFER}}",m);if(!this._program){this._program=this._createProgram(n,s)}else{this._program=this._createProgram(n,s);this._projMatrixUniform=null;for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].resetLoc()}this.finalShaderFrag=s;this.finalShaderVert=n;I.lastMesh=null;I.lastShader=null;this._countMissingUniforms=0;this._needsRecompile=false;this.lastCompile=(0,A.now)();this._cgl.profileData.shaderCompileTime+=performance.now()-e}bind(){if(!this._isValid||this._cgl.aborted)return;I.lastShader=this;if(!this._program||this.needsRecompile())this.compile();if(!this._isValid)return;if(!this._projMatrixUniform&&!this.ignoreMissingUniforms){this._countMissingUniforms++;if(this._countMissingUniforms<10){this._projMatrixUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_PROJMAT);this._attrVertexPos=this._cgl.glGetAttribLocation(this._program,d.SHADER.SHADERVAR_VERTEX_POSITION);this._mvMatrixUniform=this._cgl.gl.getUniformLocation(this._program,"mvMatrix");this._vMatrixUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_VIEWMAT);this._mMatrixUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_MODELMAT);this._camPosUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_VIEWPOS);this._normalMatrixUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_NORMALMAT);this._inverseViewMatrixUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_INVVIEWMAT);this._inverseProjMatrixUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_INVPROJMAT);this._materialIdUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_MATERIALID);this._objectIdUniform=this._cgl.gl.getUniformLocation(this._program,d.SHADER.SHADERVAR_UNI_OBJECTID);for(let e=0;e<this._uniforms.length;e++)this._uniforms[e].needsUpdate=true}}if(this._cgl.currentProgram!=this._program){this._cgl.profileData.profileShaderBinds++;this._cgl.gl.useProgram(this._program);this._cgl.currentProgram=this._program}for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].needsUpdate)this._uniforms[e].updateValue();if(this._pMatrixState!=this._cgl.getProjectionMatrixStateCount()){this._pMatrixState=this._cgl.getProjectionMatrixStateCount();this._cgl.gl.uniformMatrix4fv(this._projMatrixUniform,false,this._cgl.pMatrix);this._cgl.profileData.profileMVPMatrixCount++}if(this._objectIdUniform)this._cgl.gl.uniform1f(this._objectIdUniform,++this._cgl.tempData.objectIdCounter);if(this._materialIdUniform)this._cgl.gl.uniform1f(this._materialIdUniform,this._materialId);if(this._vMatrixUniform){if(this._vMatrixState!=this._cgl.getViewMatrixStateCount()){this._cgl.gl.uniformMatrix4fv(this._vMatrixUniform,false,this._cgl.vMatrix);this._cgl.profileData.profileMVPMatrixCount++;this._vMatrixState=this._cgl.getViewMatrixStateCount();if(this._inverseViewMatrixUniform){t(this._tempInverseViewMatrix,this._cgl.vMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseViewMatrixUniform,false,this._tempInverseViewMatrix);this._cgl.profileData.profileMVPMatrixCount++}if(this._inverseProjMatrixUniform){t(this._tempInverseProjMatrix,this._cgl.pMatrix);this._cgl.gl.uniformMatrix4fv(this._inverseProjMatrixUniform,false,this._tempInverseProjMatrix);this._cgl.profileData.profileMVPMatrixCount++}}this._cgl.gl.uniformMatrix4fv(this._mMatrixUniform,false,this._cgl.mMatrix);this._cgl.profileData.profileMVPMatrixCount++;if(this._camPosUniform){t(this._tempCamPosMatrix,this._cgl.vMatrix);this._cgl.gl.uniform3f(this._camPosUniform,this._tempCamPosMatrix[12],this._tempCamPosMatrix[13],this._tempCamPosMatrix[14]);this._cgl.profileData.profileMVPMatrixCount++}}else{const e=r();fi(e,this._cgl.vMatrix,this._cgl.mMatrix);this._cgl.gl.uniformMatrix4fv(this._mvMatrixUniform,false,e);this._cgl.profileData.profileMVPMatrixCount++}if(this._normalMatrixUniform){t(this._tempNormalMatrix,this._cgl.mMatrix);Rt(this._tempNormalMatrix,this._tempNormalMatrix);this._cgl.gl.uniformMatrix4fv(this._normalMatrixUniform,false,this._tempNormalMatrix);this._cgl.profileData.profileMVPMatrixCount++}for(let e=0;e<this._libs.length;e++){if(this._libs[e].onBind)this._libs[e].onBind.bind(this._libs[e])(this._cgl,this)}this._bindTextures();return this._isValid}unBind(){}dispose(){if(this._program&&this._cgl&&this._cgl.gl)this._cgl.gl.deleteProgram(this._program);this._program=null}setDrawBuffers(e){this._log.warn("useless drawbuffers...?!")}getUniforms(){return this._uniforms}getUniform(t){for(let e=0;e<this._uniforms.length;e++)if(this._uniforms[e].getName()==t)return this._uniforms[e];return null}removeAllUniforms(){this._uniforms=[]}_addUniform(e){this._uniforms.push(e);this.setWhyCompile("add uniform "+name)}addUniformFrag(e,t,i,r,n,s){const a=new m(this,e,t,i,r,n,s);a.shaderType="frag";return a}addUniformVert(e,t,i,r,n,s){const a=new m(this,e,t,i,r,n,s);a.shaderType="vert";return a}addUniformBoth(e,t,i,r,n,s){const a=new m(this,e,t,i,r,n,s);a.shaderType="both";return a}addUniformStructFrag(t,i,r){const n={};if(!r)return n;for(let e=0;e<r.length;e+=1){const s=r[e];if(!this.hasUniform(i+"."+s.name)){const a=new m(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="frag";n[i+"."+s.name]=a}}return n}addUniformStructVert(t,i,r){const n={};if(!r)return n;for(let e=0;e<r.length;e+=1){const s=r[e];if(!this.hasUniform(i+"."+s.name)){const a=new m(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="vert";n[i+"."+s.name]=a}}return n}addUniformStructBoth(t,i,r){const n={};if(!r)return n;for(let e=0;e<r.length;e+=1){const s=r[e];if(s.type==="2i"||s.type==="i"||s.type==="3i")this._log.error("Adding an integer struct member to both shaders can potentially error. Please use different structs for each shader. Error occured in struct:",t," with member:",s.name," of type:",s.type,".");if(!this.hasUniform(i+"."+s.name)){const a=new m(this,s.type,i+"."+s.name,s.v1,s.v2,s.v3,s.v4,i,t,s.name);a.shaderType="both";n[i+"."+s.name]=a}}return n}_createProgram(e,t){this._cgl.printError("before _createprogram");const i=this._cgl.gl.createProgram();this.vshader=v.createShader(this._cgl,e,this._cgl.gl.VERTEX_SHADER,this);this.fshader=v.createShader(this._cgl,t,this._cgl.gl.FRAGMENT_SHADER,this);if(this.vshader&&this.fshader){this._cgl.gl.attachShader(i,this.vshader);this._cgl.gl.attachShader(i,this.fshader);this._linkProgram(i,e,t)}else{this._isValid=false;this._cgl.printError("shader _createProgram");this._log.error("could not link shaderprogram");return null}this._cgl.printError("shader _createProgram");return i}hasErrors(){return this._hasErrors}_linkProgram(e,t,i){this._cgl.printError("before _linkprogram");if(this._feedBackNames.length>0){this._cgl.gl.transformFeedbackVaryings(e,this._feedBackNames,this._cgl.gl.SEPARATE_ATTRIBS)}this._cgl.gl.linkProgram(e);this._cgl.printError("gl.linkprogram");this._isValid=true;this._hasErrors=false;if(this._cgl.patch.config.glValidateShader!==false){this._cgl.gl.validateProgram(e);if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.VALIDATE_STATUS)){this._log.log("shaderprogram validation failed...");this._cgl.gl.getProgramInfoLog(e)}if(!this._cgl.gl.getProgramParameter(e,this._cgl.gl.LINK_STATUS)){this._hasErrors=true;const r=this._cgl.gl.getShaderInfoLog(this.fshader);const n=this._cgl.gl.getShaderInfoLog(this.vshader);if(this.logError)this._log.error(this._name+" shader linking fail...");else this._log.warn(this._name+" shader linking fail...");if(r)this._log.warn(this._cgl.gl.getShaderInfoLog(this.fshader));if(n)this._log.warn(this._cgl.gl.getShaderInfoLog(this.vshader));this._cgl.gl.getProgramInfoLog(e);if(!CABLES.UI)this._log.log(this);this._isValid=false;this._cgl.printError("shader link err")}}}getProgram(){return this._program}setFeedbackNames(e){this.setWhyCompile("setFeedbackNames");this._feedBackNames=e}addAttribute(t){for(let e=0;e<this._attributes.length;e++){if(this._attributes[e].name==t.name&&this._attributes[e].nameFrag==t.nameFrag)return}this._attributes.push(t);this.setWhyCompile("addAttribute")}bindTextures(){this._bindTextures()}_bindTextures(){if(this._textureStackTex.length>this._cgl.maxTextureUnits){this._log.warn("[shader._bindTextures] too many textures bound",this._textureStackTex.length+"/"+this._cgl.maxTextureUnits)}for(let i=0;i<this._textureStackTex.length;i++){if(!this._textureStackTex[i]&&!this._textureStackTexCgl[i]){this._log.warn("no texture for pushtexture",this._name)}else{let e=this._textureStackTex[i];if(this._textureStackTexCgl[i]){e=this._textureStackTexCgl[i].tex||CGL.Texture.getEmptyTexture(this._cgl).tex}let t=true;if(!this._textureStackUni[i]){this._log.warn("no uniform for pushtexture",this._name);t=this._cgl.setTexture(i,e,this._textureStackType[i])}else{this._textureStackUni[i].setValue(i);t=this._cgl.setTexture(i,e,this._textureStackType[i])}if(!t)this._log.warn("tex bind failed",this.getName(),this._textureStackUni[i])}}}setUniformTexture(t,i){i=i||x.getTempTexture(this._cgl);for(let e=0;e<this._textureStackUni.length;e++)if(this._textureStackUni[e]==t){const r=this._textureStackTex[e]||this._textureStackTexCgl[e];if(i.hasOwnProperty("tex")){this._textureStackTexCgl[e]=i;this._textureStackTex[e]=null}else{this._textureStackTexCgl[e]=null;this._textureStackTex[e]=i}return r}return null}pushTexture(e,t,i){if(!e){return}if(!t){return}if(!t.hasOwnProperty("tex")&&!(t instanceof WebGLTexture)){this._log.warn(new Error("invalid texture").stack);this._log.warn("[cgl_shader] invalid texture...",t);return}this._textureStackUni.push(e);if(t.hasOwnProperty("tex")){this._textureStackTexCgl.push(t);this._textureStackTex.push(null)}else{this._textureStackTexCgl.push(null);this._textureStackTex.push(t)}this._textureStackType.push(i)}popTexture(){this._textureStackUni.pop();this._textureStackTex.pop();this._textureStackTexCgl.pop();this._textureStackType.pop()}popTextures(){this._textureStackTex.length=this._textureStackTexCgl.length=this._textureStackType.length=this._textureStackUni.length=0}getMaterialId(){return this._materialId}getInfo(){const e={};e.name=this._name;e.defines=this.getDefines();e.hasErrors=this.hasErrors();return e}getDefaultFragmentShader(e,t,i,r){return M(e,t,i,r)}getDefaultVertexShader(){return S()}}v.getDefaultVertexShader=S;v.getDefaultFragmentShader=M;v.getErrorFragmentShader=function(){return""+O+"void main()"+O+"{"+O+"   float g=mod((gl_FragCoord.y+gl_FragCoord.x),50.0)/50.0;"+O+"   g= step(0.1,g);"+O+"   outColor = vec4( g+0.5, 0.0, 0.0, 1.0);"+O+"}"};v.createShader=function(e,t,i,r){if(e.aborted)return;const n=e.gl.createShader(i);e.gl.shaderSource(n,t);e.gl.compileShader(n);if(!e.gl.getShaderParameter(n,e.gl.COMPILE_STATUS)){r.error={str:t,infoLog:e.gl.getShaderInfoLog(n)};if(CABLES.UI)gui.emitEvent("ShaderError",r);if(!r.error.infoLog){r._log.warn("empty shader info log",this._name);return}r.setSource(v.getDefaultVertexShader(),v.getErrorFragmentShader())}return n};class pa extends A.RenderLoop{#patch;#cgl;#renderOneFrame;#animReq;frameNum=0;onOneFrameRendered=null;_frameNext=0;_frameInterval=0;_lastFrameTime=0;reqAnimTimeStamp=0;_frameWasdelayed=true;aborted=false;constructor(e,t){super();this.#cgl=e;this.#patch=t;this.#patch.renderloop=this;this.exec(0)}exec(e){cancelAnimationFrame(this.#animReq);this.#patch.config.fpsLimit=this.#patch.config.fpsLimit||0;if(this.#patch.config.fpsLimit){this._frameInterval=1e3/this.#patch.config.fpsLimit}const t=CABLES.now();const i=t-this._frameNext;if(this.#patch.isEditorMode()){if(!this.#renderOneFrame){if(t-this._lastFrameTime>=500&&this._lastFrameTime!==0&&!this._frameWasdelayed){this._lastFrameTime=0;setTimeout(this.exec.bind(this),500);this.emitEvent("renderDelayStart");this._frameWasdelayed=true;return}}}if(this.#renderOneFrame||this.#patch.config.fpsLimit===0||i>this._frameInterval||this._frameWasdelayed){this.renderFrame(e);if(this._frameInterval)this._frameNext=t-i%this._frameInterval}if(this._frameWasdelayed){this.emitEvent("renderDelayEnd");this._frameWasdelayed=false}if(this.#renderOneFrame){if(this.onOneFrameRendered)this.onOneFrameRendered();this.emitEvent(A.Patch.EVENT_RENDERED_ONE_FRAME);this._renderOneFrame=false}if(this.#patch.config.doRequestAnimation){this.#animReq=this.#patch.getDocument().defaultView.requestAnimationFrame(this.exec.bind(this))}}renderFrame(e){const t=this.#patch.timer.getTime();const i=performance.now();this.#cgl.frameStartTime=this.#patch.timer.getTime();const r=e-this.reqAnimTimeStamp||e;this.#patch.updateAnims(null,r,e);this.#cgl.profileData.profileFrameDelta=r;this.reqAnimTimeStamp=e;this.#cgl.profileData.profileOnAnimFrameOps=performance.now()-i;this.#patch.emitEvent(A.Patch.EVENT_RENDER_FRAME,t);this.frameNum++;if(this.frameNum==1){if(this.#patch.config.onFirstFrameRendered)this.#patch.config.onFirstFrameRendered()}}pause(){cancelAnimationFrame(this.#animReq);this.#animReq=null;this.paused=true}resume(){cancelAnimationFrame(this.#animReq);this.paused=false;this.exec(0)}}const _a={BLEND_NONE:0,BLEND_NORMAL:1,BLEND_ADD:2,BLEND_SUB:3,BLEND_MUL:4};class ba extends ia{#cursor="auto";frameStartTime=0;constructor(e){super(e);this.gApi=ia.API_WEBGL;this.aborted=false;e.cgl=this;this.pushMvMatrix=this.pushModelMatrix;this.popMvMatrix=this.popmMatrix=this.popModelMatrix;this._log=new h.Logger("cgl_context",{onError:e.config.onError});this.glVersion=0;this.glUseHalfFloatTex=false;this.clearCanvasTransparent=true;this.clearCanvasDepth=true;this.debugOneFrame=false;this.checkGlErrors=false;this.maxTextureUnits=0;this.maxVaryingVectors=0;this.currentProgram=null;this._hadStackError=false;this.glSlowRendere=false;this._isSafariCrap=false;this.temporaryTexture=null;this.gl=null;this.#cursor="auto";this._currentCursor="";this._viewPortStack=[];this._glFrameBufferStack=[];this._frameBufferStack=[];this._shaderStack=[];this._stackDepthTest=[];this.mainloopOp=null;this._stackBlendMode=[];this._stackBlendModePremul=[];this._stackBlend=[];this._stackDepthFunc=[];this._stackCullFaceFacing=[];this._stackCullFace=[];this._stackDepthWrite=[];this._stackDepthTest=[];this._stackStencil=[];this._simpleShader=new v(this,"simpleshader");this._simpleShader.setModules(["MODULE_VERTEX_POSITION","MODULE_COLOR","MODULE_BEGIN_FRAG","MODULE_VERTEX_MODELVIEW"]);this._simpleShader.setSource(v.getDefaultVertexShader(),v.getDefaultFragmentShader());this._currentShader=this._simpleShader;this._oldCanvasWidth=-1;this._oldCanvasHeight=-1;this._enabledExtensions={};this.errorShader=null;this.setCanvas(e.config.glCanvasId||e.config.glCanvas||"glcanvas");if(e.config.glCanvasResizeToWindow===true)this.setAutoResize("window");if(e.config.glCanvasResizeToParent===true)this.setAutoResize("parent");if(this.aborted)e.aborted=true;e.on(A.Patch.EVENT_DISPOSE,()=>{this.dispose()});e.on("patchClearStart",()=>{this.TextureEffectMesh=null});this.renderLoop=new pa(this,e)}get viewPort(){if(this._viewPortStack.length>3){const e=this._viewPortStack.length;return[this._viewPortStack[e-4],this._viewPortStack[e-3],this._viewPortStack[e-2],this._viewPortStack[e-1]]}else{return this._viewPort}}get mvMatrix(){return this.mMatrix}set mvMatrix(e){this.mMatrix=e}_setCanvas(e){if(!e)this._log.stack("_setCanvas undef");if(!this.patch.config.canvas)this.patch.config.canvas={};if(!this.patch.config.canvas.hasOwnProperty("preserveDrawingBuffer"))this.patch.config.canvas.preserveDrawingBuffer=true;if(!this.patch.config.canvas.hasOwnProperty("premultipliedAlpha"))this.patch.config.canvas.premultipliedAlpha=false;if(!this.patch.config.canvas.hasOwnProperty("alpha"))this.patch.config.canvas.alpha=false;this.patch.config.canvas.stencil=true;if(this.patch.config.hasOwnProperty("clearCanvasColor"))this.clearCanvasTransparent=this.patch.config.clearCanvasColor;if(this.patch.config.hasOwnProperty("clearCanvasDepth"))this.clearCanvasDepth=this.patch.config.clearCanvasDepth;if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){this._isSafariCrap=true;this.glUseHalfFloatTex=true}if(!this.patch.config.canvas.forceWebGl1)this.gl=e.getContext("webgl2",this.patch.config.canvas);if(!this.gl||this.gl.isContextLost()){this.aborted=true;this._log.error("NO_WEBGL","sorry, could not initialize WebGL. Please check if your Browser supports WebGL or try to restart your browser.");return}if(this.gl.getParameter(this.gl.VERSION)!="WebGL 1.0"){this.glVersion=2}else{this.gl=e.getContext("webgl",this.patch.config.canvas)||e.getContext("experimental-webgl",this.patch.config.canvas);this.glVersion=1;if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){if(!this.patch.config.canvas.hasOwnProperty("powerPreference"))this.patch.config.canvas.powerPreference="high-performance"}this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}const t=this.enableExtension("WEBGL_debug_renderer_info");if(t){this.glRenderer=this.gl.getParameter(t.UNMASKED_RENDERER_WEBGL);if(this.glRenderer==="Google SwiftShader")this.glSlowRenderer=true}this.canvas.addEventListener("webglcontextlost",e=>{if(this.aborted)return this._log.warn("[cgl_state] aborted context lost... can be ignored...");this._log.error("canvas lost...",e);this.emitEvent("webglcontextlost");this.aborted=true});this.maxAnisotropic=0;if(this.enableExtension("EXT_texture_filter_anisotropic"))this.maxAnisotropic=this.gl.getParameter(this.enableExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.maxVaryingVectors=this.gl.getParameter(this.gl.MAX_VARYING_VECTORS);this.maxTextureUnits=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS);this.maxTexSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE);this.maxUniformsFrag=this.gl.getParameter(this.gl.MAX_FRAGMENT_UNIFORM_VECTORS);this.maxUniformsVert=this.gl.getParameter(this.gl.MAX_VERTEX_UNIFORM_VECTORS);this.maxSamples=0;if(this.gl.MAX_SAMPLES)this.maxSamples=this.gl.getParameter(this.gl.MAX_SAMPLES);if(this.glVersion==1){this.enableExtension("OES_standard_derivatives");const i=this.enableExtension("ANGLE_instanced_arrays")||this.gl;if(i.vertexAttribDivisorANGLE){this.gl.vertexAttribDivisor=i.vertexAttribDivisorANGLE.bind(i);this.gl.drawElementsInstanced=i.drawElementsInstancedANGLE.bind(i)}}this.DEPTH_FUNCS=[this.gl.NEVER,this.gl.ALWAYS,this.gl.LESS,this.gl.LEQUAL,this.gl.GREATER,this.gl.GEQUAL,this.gl.EQUAL,this.gl.NOTEQUAL];this.CULL_MODES=[null,this.gl.BACK,this.gl.FRONT,this.gl.FRONT_AND_BACK]}getInfo(){return{glVersion:this.glVersion,glRenderer:this.glRenderer,glUseHalfFloatTex:this.glUseHalfFloatTex,maxVaryingVectors:this.maxVaryingVectors,maxTextureUnits:this.maxTextureUnits,maxTexSize:this.maxTexSize,maxUniformsFrag:this.maxUniformsFrag,maxUniformsVert:this.maxUniformsVert,maxSamples:this.maxSamples}}popViewPort(){this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();this._viewPortStack.pop();if(this._viewPortStack.length==0)this.setViewPort(0,0,this.canvasWidth,this.canvasHeight);else this.setViewPort(this._viewPortStack[this._viewPort.length-4],this._viewPortStack[this._viewPort.length-3],this._viewPortStack[this._viewPort.length-2],this._viewPortStack[this._viewPort.length-1])}pushViewPort(e,t,i,r){this._viewPortStack.push(e,t,i,r);this.setViewPort(e,t,i,r)}getViewPort(){return this._viewPort}resetViewPort(){this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}setViewPort(e,t,i,r){this._viewPort[0]=Math.round(e);this._viewPort[1]=Math.round(t);this._viewPort[2]=Math.round(i);this._viewPort[3]=Math.round(r);this.gl.viewport(this._viewPort[0],this._viewPort[1],this._viewPort[2],this._viewPort[3])}screenShot(t,e,i,r){if(e){this.gl.clearColor(1,1,1,1);this.gl.colorMask(false,false,false,true);this.gl.clear(this.gl.COLOR_BUFFER_BIT);this.gl.colorMask(true,true,true,true)}if(this.canvas&&this.canvas.toBlob){this.canvas.toBlob(e=>{if(t)t(e);else this._log.log("no screenshot callback...")},i,r)}}endFrame(){if(this.patch.isEditorMode())CABLES.GL_MARKER.drawMarkerLayer(this);this.setPreviousShader();if(this._vMatrixStack.length()>0)this.logStackError("view matrix stack length !=0 at end of rendering...");if(this._mMatrixStack.length()>0)this.logStackError("mvmatrix stack length !=0 at end of rendering...");if(this._pMatrixStack.length()>0)this.logStackError("pmatrix stack length !=0 at end of rendering...");if(this._glFrameBufferStack.length>0)this.logStackError("glFrameBuffer stack length !=0 at end of rendering...");if(this._stackDepthTest.length>0)this.logStackError("depthtest stack length !=0 at end of rendering...");if(this._stackDepthWrite.length>0)this.logStackError("depthwrite stack length !=0 at end of rendering...");if(this._stackDepthFunc.length>0)this.logStackError("depthfunc stack length !=0 at end of rendering...");if(this._stackBlend.length>0)this.logStackError("blend stack length !=0 at end of rendering...");if(this._stackBlendMode.length>0)this.logStackError("blendMode stack length !=0 at end of rendering...");if(this._shaderStack.length>0)this.logStackError("this._shaderStack length !=0 at end of rendering...");if(this._stackCullFace.length>0)this.logStackError("this._stackCullFace length !=0 at end of rendering...");if(this._stackCullFaceFacing.length>0)this.logStackError("this._stackCullFaceFacing length !=0 at end of rendering...");if(this._viewPortStack.length>0)this.logStackError("viewport stack length !=0 at end of rendering...");this._frameStarted=false;if(this._oldCanvasWidth!=this.canvasWidth||this._oldCanvasHeight!=this.canvasHeight){this._oldCanvasWidth=this.canvasWidth;this._oldCanvasHeight=this.canvasHeight;this.emitEvent(ia.EVENT_RESIZE)}if(this.#cursor!=this._currentCursor){this._currentCursor=this.canvas.style.cursor=this.#cursor}this.emitEvent("endframe");this.fpsCounter.endFrame()}logStackError(e){if(!this._hadStackError){this._hadStackError=true;this._log.warn("["+this.canvas.id+"]: ",e)}}getShader(){if(this._currentShader)if(!this.tempData||this.tempData.renderOffscreen===true==this._currentShader.offScreenPass===true)return this._currentShader;for(let e=this._shaderStack.length-1;e>=0;e--)if(this._shaderStack[e])if(this.tempData.renderOffscreen==this._shaderStack[e].offScreenPass)return this._shaderStack[e]}getDefaultShader(){return this._simpleShader}setShader(e){this.pushShader(e)}pushShader(t){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){t=this.tempData.forceShaderMods[e].bind(t,false)}}this._shaderStack.push(t);this._currentShader=t}popShader(){this.setPreviousShader()}setPreviousShader(){if(this.tempData.forceShaderMods){for(let e=0;e<this.tempData.forceShaderMods.length;e++){this.tempData.forceShaderMods[e].unbind(false)}}if(this._shaderStack.length===0)throw new Error("Invalid shader stack pop!");this._shaderStack.pop();this._currentShader=this._shaderStack[this._shaderStack.length-1]}pushGlFrameBuffer(e){this._glFrameBufferStack.push(e)}popGlFrameBuffer(){if(this._glFrameBufferStack.length==0)return null;this._glFrameBufferStack.pop();return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}getCurrentGlFrameBuffer(){if(this._glFrameBufferStack.length===0)return null;return this._glFrameBufferStack[this._glFrameBufferStack.length-1]}pushFrameBuffer(e){this._frameBufferStack.push(e)}popFrameBuffer(){if(this._frameBufferStack.length==0)return null;this._frameBufferStack.pop();return this._frameBufferStack[this._frameBufferStack.length-1]}getCurrentFrameBuffer(){if(this._frameBufferStack.length===0)return null;return this._frameBufferStack[this._frameBufferStack.length-1]}renderStart(e,t,i){this.fpsCounter.startFrame();this.pushDepthTest(true);this.pushDepthWrite(true);this.pushDepthFunc(e.gl.LEQUAL);this.pushCullFaceFacing(e.gl.BACK);this.pushCullFace(false);e.setViewPort(0,0,e.canvasWidth,e.canvasHeight);this._startMatrixStacks(t,i);e.pushBlendMode(d.BLEND_MODES.BLEND_NORMAL,false);for(let e=0;e<this._textureslots.length;e++)this._textureslots[e]=null;this.pushShader(this._simpleShader);this._frameStarted=true;this._execOneTimeCallbacks();for(let e=0;e<this._textureslots.length;e++){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(this.gl.TEXTURE_2D,null);this._textureslots[e]=null}this.emitEvent("beginFrame")}renderEnd(e,t=true){this._endMatrixStacks();this.popDepthTest();this.popDepthWrite();this.popDepthFunc();this.popCullFaceFacing();this.popCullFace();this.popBlend();this.popBlendMode();if(t)e.endFrame();this.emitEvent("endFrame")}getTexture(e){return this._textureslots[e]}hasFrameStarted(){return this._frameStarted}checkFrameStarted(e){if(!this._frameStarted){this._log.warn("frame not started "+e);Error.stackTraceLimit=25;A.utils.logStack();this.patch.printTriggerStack()}}setTexture(e,t,i){this.checkFrameStarted("cgl setTexture");if(t===null)t=x.getEmptyTexture(this).tex;if(this._textureslots[e]!=t){this.gl.activeTexture(this.gl.TEXTURE0+e);this.gl.bindTexture(i||this.gl.TEXTURE_2D,t);this._textureslots[e]=t}return true}fullScreen(){if(this.canvas.requestFullscreen)this.canvas.requestFullscreen();else if(this.canvas.mozRequestFullScreen)this.canvas.mozRequestFullScreen();else if(this.canvas.webkitRequestFullscreen)this.canvas.webkitRequestFullscreen();else if(this.canvas.msRequestFullscreen)this.canvas.msRequestFullscreen()}printError(t){if(!this.checkGlErrors)return;let i=false;let r=this.gl.getError();if(r!=this.gl.NO_ERROR){let e="";if(r==this.gl.OUT_OF_MEMORY)e="OUT_OF_MEMORY";if(r==this.gl.INVALID_ENUM)e="INVALID_ENUM";if(r==this.gl.INVALID_OPERATION)e="INVALID_OPERATION";if(r==this.gl.INVALID_FRAMEBUFFER_OPERATION)e="INVALID_FRAMEBUFFER_OPERATION";if(r==this.gl.INVALID_VALUE)e="INVALID_VALUE";if(r==this.gl.CONTEXT_LOST_WEBGL){this.aborted=true;e="CONTEXT_LOST_WEBGL"}if(r==this.gl.NO_ERROR)e="NO_ERROR";i=true;this._log.warn("gl error ["+this.canvas.id+"]: ",t,r,e);if(this.canvas.id.includes("glGuiCanvas"))if(!this._loggedGlError){this.patch.printTriggerStack();this._log.stack("glerror");this._loggedGlError=true}}r=this.gl.getError();return i}_dispose(){this._simpleShader.dispose();this.gl=null}pushDepthTest(e){this._stackDepthTest.push(e);if(!e)this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}stateDepthTest(){return this._stackDepthTest[this._stackDepthTest.length-1]}popDepthTest(){this._stackDepthTest.pop();if(!this._stackDepthTest[this._stackDepthTest.length-1])this.gl.disable(this.gl.DEPTH_TEST);else this.gl.enable(this.gl.DEPTH_TEST)}pushDepthWrite(e){e=e||false;this._stackDepthWrite.push(e);this.gl.depthMask(e)}stateDepthWrite(){return this._stackDepthWrite[this._stackDepthWrite.length-1]}popDepthWrite(){this._stackDepthWrite.pop();this.gl.depthMask(this._stackDepthWrite[this._stackDepthWrite.length-1]||false)}pushCullFace(e){this._stackCullFace.push(e);if(e)this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}stateCullFace(){return this._stackCullFace[this._stackCullFace.length-1]}popCullFace(){this._stackCullFace.pop();if(this._stackCullFace[this._stackCullFace.length-1])this.gl.enable(this.gl.CULL_FACE);else this.gl.disable(this.gl.CULL_FACE)}pushCullFaceFacing(e){this._stackCullFaceFacing.push(e);this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}stateCullFaceFacing(){return this._stackCullFaceFacing[this._stackCullFaceFacing.length-1]}popCullFaceFacing(){this._stackCullFaceFacing.pop();if(this._stackCullFaceFacing.length>0)this.gl.cullFace(this._stackCullFaceFacing[this._stackCullFaceFacing.length-1])}pushDepthFunc(e){this._stackDepthFunc.push(e);this.gl.depthFunc(e)}stateDepthFunc(){if(this._stackDepthFunc.length>0)return this._stackDepthFunc[this._stackDepthFunc.length-1];return false}popDepthFunc(){this._stackDepthFunc.pop();if(this._stackDepthFunc.length>0)this.gl.depthFunc(this._stackDepthFunc[this._stackDepthFunc.length-1])}pushBlend(e){this._stackBlend.push(e);if(!e)this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}popBlend(){this._stackBlend.pop();if(!this._stackBlend[this._stackBlend.length-1])this.gl.disable(this.gl.BLEND);else this.gl.enable(this.gl.BLEND)}stateBlend(){return this._stackBlend[this._stackBlend.length-1]}pushBlendMode(e,t){this._stackBlendMode.push(e);this._stackBlendModePremul.push(t);const i=this._stackBlendMode.length-1;this.pushBlend(this._stackBlendMode[i]!==d.BLEND_MODES.BLEND_NONE);this._setBlendMode(this._stackBlendMode[i],this._stackBlendModePremul[i])}popBlendMode(){this._stackBlendMode.pop();this._stackBlendModePremul.pop();const e=this._stackBlendMode.length-1;this.popBlend();if(e>=0)this._setBlendMode(this._stackBlendMode[e],this._stackBlendModePremul[e])}pushStencil(e){this._stackStencil.push(e);if(!e)this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}popStencil(){this._stackStencil.pop();if(!this._stackStencil[this._stackStencil.length-1])this.gl.disable(this.gl.STENCIL_TEST);else this.gl.enable(this.gl.STENCIL_TEST)}glGetAttribLocation(e,t){const i=this.gl.getAttribLocation(e,t);return i}shouldDrawHelpers(e){if(this.tempData.shadowPass)return false;if(!e.patch.isEditorMode())return false;return gui.shouldDrawOverlay}_setBlendMode(e,t){const i=this.gl;if(e==d.BLEND_MODES.BLEND_NONE){}else if(e==d.BLEND_MODES.BLEND_ADD){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE,i.ONE,i.ONE)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.SRC_ALPHA,i.ONE)}}else if(e==d.BLEND_MODES.BLEND_SUB){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.ONE_MINUS_SRC_COLOR)}}else if(e==d.BLEND_MODES.BLEND_MUL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA)}else{i.blendEquation(i.FUNC_ADD);i.blendFunc(i.ZERO,i.SRC_COLOR)}}else if(e==d.BLEND_MODES.BLEND_NORMAL){if(t){i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}else{i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD);i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)}}else{this._log.log("setblendmode: unknown blendmode")}}createMesh(e,t){if(A.utils.isNumeric(t))t={glPrimitive:t};return new fa(this,e,t)}setCursor(e){this.#cursor=e}enableExtension(e){if(!this.gl)return null;if(this._enabledExtensions.hasOwnProperty(e))return this._enabledExtensions[e];const t=this.gl.getExtension(e);this._enabledExtensions[e]=t;if(!t)this._log.warn("[cgl_state] extension not available "+e);return t}getErrorShader(){if(this.errorShader)return this.errorShader;this.errorShader=new v(this,"errormaterial");this.errorShader.setSource(v.getDefaultVertexShader(),v.getErrorFragmentShader());return this.errorShader}}const va=8;const xa=new h.Logger("cgl_texture");class x extends g{constructor(e,t={}){super(t);if(!e)throw new Error("no cgl");this._cgl=e;this._log=new h.Logger("tex");this.tex=this._cgl.gl.createTexture();this.loading=false;this.flip=true;this.flipped=false;this.shadowMap=false;this.deleted=false;this.image=null;this.anisotropic=0;this.filter=x.FILTER_NEAREST;this.wrap=x.WRAP_CLAMP_TO_EDGE;this.texTarget=this._cgl.gl.TEXTURE_2D;if(t&&t.type)this.texTarget=t.type;this.textureType=x.TYPE_DEFAULT;this.unpackAlpha=true;this._fromData=true;this._glDataType=-1;this._glInternalFormat=-1;this._glDataFormat=-1;if(t){if(t.isDepthTexture)this.textureType=x.TYPE_DEPTH;if(t.isFloatingPointTexture===true)this.textureType=x.TYPE_FLOAT;if("textureType"in t)this.textureType=t.textureType;if("filter"in t)this.filter=t.filter;if("wrap"in t)this.wrap=t.wrap;if("unpackAlpha"in t)this.unpackAlpha=t.unpackAlpha;if("flip"in t)this.flip=t.flip;if("shadowMap"in t)this.shadowMap=t.shadowMap;if("anisotropic"in t)this.anisotropic=t.anisotropic}else{t={}}if(!t.pixelFormat&&t.isFloatingPointTexture)this.pixelFormat=x.PFORMATSTR_RGBA32F;if(this.textureType==x.TYPE_DEPTH)this.pixelFormat=x.PFORMATSTR_DEPTH;this._cgl.profileData.profileTextureNew++;this.setFormat(x.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.profileData.addHeavyEvent("texture created",this.name,t.width+"x"+t.height);this.setSize(t.width,t.height);this.getInfoOneLine()}isFloatingPoint(){return x.isPixelFormatFloat(this.pixelFormat)}compareSettings(e){if(!e)return false;return e.width==this.width&&e.height==this.height&&e.filter==this.filter&&e.wrap==this.wrap&&e.textureType==this.textureType&&e.unpackAlpha==this.unpackAlpha&&e.anisotropic==this.anisotropic&&e.shadowMap==this.shadowMap&&e.texTarget==this.texTarget&&e.flip==this.flip}clone(){const e=new x(this._cgl,{name:this.name,filter:this.filter,anisotropic:this.anisotropic,wrap:this.wrap,textureType:this.textureType,pixelFormat:this.pixelFormat,unpackAlpha:this.unpackAlpha,flip:this.flip,width:this.width,height:this.height});this._cgl.profileData.addHeavyEvent("texture created",this.name,this.width+"x"+this.height);if(!this.compareSettings(e)){this._log.error("Cloned texture settings do not compare!");this._log.error(this);this._log.error(e)}return e}setFormat(e){this.pixelFormat=e.pixelFormat;this._glDataFormat=e.glDataFormat;this._glInternalFormat=e.glInternalFormat;this._glDataType=e.glDataType}setSize(e,t){if(this._cgl.aborted)return;if(e!=e||e<=0||!e)e=va;if(t!=t||t<=0||!t)t=va;if(e>this._cgl.maxTexSize||t>this._cgl.maxTexSize)this._log.error("texture size too big! "+e+"x"+t+" / max: "+this._cgl.maxTexSize);e=Math.min(e,this._cgl.maxTexSize);t=Math.min(t,this._cgl.maxTexSize);e=Math.floor(e);t=Math.floor(t);if(this.width==e&&this.height==t)return;e=this._cgl.checkTextureSize(e);t=this._cgl.checkTextureSize(t);this.width=e;this.height=t;this.deleted=false;this.setFormat(x.setUpGlPixelFormat(this._cgl,this.pixelFormat));this.shortInfoString=this.getInfoOneLine();this._cgl.gl.bindTexture(this.texTarget,this.tex);this._cgl.profileData.profileTextureResize++;const i=null;this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,e,t,0,this._glDataFormat,this._glDataType,i);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null)}initFromData(e,t,i,r,n){this.filter=r;this.wrap=n;if(r==undefined)this.filter=x.FILTER_LINEAR;if(n==undefined)this.wrap=x.WRAP_CLAMP_TO_EDGE;this.width=t;this.height=i;this._fromData=true;this.deleted=false;if(this.height>this._cgl.maxTexSize||this.width>this._cgl.maxTexSize){const s=CGL.Texture.getTempTexture(this._cgl);this.width=s.width;this.height=s.height;this.tex=s.tex;this._log.warn("[cgl_texture] texture size too big!",this.width,this.height,this._cgl.maxTexSize);return}if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flip);this._cgl.gl.bindTexture(this.texTarget,this.tex);this.setFormat(x.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,t,i,0,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();if(this.flip)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this._cgl.gl.bindTexture(this.texTarget,null)}updateMipMap(){if((this._cgl.glVersion==2||this.isPowerOfTwo())&&this.filter==x.FILTER_MIPMAP){this._cgl.gl.generateMipmap(this.texTarget);this._cgl.profileData.profileGenMipMap++}}initTexture(e,t=null){this._cgl.printError("before initTexture");this._cgl.checkFrameStarted("texture inittexture");this._fromData=false;this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha);if(e.width||e.videoWidth)this.width=e.videoWidth||e.width;if(e.height||e.videoHeight)this.height=e.videoHeight||e.height;if(t!==null)this.filter=t;if(e.height>this._cgl.maxTexSize||e.width>this._cgl.maxTexSize){const i=CGL.Texture.getTempTexture(this._cgl);this.width=i.width;this.height=i.height;this.tex=i.tex;this._log.warn("[cgl_texture] texture size too big!",e.width,e.height,this._cgl.maxTexSize);return}this._cgl.gl.bindTexture(this.texTarget,this.tex);this.deleted=false;this.flipped=!this.flip;if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,this.flipped);this.setFormat(x.setUpGlPixelFormat(this._cgl,this.pixelFormat));this._cgl.gl.texImage2D(this.texTarget,0,this._glInternalFormat,this._glDataFormat,this._glDataType,e);this._setFilter();this.updateMipMap();this._cgl.gl.bindTexture(this.texTarget,null);this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,false);if(this.flipped)this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_FLIP_Y_WEBGL,false);this.getInfoOneLine();this._cgl.printError("initTexture")}dispose(){this.delete()}delete(){if(this.loading){return}this.deleted=true;this.width=0;this.height=0;this._cgl.profileData.profileTextureDelete++;this._cgl.gl.deleteTexture(this.tex);this.image=null;this.tex=null}isPowerOfTwo(){return x.isPowerOfTwo(this.width)&&x.isPowerOfTwo(this.height)}printInfo(){xa.log(this.getInfo())}getInfoReadable(){const t=this.getInfo();let i="";t.name=t.name.substr(0,t.name.indexOf("?rnd="));for(const e in t){i+="* "+e+":  **"+t[e]+"**\n"}return i}getInfoOneLine(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;if(this.filter===x.FILTER_NEAREST)e+=" nearest";if(this.filter===x.FILTER_LINEAR)e+=" linear";if(this.filter===x.FILTER_MIPMAP)e+=" mipmap";if(this.wrap===x.WRAP_CLAMP_TO_EDGE)e+=" clamp";if(this.wrap===x.WRAP_REPEAT)e+=" repeat";if(this.wrap===x.WRAP_MIRRORED_REPEAT)e+=" repeatmir";this.shortInfoString=e;return e}getInfoOneLineShort(){let e=""+this.width+"x"+this.height;e+=" ";e+=this.pixelFormat;this.shortInfoString=e;return e}getInfo(){return x.getTexInfo(this)}_setFilter(){this._cgl.printError("before _setFilter");if(!this._fromData){this._cgl.gl.pixelStorei(this._cgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.unpackAlpha)}if(this.shadowMap){this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_MODE,this._cgl.gl.COMPARE_REF_TO_TEXTURE);this._cgl.gl.texParameteri(this._cgl.gl.TEXTURE_2D,this._cgl.gl.TEXTURE_COMPARE_FUNC,this._cgl.gl.LEQUAL)}if(this.textureType==x.TYPE_FLOAT&&this.filter==x.FILTER_MIPMAP){this.filter=x.FILTER_LINEAR;this._log.stack("texture: HDR and mipmap filtering at the same time is not possible")}if(this._cgl.glVersion==1&&!this.isPowerOfTwo()){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE);this.filter=x.FILTER_NEAREST;this.wrap=x.WRAP_CLAMP_TO_EDGE}else{if(this.wrap==x.WRAP_CLAMP_TO_EDGE){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.CLAMP_TO_EDGE);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.CLAMP_TO_EDGE)}else if(this.wrap==x.WRAP_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.REPEAT)}else if(this.wrap==x.WRAP_MIRRORED_REPEAT){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_S,this._cgl.gl.MIRRORED_REPEAT);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_WRAP_T,this._cgl.gl.MIRRORED_REPEAT)}if(this.filter==x.FILTER_NEAREST){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.NEAREST);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.NEAREST)}else if(this.filter==x.FILTER_LINEAR){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR)}else if(this.filter==x.FILTER_MIPMAP){this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MAG_FILTER,this._cgl.gl.LINEAR);this._cgl.gl.texParameteri(this.texTarget,this._cgl.gl.TEXTURE_MIN_FILTER,this._cgl.gl.LINEAR_MIPMAP_LINEAR)}else{this._log.log("unknown texture filter!",this.filter);throw new Error("unknown texture filter!"+this.filter)}if(this.anisotropic){const e=this._cgl.enableExtension("EXT_texture_filter_anisotropic");if(this._cgl.maxAnisotropic){const t=Math.min(this._cgl.maxAnisotropic,this.anisotropic);this._cgl.gl.texParameterf(this._cgl.gl.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}}}this.getInfoOneLine();this._cgl.printError("_setFilter")}}x.load=function(i,r,n,e){if(!r)return n({error:true});let s=null;if(!i.patch.loading.existByName(r))s=i.patch.loading.start("cgl.texture",r);const a=new x(i);a.name=r;a.image=new Image;a.image.crossOrigin="anonymous";a.loading=true;if(e&&e.hasOwnProperty("filter"))a.filter=e.filter;if(e&&e.hasOwnProperty("flip"))a.flip=e.flip;if(e&&e.hasOwnProperty("wrap"))a.wrap=e.wrap;if(e&&e.hasOwnProperty("anisotropic"))a.anisotropic=e.anisotropic;if(e&&e.hasOwnProperty("unpackAlpha"))a.unpackAlpha=e.unpackAlpha;if(e&&e.hasOwnProperty("pixelFormat"))a.pixelFormat=e.pixelFormat;a.image.onabort=a.image.onerror=e=>{console.warn("[cgl.texture.load] error loading texture",r,e);a.loading=false;if(s)i.patch.loading.finished(s);const t={error:true};if(n)n(t,a)};a.image.onload=function(e){i.addNextFrameOnceCallback(()=>{a.initTexture(a.image);if(s)i.patch.loading.finished(s);a.loading=false;if(n)n(null,a)})};a.image.src=r;return a};x.getTempTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.tempTexture)e.tempTexture=x.getTemporaryTexture(e,256,x.FILTER_LINEAR,x.REPEAT);return e.tempTexture};x.getErrorTexture=function(e){if(!e)console.error("[getTempTexture] no cgl!");if(!e.errorTexture)e.errorTexture=x.getTemporaryTexture(e,256,x.FILTER_LINEAR,x.REPEAT,1,.2,.2);return e.errorTexture};x.getEmptyTexture=function(e,t){if(t)return x.getEmptyTextureFloat(e);if(!e)console.error("[getEmptyTexture] no cgl!");if(e.tempTextureEmpty)return e.tempTextureEmpty;let i=8;e.tempTextureEmpty=new x(e,{name:"emptyTexture"});const r=x.getDefaultTextureData("empty",i);e.tempTextureEmpty.initFromData(r,i,i,x.FILTER_NEAREST,x.WRAP_REPEAT);return e.tempTextureEmpty};x.getEmptyTextureFloat=function(e){if(!e)console.error("[getEmptyTextureFloat] no cgl!");if(e.tempTextureEmptyFloat)return e.tempTextureEmptyFloat;e.tempTextureEmptyFloat=new x(e,{name:"emptyTexture",isFloatingPointTexture:true});const t=new Float32Array(8*8*4).fill(1);for(let e=0;e<8*8*4;e+=4)t[e+3]=0;e.tempTextureEmptyFloat.initFromData(t,8,8,x.FILTER_NEAREST,x.WRAP_REPEAT);return e.tempTextureEmptyFloat};x.getRandomTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.randomTexture)return e.randomTexture;const t=256;const i=x.getDefaultTextureData("randomUInt",t);e.randomTexture=new x(e);e.randomTexture.initFromData(i,t,t,x.FILTER_NEAREST,x.WRAP_REPEAT);return e.randomTexture};x.getRandomFloatTexture=function(e){if(!e)console.error("[getRandomTexture] no cgl!");if(e.getRandomFloatTexture)return e.getRandomFloatTexture;const t=256;const i=x.getDefaultTextureData("randomFloat",t);e.getRandomFloatTexture=new x(e,{isFloatingPointTexture:true});e.getRandomFloatTexture.initFromData(i,t,t,x.FILTER_NEAREST,x.WRAP_REPEAT);return e.getRandomFloatTexture};x.getBlackTexture=function(e){if(e.blackTexture)return e.blackTexture;const t=8;const i=x.getDefaultTextureData("color",t,{r:0,g:0,b:0});e.blackTexture=new x(e);e.blackTexture.initFromData(i,t,t,x.FILTER_NEAREST,x.WRAP_REPEAT);return e.blackTexture};x.getEmptyCubemapTexture=function(t){const i=[t.gl.TEXTURE_CUBE_MAP_POSITIVE_X,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,t.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z];const e=t.gl.createTexture();const r=t.gl.TEXTURE_CUBE_MAP;const n=x.FILTER_NEAREST;const s=x.WRAP_CLAMP_TO_EDGE;const a=8;const o=8;t.profileData.profileTextureNew++;t.gl.bindTexture(r,e);t.profileData.profileTextureResize++;for(let e=0;e<6;e+=1){const l=new Uint8Array(8*8*4);t.gl.texImage2D(i[e],0,t.gl.RGBA,8,8,0,t.gl.RGBA,t.gl.UNSIGNED_BYTE,l);t.gl.texParameteri(r,t.gl.TEXTURE_MAG_FILTER,t.gl.NEAREST);t.gl.texParameteri(r,t.gl.TEXTURE_MIN_FILTER,t.gl.NEAREST);t.gl.texParameteri(r,t.gl.TEXTURE_WRAP_S,t.gl.CLAMP_TO_EDGE);t.gl.texParameteri(r,t.gl.TEXTURE_WRAP_T,t.gl.CLAMP_TO_EDGE)}t.gl.bindTexture(r,null);return{id:A.utils.uuid(),tex:e,cubemap:e,width:a,height:o,filter:n,wrap:s,unpackAlpha:true,flip:true,_fromData:true,name:"emptyCubemapTexture",anisotropic:0}};x.getTempGradientTexture=function(e){if(!e)console.error("[getTempGradientTexture] no cgl!");return x.getTempTexture(e)};x.getTemporaryTexture=function(e,t,i,r,n,s,a){const o=x.getDefaultTextureData("stripes",256,{r:n,g:s,b:a});const l=new x(e);l.initFromData(o,t,t,i,r);return l};x.createFromImage=function(e,t,i){i=i||{};const r=new x(e,i);r.flip=false;r.image=t;r.width=t.videoWidth||t.width||8;r.height=t.videoHeight||t.height||8;if(i.hasOwnProperty("wrap"))r.wrap=i.wrap;r.initTexture(t,i.filter);return r};x.fromImage=function(e,t,i,r){console.error("deprecated texture from image...");const n=new x(e);n.flip=false;if(i)n.filter=i;if(r)n.wrap=r;n.image=t;n.initTexture(t);return n};x.isPowerOfTwo=function(e){return e==1||e==2||e==4||e==8||e==16||e==32||e==64||e==128||e==256||e==512||e==1024||e==2048||e==4096||e==8192||e==16384};x.getTexInfo=function(e){const t={};t.name=e.name;t["power of two"]=e.isPowerOfTwo();t.size=e.width+" x "+e.height;let i=e.texTarget;if(e.texTarget==e._cgl.gl.TEXTURE_2D)i="TEXTURE_2D";t.target=i;t.unpackAlpha=e.unpackAlpha;if(e.cubemap)t.cubemap=true;if(e.textureType==x.TYPE_FLOAT)t.textureType="TYPE_FLOAT";if(e.textureType==x.TYPE_HALF_FLOAT)t.textureType="TYPE_HALF_FLOAT";else if(e.textureType==x.TYPE_DEPTH)t.textureType="TYPE_DEPTH";else if(e.textureType==x.TYPE_DEFAULT)t.textureType="TYPE_DEFAULT";else t.textureType="UNKNOWN "+this.textureType;if(e.wrap==x.WRAP_CLAMP_TO_EDGE)t.wrap="CLAMP_TO_EDGE";else if(e.wrap==x.WRAP_REPEAT)t.wrap="WRAP_REPEAT";else if(e.wrap==x.WRAP_MIRRORED_REPEAT)t.wrap="WRAP_MIRRORED_REPEAT";else t.wrap="UNKNOWN";if(e.filter==x.FILTER_NEAREST)t.filter="FILTER_NEAREST";else if(e.filter==x.FILTER_LINEAR)t.filter="FILTER_LINEAR";else if(e.filter==x.FILTER_MIPMAP)t.filter="FILTER_MIPMAP";else t.filter="UNKNOWN";t.pixelFormat=e.pixelFormat||"unknown";return t};x.setUpGlPixelFormat=function(e,t){const i={};if(!t){e._log.error("no pixelformatstr!");e._log.log(new Error);t=x.PFORMATSTR_RGBA8UB}i.pixelFormatBase=t;i.pixelFormat=t;i.glDataType=e.gl.UNSIGNED_BYTE;i.glInternalFormat=e.gl.RGBA8;i.glDataFormat=e.gl.RGBA;let r=e.gl.FLOAT;if(e.glUseHalfFloatTex){if(t==x.PFORMATSTR_RGBA32F)t=x.PFORMATSTR_RGBA16F;if(t==x.PFORMATSTR_RG32F)t=x.PFORMATSTR_RG16F;if(t==x.PFORMATSTR_R32F)t=x.PFORMATSTR_R16F}if(t.includes("16bit")){if(e.glVersion==2){const n=e.enableExtension("EXT_color_buffer_half_float");if(!n){console.warn("no 16bit extension, fallback to 32bit",t);if(t==x.PFORMATSTR_RGBA16F)t=x.PFORMATSTR_RGBA32F;if(t==x.PFORMATSTR_RGB16F)t=x.PFORMATSTR_RGB32F;if(t==x.PFORMATSTR_RG16F)t=x.PFORMATSTR_RG32F;if(t==x.PFORMATSTR_R16F)t=x.PFORMATSTR_R32F}else{r=e.gl.HALF_FLOAT}}}if(e.glVersion==1){i.glInternalFormat=e.gl.RGBA;if(t==x.PFORMATSTR_RGBA16F||t==x.PFORMATSTR_RG16F||t==x.PFORMATSTR_R16F){const s=e.enableExtension("OES_texture_half_float");if(!s)throw new Error("no half float texture extension");r=s.HALF_FLOAT_OES}}if(t==x.PFORMATSTR_RGBA8UB){}else if(t==x.PFORMATSTR_RGB565){i.glInternalFormat=e.gl.RGB565;i.glDataFormat=e.gl.RGB}else if(t==x.PFORMATSTR_R8UB){i.glInternalFormat=e.gl.R8;i.glDataFormat=e.gl.RED}else if(t==x.PFORMATSTR_RG8UB){i.glInternalFormat=e.gl.RG8;i.glDataFormat=e.gl.RG}else if(t==x.PFORMATSTR_RGB8UB){i.glInternalFormat=e.gl.RGB8;i.glDataFormat=e.gl.RGB}else if(t==x.PFORMATSTR_SRGBA8){i.glInternalFormat=e.gl.SRGB8_ALPHA8}else if(t==x.PFORMATSTR_R32F){i.glInternalFormat=e.gl.R32F;i.glDataFormat=e.gl.RED;i.glDataType=r}else if(t==x.PFORMATSTR_R16F){i.glInternalFormat=e.gl.R16F;i.glDataType=r;i.glDataFormat=e.gl.RED}else if(t==x.PFORMATSTR_RG16F){i.glInternalFormat=e.gl.RG16F;i.glDataType=r;i.glDataFormat=e.gl.RG}else if(t==x.PFORMATSTR_RGBA16F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA16F;i.glDataType=r}else if(t==x.PFORMATSTR_R11FG11FB10F){i.glInternalFormat=e.gl.R11F_G11F_B10F;i.glDataType=r;i.glDataFormat=e.gl.RGB}else if(t==x.PFORMATSTR_RGBA32F){if(e.glVersion==1)i.glInternalFormat=e.gl.RGBA;else i.glInternalFormat=e.gl.RGBA32F;i.glDataType=r}else if(t==x.PFORMATSTR_DEPTH){if(e.glVersion==1){i.glInternalFormat=e.gl.DEPTH_COMPONENT;i.glDataType=e.gl.UNSIGNED_SHORT;i.glDataFormat=e.gl.DEPTH_COMPONENT}else{i.glInternalFormat=e.gl.DEPTH_COMPONENT32F;i.glDataType=e.gl.FLOAT;i.glDataFormat=e.gl.DEPTH_COMPONENT}}else{xa.log("unknown pixelformat ",t)}if(t.includes("32bit")||t==x.PFORMATSTR_R11FG11FB10F){if(e.glVersion==2)e.enableExtension("EXT_color_buffer_float");if(e.glVersion==2)e.enableExtension("EXT_float_blend");e.enableExtension("OES_texture_float_linear")}i.numColorChannels=x.getPixelFormatNumChannels(t);if(!i.glDataType||!i.glInternalFormat||!i.glDataFormat)xa.log("pixelformat wrong ?!",t,i.glDataType,i.glInternalFormat,i.glDataFormat,this);return i};x.getPixelFormatNumChannels=e=>{if(e.startsWith("RGBA"))return 4;if(e.startsWith("RGB"))return 3;if(e.startsWith("RG"))return 2;return 1};x.isPixelFormatFloat=e=>{return(e||"").includes("float")};x.isPixelFormatHalfFloat=e=>{return(e||"").includes("float")&&(e||"").includes("16bit")};A.Op.prototype.outTexture=function(e,t){const i=this.addOutPort(new A.Port(this,e,A.Port.TYPE_OBJECT,{preview:true,objType:"texture",display:"texture"}));if(t!==undefined)i.setRef(t||x.getEmptyTexture(this.patch.cgl));i.ignoreValueSerialize=true;return i};class Ea{constructor(t,e,i,r){this._log=new h.Logger("cgl_framebuffer2");if(t.glVersion==1)this._log.error("framebuffer2 used on webgl1");this.Framebuffer2DrawTargetsDefault=null;this.Framebuffer2BlittingFramebuffer=null;this.Framebuffer2FinalFramebuffer=null;this._cgl=t;this._cgl.printError("before framebuffer2 constructor");this._width=0;this._height=0;this.valid=true;this._depthRenderbuffer=null;this._frameBuffer=null;this._textureFrameBuffer=null;this._colorRenderbuffers=[];this._drawTargetArray=[];this._disposed=false;if(!this.Framebuffer2BlittingFramebuffer)this.Framebuffer2BlittingFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2FinalFramebuffer)this.Framebuffer2FinalFramebuffer=t.gl.createFramebuffer();if(!this.Framebuffer2DrawTargetsDefault)this.Framebuffer2DrawTargetsDefault=[t.gl.COLOR_ATTACHMENT0];this._options=r||{isFloatingPointTexture:false};this.name=this._options.name||"unknown";this._cgl.profileData.addHeavyEvent("framebuffer create",this.name);if(!this._options.hasOwnProperty("numRenderBuffers"))this._options.numRenderBuffers=1;if(!this._options.hasOwnProperty("depth"))this._options.depth=true;if(!this._options.hasOwnProperty("clear"))this._options.clear=true;if(!this._options.hasOwnProperty("multisampling")){this._options.multisampling=false;this._options.multisamplingSamples=0}if(this._options.multisamplingSamples){if(this._cgl.glSlowRenderer)this._options.multisamplingSamples=0;if(!this._cgl.gl.MAX_SAMPLES)this._options.multisamplingSamples=0;else this._options.multisamplingSamples=Math.min(this._cgl.maxSamples,this._options.multisamplingSamples)}if(!this._options.hasOwnProperty("filter"))this._options.filter=x.FILTER_LINEAR;if(!this._options.hasOwnProperty("wrap"))this._options.wrap=x.WRAP_REPEAT;this._numRenderBuffers=this._options.numRenderBuffers;this._colorTextures=[];this.clearColors=[];for(let e=0;e<this._numRenderBuffers;e++)this.clearColors.push([0,0,0,1]);if(!r.pixelFormat){if(r.isFloatingPointTexture)this._options.pixelFormat=x.PFORMATSTR_RGBA32F;else this._options.pixelFormat=x.PFORMATSTR_RGBA8UB}for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e]=new x(t,{name:"fb2 "+this.name+" "+e,isFloatingPointTexture:this._options.isFloatingPointTexture,anisotropic:this._options.anisotropic||0,pixelFormat:this._options.pixelFormat,filter:this._options.filter,wrap:this._options.wrap})}let n=x.FILTER_NEAREST;if(this._options.shadowMap)n=x.FILTER_LINEAR;const s=512;if(this._options.depth){this._textureDepth=new x(t,{name:"fb2 depth "+this.name,isDepthTexture:true,filter:n,shadowMap:this._options.shadowMap||false,width:e||s,height:i||s})}if(t.aborted)return;this.setSize(e||s,i||s);this._cgl.printError("framebuffer2 constructor")}getWidth(){return this._width}getHeight(){return this._height}getGlFrameBuffer(){return this._frameBuffer}getDepthRenderBuffer(){return this._depthRenderbuffer}getTextureColor(){return this._colorTextures[0]}getTextureColorNum(e){return this._colorTextures[e]}getTextureDepth(){return this._textureDepth}setFilter(t){for(let e=0;e<this._numRenderBuffers;e++){this._colorTextures[e].filter=t;this._colorTextures[e].setSize(this._width,this._height)}}delete(){this.dispose()}dispose(){this._disposed=true;let e=0;for(e=0;e<this._numRenderBuffers;e++)this._colorTextures[e].delete();if(this._textureDepth)this._textureDepth.delete();for(e=0;e<this._numRenderBuffers;e++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[e]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}setSize(e,t){if(this._disposed)return this._log.warn("disposed framebuffer setsize...");this._cgl.profileData.addHeavyEvent("framebuffer resize",this.name);let i=0;this._width=this._cgl.checkTextureSize(e);this._height=this._cgl.checkTextureSize(t);this._cgl.profileData.profileFrameBuffercreate++;if(this._frameBuffer){for(i=0;i<this._numRenderBuffers;i++)this._cgl.gl.deleteRenderbuffer(this._colorRenderbuffers[i]);this._cgl.gl.deleteRenderbuffer(this._depthRenderbuffer);this._cgl.gl.deleteFramebuffer(this._frameBuffer);this._cgl.gl.deleteFramebuffer(this._textureFrameBuffer)}this._frameBuffer=this._cgl.gl.createFramebuffer();this._textureFrameBuffer=this._cgl.gl.createFramebuffer();const r=this._options.depth;for(i=0;i<this._numRenderBuffers;i++){this._colorTextures[i].setSize(this._width,this._height)}for(i=0;i<this._numRenderBuffers;i++){const a=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,a);const o=x.setUpGlPixelFormat(this._cgl,this._options.pixelFormat);let e=o.glInternalFormat;if(CGL.Texture.isPixelFormatHalfFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._options.filter=x.FILTER_NEAREST;this.setFilter(this._options.filter)}}else if(CGL.Texture.isPixelFormatFloat(o.pixelFormat)){if(!this._cgl.enableExtension("OES_texture_float_linear")){this._log.warn("no linear pixelformat,using nearest");this._options.filter=x.FILTER_NEAREST;this.setFilter(this._options.filter)}}if(this._options.multisampling&&this._options.multisamplingSamples){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,e,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,e,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.RENDERBUFFER,a);this._colorRenderbuffers[i]=a}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._textureFrameBuffer);for(i=0;i<this._numRenderBuffers;i++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+i,this._cgl.gl.TEXTURE_2D,this._colorTextures[i].tex,0)}if(this._options.depth){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0)}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);let n=this._cgl.gl.DEPTH_COMPONENT32F;if(this._cgl.glSlowRenderer)n=this._cgl.gl.DEPTH_COMPONENT16;if(r){this._textureDepth.setSize(this._width,this._height);this._depthRenderbuffer=this._cgl.gl.createRenderbuffer();this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);if(this._options.isFloatingPointTexture){if(this._options.multisampling)this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,n,this._width,this._height);else this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,n,this._width,this._height)}else if(this._options.multisampling){this._cgl.gl.renderbufferStorageMultisample(this._cgl.gl.RENDERBUFFER,this._options.multisamplingSamples,n,this._width,this._height)}else{this._cgl.gl.renderbufferStorage(this._cgl.gl.RENDERBUFFER,n,this._width,this._height)}this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer)}this._drawTargetArray.length=0;for(i=0;i<this._numRenderBuffers;i++)this._drawTargetArray.push(this._cgl.gl.COLOR_ATTACHMENT0+i);if(!this._cgl.gl.isFramebuffer(this._textureFrameBuffer))this._log.warn("invalid framebuffer");const s=this._cgl.gl.checkFramebufferStatus(this._cgl.gl.FRAMEBUFFER);if(s!=this._cgl.gl.FRAMEBUFFER_COMPLETE){this._log.error("framebuffer incomplete: "+this.name,this);this._log.log("options",this._options);this._log.log("options pixelformat",this._options.pixelFormat);switch(s){case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_ATTACHMENT...",this);throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:this._log.warn("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case this._cgl.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:this._log.warn("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case this._cgl.gl.FRAMEBUFFER_UNSUPPORTED:this._log.warn("FRAMEBUFFER_UNSUPPORTED");throw new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:this.valid=false;this._log.error("incomplete framebuffer",s,this._frameBuffer);this._cgl.printError();this._frameBuffer=null;throw new Error("Incomplete framebuffer: "+s)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindRenderbuffer(this._cgl.gl.RENDERBUFFER,null)}renderStart(){if(this._disposed)return this._log.warn("disposed framebuffer renderStart...");this._cgl.checkFrameStarted("fb2 renderstart");this._cgl.pushModelMatrix();this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.pushGlFrameBuffer(this._frameBuffer);this._cgl.pushFrameBuffer(this);this._cgl.pushPMatrix();this._cgl.pushViewPort(0,0,this._width,this._height);this._cgl.gl.drawBuffers(this._drawTargetArray);if(this._options.clear){this._cgl.gl.clearColor(0,0,0,0);this._cgl.gl.clear(this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT)}}clear(){if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer)}else this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._frameBuffer);this._cgl.gl.drawBuffers(this._drawTargetArray);for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0+e,this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex,0);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,e,this.clearColors[e])}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null)}renderEnd(){if(this._disposed)return this._log.warn("disposed framebuffer renderEnd...");this._cgl.popPMatrix();this._cgl.profileData.profileFramebuffer++;if(this._numRenderBuffers<=1){this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this._frameBuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this._textureFrameBuffer);this._cgl.gl.clearBufferfv(this._cgl.gl.COLOR,0,[0,0,0,1]);this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,this._cgl.gl.COLOR_BUFFER_BIT|this._cgl.gl.DEPTH_BUFFER_BIT,this._cgl.gl.NEAREST)}else{this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.RENDERBUFFER,this._depthRenderbuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.DEPTH_ATTACHMENT,this._cgl.gl.TEXTURE_2D,this._textureDepth.tex,0);for(let t=0;t<this._numRenderBuffers;t++){this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.framebufferRenderbuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.RENDERBUFFER,this._colorRenderbuffers[t]);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);this._cgl.gl.framebufferTexture2D(this._cgl.gl.FRAMEBUFFER,this._cgl.gl.COLOR_ATTACHMENT0,this._cgl.gl.TEXTURE_2D,this._colorTextures[t].tex,0);this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,null);this._cgl.gl.bindFramebuffer(this._cgl.gl.READ_FRAMEBUFFER,this.Framebuffer2BlittingFramebuffer);this._cgl.gl.bindFramebuffer(this._cgl.gl.DRAW_FRAMEBUFFER,this.Framebuffer2FinalFramebuffer);let e=this._cgl.gl.COLOR_BUFFER_BIT;if(t==0)e|=this._cgl.gl.DEPTH_BUFFER_BIT;this._cgl.gl.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,e,this._cgl.gl.NEAREST)}}this._cgl.gl.bindFramebuffer(this._cgl.gl.FRAMEBUFFER,this._cgl.popGlFrameBuffer());this._cgl.popFrameBuffer();this._cgl.popModelMatrix();this._cgl.popViewPort();if(this._colorTextures[0].filter==x.FILTER_MIPMAP){for(let e=0;e<this._numRenderBuffers;e++){this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,this._colorTextures[e].tex);this._colorTextures[e].updateMipMap();this._cgl.gl.bindTexture(this._cgl.gl.TEXTURE_2D,null)}}}}const Aa=function(e){this.draw=function(e,t,i){}};const Ta=function(e){this.render=function(e,t){}};const Oa=function(e){this.render=function(e,t,i,r){}};class Ia{constructor(e){this.shader=new CGL.Shader(e,"markermaterial");const t="".endl()+"void main()".endl()+"{".endl()+"    outColor = vec4(color.rgb,1.0);".endl()+"}";const i="".endl()+"IN vec3 vPosition;".endl()+"UNI mat4 projMatrix;".endl()+"UNI mat4 mvMatrix;".endl()+"void main()".endl()+"{".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(vPosition,1.0);".endl()+"}";this.shader.setSource(i,t);this.coloruni=this.shader.addUniformFrag("4f","color",[1,.777,1,1])}setColor(e,t,i,r){this.coloruni.set(e,t,i,r)}}const Sa=Math.PI/180;const Ma=180/Math.PI;const Ca=null;const Ra=window.navigator.userAgent.includes("Windows");const Na=function(t){let i;if(t.wheelDelta){i=t.wheelDelta%120-0==-0?t.wheelDelta/120:t.wheelDelta/30;i*=-1.5;if(Ra)i*=2}else{let e=t.deltaY;if(t.shiftKey)e=t.deltaX;const r=e||t.detail;i=-(r%3?r*10:r/3);i*=-3}if(i>20)i=20;if(i<-20)i=-20;return i};const ya=Na;const Pa=Na;const E={Framebuffer2:Ea,Geometry:c,BoundingBox:i,Marker:Aa,WirePoint:Ta,WireCube:Oa,MatrixStack:a,Mesh:fa,MESH:I,ShaderLibMods:ga,Shader:v,Uniform:m,MESHES:p,getWheelSpeed:ya,getWheelDelta:Pa,Context:ba,Texture:x,TextureEffect:b,onLoadingAssetsFinished:Ca,ProfileData:ta,UniColorShader:Ia,...d.BLEND_MODES,...d.SHADER,...d.MATH,...d.BLEND_MODES};window.CABLES=window.CABLES||{};window.CABLES.CGL={...window.CABLES.CGL,...E};window.CGL={...window.CGL,...E};window.cgInitialized=false;window.addEventListener("INIT_CG",e=>{if(window.cgInitialized&&!CABLES.UI)return;window.cgInitialized=true;const t=new ba(e.detail)});A.Anim.slerpQuaternion=function(e,t,i,r,n,s){if(!A.Anim.slerpQuaternion.q1){A.Anim.slerpQuaternion.q1=quat.create();A.Anim.slerpQuaternion.q2=quat.create()}const a=i.getKeyIndex(e);let o=a+1;if(o>=i.keys.length)o=i.keys.length-1;if(a==o){quat.set(t,i.keys[a].value,r.keys[a].value,n.keys[a].value,s.keys[a].value)}else{const l=i.keys[a].time;const u=i.keys[o].time;const h=(e-l)/(u-l);quat.set(A.Anim.slerpQuaternion.q1,i.keys[a].value,r.keys[a].value,n.keys[a].value,s.keys[a].value);quat.set(A.Anim.slerpQuaternion.q2,i.keys[o].value,r.keys[o].value,n.keys[o].value,s.keys[o].value);quat.slerp(t,A.Anim.slerpQuaternion.q1,A.Anim.slerpQuaternion.q2,h)}return t};class La{constructor(e,t,i){this.cgl=e;this._options=i;this.fb=null;let r=i.shader;this._useDefaultShader=true;if(i.shader)this._useDefaultShader=false;i.numRenderBuffers=i.numRenderBuffers||1;if(!r){r="".endl()+"IN vec2 texCoord;";for(let e=0;e<i.numRenderBuffers;e++){r=r.endl()+"UNI sampler2D tex"+e+";".endl()}r=r.endl()+"void main()".endl()+"{";if(i.numRenderBuffers==1){r=r.endl()+"    outColor= texture(tex0,texCoord);".endl()}else for(let e=0;e<i.numRenderBuffers;e++){r=r.endl()+"outColor"+e+" = texture(tex"+e+",texCoord);".endl()}r=r.endl()+"}"}const n=i.vertexShader||"".endl()+"IN vec3 vPosition;".endl()+"IN vec2 attrTexCoord;".endl()+"OUT vec2 texCoord;".endl()+"void main()".endl()+"{".endl()+"   texCoord=attrTexCoord;".endl()+"   gl_Position = vec4(vPosition,  1.0);".endl()+"}";this.bgShader=new E.Shader(e,"corelib copytexture "+t);this.bgShader.setSource(n,r);if(!i.vertexShader)this.bgShader.ignoreMissingUniforms=true;new E.Uniform(this.bgShader,"t","tex",0);new E.Uniform(this.bgShader,"t","tex1",1);new E.Uniform(this.bgShader,"t","tex2",2);new E.Uniform(this.bgShader,"t","tex3",3);this.mesh=E.MESHES.getSimpleRect(this.cgl,"texEffectRect")}setSize(e,t){this._options.width=e;this._options.height=t}copy(e,t,i,r,n){const s=this.cgl;if(!e)e=E.Texture.getEmptyTexture(this.cgl);let a=this._options.width||e.width,o=this._options.height||e.height;if(this.fb){if(a<=0)a=8;if(o<=0)o=8;if(this.fb.getWidth()!=a||this.fb.getHeight()!=o)this.fb.setSize(a,o)}else{let e=E.Texture.FILTER_LINEAR;let t=E.Texture.WRAP_CLAMP_TO_EDGE;if(this._options.isFloatingPointTexture)e=E.Texture.FILTER_NEAREST;if(this._options.hasOwnProperty("filter"))e=this._options.filter;if(this._options.hasOwnProperty("wrap"))t=this._options.wrap;const l={isFloatingPointTexture:this._options.isFloatingPointTexture,pixelFormat:this._options.pixelFormat,numRenderBuffers:this._options.numRenderBuffers||1,filter:e,wrap:t};if(s.glVersion==1)this.fb=new E.Framebuffer(s,a,o,l);else this.fb=new E.Framebuffer2(s,a,o,l)}s.tempData.renderOffscreen=true;this.fb.renderStart(s);s.setTexture(0,e.tex);if(t)s.setTexture(1,t.tex);if(i)s.setTexture(2,i.tex);if(r)s.setTexture(3,r.tex);if(n)s.setTexture(4,n.tex);s.pushShader(this.bgShader);this.mesh.render(this.bgShader);s.popShader();this.fb.renderEnd();s.tempData.renderOffscreen=false;return this.fb.getTextureColor()}dispose(){if(this.fb)this.fb.dispose();if(this.bgShader)this.bgShader.dispose();if(this.mesh)this.mesh.dispose()}}})();var e=CGL=typeof CGL==="undefined"?{}:CGL;for(var t in Fa)e[t]=Fa[t];if(Fa.__esModule)Object.defineProperty(e,"__esModule",{value:true})})();